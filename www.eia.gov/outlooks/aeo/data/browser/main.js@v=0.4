/**
 * @license RequireJS text 2.0.10 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*
 RequireJS order 1.0.5 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

define("page",["classy","kizzy","signals","hasher","loadmask","json2"],function(e,t,n,r){return e.$extend({__init__:function(e){this.name=e,this.settings=t(this.name),this.loadSignal=new n.Signal,this.unloadSignal=new n.Signal},load:function(e){this.settings.clearExpireds(),this.$class.pushRequest(e),this.loadSignal.dispatch(e),this.isLoaded=!0},unload:function(){this.settings.clearExpireds(),this.unloadSignal.dispatch(),this.isLoaded=!1},toString:function(){return"[Page "+this.name+"]"},__classvars__:{requests:[],setHash:function(e){r.setHash(e)},showLoadMask:function(e,t){t=t||$("#pagecontent"),e='<span class="loading">'+(e||this.LOADING_MESSAGE)+"</span>",t.mask(e)},hideLoadMask:function(e){e=e||$("#pagecontent"),e.unmask()},pushRequest:function(e){this.requests.length>=10&&this.requests.shift(),this.requests.push(e)},errorHandler:function(e,t){var n=$("#pagecontent");if(e&&t){var r=this.generateErrorJSON(e);$.ajax({url:t,type:"POST",data:{json:r}})}var i='An error has occurred, and has been logged.  </br>If refreshing the page does not solve the issue, </br>try returning to the <a href="./">main page</a> and making</br> another selection';n.mask(i)},clearErrorMessage:function(){var e=$("#pagecontent");e.unmask()},generateErrorJSON:function(e){return JSON.stringify($.extend(!0,{},e,{browser:$.browser,requests:this.requests}))},LOADING_MESSAGE:"Loading..."}})}),define("text",["module"],function(e){var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.10",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}d.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("ï»¿")===0&&(i=i.substring(1)),t(i)}catch(s){r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!status.json",[],function(){return'{"debug": true}'}),define("js/Facade",["puremvc","text!status.json","json2"],function(e,t){var n=JSON.parse(t);return e.Facade.$extend({sendNotification:function(e,t,r){Date.now=Date.now||function(){return+(new Date)},console.log(Date.now()+" : "+e+(r?" : "+r:""));try{this.$super(e,t,r)}catch(i){typeof console!="undefined"&&typeof console.log=="function"&&(console.log("ERROR: "+i.name+" : "+i.message),console.log(i.stack));if(n.debug)throw i;this.$super(this.$class.ERROR,i,e)}},__classvars__:{STARTUP:"startup",RELOAD:"reload",UNLOAD:"unload",PARAMETER_PROXY_UPDATED:"parameterProxyUpdated",TABLE_RENDERED:"tableRendered",UPDATE_VISUALIZATION_VIEW_STACK:"updateVisualizationViewStack",TABLEDATA_UPDATED:"tableDataUpdated",CHART_DATA_UPDATED:"chartDataUpdated",DEFAULT_CHART_SET:"defaultChartSet",MAP_DATA_UPDATED:"mapDataUpdated",CSV_DATA_GENERATED:"csvDownloadDataGenerated",TIME_PERIOD_PARAM_UPDATED:"timePeriodParamUpdated",FREQUENCY_PARAM_UPDATED:"frequencyParamUpdated",CASE_PARAM_UPDATED:"caseParamUpdated",TABLE_PARAMS_UPDATED:"tableParamsUpdated",CHART_PARAMS_UPDATED:"chartParamsUpdated",CTYPE_PARAM_UPDATED:"ctypeParamUpdated",REGION_PARAM_UPDATED:"regionParamUpdated",MAP_TYPE_PARAM_UPDATED:"mapTypeParamUpdated",PIN_SOURCEKEY_PARAM_UPDATED:"pinSourcekeyParamUpdated",TABLE_SELECTION_CHANGED:"tableSelectionChanged",TIME_SELECTION_UPDATED:"timeSelectionUpdated",CASE_SELECTION_CHANGED:"caseSelectionChanged",FREQUENCY_SELECTION_UPDATED:"frequencySelectionUpdated",CHART_SELECTION_UPDATED:"chartSelectionUpdated",REGION_SELECTION_UPDATED:"regionSelectionUpdated",MAP_TYPE_SELECTION_UPDATED:"mapTypeSelectionUpdated",DOWNLOAD_OPTION_SELECTED:"downloadOptionSelected",PIN_SOURCEKEY_SELECTED:"pinSourcekeySelected",SOURCE_KEY_SELECTED:"sourcekeySelected",ERROR:"error"}})}),define("js/model/ConfigProxy",["puremvc","text!configJSON","json2"],function(e,t){var n=JSON.parse(t);return e.Proxy.$extend({topicMap:null,__init__:function(){var e=this;this.$super(this.$class.NAME,n)},getStudies:function(){return this.getData().studies},getVisualizations:function(){return this.getData().visualizations},setVisualizations:function(e){this.getData().visualizations=e},setDownloadParameters:function(e){this.getData().downloadParameters=e},getDownloadParameters:function(){return this.getData().downloadParameters},getDefaultFrequency:function(){return"A"},getValidFrequencies:function(){return["A","Q"]},getDefaultStart:function(e){return e.start},getDefaultEnd:function(e){return e.end},__classvars__:{NAME:"ConfigProxy"}})}),define("js/model/RequestProxy",["puremvc"],function(e){return e.Proxy.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},getQuery:function(){return this.getData().query},getSelectedTable:function(){return this.getQuery().id},getSelectedCase:function(){return this.getQuery().cases},getFrequency:function(){return this.getQuery().f},getStartPeriod:function(){return this.getQuery().start},getEndPeriod:function(){return this.getQuery().end},__classvars__:{NAME:"RequestProxy"}})}),define("js/model/ParameterProxy",["puremvc","js/Facade","js/model/ConfigProxy","js/model/RequestProxy","text!defaults","json2"],function(e,t,n,r,i){var s=JSON.parse(i);return e.Proxy.$extend({__init__:function(){this.$super(this.$class.NAME,{query:$.extend({},s)})},getQuery:function(){return this.getData().query},getQueryKeys:function(){return["id","region","cases","start","end","f","linechart","map","ctype","chartindexed","maptype","columnvalues","sid","sourcekey"]},getConfig:function(){var e=this.facade.retrieveProxy(n.NAME);return e.getData()},getQueryString:function(e){var t=$.extend({},this.getQuery(),e),n="?",r=this.getQueryKeys(),i,s;for(i=0;i<r.length;i++)s=r[i],t.hasOwnProperty(s)&&(n+=s+"="+t[s]+"&");return n.substring(0,n.length-1)},update:function(e){this.note=e;var n=this.facade.retrieveProxy(r.NAME),i=!1,s=typeof n.getSelectedTable()=="undefined",o=typeof n.getSelectedCase()=="undefined",u=typeof n.getFrequency()=="undefined",a=typeof n.getStartPeriod()=="undefined"||typeof n.getEndPeriod()=="undefined",f=!("region"in n.getQuery())&&this.hasRegions(this.getSelectedTable()),l=!("ctype"in n.getQuery()),c=!1,h=!1,p=!1;this.updateQuery(n.getQuery(),function(e,t,n){i=!0,s|=e=="id",o|=e=="cases",u|=e=="f",a|=e=="start"||e=="end",$.each(["linechart","map","sid"],function(t,n){h|=e==n}),l|=e=="ctype",h|=e=="chartindexed",f|=e=="region",c|=e=="maptype",h|=e=="columnvalues",p|=e=="sourcekey"}),i&&this.sendNotification(t.PARAMETER_PROXY_UPDATED),s|=o||f,h|=l,s&&this.sendNotification(t.TABLE_PARAMS_UPDATED),l&&(this.sendNotification(t.UPDATE_VISUALIZATION_VIEW_STACK),this.sendNotification(t.CTYPE_PARAM_UPDATED)),o&&this.sendNotification(t.CASE_PARAM_UPDATED),u&&this.sendNotification(t.FREQUENCY_PARAM_UPDATED),a&&this.sendNotification(t.TIME_PERIOD_PARAM_UPDATED),h&&this.sendNotification(t.CHART_PARAMS_UPDATED),f&&this.sendNotification(t.REGION_PARAM_UPDATED),c&&this.sendNotification(t.MAP_TYPE_PARAM_UPDATED),p&&this.sendNotification(t.PIN_SOURCEKEY_PARAM_UPDATED)},copyQuery:function(e,t,n,r){var i={},s={},o,u;for(o in t)t.hasOwnProperty(o)&&(u=o.toLowerCase(),e[u]=t[o],n[u]!=t[o]?i[u]=o:s[u]=o);for(u in n)n.hasOwnProperty(u)&&!(u in i)&&!(u in s)&&(e[u]=void 0,i[u]=u);for(u in i)i.hasOwnProperty(u)&&r.call(this,u,e[u],n[u])},updateQuery:function(e,t){var n={};this.copyQuery(n,e,this.getQuery(),t),this.validateQuery(n),$.extend(this.getData(),{query:n})},checkVal:function(e,t,n,r){e[t]=e[t]!==void 0&&(r?r(e[t]):!0)?e[t]:n},validateQuery:function(e){this.validateId(e),this.validateFrequency(e),this.validateStartEnd(e)},validateFrequency:function(e){var t=this.facade.retrieveProxy(n.NAME),r=t.getDefaultFrequency();this.checkVal(e,"f",r,function(e){return $.inArray(e,t.getValidFrequencies())>-1})},validateStartEnd:function(e){var t=this.facade.retrieveProxy(n.NAME);e.start=parseInt(e.start),e.end=parseInt(e.end);var r=t.getDefaultStart(this.getTableById(e.id)),i=t.getDefaultEnd(this.getTableById(e.id));this.checkVal(e,"start",r,function(e){return e>=r&&e<=i}),this.checkVal(e,"end",i,function(t){return t>e.start&&t<=i})},validateId:function(e){var t=this.facade.retrieveProxy(n.NAME),r=s.id,i=t.getStudies(),o=!1,u=!1,a=!1,f,l,c,h;this.checkVal(e,"id",r,function(e){l=e.split("-")[1];for(var t=0;t<i.length;t++)if(i[t].id==l){f=i[t],o=!0;for(var n=0;n<f.tables.length;n++)if(f.tables[n].id==e)return c=f.tables[n],u=!0,!0}return!1}),o?u||(c=f.tables[0],e.id=c.id):(c=this.getTableById(s.id),f=this.getStudyByTableId(c.id),e.id=s.id),this.checkVal(e,"region",c.regions[0].id,function(e){for(var t=0;t<c.regions.length;t++)if(c.regions[t].id==e)return!0;return!1}),this.checkVal(e,"sourcekey",0,function(e){return e||!e?!0:!1});if(typeof e["cases"]!="undefined"){var p=e.cases.split("~");for(var d=0;d<p.length;d++){var v=!1;for(var m=0;m<f.cases.length;m++)if(f.cases[m].scenario==p[d]){v=!0;break}v||(p.splice(d,1),d--)}e.cases=p.join("~")}var g=[];for(oneCase=0;oneCase<f.cases.length;oneCase++)f.cases[oneCase].default_case==1&&g.push(f.cases[oneCase].scenario);g.length?defaultCases=g.join("~"):defaultCases=f.cases[0].scenario,this.checkVal(e,"cases",defaultCases,function(e){return typeof e!="undefined"&&e.length>0?!0:!1})},getGAString:function(e){return this.getQueryString(e)},getTableParamsString:function(){var e=this.getQuery().id.split("-")[1],t=this.getSelectedTable().id,n=this.getQuery().cases?this.getCaseIdsByArgs(this.getQuery().cases):this.getSelectedStudy().cases[0].id,r=this.getQuery().f?this.getQuery().f:"A",i=this.getQuery().region?this.getQuery().region:this.getTableById(t).regions[0].id;return"?studyID="+e+"&tableID="+t+"&caseID="+n+"&regionID="+i+"&freq="+r+"&sid="+this.getPinnedIds().join("~")},getMapParamsString:function(e){var t=e.uuid.split(".")[1].split("-");t=t[1]+"-"+t[2];var n=e.uuid.split(".")[0],r=e.rowId;return"?tableID="+t+"&caseID="+n+"&rowID="+r},resetStartEnd:function(e){var t=this.facade.retrieveProxy(r.NAME),n=this.getLastHistorical(),i=this.getQuery();if(e)switch(e){case"Q":parseInt(i.start)>parseInt(n)?parseInt(i.start)-parseInt(n)<5?i.start=(5*Math.ceil(parseInt(i.start)/5)).toString():i.start=(5*Math.round(parseInt(i.start)/5)).toString():i.start=i.start,parseInt(i.end)>parseInt(n)?parseInt(i.end)-parseInt(n)<5?i.end=(5*Math.ceil(parseInt(i.end)/5)).toString():i.end=(5*Math.round(parseInt(i.end)/5)).toString():i.end=i.end;break;default:i.start=i.start,i.end=i.end}else delete i.start,delete i.end},resetFrequency:function(){var e=this.getQuery();delete e.f},getChartParams:function(){var e=this.facade.retrieveProxy(n.NAME),t={chartindexed:this.getChartIndexed(),ctype:this.getChartType(),columnendpoints:this.getColumnEndpoints(),columnvalues:this.getColumnValues()};return $.extend(t,this.getTimeParams())},getChartedIds:function(e){var t=this.getCharted(e),n=t?t.split("~"):[];return n},getCharted:function(e){return this.getQuery()[e]},setDefaultCharted:function(e,t){this.getQuery()[e]=t},getChartIndexed:function(){return this.getQuery().chartindexed},getChartType:function(){return this.getQuery().ctype?this.getQuery().ctype:"linechart"},getMapType:function(){return this.getQuery().maptype?this.getQuery().maptype:0},getColumnEndpoints:function(){return this.getQuery().columnendpoints},getColumnValues:function(){return this.getQuery().columnvalues},getSelectedStudy:function(){return this.getStudyByTableId(this.getQuery().id)},getStudyByTableId:function(e){var e=e.split("-")[1],t=this.getConfig().studies;for(var n=0;n<t.length;n++)if(t[n].id==e)return t[n]},getSelectedTable:function(){return this.getTableById(this.getQuery().id)},getLastHistorical:function(){return this.getSelectedTable().lastHistorical},getTableById:function(e){var t=this.getStudyByTableId(e).tables;for(var n=0;n<t.length;n++)if(t[n].id==e)return t[n]},getTimeParams:function(){var e=this.getQuery().start?parseInt(this.getQuery().start):parseInt(this.getSelectedTable().start),t=this.getQuery().end?parseInt(this.getQuery().end):parseInt(this.getSelectedTable().end),n=this.getQuery().f?this.getQuery().f:"A",r=this.getQuery().ctype?this.getQuery().ctype:"linechart";return{start:e,end:t,f:n,ctype:r}},getSelectedCases:function(){return this.getQuery().cases.split("~")},getSelectedRegion:function(){return this.getQuery().region?this.getQuery().region:this.getSelectedTable().regions[0].id},getPinned:function(){return this.getQuery().sid},getPinnedIds:function(){var e=this.getPinned();if(typeof e=="undefined")return[];var t=e?e.split("~"):[];return $.each(t,function(e,n){t[e]==""&&(t[e]=null)}),t},getUpdatedPinnedIds:function(e,t){var n=this.getPinnedIds().slice();e=e instanceof Array?e:[e];for(var r=0;r<e.length;r++){var i=e[r],s=$.inArray(i,n);if(!~s&&t!==!0){var o=$.inArray(null,n);~o?n[o]=i:n.push(i)}else~s&&t!==!1&&(n[s]=null)}return n},getUpdatedPinned:function(e,t){return this.getUpdatedPinnedIds(e,t).join("~")},getUpdatedCharted:function(e,t,n){return this.getUpdatedChartedIds(e,t,n).join("~")},getUpdatedChartedIds:function(e,t,n){var r=this.getChartedIds(t).slice();e=e instanceof Array?e:[e];for(var i=0;i<e.length;i++){var s=e[i],o=$.inArray(s,r);if(!~o&&n!==!0){var u=$.inArray(null,r);~u?r[u]=s:r.push(s)}else~o&&n!==!1&&(r[o]=null)}return r},getPinSourcekey:function(){return this.getQuery().sourcekey},resetCase:function(){var e=this.getQuery();delete e.cases},resetRegion:function(){var e=this.getQuery();delete e.region},resetCharted:function(){var e=this.facade.retrieveProxy(n.NAME),t=e.getVisualizations(),r=this.getQuery();delete r.map,delete r.linechart,delete r.ctype},resetChartindexed:function(){var e=this.getQuery();delete e.chartindexed},getCaseIdsByArgs:function(e){var t=e.split("~"),n=[],r=this.getSelectedStudy().cases;for(var i=0;i<r.length;i++)$.inArray(r[i].scenario,t)!=-1&&n.push(r[i].id);return n.join(",")},getCaseIDsArray:function(){var e=this.getQuery().cases?this.getCaseIdsByArgs(this.getQuery().cases):this.getSelectedStudy().cases[0].id;return e.split(",")},getCaseNameById:function(e){var t=this.getSelectedStudy().cases;for(var n=0;n<t.length;n++)if(t[n].id==e)return t[n].description;return""},hasRegions:function(e){return e.regions.length>1?!0:!1},isMappable:function(e){if(e.regions.length>1){for(var t=0;t<e.regions.length;t++)if(e.regions[t].region_group_id!=1)return!1;return!0}return!1},__classvars__:{NAME:"ParameterProxy"}})}),define("js/model/DataProxy",["puremvc"],function(e){return e.Proxy.$extend({__init__:function(){this.$super(this.$class.NAME),this.cache={},this.cacheKeys=[]},setData:function(e,t){this.$super(t),this.addToCache(e,t)},setDataFromCache:function(e){this.data=this.getFromCache(e)},inCache:function(e){return e in this.cache},addToCache:function(e,t){this.inCache(e)?this.cache[e]=t:(this.cacheKeys.length>=this.$class.CACHE_LIMIT&&delete this.cache[this.cacheKeys.shift()],this.cacheKeys.push(e),this.cache[e]=t)},getFromCache:function(e){return this.cache[e]},__classvars__:{CACHE_LIMIT:5}})}),define("js/model/TableDataProxy",["js/Facade","js/model/DataProxy","js/model/ParameterProxy","js/model/ConfigProxy"],function(e,t,n,r){return t.$extend({combinedRows:[],pinData:[],getItemMetadata:function(e){var t={cssClasses:""},n=this[e];return t.cssClasses+="level_"+n.LEVEL,n.HAS_DATA||(t.cssClasses+=" NO_DATA"),t},getDataColumns:function(e){var t=this.facade.retrieveProxy(n.NAME),r=t.getLastHistorical(),i=[],s=[],o=this.getData().tabledata.datacolumns;for(col in o){s.push(o[col]);if(r!=-1)r==o[col]&&(r=-1),i.push(o[col]);else switch(e){case"Q":(isNaN(parseInt(o[col]))||parseInt(o[col])%5==0)&&i.push(o[col]);break;default:i.push(o[col])}}return i},getDataColsNoGrowth:function(e){var t=this.facade.retrieveProxy(n.NAME),r=t.getLastHistorical(),i=[],s=[],o=this.getData().tabledata.datacolumns;for(col in o){s.push(o[col]);if(r!=-1)r==o[col]&&(r=-1),i.push(o[col]);else switch(e){case"Q":(isNaN(parseInt(o[col]))||parseInt(o[col])%5==0)&&i.push(o[col]);break;default:i.push(o[col])}}return i.pop(),i},getTableData:function(){return this.getData()?this.getData().tabledata.rows:{}},getFootnotes:function(){return this.getData()?this.getData().tabledata.footnotes:[]},getCombinedData:function(e){var t=this.facade.retrieveProxy(r.NAME),i=this.facade.retrieveProxy(n.NAME),s=i.getLastHistorical(),o=i.getSelectedTable().id,u=i.getSelectedStudy(),a=[],f=[],l,c=-1;if(typeof e=="undefined")return this.combinedRows;l=e,Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t});for(var h in l)if(l[h].description&&l[h].description!=null&&l[h].description!=undefined&&l[h].description!=""){a.push(l[h]),c++,a[c].description=a[c].description+"<sup>"+a[c].footnoteLineNumber+"</sup>",a[c].rowId&&(a[c].series_id=o+"."+a[c].rowId.split("-")[0]+"."),a[c].last_historical=s,a[c].show_units=!0;if(l[h].has_data>0){var p=this.getObjectLength(l[h].data);if(p>1){var d=i.getCaseIDsArray(),v=0;for(oneCase=0;oneCase<d.length;oneCase++){var m=d[oneCase],g=l[h].data[m];a.push(JSON.parse(JSON.stringify(l[h]))),c++,a[c].uuid=a[c].uuid[v];var y=a[c].uuid.split(".")[1].split("-");y=y[1]+"-"+y[2];if(a[c].uuid.split(".").length>2){var b=i.getTableById(y).regions;for(var w=0;w<b.length;w++)if(b[w].id==a[c].uuid.split(".")[2]){a[c].regionTitle=b[w].title;break}}a[c].caseTitle=i.getCaseNameById(a[c].uuid.split(".")[0]),a[c].PIN=$.inArray(a[c].uuid,i.getPinnedIds())>-1?!0:!1,a[c].description=i.getCaseNameById(m),a[c].isPinned?a[c].indentLevel=1:a[c].indentLevel++,a[c].data=g,a[c].last_historical=s,a[c].series_id=o+"."+a[c].rowId.split("-")[0]+"."+m,a[c].show_units=!0,a[c].is_chartable=!0,i.isMappable(i.getTableById(y))&&(a[c].is_mappable=!0),v++}a[c-p].data={},a[c-p].has_data=!1,a[c-p].show_units=!1,a[c-p].is_chartable=!0,a[c-p].is_mappable=!1}else a[c].uuid=a[c].uuid[0],a[c].series_id+=a[c].uuid.split(".")[0],a[c].PIN=$.inArray(a[c].uuid,i.getPinnedIds())>-1?!0:!1,$.each(l[h].data,function(e,t){a[c].data=t,a[c].is_chartable=!0;var n=a[c].uuid.split(".")[1].split("-");n=n[1]+"-"+n[2];if(a[c].uuid.split(".").length>2){var n=a[c].uuid.split(".")[1].split("-");n=n[1]+"-"+n[2];var r=i.getTableById(n).regions;for(var s=0;s<r.length;s++)if(r[s].id==a[c].uuid.split(".")[2]){a[c].regionTitle=r[s].title;break}}a[c].caseTitle=i.getCaseNameById(a[c].uuid.split(".")[0]),i.isMappable(i.getTableById(n))&&(a[c].is_mappable=!0)})}a[c].isPinned&&f.push(a[c])}return this.setPinData(f),a},getTableUnits:function(){return"Unknown Units"},getTableTitle:function(){return this.data.tabledata.description},getChildRows:function(e){var t=[],n=this.combinedRows;for(var r=e+1;r<n.length&&n[r].indentLevel>n[e].indentLevel;r++)n[r].has_data&&t.push(r);return t},getChildData:function(e){var t=this.getChildRows(e),n=this.combinedRows,r=[];for(i=0;i<t.length;i++)r.push(n[t[i]]);return r},loadTableData:function(){var t=this.facade.retrieveProxy(n.NAME),i=t.getTableParamsString(),s=this.facade.retrieveProxy(r.NAME),o=this;this.isUpdating=!0,$.ajax(encodeURI("data/index.php"+i+"&type=data"),{dataType:"json",error:function(){o.sendNotification(e.ERROR)},success:function(n){var r=n.tabledata.rows;o.combinedRows=o.getCombinedData(n.tabledata.rows),n.chartData={},o.setData(i,n),o.createIDMap(),o.processLevels(o.combinedRows),o.processChartData(t.getChartType()),o.processPinData(),o.isUpdating=!1,o.sendNotification(e.TABLEDATA_UPDATED)}})},processLevels:function(e){var t=[],n=[],r,i,s,o,u;for(r=e.length-1;r>=0;r--){u=e[r],u.levelGroups=[],u.indentLevel=u.indentLevel-1,o=u.indentLevel;for(i=t.slice(0).length-1;i>o;i--)t.pop();for(s=o;s>0;s--)t[s]===void 0?s==o&&(u.isLast=!0,u.levelGroups[s]=t[s]=n[s]!==void 0?++n[s]:n[s]=0):u.levelGroups[s]=t[s]}},processChartData:function(t,i){var s=this.facade.retrieveProxy(n.NAME),o=this.facade.retrieveProxy(r.NAME),u=[],a=[],f=this.combinedRows,l=this.getTableData(),c=this.getIDMap(),h,p,d,v,m,g,y,b,w=$.map(o.getVisualizations(),function(e){return e["class"]});for(var d=0;d<w.length;d++)if(w[d]!=t)for(var h=0;h<f.length;h++)f[h][w[d]]&&(f[h][w[d]]=!1,u.push(h));else{a=[];var E=s.getChartedIds(t);if(E.length==0&&!i){var S=s.getSelectedTable().default_row,x=!1;if(!isNaN(parseInt(S))&&S>=0&&S<f.length)for(h=0;h<f.length;h++){while(h<f.length&&f[h].num==S&&f[h].has_data)E.push(f[h].uuid),x=!0,h++;if(x)break}if(!x){var T=!1,N=[];for(h=0;h<f.length;h++){var C=f[h].num;while(f[h].has_data&&!f[h].isPinned&&h<f.length&&f[h].num==C)E.push(f[h].uuid),x=!0,h++,f[h].is_mappable&&(N.push(f[h].uuid),T=!0);if(x)break}if(!T)for(h=0;h<f.length;h++){var C=f[h].num;while(f[h].has_data&&f[h].is_mappable&&h<f.length&&f[h].num==C)N.push(f[h].uuid),T=!0,h++;if(T)break}s.setDefaultCharted("map",N[0])}else s.setDefaultCharted("map",E[0]);s.setDefaultCharted("linechart",E.join("~"))}var k=E.slice(),L=this.getChartData(t)||[];if(k.length>0)for(h=0;h<k.length;h++){var A=!1,O=c[k[h]];if(O)for(p=0;p<O.length;p++){m=f[O[p]];if(m.has_data){m[t]=!0,u.push(O[p]);if(!A){A=!0,a.push(m);var M=$.inArray(m,L);M>=0&&L.splice(M,1)}}}else k[h]==null?a.push(null):E.splice(h,1)}if(E.length<1&&t!="pin"&&t!="sourcekey"&&t==s.getChartType()){if(!i||t=="map"){var _=s.getQuery();for(h=0,p=0;h<l.length&&p<1;p++){m=null;for(h;h<l.length&&(!m||!m.has_data);m=l[h++]);m[t]=!0,a.push(m),E.push(m.uuid),u=u.concat(c[m.uuid])}if(t=="map"&&E.length==1){var O=u;O&&O.length>0&&$.each(O,function(e,n){var r=f[n];r[t]=!0})}}this.sendNotification(e.DEFAULT_CHART_SET,E,t)}for(h=0;h<L.length;h++){m=L[h];if(m!=null&&!~$.inArray(m.uuid,E)){var O=c[m.uuid];for(var p=0;p<O.length;p++)m=f[O[p]],m.has_data&&(m[t]=!1,u.push(O[p]))}}if(w[d]=="linechart")for(h=0;h<f.length;h++){m=f[h];if(!m.has_data&&m.levelGroups&&m.description.indexOf("Pinned Series")<0){y=this.getChildData(h),b=y.length>0;for(p=0;p<y.length;p++)b&=y[p][t];m[t]!=b&&u.push(h),m[t]=b}}typeof this.getData()["chartData"]=="undefined"&&(this.getData().chartData={}),this.getData().chartData[t]=a}return u},createIDMap:function(){var e=this.combinedRows,t={};for(var n=0;n<e.length;n++){var r=e[n].uuid;t[r]||(t[r]=[]),t[r].push(n)}return this.getData().IDMAP=t,t},getIDMap:function(){return this.getData().IDMAP},getChartData:function(e){return e!==void 0?this.getData().chartData[e]:this.getData().chartData},getPinData:function(){return this.pinData||[]},setPinData:function(e){this.pinData=e},processPinData:function(){var e=this.facade.retrieveProxy(n.NAME),t=this.combinedRows,r=this.getIDMap(),i=e.getPinnedIds(),s,o,u,a,f=this.getPinData(),l=[],c=0,h=e.getSelectedRegion();for(a=0;a<t.length;a++){s=t[a];if(typeof s["PIN"]=="undefined")continue;var p=$.inArray(s.uuid,i)==-1?!1:!0,d=s.PIN;s.PIN=p;var v=s.uuid.split(".");v.length>2?v=v[2]:v="0-0";var m="";if(s.isPinned){if(v!="0-0"){var g=s.uuid.split(".")[1].split("-");g=g[1]+"-"+g[2];var y=e.getTableById(g).regions;for(var b=0;b<y.length;b++){m+=": "+y[b].title;break}}var w=e.getCaseNameById(s.uuid.split(".")[0]);m+=": "+w,t[a]["chart_name"].indexOf(s.uuid.split(".")[1].split("-")[2])!=0&&(t[a].chart_name=s.uuid.split(".")[1].split("-")[2]+": "+t[a].chart_name),t[a].description=t[a].chart_name+m}if(p!=d&&s.has_data){var E=$.extend(!0,[],t);if(p){E[r[s.uuid][0]].level=1,E[r[s.uuid][0]].indentLevel=1,E[r[s.uuid][0]].chart_name=s.uuid.split(".")[1].split("-")[2]+": "+E[r[s.uuid][0]].chart_name,E[r[s.uuid][0]].description=E[r[s.uuid][0]].chart_name;if(e.getSelectedRegion()!="0-0"){var y=e.getSelectedTable().regions;for(var b=0;b<y.length;b++)if(y[b].id==e.getSelectedRegion()){E[r[s.uuid][0]].description+=": "+y[b].title;break}}var w=e.getCaseNameById(s.uuid.split(".")[0]);E[r[s.uuid][0]].description+=": "+w,l.push(E[r[s.uuid][0]])}else if(s.level==1){var S=r[s.uuid][0];typeof S!="undefined"&&$.each(r,function(e,t){var n=$.inArray(S,t);if(n>-1)return t.splice(n,1),!1}),t.splice(a,1);var x;$.each(f,function(e,t){if(t.uuid==s.uuid)return x=e,!1}),typeof x!="undefined"&&(f.splice(x,1),c--,a--)}}}t&&t[0]&&t[0].description.indexOf("Pinned Series")<0&&l.length>0?(t.unshift({chart_name:"",data:[],description:"Pinned Series",has_data:!1,level:0,pinned_name:"",precision:0,series_id:"",in_api:!1,units:"",indentLevel:0,isPinned:!0}),c++):f.length<1&&c<0&&(t.splice(0,1),c--),l.reverse(),$.each(l,function(e,n){t.splice(1,0,n),f.push(n),c++}),l.reverse();var T=1;$.each(l,function(e,t){t.uuid&&r[t.uuid].unshift(T++ -c)}),c!=0&&$.each(r,function(e,t){$.each(t,function(e,n){if(c>0||S<n)t[e]=parseInt(n)+c})}),this.setPinData(f)},updateChartData:function(){var t=this.facade.retrieveProxy(n.NAME),r=t.getChartType(),i=this.processChartData(r,!0);this.processPinData(),this.sendNotification(e.CHART_DATA_UPDATED,i)},getObjectLength:function(e){var t=0;return $.each(e,function(e,n){t++}),t},__classvars__:{NAME:"TableDataProxy",PROXY_URL:"dataService.cfc",PROXY_METHOD:"getData"}})}),define("js/Controller",["puremvc","page","js/model/ConfigProxy","js/model/RequestProxy","js/model/ParameterProxy","js/model/TableDataProxy","json2"],function(e,t,n,r,i,s){var o=e.SimpleCommand.$extend({execute:function(e){var n=e.getBody(),i=this.facade.retrieveProxy(r.NAME);t.errorHandler(n?{route:i?i.getData():null,notification:e.getType(),error:n.name+" "+n.message,stack:n.stack}:void 0,"errorService.cfc?method=logError")}}),u=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(r.NAME);t.setData(e.getBody())}}),a=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(i.NAME);t.update(e)}}),f=e.SimpleCommand.$extend({execute:function(){t.showLoadMask()}}),l=e.SimpleCommand.$extend({execute:function(e){t.hideLoadMask()}}),c=e.SimpleCommand.$extend({execute:function(e){var n=this.facade.retrieveProxy(i.NAME),r=e.getBody(),s=e.getType();if(typeof r.id=="undefined"||r.id=="")r.id=n.getSelectedTable().id;if(s){var o=n.getGAString(r);typeof _gaq!="undefined"?_gaq.push(["_trackEvent","AEO",s,o]):typeof console!="undefined"&&typeof console.log=="function"&&console.log("_trackEvent : AEO : "+s+" : "+o)}t.setHash(n.getGAString(r))}}),h=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(s.NAME),n=this.facade.retrieveProxy(i.NAME),r,o,u=e.getType();if(u){var a=n.getGAString({});typeof _gaq!="undefined"?_gaq.push(["_trackEvent","AEO",u,a]):typeof console!="undefined"&&typeof console.log=="function"&&console.log("_trackEvent : AEO : "+u+" : "+a)}var f=JSON.stringify(e.getBody()),l=f.replace(/<sup>/g,"").replace(/<\/sup>/g,"");r=$('<input type="hidden" name="csvArr"/>').val(l);var c=t.getTableTitle().replace(/,/g,"").replace(/\s+/g,"_");o=$('<input type="hidden" name="fileName"/>').val(c),jQuery('<form style="display:none;" action="'+this.$class.POST_URL+'" method="post"></form>').append(r).append(o).appendTo("body").submit().remove()},__classvars__:{POST_URL:"/global/scripts/jquery/highcharts/exporting-server/csv_exporter.cfm"}}),p=e.SimpleCommand.$extend({execute:function(e){window.open("/opendata/qb.cfm?sdid="+e.getBody())}}),d=e.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(f),this.addSubCommand(v)}}),v=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(s.NAME);t.loadTableData()}}),m=e.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(c)}}),g=e.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(c)}}),y=e.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(b),this.addSubCommand(c)}}),b=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(i.NAME);t.resetStartEnd(e.body.f)}}),w=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(i.NAME);(typeof body=="undefined"||typeof body.newStudy=="undefined"||typeof body.oldStudy=="undefined"||body.newStudy!=body.oldStudy)&&t.resetFrequency()}}),E=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(i.NAME),n=e.getBody();(typeof n=="undefined"||typeof n.newStudy=="undefined"||typeof n.oldStudy=="undefined"||n.newStudy!=n.oldStudy)&&t.resetCase()}}),S=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(i.NAME);t.resetCharted(e.getType()),t.updateCharted(t.getUpdatedCharted(e.getBody(),e.getType()),e.getType())}}),x=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(s.NAME);t.isUpdating||t.updateChartData()}}),T=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(i.NAME);t.resetCharted()}}),N=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(i.NAME);t.resetChartindexed()}}),C=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(i.NAME);t.resetRegion()}});return{ErrorCommand:o,UpdateRequestProxyCommand:u,UpdateParameterProxyCommand:a,UpdateChartedCommand:S,UpdateChartDataCommand:x,ShowLoadMaskCommand:f,HideLoadMaskCommand:l,UpdateHashCommand:c,OpenAPIWindowCommand:p,ResetChartedCommand:T,ResetChartindexedCommand:N,ResetStartEndommand:b,OutputToCSVCommand:h,TableParamsUpdatedCommand:d,FrequencySelectionUpdatedCommand:y,TimeSelectionUpdatedCommand:m,RegionSelectionUpdatedCommand:g,ResetCaseCommand:E,UpdateDataProxyCommand:v,ResetRegionCommand:C,ResetFrequencyCommand:w}}),define("js/view/components/help.js",[],function(){return function(){return[{selector:"div#v1.pub_button",tip:"First, select a publication & table.",position:"bottomMiddle"},{selector:".chartIndexing:visible",tip:"These controls change the charting options. For time-series charts, you may index the chart to the first point by value or percent.",position:"topMiddle",xAdjust:-100,yAdjust:-5},{selector:"div#v2.pub_button",tip:"First, select a publication & table.",position:"leftMiddle"},{selector:"div#case_button",tip:"Second, you can optionally select cases and/or scenarios to compare.",position:"topMiddle",xAdjust:-80},{selector:"div#region_button",tip:"Third, you can optionally select a region (for tables with regional data)",position:"rightMiddle",xAdjust:-3,yAdjust:-3,width:225},{selector:"#help_button",tip:'<iframe width="230" height="200" src="https://www.youtube.com/embed/33ayOFVwdcw" frameborder="0" allowfullscreen=""></iframe>Play the short video to learn how to use this tool.  Click anywhere else to close these help tips.',position:"rightMiddle",xAdjust:153,yAdjust:-165},{selector:"#main_download_button",tip:'This menu provides options to download the table or graphic data in <span class="ico_csv">CSV</span> format, as well as an <span class="ico_img ico_pdf">image</span> or <span class="ico_pdf">PDF</span> of the graphic. You can also embed the graph with the <span class="ico_embed">EMBED</span> option.',position:"rightBottom",yAdjust:-20},{selector:"#time_selection_container",tip:"Use the Annual and Every 5th Year buttons buttons to adjust the level of granularity of the data. Use the slider controls to adjust the time span shown in the table below.",position:"bottomMiddle",xAdjust:-71},{selector:".linechart:first",tip:'Click on the <span class="ico linechart selected"></span>or <span class="ico map selected"></span>icons to visualize in the chart or map above.',position:"rightMiddle",xAdjust:260,yAdjust:185},{selector:".slick-header-column:last",tip:"This column shows the Compound Annual Growth Rate for all years available for each series.",position:"rightBottom",xAdjust:-80,yAdjust:-10,width:355},{selector:"#timeSliderContainer",tip:"Set the start and/or end year for the table and chart.",position:"bottomMiddle",xAdjust:0,yAdjust:-15,width:325},{selector:".pinkey_header",tip:'Use this menu to change the icons in this column. The <span class="ico sourcekey selected"></span>API icon provides a link to EIA\'s API for each series. The <span class="ico pin selected"></span>pin series icon allows you to preserve a series for comparison across data sets.',position:"leftBottom",yAdjust:-10},{selector:"#visualizationSelectorContainer",tip:'Use this menu to change the action associated with the icons in the table. The <span class="ico linechart selected"></span>time-series chart and <span class="ico map selected"></span>map selections change the type of graphic displayed above.',position:"leftMiddle",width:350,xAdjust:20,yAdjust:10},{selector:"div#animated_map_type_container",tip:"The map controls allow you to switch between coloring the states based on the current period value or the percent change from the previous period. You can also play the map over time or scroll to a specific period.",position:"rightMiddle",yAdjust:-10,width:275},{selector:".animated_map_button_container",tip:"Use this interface to play the map over time or scroll to a specific period.",position:"rightMiddle",width:275}]}}),define("js/model/HelpTooltipProxy",["puremvc","js/view/components/help.js"],function(e,t){return e.Proxy.$extend({__init__:function(){this.$super(this.$class.NAME,t)},getHelpTooltips:function(){return this.getData()()},__classvars__:{NAME:"HelpTooltipProxy"}})}),define("js/model/MapDataProxy",["js/Facade","js/model/DataProxy","js/model/ParameterProxy","js/model/ConfigProxy"],function(e,t,n,r){return t.$extend({__init__:function(){this.hasData=!1,this.$super(this.$class.NAME)},updateMapData:function(t){var i=this;if(t&&typeof t!="undefined"){var s=this.facade.retrieveProxy(n.NAME),o=s.getCaseNameById(t.uuid.split(".")[0]),u=t.rowId,a=t.chart_name+": "+o,f=t.units,l=t.precision,c=this.facade.retrieveProxy(r.NAME),h=s.getMapParamsString(t);h&&(h in this.cache?(this.data=this.cache[h],this.hasData=!0,this.sendNotification(e.MAP_DATA_UPDATED)):$.ajax(encodeURI("data/index.php"+h+"&type=mapData"),{dataType:"json",error:function(){i.sendNotification(e.ERROR)},success:function(t){a=a;for(var n in t.data)if(t.data.hasOwnProperty(n)){var r=t.data[n];for(var s in r)r.hasOwnProperty(s)&&isNaN(r[s])&&delete r[s]}i.data=i.cache[h]=$.extend(t,{title:a,units:f,precision:l}),i.hasData=!0,i.sendNotification(e.MAP_DATA_UPDATED)}}))}},__classvars__:{NAME:"MapDataProxy"}})}),define("js/view/components/DateCodeUtil",[],function(){return{months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],parseDateCode:function(e,t){e=e.toString();var n=e.substring(0,4),r,i;switch(t.toUpperCase()){case"A":i=0;break;case"Q":i=(e.substring(4)-1)*3;break;case"M":i=e.substring(4)-1}return i!==void 0&&(r=new Date(Date.UTC(n,i,1,0,0))),r},createDateCode:function(e,t){var n=e.getFullYear().toString(),r,i;switch(t.toUpperCase()){case"A":i="";break;case"Q":i=Math.ceil((e.getMonth()+1)/3),i=i<10?"0"+i:i;break;case"M":i=e.getMonth()+1,i=i<10?"0"+i:i}return i!==void 0&&(r=n+""+i),r},formatDateCode:function(e,t){var n=e.toString().substring(0,4),r=e.toString().substring(4,6),i="";switch(t){case"A":i=n;break;case"Q":i="Q"+parseInt(r,10)+" "+n;break;case"M":i=this.months[parseInt(r,10)-1]+" "+n}return i},deincrementDateCode:function(e,t){return this.deincrementOrIncrementDateCode(e,t,!1)},incrementDateCode:function(e,t){return this.deincrementOrIncrementDateCode(e,t,!0)},deincrementOrIncrementDateCode:function(e,t,n){var r=this.parseDateCode(e,t);switch(t){case"A":r=new Date(r.getFullYear()+(n?1:-1),0);break;case"Q":r=new Date(r.getFullYear(),r.getMonth()+(n?3:-3));break;case"M":r=new Date(r.getFullYear(),r.getMonth()+(n?1:-1))}return this.createDateCode(r,t)},getNumberOfDataPoints:function(e,t,n){var r=0,i=this.parseDateCode(e,n),s=this.parseDateCode(t,n);switch(n){case"A":r=s.getFullYear()-i.getFullYear()+1;break;case"Q":r=(s.getFullYear()-i.getFullYear()+1)*4-i.getMonth()/3-(3-s.getMonth()/3);break;case"M":r=(s.getFullYear()-i.getFullYear()+1)*12-i.getMonth()-(11-s.getMonth())}return r}}}),define("js/view/components/GridFormatters",[],function(){var e={nestedPropertyResolver:function(e,t){var n=e.split("."),r=t;for(var i=0;i<n.length;i++){r=r[n[i]];if(!r||typeof r=="undefined")break}return r},descriptionFormatter:function(e,t,n,r,i){var s=i.indentLevel,o=i.levelGroups,u='<span class="description_wrapper '+(o?"level_group_"+s+"_"+o[s]:"")+'">',a='<span class="description_text_wrapper';typeof i.footnoteLineNumber=="number"&&(a+=" footnote"+i.footnoteLineNumber),a+=(s===void 0?" bold":"")+'"',i.chart_name&&(a+=' title="'+i.chart_name),a+='">';var f="</span></span>",l="",c,h,p;for(c=s;c>0;c--){p='<span class="description_spacer';if(o&&o[c]!==void 0||c==s)p+=" spacer_group_"+c+"_"+o[c];c!=s?o[c]!==void 0?p+=" pre":p+=" blank":i.isLast?p+=" last":p+=" intermediate",p+='"></span>',l=p+l}var d="";return i["has_data"]==1&&(d=" ("+i.units+")"),u+l+a+(n+d)+f},numericalDataFormatter:function(e,t,n,r,i){if(i["has_data"]==0)return"";var s=isNaN(parseFloat(n))?n:Highcharts.numberFormat(n,r.precision!==void 0?r.precision:i.precision!==void 0?i.precision:0,void 0,",");return s===void 0||s==""?"--":s},rseNumericalDataFormatter:function(e,t,n,r,i){},chartButtonFormatter:function(e,t,n,r,i){var s="ico",o="";if(r.iconClass==="map"&&(i.SERIES_ID&&i.SERIES_ID.split(".")[1]==="PLANT"||!n||i.ACTION)||i.description.indexOf("Pinned Series")>=0)return"";if(i.ACTION)return s+=" remove",o="Click to clear chart",'<span class="'+s+'" title="'+o+'"></span>';s+=" "+r.iconClass;if(r.iconClass=="map"){if(!i.is_mappable)return"";i[r.iconClass]&&(s+=" selected"),o="Click to view a U.S. map of this series"}else i.has_data?i[r.iconClass]?(s+=" selected",o="Click to remove this series from the chart"):o="Click to add this series to the chart":(s+=" parent",i[r.iconClass]?(s+=" selected",o="Click to remove all child series from the chart"):o="Click to add all child series to the chart");return n||i.levelGroups?'<span class="'+s+'" title="'+o+'"></span>':""},pinSeriesFormatter:function(e,t,n,r,i){var s="ico",o="";if(r.iconClass=="sourcekey"&&(!n||i.ACTION)||typeof i[r.iconClass.toUpperCase()]=="undefined")return"";if(i.ACTION&&r.iconClass=="pin")return s+=" remove",o="Click to remove all pinned series",'<span class="'+s+'" title="'+o+'"></span>';s+=" "+r.iconClass;if(r.iconClass=="sourcekey")o="Click to view series in API Browser";else if(typeof n!="undefined"&&n!="")i[r.iconClass.toUpperCase()]?(s+=" selected",o="Click to unpin this series"):o="Click to pin this series for comparison across data sets";else{s+=" parent";if(typeof i[r.iconClass.toUpperCase()]=="undefined")return"";i[r.iconClass.toUpperCase()]?(s+=" selected",o="Click to unpin all child series"):o="Click to pin all child series for comparison across data sets"}return n||i.levelGroups?'<span class="'+s+'" title="'+o+'"></span>':""},sourceKeyFormatter:function(e,t,n,r,i){return(n||i.levelGroups)&&i.varName?'<span class="ico '+r.iconClass+(n?"":" parent")+(i[r.iconClass]?" selected":"")+'"></span>':""}};return e}),define("text!templates/main.html",[],function(){return'<!-- This is the main Mustache template that the other templates build off of -->\r\n<span id="selection_container"></span>\r\n<div class="carousel blue_top" id="chart_area"></div>\r\n\r\n<div id="middle_selections_container">\r\n	<!-- Button: PUBLICATIONS & TABLES -->\r\n	<div class="pub_button_container float_left">\r\n	    <div id="v2" class="pub_button">\r\n	        <span class="pub_button_text">Publications &amp; Tables</span>\r\n	    </div>\r\n	</div>\r\n\r\n	<!-- Spacer between Publications & Tables button, and Cases & Scenarios button -->\r\n	<div style="float:left; padding-left:15px;">&nbsp;</div>\r\n\r\n	<!-- Button: CASES/SCENARIOS -->\r\n	<div class="case_button_container float_left">\r\n	    <div id="case_button" class="case_button">\r\n	        <span class="case_button_text">Cases & Scenarios</span>\r\n	    </div>\r\n	</div>\r\n\r\n	<!-- Spacing -->\r\n	<div style="float:left; padding-left:15px;">&nbsp;</div>\r\n\r\n	<!-- Button: REGIONS -->\r\n	<div class="region_button_container float_left">\r\n		<div id="region_button" class="region_button">\r\n	        <span class="region_button_text">Regions</span>\r\n	    </div>\r\n	</div>\r\n\r\n	<!-- Button: DOWNLOAD -->\r\n	<div id="download_dialog_wrap">\r\n		<div id="download_dialog_container">\r\n			{{#overlayDownloadButtonOpts}}\r\n				{{>download_button}}\r\n			{{/overlayDownloadButtonOpts}}\r\n			<div id="download_dialog"></div>\r\n		</div>\r\n	</div>\r\n	{{#mainDownloadButtonOpts}}\r\n		 {{>download_button}}\r\n	{{/mainDownloadButtonOpts}}\r\n\r\n	<!-- Button: HELP -->\r\n	<div id="help_button" class="help_button">\r\n		<span class="help_icon">&nbsp;</span><span class="help_button_text">Help</span>\r\n	</div>\r\n</div>\r\n\r\n<!-- Chart/Map controls will be inserted here -->\r\n<div id="controls_container" class="grey_side ltblue">\r\n	<!-- Retain in case we add periodicity other than annual in the future:\r\n	<div id="frequency_container"></div>\r\n	-->\r\n	<!-- Time slider will be inserted here -->\r\n	<div id="time_selection_container"></div>\r\n</div>\r\n<div class="clear"></div>\r\n\r\n<!-- Data table will be inserted here -->\r\n<div id="tableContainer"></div>\r\n<div class="clear"></div>\r\n\r\n<div id="footnote_container"></div>\r\n\r\n<!-- Publications/Tables modal dialog will be inserted here, and positioned based on which of the two buttons is clicked -->\r\n<div id="pubstables_dialog_wrap">\r\n	<div id="pubstables_dialog_container">\r\n		<div id="pubstables_dialog"></div>\r\n	</div>\r\n</div>\r\n\r\n<!-- Cases/Scenarios modal dialog will be inserted here -->\r\n<div id="cases_dialog_wrap">\r\n	<div id="cases_dialog_container">\r\n		<div id="cases_dialog"></div>\r\n	</div>\r\n</div>\r\n\r\n<!-- Regions modal dialog will be inserted here -->\r\n<div id="regions_dialog_wrap">\r\n	<div id="regions_dialog_container">\r\n		<div id="regions_dialog"></div>\r\n	</div>\r\n</div>\r\n'}),define("text!templates/download_button.html",[],function(){return'<!-- This Mustache template displays the Download button  -->\r\n<div\r\n	{{#id}}\r\n		id="{{id}}"\r\n	{{/id}}\r\n	class="download_button\r\n		{{#selected}}\r\n			selected\r\n		{{/selected}}\r\n	"\r\n>\r\n	<span class="download_icon">&nbsp;</span><span class="download_button_text">Download</span>\r\n</div>'}),define("js/view/components/PageLayout",["classy","text!templates/main.html","text!templates/download_button.html","mustache"],function(e,t,n){return e.$extend({container:null,__init__:function(e,r){this.container=e,this.container.empty().html(Mustache.render(t,r,{download_button:n}))},getSelectionContainer:function(){return $("#selection_container",this.container)},getCaseSelectionContainer:function(){return $("#case_container",this.container)},getRegionSelectionContainer:function(){return $("#region_container",this.container)},getTimeSelectionContainer:function(){return $("#time_selection_container",this.container)},getChartContainer:function(){return $("#chart_area",this.container)},getTableContainer:function(){return $("#tableContainer",this.container)},getDownloadContainer:function(){return $("#download_dialog",this.container)},getFootnoteContainer:function(){return $("#footnote_container",this.container)}})}),define("text!templates/pubstables_selection.html",[],function(){return'<!-- This Mustache template is used to build the Publications & Tables modal dialog -->\r\n<div class="inner_container ltblue grey_side blue_side_border" id="selection_titles_container">\r\n    {{#selectedStudy}}\r\n    <h1 id="study_title">{{name}}</h1>\r\n    {{/selectedStudy}}\r\n    {{#selectedTable}}\r\n    <h2 id="table_title">Table: {{description}}</h2>  \r\n    {{/selectedTable}}\r\n\r\n    <div id="subtitle_mid" style="font-size:15px;font-style:italic;">\r\n        <span id="subtitle_case"></span>\r\n        <span id="subtitle_region"></span>\r\n    </div>\r\n\r\n</div>\r\n<div id="blue_arrow">\r\n    <div id="shaft"></div>\r\n    <div id="head"></div>\r\n</div>\r\n<div class="pub_button_container">\r\n    <div id="v1" class="pub_button">\r\n        <span class="pub_button_text">Publications &amp; Tables</span>\r\n    </div>\r\n</div>\r\n<div class="clear"></div>\r\n<!-- NOTE: The modal dialog was moved to publications_tables_template.html -->\r\n\r\n<style>\r\n/* NOTE: CAN THE FOLLOWING BE APPLIED TO BOTH TABLE_ITEM AND CASE_ITEM IN MAIN.LESS? */\r\n.table_item {\r\n    padding: 2px 8px;\r\n    margin-bottom: 5px;\r\n    line-height: 15px;\r\n}\r\n.table_item.selected {\r\n    background-color: #189bd7; \r\n    color: #fff;\r\n}\r\n.table_item:hover{\r\n    text-decoration: none;\r\n    background-color: #189bd7; \r\n    color: #fff;\r\n    cursor: pointer;\r\n}\r\n</style>\r\n'}),define("text!templates/publications.html",[],function(){return'<!--- NOTE: Currently all the CSS for this template is in selection.html, and needs to be moved to main.css -->\r\n<div id="table_select" class="blue_top" style="display:block"><!-- NOTE: This was hidden initially, and faded in with jQuery -->\r\n    <div id="table_select_inner">\r\n        <div id="table_select_cancel"><span>CANCEL</span><div>&nbsp;</div></div>\r\n        <div id="table_select_left">\r\n            <div class="table_select_title">Publications</div>\r\n            <div class="pubs_tables_scroller ui-slider ui-slider-vertical ui-widget ui-widget-content ui-corner-all" aria-disabled="false">\r\n                <a class="ui-slider-handle ui-state-default ui-corner-all" href="#" style="bottom: 0%;"></a>\r\n            </div>\r\n            <div class=\'scrollable_list\'>\r\n            {{#studies}}\r\n                <div class="pub_item" value="{{id}}">{{name}}</div>\r\n            {{/studies}}\r\n            </div>\r\n        </div>\r\n        <div id="table_select_right">\r\n            <div class="table_select_title">\r\n                Tables\r\n                <div id="sort-options">Browse: \r\n                    <span id="bysubject"><a href="javascript:void(0);">By Subject</a></span> |\r\n                    <span id="alltables"><a href="javascript:void(0);">All Tables</a></span>\r\n                </div>\r\n            </div>\r\n\r\n            <div>\r\n                <input type="text" id="tableFilter" placeholder="search for a table">\r\n            </div>\r\n            <div id="search-button"></div>\r\n\r\n            <div class="pubs_tables_scroller ui-slider ui-slider-vertical ui-widget ui-widget-content ui-corner-all" aria-disabled="false">\r\n                <a class="ui-slider-handle ui-state-default ui-corner-all" href="#" style="bottom: 0%;"></a>\r\n            </div>\r\n            <div class=\'scrollable_list\'>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("text!templates/tables.html",[],function(){return'<!-- This Mustache template displays each data table -->\r\n{{#tables}}<div id="{{id}}" class="table_item">{{description}}</div>{{/tables}}'}),define("js/view/components/Selection",["classy","signals","text!templates/pubstables_selection.html","text!templates/publications.html","text!templates/tables.html","mustache","simpleModal","json2"],function(e,t,n,r,i){return e.$extend({viewSelect:null,lastTab:null,tableSelectionChanged:null,__init__:function(e){this.container=e,this.tableSelectionChanged=new t.Signal},create:function(e,t,n){this.updateTableSelection(e,t,n)},updateTableSelection:function(e,t,r){var i=this;this.selectedStudy=e,this.studies=t,this.selectedTable=r,this.container.html(Mustache.render(n,{selectedStudy:this.selectedStudy,selectedTable:this.selectedTable})),$(".pub_button").off("click").on("click",function(e){i.openPubsTablesDialog($(this))})},openPubsTablesDialog:function(e){var t=this;this.buttonObject=e;var n=$(Mustache.to_html(r,{selectedStudy:t.selectedStudy,selectedTable:t.selectedTable,studies:t.studies})),i=$("div#pubstables_dialog");i.empty(),i.append(n),this.pubsTablesDialogContainer=$("div#pubstables_dialog_container");var s=this.pubsTablesDialogContainer.parent();this.pubsTablesDialogContainer.appendTo("body").css({position:"absolute",display:"block",left:-9999,top:-9999});var o=this.pubsTablesDialogContainer.height();this.pubsTablesDialogContainer.appendTo(s).css({position:"relative",left:0,top:0}),this.pubsTablesDialogContainer.modal({autoPosition:!1,overlayClose:!0,fixed:!1,persist:!0,minHeight:o,maxHeight:o,close:!1,onClose:function(){t.pubsTablesDialogContainer.find(".pub_button").remove(),$(window).off("resize.selection"),$.modal.close()}}),e.clone().prependTo(this.pubsTablesDialogContainer),this.pubsTablesDialogContainer.find(".pub_button").addClass("selected"),this.positionPubsTablesDialog(),$(window).on("resize.selection",this.resizeCallback=function(){t.positionPubsTablesDialog()});var u=$(window).height(),a=$("div#simplemodal-container").position().top+$("#simplemodal-container").height(),f=$("div#table_select").height(),l=$("body").scrollTop(),c=a-u+f+10;l<c&&$("html, body").animate({scrollTop:c},600,"swing",function(){});var h=$("#table_select_left").find(".scrollable_list").children();h.disableSelection();var p=$("#table_select_cancel").on("click",function(e){$.modal.close()});for(var d=0;d<h.length;d++)$(h[d]).attr("value")==this.selectedStudy.id&&$(h[d]).addClass("selected");$(h).on("click",function(e){$("#tableFilter").val(""),t.publicationSelected($(this))});var v=$("#table_select");v.find(".scrollable_list").bind("scroll",function(){$(this).siblings(".pubs_tables_scroller").slider("value",this.scrollHeight-this.offsetHeight==0?100:100-100*this.scrollTop/(this.scrollHeight-this.offsetHeight))}),$(".pubs_tables_scroller").each(function(){ele=$(this),ele.slider({orientation:"vertical",min:0,max:100,value:100,slide:function(e,t){(function(){this.scrollTop=(this.scrollHeight-this.offsetHeight)*((100-t.value)/100)}).call($(t.handle).parent().siblings(".scrollable_list").get(0))}}).mousedown(function(e){$.browser.msie&&e.stopPropagation()})});if(navigator.appName=="Microsoft Internet Explorer"){function m(e){var t=$(e.data);return e.data!=e.target?t.data("open")?(t.css("width",t.data("originalWidth")),t.data("open",!1)):t.data("open",!0):setTimeout(function(){t.data("open")?(t.css("width",t.data("originalWidth")),t.data("open",!1)):t.data("open",!0)},100),typeof m=="function"&&$("body").unbind("mouseup",m),!0}var g=navigator.userAgent,y=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");y.exec(g)!=null&&(rv=parseFloat(RegExp.$1),rv<9&&this.container.find("select").each(function(){var e=$(this);e.css("min-width",e.width()),e.data("originalWidth",e.width())}).bind("mousedown",function(e){var t=$(this),n=$(this).clone();return n.css("width","auto"),t.parent().append(n.css("visible","false")),n.width()>t.width()&&t.css("width","auto"),n.remove(),t.css("position","relative"),$("body").bind("mouseup",this,m),!0}).bind("change blur",function(e){var t=$(this);return t.css("width",t.data("originalWidth")),t.data("open",!1),!0}))}t.lastTab!="alltables"?this.generateTablesList(this.selectedStudy,"bysubject",!1):this.generateTablesList(this.selectedStudy,"alltables",!1),$("span#alltables a").on("click",function(e){t.lastTab="alltables",t.generateTablesList(t.selectedStudy,"alltables",!1),$("span#alltables").addClass("selected"),$("span#bysubject").removeClass("selected"),t.checkScrollbar()}),$("span#bysubject a").on("click",function(e){t.lastTab="bysubject",t.generateTablesList(t.selectedStudy,"bysubject",!1),$("span#bysubject").addClass("selected"),$("span#alltables").removeClass("selected"),t.checkScrollbar()})},positionPubsTablesDialog:function(){var e=this.buttonObject.offset();if(this.buttonObject.attr("id")=="v1")xPos=e.left+this.buttonObject.width()-$("#table_select").width()+4,this.pubsTablesDialogContainer.find(".pub_button").css({position:"relative",left:$("#table_select").width()-this.buttonObject.width()-4});else{if(this.buttonObject.attr("id")!="v2"){alert("ERROR: id= "+this.buttonObject.attr("id"));return}xPos=e.left}$("#simplemodal-container").css({top:e.top,left:xPos})},publicationSelected:function(e){var t=this;this.selectedStudy=this.getStudyById(e.attr("value")),e.siblings().removeClass("selected"),e.addClass("selected"),this.table_list.fadeOut(200,function(){t.generateTablesList(t.selectedStudy,"bysubject",!0),$("span#alltables").removeClass("selected"),$("span#bysubject").addClass("selected")}).fadeIn(200,function(){t.checkScrollbar()}),$("#table_select_right .scrollable_list").prop("scrollTop",0)},getStudyById:function(e){for(var t=0;t<this.studies.length;t++)if(this.studies[t].id==e)return this.studies[t]},generateTablesList:function(e,t,n){var r=this;this.table_list=$("#table_select_right").find(".scrollable_list");var s=r.selectedTable.id;if(n)for(oneTable=0;oneTable<e.tables.length;oneTable++)if(e.tables[oneTable].default_table==1){var s=e.tables[oneTable].id;break}if(t=="alltables"){$("#alltables").addClass("selected"),$("#table_select_right").toggleClass("all_tables",!0),$("#tableFilter").show(),$("#search-button").show();var o=e.subjects[0].tables;this.table_list.html(Mustache.render(i,{tables:o})),$("#search-button").css({position:"absolute",height:"16px",width:"16px",background:"url('/global/images/sprites/gc_sprite.png') no-repeat -316px -245px","margin-left":"167px","margin-top":"-22px"}),$("#tableFilter").keyup(function(e){$("#tableFilter").parent().parent().find(".table_item").each(function(e,t){$(t).html().toUpperCase().indexOf($("#tableFilter").val().toUpperCase())>=0?$(t).show():$(t).hide()})}),this.table_list.children().each(function(){$(this)[0].id==s&&$(this).addClass("selected")}),this.table_list.children().on("click",function(e){$.modal.close(),r.tableSelectionChanged.dispatch(this.id),$("#tableContainer div.slick-pane.slick-pane-top.slick-pane-right > div.slick-viewport.slick-viewport-top.slick-viewport-right").prop("scrollTop",0)})}else if(t=="bysubject"){$("#bysubject").addClass("selected"),$("#table_select_right").toggleClass("all_tables",!1),$("#tableFilter").hide(),$("#search-button").hide();var u=e.subjects;for(oneSubject=0;oneSubject<u.length;oneSubject++){var a=u[oneSubject];for(oneSubjectTable=0;oneSubjectTable<a.tables.length;oneSubjectTable++)for(oneTable=0;oneTable<e.tables.length;oneTable++)if(e["tables"][oneTable].id==a.tables[oneSubjectTable]){a.tables[oneSubjectTable]=e.tables[oneTable];continue}}theSubjects=$.grep(e.subjects,function(e,t){return e.name!="All Tables"}),this.table_list.html('<ul class="tablesTree">'+Mustache.render('{{#subjects}}<li id="{{id}}" class="subjectItem"><img src="css/images/img_trans.gif" class="accordion-open" height="10" width="10">{{name}}<ul class="menuHide">{{#tables}}<li class="table_item" id="{{id}}">{{description}}</li>{{/tables}}</ul></li>{{/subjects}}',{subjects:theSubjects})+"</ul>"),$("li.subjectItem").disableSelection(),$("li.subjectItem li.table_item").each(function(){$(this)[0].id==s&&$(this).addClass("selected")});var f=$("div#table_select_right li.table_item.selected").parent();f.show(),r.checkScrollbar(),f.prev().removeClass("accordion-open").addClass("accordion-close"),$("li.subjectItem").on("click",function(e){var t=$(this),n=$(this).find("img");if(n.hasClass("accordion-open")){var i=t.offset().top-t.parent().offset().top,s=$("#table_select_right .scrollable_list").height(),o=1-i/s;n.parent().children("ul").stop().slideDown(400*o,"swing",function(){$("#table_select_right .scrollable_list").prop("scrollTop",i),r.checkScrollbar()}),n.removeClass("accordion-open"),n.addClass("accordion-close")}else n.hasClass("accordion-close")&&(n.parent().children("ul").stop().slideUp(400,"swing",function(){r.checkScrollbar()}),n.removeClass("accordion-close"),n.addClass("accordion-open"))}),$("li.table_item").on("click",function(e){$.modal.close(),r.tableSelectionChanged.dispatch(this.id),$("#tableContainer div.slick-pane.slick-pane-top.slick-pane-right > div.slick-viewport.slick-viewport-top.slick-viewport-right").prop("scrollTop",0)})}else alert("ERROR: No handler for sortBy= "+t)},checkScrollbar:function(){var e=$("div#table_select_right .scrollable_list"),t=$("#table_select_right .pubs_tables_scroller");e.innerHeight()==e.get(0).scrollHeight?t.slider("option","disabled",!0):t.slider("option","disabled",!1)}})}),define("text!/global/scripts/modules/src/timeSlider/time_slider.html",[],function(){return'<div id="timeSliderContainer">\r\n	<div class="labelContainer"></div>\r\n	<div class="timeSlider{{#selectDateRange}} range{{/selectDateRange}}"></div>\r\n</div>'}),define("dateCodeUtils",[],{months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],parseDateCode:function(e,t){e=e.toString();var n=e.substring(0,4),r,i;switch(t.toUpperCase()){case"A":i=0;break;case"Q":i=(e.substring(4)-1)*3;break;case"M":i=e.substring(4)-1}return i!==void 0&&(r=new Date(n,i)),r},createDateCode:function(e,t){var n=e.getFullYear().toString(),r,i;switch(t.toUpperCase()){case"A":i="";break;case"Q":i=Math.ceil((e.getMonth()+1)/3),i=i<10?"0"+i:i;break;case"M":i=e.getMonth()+1,i=i<10?"0"+i:i}return i!==void 0&&(r=n+""+i),r},formatDateCode:function(e,t){var n=e.toString().substring(0,4),r=e.toString().substring(4,6),i="";switch(t){case"A":i=n;break;case"Q":i="Q"+parseInt(r,10)+" "+n;break;case"M":i=this.months[parseInt(r,10)-1]+" "+n}return i},deincrementDateCode:function(e,t){return this.deincrementOrIncrementDateCode(e,t,!1)},incrementDateCode:function(e,t){return this.deincrementOrIncrementDateCode(e,t,!0)},deincrementOrIncrementDateCode:function(e,t,n){var r=this.parseDateCode(e,t);switch(t){case"A":r=new Date(r.getFullYear()+(n?1:-1),0);break;case"Q":r=new Date(r.getFullYear(),r.getMonth()+(n?3:-3));break;case"M":r=new Date(r.getFullYear(),r.getMonth()+(n?1:-1))}return this.createDateCode(r,t)}}),define("timeSlider",["signals","classy","text!/global/scripts/modules/src/timeSlider/time_slider.html","dateCodeUtils","mustache"],function(e,t,n,r){return t.$extend({sliderType:null,timeSelectionChanged:null,suppressSignals:!1,isCreated:!1,timeSlider:null,lowLabel:null,highLabel:null,lowHandle:null,highHandle:null,values:null,highVal:null,lowVal:null,freq:null,__init__:function(t){this.container=t,this.timeSelectionChanged=new e.Signal},create:function(e,t,r,i,s){var o=this;this.freq=t.toUpperCase(),this.values=r,this.lowVal=i,this.highVal=s,this.container.html(Mustache.render(n,e)),this.timeSlider=$(".timeSlider",this.container),this.sliderType=this.timeSlider.hasClass("range")?this.$class.RANGE_SLIDER:this.$class.SINGLE_SLIDER,this.createSlider(),this.isCreated=!0,this.updateTimeSelection(t,r,i,s)},createSlider:function(){var e=this,t,n,r;switch(this.sliderType){case this.$class.RANGE_SLIDER:t=function(t,n){var r;return n.values[0]>=n.values[1]||n.values[0]<0||n.values[0]>e.values.length||n.values[1]<0||n.values[1]>e.values.length?!1:(e.lowVal=e.values[n.values[0]],e.highVal=e.values[n.values[1]],e.updateLabel(!0),e.updateLabel(!1),!0)},n=function(t,n){e.lowVal=n.values[0]<0||n.values[0]>e.values.length?e.values[0]:e.values[n.values[0]],e.highVal=n.values[1]<0||n.values[1]>e.values.length?e.values[e.values.length-1]:e.values[n.values[1]],e.updateLabel(!0),e.updateLabel(!1),e.suppressSignals||e.timeSelectionChanged.dispatch(e.lowVal,e.highVal)},r=!0;break;case this.$class.SINGLE_SLIDER:t=function(t,n){return e.lowVal=e.values[n.value],e.updateLabel(!0),!0},n=function(t,n){e.lowVal=e.values[n.value],e.updateLabel(!0),e.suppressSignals||e.timeSelectionChanged.dispatch(e.lowVal)},r=!1}this.timeSlider.slider({orientation:"horizontal",slide:t,change:n,range:r});var i=this.timeSlider.children(".ui-slider-handle");this.lowHandle=i.eq(0),this.highHandle=i.eq(1),this.lowLabel=$('<div class="time_slider_tooltip"></div>').append("<span/>").css({position:"absolute"}),this.sliderType===this.$class.SINGLE_SLIDER?this.lowLabel.appendTo(this.lowHandle):(this.highLabel=$('<div class="time_slider_tooltip"></div>').append("<span/>"),this.lowLabel.appendTo(this.timeSlider),this.highLabel.appendTo(this.timeSlider),this.lowLabel.css({left:0}),this.highLabel.css({position:"absolute"})),this.updateLabel(!0),this.updateLabel(!1);switch(this.sliderType){case this.$class.RANGE_SLIDER:this.lowHandle.add(this.highHandle).addClass("dual_slider_handle");break;case this.$class.SINGLE_SLIDER:this.lowHandle.addClass("single_slider_handle")}},updateTimeSelection:function(e,t,n,r){this.suppressSignals=!0,this.values=t,this.freq=e,this.lowVal=n,this.highVal=r,this.updateTimeSlider(),this.suppressSignals=!1},updateLabel:function(e){var t=e?this.lowLabel:this.highLabel;if(t&&t.length>0){var n=e?this.lowVal:this.highVal,r=e?this.lowHandle:this.highHandle,i=t.find("span");i.text(this.formatLabel(n)),this.sliderType===this.$class.SINGLE_SLIDER?t.css({left:-0.5*i.width()+.5*r.width()}):e||t.css({left:this.timeSlider.width()-i.width()})}},updateTimeSlider:function(){this.timeSlider.slider("option",{min:0,max:this.values.length-1});switch(this.sliderType){case this.$class.RANGE_SLIDER:this.timeSlider.slider("option",{values:[$.inArray(this.lowVal,this.values),$.inArray(this.highVal,this.values)]});break;case this.$class.SINGLE_SLIDER:this.timeSlider.slider("option",{value:$.inArray(this.lowVal,this.values)})}},formatLabel:function(e){return r.formatDateCode(e,this.freq)},__classvars__:{RANGE_SLIDER:"rangeSlider",SINGLE_SLIDER:"singleSlider"}})}),define("text!templates/time_selector.html",[],function(){return'<!-- This Mustache template displays the Map Type buttons, Periodicity buttons, and Time Slider -->\r\n<div id="visualizationSelectorContainer">\r\n	<input type="radio" name="vizSelectorGroup" value="linechart" id="timeseriesbutton"/><label for="timeseriesbutton"><span class="ico linechart"></span>Time-series</label>\r\n	<input type="radio" name="vizSelectorGroup" value="map" id="mapbutton"/><label for="mapbutton"><span class="ico map"></span>Map</label>\r\n</div>\r\n<div id="frequencySelectorContainer">\r\n	<div class="labelContainer"></div>\r\n	<input type="radio" name="freqSelectorGroup" value="A" id="annual"/><label for="annual">Annual</label>\r\n	<input type="radio" name="freqSelectorGroup" value="Q" id="quinquennial"/><label for="quinquennial">Every 5th Year</label>\r\n</div>\r\n<div id="timeSliderContainer">\r\n	<div class="labelContainer"></div>\r\n	<div class="timeSlider range"></div>\r\n</div>\r\n'}),define("js/view/components/TimeSelection",["timeSlider","signals","text!templates/time_selector.html"],function(e,t,n){return e.$extend({visualizationSelectionChanged:null,frequencySelectionChanged:null,vizSelectors:null,freqSelectors:null,isCreated:!1,__init__:function(e){this.$super(e),this.visualizationSelectionChanged=new t.Signal,this.frequencySelectionChanged=new t.Signal},create:function(e,t,r,i,s,o){var u=this;this.freq=t,this.values=r,this.lowVal=i,this.highVal=s,this.container.html(Mustache.render(n,e)),$("#visualizationSelectorContainer",this.container).buttonset(),this.vizSelectors=$("input:radio[name=vizSelectorGroup]",this.container),this.vizSelectors.change(function(){u.suppressSignals||u.visualizationSelectionChanged.dispatch(u.vizSelectors.filter(":checked").val())}),$("#frequencySelectorContainer",this.container).buttonset(),this.freqSelectors=$("input:radio[name=freqSelectorGroup]",this.container),this.freqSelectors.change(function(){u.suppressSignals||u.frequencySelectionChanged.dispatch(u.freqSelectors.filter(":checked").val())}),this.timeSlider=$(".timeSlider",this.container),this.sliderType=this.timeSlider.hasClass("range")?this.$class.RANGE_SLIDER:this.$class.SINGLE_SLIDER,this.createSlider(),this.isCreated=!0,this.updateTimeSelection(t,r,i,s,o)},updateTimeSelection:function(e,t,n,r,i){this.$super("A",t,n,r),this.suppressSignals=!0,this.updateFreqSelectors(e),this.updateVizSelectors(i),this.suppressSignals=!1},updateFreqSelectors:function(e){this.freqSelectors.filter("[value="+e+"]").prop("checked",!0),$("#frequencySelectorContainer",this.container).buttonset("refresh")},updateVizSelectors:function(e){this.vizSelectors.filter("[value="+e+"]").prop("checked",!0),$("#visualizationSelectorContainer",this.container).buttonset("refresh")},disableMapButton:function(e){var t=$("#visualizationSelectorContainer input:checked");t.attr("id")=="mapbutton"&&e&&$("input#timeseriesbutton").attr("checked",!0),$("input#mapbutton",this.container).button({disabled:e})}})}),define("text!templates/case_selection.html",[],function(){return'<!-- This Mustache template displays the Cases/Scenarios modal dialog -->\r\n<div id="case_select" class="blue_top">\r\n    <div id="case_select_inner">\r\n        <div id="case_select_controls">\r\n            <div id="case_select_cancel"><span>CANCEL</span><div>&nbsp;</div></div>\r\n            <div id="case_select_submit"><span>SUBMIT</span><div>&nbsp;</div></div>    \r\n        </div>\r\n        <div id="cases_options"><span id="cases_selected"></span> &nbsp; | &nbsp; <a id="reset" href="javascript:void(0);">reset to default</a></div>\r\n\r\n        <div class="filter_tree_scroller ui-slider ui-slider-vertical ui-widget ui-widget-content ui-corner-all" aria-disabled="false">\r\n            <a class="ui-slider-handle ui-state-default ui-corner-all" href="#" style="bottom: 0%;"></a>\r\n        </div>\r\n        <div class=\'scrollable_list\'>\r\n        {{#cases}}\r\n            <div class="case_item" alt="{{long_description}}" title="{{long_description}}">\r\n                <img src="css/images/img_trans.gif" height="1" width="1" value="{{scenario}}" class="checkBox">\r\n                <span>{{description}}</span>\r\n            </div>\r\n        {{/cases}}\r\n        </div>\r\n        <div class="clear"></div>\r\n        <div id="cases_warning" style=""></div>\r\n    </div>\r\n</div>\r\n'}),define("js/view/components/CaseSelection",["classy","signals","text!templates/case_selection.html","mustache","simpleModal","json2"],function(e,t,n){return e.$extend({viewSelect:null,caseSelectionChanged:null,__init__:function(e){this.container=e,this.caseSelectionChanged=new t.Signal,this.maxCases=3},create:function(e,t,n,r){var i=this,s=$("#case_button").off("click").on("click",function(){i.openCasesScenariosDialog($(this))})},updateCaseSubtitle:function(e,t,n,r){var i=this,s="";this.selectedStudy=e,this.selectedTable=n,this.selectedCases=r;if(this.selectedCases.length>1)s="Multiple Cases";else for(var o=0;o<this.selectedStudy.cases.length;o++)if(this.selectedStudy.cases[o].scenario==this.selectedCases[0]){s=this.selectedStudy.cases[o].description;break}$("#subtitle_case").html("Case: "+s)},openCasesScenariosDialog:function(e){var t=this;this.buttonObject=e;var r=$(Mustache.to_html(n,{cases:t.selectedStudy.cases})),i=$("div#cases_dialog");i.empty(),i.append(r),this.casesDialogContainer=$("div#cases_dialog_container");var s=this.casesDialogContainer.parent();this.casesDialogContainer.appendTo("body").css({position:"absolute",display:"block",left:-9999,top:-9999});var o=this.casesDialogContainer.height();this.casesDialogContainer.appendTo(s).css({position:"relative",left:0,top:0}),this.casesDialogContainer.modal({autoPosition:!1,overlayClose:!0,fixed:!1,persist:!0,minHeight:o,maxHeight:o,close:!1,onClose:function(){t.casesDialogContainer.find(".case_button").remove(),$(window).off("resize.caseselection"),$.modal.close()}}),e.clone().prependTo(this.casesDialogContainer),this.casesDialogContainer.find(".case_button").addClass("selected"),this.positionCasesScenariosDialog(),$(window).on("resize.caseselection",this.resizeCallback=function(){t.positionCasesScenariosDialog()});var u=$(window).height(),a=$("div#simplemodal-container").position().top+$("#simplemodal-container").height(),f=$("div#case_select").height(),l=$("body").scrollTop(),c=a-u+f+10;l<c&&$("html, body").animate({scrollTop:c},600,"swing",function(){});var h=$("#case_select_inner").find(".scrollable_list").children();h.disableSelection();var p=$("#case_select_cancel").on("click",function(){$.modal.close()});this.checkboxes=h.children("img"),this.numSelected=0;for(var d=0;d<this.checkboxes.length;d++)$.inArray($(this.checkboxes[d]).attr("value"),this.selectedCases)!=-1?($(this.checkboxes[d]).addClass("checked"),this.numSelected++):$(this.checkboxes[d]).addClass("unchecked");this.updateCasesSelected(),h.on("click",function(){thisCheckbox=$(this).children("img"),thisCheckbox.hasClass("checked")?(thisCheckbox.removeClass("checked"),thisCheckbox.addClass("unchecked"),t.numSelected--):(thisCheckbox.removeClass("unchecked"),thisCheckbox.addClass("checked"),t.numSelected++),t.updateCasesSelected()});var v=$("#case_select_submit").on("click",function(){var e=[];for(var n=0;n<t.checkboxes.length;n++)$(t.checkboxes[n]).hasClass("checked")&&e.push($(t.checkboxes[n]).attr("value"));t.caseSelectionChanged.dispatch(e.join("~")),$.modal.close()}),m=$("a#reset").on("click",function(){for(var e=0;e<t.checkboxes.length;e++)e==0?($(t.checkboxes[e]).removeClass("unchecked"),$(t.checkboxes[e]).addClass("checked")):($(t.checkboxes[e]).removeClass("checked"),$(t.checkboxes[e]).addClass("unchecked"));t.numSelected=1,t.updateCasesSelected()}),g=$("#case_select");g.find(".scrollable_list").bind("scroll",function(){$(this).siblings(".filter_tree_scroller").slider("value",this.scrollHeight-this.offsetHeight==0?100:100-100*this.scrollTop/(this.scrollHeight-this.offsetHeight))}),$(".filter_tree_scroller").each(function(){ele=$(this),ele.slider({orientation:"vertical",min:0,max:100,value:100,slide:function(e,t){(function(){this.scrollTop=(this.scrollHeight-this.offsetHeight)*((100-t.value)/100)}).call($(t.handle).parent().siblings(".scrollable_list").get(0))}}).mousedown(function(e){$.browser.msie&&e.stopPropagation()});var e=ele.siblings(".scrollable_list");e.innerHeight()==e.get(0).scrollHeight&&ele.slider("option","disabled",!0)});if(navigator.appName=="Microsoft Internet Explorer"){function y(e){var t=$(e.data);return e.data!=e.target?t.data("open")?(t.css("width",t.data("originalWidth")),t.data("open",!1)):t.data("open",!0):setTimeout(function(){t.data("open")?(t.css("width",t.data("originalWidth")),t.data("open",!1)):t.data("open",!0)},100),typeof y=="function"&&$("body").unbind("mouseup",y),!0}var b=navigator.userAgent,w=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");w.exec(b)!=null&&(rv=parseFloat(RegExp.$1),rv<9&&this.container.find("select").each(function(){var e=$(this);e.css("min-width",e.width()),e.data("originalWidth",e.width())}).bind("mousedown",function(e){var t=$(this),n=$(this).clone();return n.css("width","auto"),t.parent().append(n.css("visible","false")),n.width()>t.width()&&t.css("width","auto"),n.remove(),t.css("position","relative"),$("body").bind("mouseup",this,y),!0}).bind("change blur",function(e){var t=$(this);return t.css("width",t.data("originalWidth")),t.data("open",!1),!0}))}},positionCasesScenariosDialog:function(){buttonOffset=this.buttonObject.offset(),$("#simplemodal-container").css({top:buttonOffset.top,left:buttonOffset.left})},updateCasesSelected:function(){$("span#cases_selected").html(this.numSelected.toString()+" selected"),$("span#cases_selected").css("color","green"),$("span#cases_selected").css("font-weight","normal")}})}),define("text!templates/region_selection.html",[],function(){return'<!-- This Mustache template displays the Regions modal dialog  -->\r\n<div id="region_select" class="blue_top">\r\n    <div id="region_select_inner">\r\n        <div id="region_select_controls">\r\n            <div id="region_select_cancel"><span>CANCEL</span><div>&nbsp;</div></div>\r\n            <div id="region_select_submit"><span>SUBMIT</span><div>&nbsp;</div></div>    \r\n        </div>\r\n        <div style="border-bottom: 1px #999 solid; margin:5px 0;">&nbsp;</div>\r\n        <div class="filter_tree_scroller ui-slider ui-slider-vertical ui-widget ui-widget-content ui-corner-all" aria-disabled="false">\r\n            <a class="ui-slider-handle ui-state-default ui-corner-all" href="#" style="bottom: 0%;"></a>\r\n        </div>\r\n        <div class=\'scrollable_list\'>\r\n        {{#regions}}\r\n            <div id="{{id}}" class="region_item">\r\n            <label><input type="radio" value="{{id}}" name="regions">{{title}}</label>\r\n            </div>\r\n        {{/regions}}\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("js/view/components/RegionSelection",["classy","signals","text!templates/region_selection.html","mustache","simpleModal","json2"],function(e,t,n){return e.$extend({regionSelectionChanged:null,__init__:function(e){this.container=e,this.regionSelectionChanged=new t.Signal},create:function(e,t,n){var r=this,i=$("#region_button").off("click").on("click",function(){r.openRegionsDialog($(this))})},update:function(e,t,n){var r=this,i="";this.selectedTable=e,this.selectedRegion=t;if(n){$("div#region_button").addClass("active");for(var s=0;s<this.selectedTable.regions.length;s++)this.selectedTable.regions[s].id==this.selectedRegion&&(i=this.selectedTable.regions[s].title);$("#subtitle_region").html(" | Region: "+i)}else $("div#region_button").removeClass("active"),$("#subtitle_region").html("")},openRegionsDialog:function(e){var t=this;this.buttonObject=e;var r=$(Mustache.to_html(n,{regions:t.selectedTable.regions})),i=$("div#regions_dialog");i.empty(),i.append(r);var s=$("#region_select_inner").find(".scrollable_list").children();s.disableSelection();for(var o=0;o<s.length;o++)if($(s[o]).attr("id")==this.selectedRegion){$(s[o]).find("input").attr("checked","checked");break}this.regionsDialogContainer=$("div#regions_dialog_container");var u=this.regionsDialogContainer.parent();this.regionsDialogContainer.appendTo("body").css({position:"absolute",display:"block",left:-9999,top:-9999});var a=this.regionsDialogContainer.height();this.regionsDialogContainer.appendTo(u).css({position:"relative",left:0,top:0}),this.regionsDialogContainer.modal({autoPosition:!1,overlayClose:!0,fixed:!1,persist:!0,minHeight:a,maxHeight:a,close:!1,onClose:function(){t.regionsDialogContainer.find(".region_button").remove(),$(window).off("resize.regionselection"),$.modal.close()}}),e.clone().prependTo(this.regionsDialogContainer),this.regionsDialogContainer.find(".region_button").addClass("selected"),this.positionRegionsDialog(),$(window).on("resize.regionselection",this.resizeCallback=function(){t.positionRegionsDialog()});var f=$(window).height(),l=$("div#simplemodal-container").position().top+$("#simplemodal-container").height(),c=$("div#region_select").height(),h=$("body").scrollTop(),p=l-f+c+10;h<p&&$("html, body").animate({scrollTop:p},600,"swing",function(){});var d=$("#region_select_submit").click(function(){for(var e=0;e<s.length;e++)if($(s[e]).find("input").attr("checked")=="checked"){selected=$(s[e]).attr("id"),t.regionSelectionChanged.dispatch(selected),$.modal.close();break}}),v=$("#region_select_cancel").on("click",function(){$.modal.close()}),m=$("#region_select");m.find(".scrollable_list").bind("scroll",function(){$(this).siblings(".filter_tree_scroller").slider("value",this.scrollHeight-this.offsetHeight==0?100:100-100*this.scrollTop/(this.scrollHeight-this.offsetHeight))}),$(".filter_tree_scroller").each(function(){ele=$(this),ele.slider({orientation:"vertical",min:0,max:100,value:100,slide:function(e,t){(function(){this.scrollTop=(this.scrollHeight-this.offsetHeight)*((100-t.value)/100)}).call($(t.handle).parent().siblings(".scrollable_list").get(0))}}).mousedown(function(e){$.browser.msie&&e.stopPropagation()});var e=ele.siblings(".scrollable_list");e.innerHeight()==e.get(0).scrollHeight&&ele.slider("option","disabled",!0)});if(navigator.appName=="Microsoft Internet Explorer"){function g(e){var t=$(e.data);return e.data!=e.target?t.data("open")?(t.css("width",t.data("originalWidth")),t.data("open",!1)):t.data("open",!0):setTimeout(function(){t.data("open")?(t.css("width",t.data("originalWidth")),t.data("open",!1)):t.data("open",!0)},100),typeof g=="function"&&$("body").unbind("mouseup",g),!0}var y=navigator.userAgent,b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");b.exec(y)!=null&&(rv=parseFloat(RegExp.$1),rv<9&&this.container.find("select").each(function(){var e=$(this);e.css("min-width",e.width()),e.data("originalWidth",e.width())}).bind("mousedown",function(e){var t=$(this),n=$(this).clone();return n.css("width","auto"),t.parent().append(n.css("visible","false")),n.width()>t.width()&&t.css("width","auto"),n.remove(),t.css("position","relative"),$("body").bind("mouseup",this,g),!0}).bind("change blur",function(e){var t=$(this);return t.css("width",t.data("originalWidth")),t.data("open",!1),!0}))}},positionRegionsDialog:function(){buttonOffset=this.buttonObject.offset(),$("#simplemodal-container").css({top:buttonOffset.top,left:buttonOffset.left})}})}),define("text!templates/lineChart.html",[],function(){return'<!-- This Mustache template displays the Highchart indexing options -->\r\n<div id="lineChartContainer"></div>\r\n<div class="chartIndexing">\r\n	<form id="chartOptions">\r\n		<div id="indexContainer">\r\n			<span class="optionsLabel">Chart Indexing Options: </span>\r\n			<input type="radio" id="index0" name="index" value="0" checked="checked"/><label for="index0">None</label>\r\n			<input type="radio" id="index1" name="index" value="1"/><label for="index1">Index to Start as Percent</label> \r\n			<input type="radio" id="index2" name="index" value="2"/><label for="index2">Index to Start as Value</label>\r\n		</div>\r\n	</form>\r\n</div>'}),define("js/view/components/LineChart",["signals","classy","js/view/components/DateCodeUtil","text!templates/lineChart.html"],function(e,t,n,r){return t.$extend({container:null,chart:null,indexingChanged:null,indexing:null,data:null,dataMap:null,dataColumns:null,freq:null,units:null,axis:null,series:null,seriesMap:null,seriesColorQueue:null,seriesSymbolQueue:null,__init__:function(t){var n=this;this.indexing=null,this.data=[],this.dataMap={},this.dataColumns=[],this.freq="",this.units={},this.axis=[],this.series=[],this.seriesMap={},this.seriesColorQueue=this.$class.seriesColors.slice(0),this.container=t,this.indexingChanged=new e.Signal,this.container.html(Mustache.render(r)),$("#indexContainer",this.container).buttonset(),$('form input[name="index"]',this.container).on("change",function(e){n.indexingChanged.dispatch($(e.target).val())})},embed:function(){this.chart.openAPIEmbed()},createSeriesOpts:function(e,t,n,r,i,s,o){var u=e.chart_name;if(e.regionTitle){var a=": "+e.regionTitle;if(o&&o.indexOf("Region:")>=0){var f=o.substr(o.indexOf("Region:")+8);f.indexOf(e.regionTitle)>=0&&(a="")}u=="All"?u=e.regionTitle:u+=a}if(e.caseTitle){var l=": "+e.caseTitle;if(o&&o.indexOf("Case:")>=0){var c=o.substr(o.indexOf("Case:")+6);c.indexOf("|")>=0&&(c=c.substr(0,c.indexOf("|"))),c.indexOf(e.caseTitle)>=0&&(l="")}u=="All"?u=e.caseTitle:u+=l}var h={data:[],color:this.claimNextColor(),marker:{symbol:this.claimNextSymbol()},stickyTracking:!1,xType:function(){switch(n){case"A":return Highcharts.xTypes.annual}}(),region:e.regionTitle,"case":e.caseTitle},p=h.name=(i?e.pinned_name:u)+(r?" ("+e.units+")":"");return this.indexSeries(e,t,n,h,s)},resetColorQueue:function(){this.seriesColorQueue=this.$class.seriesColors.slice(0)},claimNextColor:function(){return color=this.seriesColorQueue.shift(),this.seriesColorQueue.push(color),color},releaseColor:function(e){this.seriesColorQueue.splice($.inArray(e,this.seriesColorQueue),1),this.seriesColorQueue.unshift(e)},resetSymbolQueue:function(){this.seriesSymbolQueue=this.$class.seriesSymbols.slice(0)},claimNextSymbol:function(){return symbol=this.seriesSymbolQueue.shift(),this.seriesSymbolQueue.push(symbol),symbol},releaseSymbol:function(e){this.seriesSymbolQueue.splice($.inArray(e,this.seriesSymbolQueue),1),this.seriesSymbolQueue.unshift(e)},update:function(e,t,r,i,s,o,u,a,f,l,c){var h=this,p=[],d=[],v={},m,g,y,b,w=[],E=[];this.data=t,this.dataColumns=r,this.freq=i,this.indexing=s,this.seriesMap={},this.resetColorQueue(),this.resetSymbolQueue(),this.setIndexed(this.indexing);if(this.indexing!=1)for(m=0;m<this.data.length;m++)t[m]!=null&&(y=t[m],b=y.units,b in v||(v[b]=d.length,d.push($.extend(!0,{title:{text:b},opposite:d.length%2},this.$class.defaultYAxisOptions))));else b="Percent",v[b]=0,d.push($.extend({title:{text:b}},this.$class.defaultYAxisOptions));for(m=0;m<this.data.length;m++)if(t[m]!=null){y=t[m];var S=y.uuid.split(".")[1].split("-")[2].replace("ER","").replace("AEO",""),x=y.uuid.split(".")[0].split("-")[0];y.series_id.split(".").length>2?w.push(y.series_id):w.push(y.series_id+"0-0");for(var T=0;T<c.length;T++){var N=!1;c[T].id==y["uuid"].split(".")[1].split("-")[2]&&c[T].inAPI&&(N=!0,E.push(("AEO."+S+"."+x+"."+y.varName+".A").toUpperCase())),!!N}var C=null;if((s==="1"||s==="2")&&!isNaN(y.data[o])||s==="0"||typeof s=="undefined")C=this.createSeriesOpts(y,r,i,d.length>1?!0:!1,a,o,l),$.each(C,function(e,t){C[e]=$.extend(C[e],{yAxis:s==="1"?0:v[y.units]}),p.push(C[e])})}else this.claimNextColor(),this.claimNextSymbol();this.destroy(),g=$.extend(!0,{chart:{renderTo:$("#lineChartContainer",this.container).get(0),spacingBottom:0},title:{text:e},subtitle:{text:l},yAxis:d,xAxis:{min:n.parseDateCode(o,i).getTime(),max:n.parseDateCode(u,i).getTime()},series:p,userGenerated:f,tooltip:{formatter:function(){var e=(new Date(this.x)).getUTCFullYear();this.series.linkedSeries.length||(e+=" (Projected)");var t="<b>"+this.series.name+"</b><br>Year: "+e+"<br>";this.series.userOptions.region&&(t+="Region: "+this.series.userOptions.region+"<br>"),this.series.userOptions.case&&(t+="Case: "+this.series.userOptions.case+"<br>");var n=this.indexing==1?2:y.precision==0?1:y.precision;return t+=Highcharts.numberFormat(this.y,n,void 0,",")+" "+y.units,t}}},this.$class.defaultChartOptions),t.length==1&&(g.legend={enabled:!1}),$.extend(!0,g,{exporting:{embedOptions:{series_id:null,relation_mode:"line"}}}),E.length>0&&(g.exporting.embedOptions.series_id=E.join(";")),i=="A"&&(g.xAxis.tickInterval=31536e6),r.length>20&&(g.xAxis.tickInterval*=2);switch(s){case"1":$.extend(!0,g,{yAxis:Highcharts.map(g.yAxis,function(e){return $.extend(!0,e,{min:null,title:{text:"Indexed to "+n.formatDateCode(o,i)+" as percent",align:g.yAxis.length>2?"middle":"above"}})})});break;case"2":$.extend(!0,g,{yAxis:Highcharts.map(g.yAxis,function(e){return $.extend(!0,e,{min:null,title:{text:"Indexed to "+n.formatDateCode(o,i)+" as value",align:g.yAxis.length>2?"middle":"above"}})})});break;default:$.extend(!0,g,{yAxis:Highcharts.map(g.yAxis,function(e){return $.extend(!0,e,{min:0,title:{align:g.yAxis.length>2?"middle":"above"}})})})}this.units=v,this.axis=d,this.chart=new this.$class.chartConstructor(g),this.series=this.chart.series.slice(0),$.each(this.series,function(e,t){h.seriesMap[t.name]=e})},setStartEnd:function(e,t,r){this.chart.xAxis&&this.chart.xAxis.length>0&&this.chart.xAxis[0].setExtremes(n.parseDateCode(e,r).getTime(),n.parseDateCode(t,r).getTime());switch(this.indexing){case"1":this.chart.yAxis[0].setTitle({text:"Indexed to "+n.formatDateCode(e,r)+" as percent"});break;case"2":this.chart.yAxis[0].setTitle({text:"Indexed to "+n.formatDateCode(e,r)+" as value"});break;default:}var i=[];for(var s=0;s<this.data.length;s++)this.data[s]!=null&&(i=i.concat(this.indexSeries(this.data[s],this.dataColumns,r,{data:[]},e)));for(var s=0;s<i.length;s++)this.chart.series[s].setData(i[s].data,!1);this.chart.redraw()},download:function(e){if(this.chart)if(e=="csv")this.chart.generateCSV();else{var t;switch(e){case"pdf":t={url:"/global/scripts/jquery/highcharts/exporting-server/index.cfm",type:"application/pdf"};break;case"png":default:t={url:"/global/scripts/jquery/highcharts/exporting-server/index.cfm"}}this.chart.exportChart(t)}},setIndexed:function(e){typeof e=="undefined"&&(e=0),$('form input[name="index"]').filter("[value="+e+"]").prop("checked",!0),$("#indexContainer",this.container).buttonset("refresh")},removeSeries:function(e){this.highchartSeries[e.chart_name].remove(),delete this.seriesOptions[e.chart_name]},indexSeries:function(e,t,r,i,s){var o=null;e.indexed={};switch(this.indexing){case"1":$.each(e.data,function(t,n){t>=s&&n!=""&&o==null&&(o=n),o!=null?e.indexed[t]=n/o*100-100:e.indexed[t]=null});break;case"2":$.each(e.data,function(t,n){t>=s&&n!=""&&o==null&&(o=n),o!=null?e.indexed[t]=n-o:e.indexed[t]=null});break;default:e.indexed=e.data}var u,a,f=[i];for(a=0;a<t.length;a++){var l=parseInt(t[a].toString());isNaN(l)||f[0].data.push([n.parseDateCode(l,r).getTime(),isNaN(u=parseFloat(e.indexed[l]))?null:u])}return typeof e.last_historical!="undefined"&&(f[0].lastHistoricalPeriod=e.last_historical),[i]},destroy:function(){this.chart!=null&&(this.chart.hasRendered==1&&this.chart.destroy(),$(".chartCaptionsContainer",this.container).remove(),this.chart=null)},__classvars__:{chartConstructor:Highcharts.Chart,seriesColors:Highcharts.getOptions().colors,seriesSymbols:Highcharts.getOptions().symbols,defaultYAxisOptions:{labels:{x:null,y:null}},defaultChartOptions:{chart:{zoomType:"",panning:!1,lineUpYAxisZeros:!0},xAxis:{maxZoom:1,type:"datetime",labels:{y:20},startOnTick:!1,showFirstLabel:!0},navigator:{enabled:!1},rangeSelector:{enabled:!1},scrollbar:{enabled:!1}}}})}),define("animatedComponent",["classy"],function(e){return e.$extend({__init__:function(){this.animation={enabled:!1,stepSize:1e3,iteration:0,interval:null}},update:function(e){$.extend(this.animation,e)},play:function(e,t){var n=this,r=function(){var t;n.animation.maxIteration&&(e?t=n.animation.iteration%n.animation.maxIteration:(t=Math.min(n.animation.iteration,n.animation.maxIteration),t==n.animation.maxIteration&&n.stop())),n.animation.callback&&n.animation.callback.call(n,t);if(n.animation.maxIteration===void 0||t+1<=n.animation.maxIteration)n.animation.iteration=t+1};this.animation.interval&&this.stop(),r(),this.animation.interval=setInterval(r,t||this.animation.stepSize)},stop:function(){clearInterval(this.animation.interval),this.animation.interval=null},reset:function(e){this.animation.iteration=Math.min(e,this.animation.maxIteration),this.animation.callback&&this.animation.callback.call(this,e)},destroy:function(){this.stop()}})}),function(){function e(e){var t=e.currentTarget||e.srcElement,n;if(e.type==="load"||s.test(t.readyState)){e=t.getAttribute("data-requiremodule"),u[e]=!0;for(e=0;n=o[e];e++){if(!u[n.name])break;n.req([n.name],n.onLoad)}e>0&&o.splice(0,e),setTimeout(function(){t.parentNode.removeChild(t)},15)}}function t(e){var t,n;e.setAttribute("data-orderloaded","loaded");for(e=0;n=f[e];e++){if(!(t=a[n])||t.getAttribute("data-orderloaded")!=="loaded")break;delete a[n],require.addScriptToDom(t)}e>0&&f.splice(0,e)}var n=typeof document!="undefined"&&typeof window!="undefined"&&document.createElement("script"),r=n&&(n.async||window.opera&&Object.prototype.toString.call(window.opera)==="[object Opera]"||"MozAppearance"in document.documentElement.style),i=n&&n.readyState==="uninitialized",s=/^(complete|loaded)$/,o=[],u={},a={},f=[],n=null;define("order",{version:"1.0.5",load:function(n,s,u,l){var c;s.nameToUrl?(c=s.nameToUrl(n,null),require.s.skipAsync[c]=!0,r||l.isBuild?s([n],u):i?(l=require.s.contexts._,!l.urlFetched[c]&&!l.loaded[n]&&(l.urlFetched[c]=!0,require.resourcesReady(!1),l.scriptCount+=1,c=require.attach(c,l,n,null,null,t),a[n]=c,f.push(n)),s([n],u)):s.specified(n)?s([n],u):(o.push({name:n,req:s,onLoad:u}),require.attach(c,null,n,e,"script/cache"))):s([n],u)}})}(),define("map",["animatedComponent","signals","order!jVectorMap","order!usa-en"],function(e,t,n){return e.$extend({__init__:function(e,n){var r=this;this.$super(),this.container=e,this.regionClicked=new t.Signal,this.markerClicked=new t.Signal,this.mapContainer=$("#mapContainer",this.container),this.legendContainer=$("#map_legend",this.container),this.titleContainer=$("#mapTitle",this.container),this.titleContainer.length==0&&(this.titleContainer=$('<h2 id="mapTitle"></h2>').appendTo(this.container)),this.mapContainer.length==0&&(this.mapContainer=$('<div id="mapContainer"></div>').appendTo(this.container)),this.legendContainer.length==0&&(this.legendContainer=$('<div id="map_legend"></div>').appendTo(this.container)),this.counts=null,this.map=null,this.colors={},this.basemap=n==null?"usa_en":n,this.options={animation:{callback:function(e){this.colors?this.worldMap.series.regions[0].setValues(this.getCurrentColors()):this.worldMap.series.regions&&this.worldMap.series.regions.length>0?this.worldMap.series.regions[0].setValues(this.getCurrentCounts()):this.worldMap.series.markers&&this.worldMap.series.markers.length>0&&this.worldMap.series.markers[0].setValues(this.getCurrentCounts())}},map:this.basemap,normalizeFunction:"polynomial",hoverOpacity:.7,hoverColor:!1,backgroundColor:"white",dataPrecision:0}},play:function(e,t){this.$super(e,t)},update:function(e,t,n){var r=this;typeof n!="undefined"&&typeof n.map!="undefined"&&(this.basemap=n.map,this.options.map=n.map),this.counts=$.map(e instanceof Array?e:[e],function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(jvm.WorldMap.maps[r.basemap].paths.hasOwnProperty(n.toUpperCase())?t[n.toUpperCase()]=e[n]:jvm.WorldMap.maps[r.basemap].paths.hasOwnProperty(n.toLowerCase())?t[n.toLowerCase()]=e[n]:t[n]=e[n]);return t}),this.options=$.extend(this.options||{},n),this.$super($.extend(!0,this.animation,this.options.animation,{maxIteration:e.length-1})),this.setTitle(t),this.calculateMinMax(),typeof this.assignColors=="function"&&this.assignColors(),this.createLegend(),this.setContainerHeight(),this.createMap()},setContainerHeight:function(){this.mapContainer.height(this.mapContainer.parent().height()-(this.titleContainer.outerHeight(!0)+this.legendContainer.outerHeight(!0)+parseInt(this.mapContainer.css("paddingTop"))+parseInt(this.mapContainer.css("paddingBottom"))+10))},calculateMinMax:function(){this.min=this.max=null;for(var e=0;e<this.counts.length;e++)for(var t in this.counts[e])this.counts[e].hasOwnProperty(t)&&(this.min=this.min==null||this.counts[e][t]<this.min?this.counts[e][t]:this.min,this.max=this.max==null||this.counts[e][t]>this.max?this.counts[e][t]:this.max);this.min!==null&&(this.min=parseFloat(Highcharts.numberFormat(this.min,this.options.dataPrecision,".",""))),this.max!==null&&(this.max=parseFloat(Highcharts.numberFormat(this.max,this.options.dataPrecision,".","")))},setTitle:function(e){this.titleContainer.text(e)},createRegionOps:function(){return[{values:this.colors?this.getCurrentColors():this.getCurrentCounts(),min:this.min,max:this.max,scale:this.colors?void 0:this.$class.palette}]},createMarkerOps:function(){return this.options.markers?[{values:this.colors?this.getCurrentColors():this.getCurrentCounts(),min:this.min,max:this.max,scale:this.colors?void 0:this.$class.palette}]:null},createMap:function(){var e=this;this.worldMap&&this.worldMap.remove(),this.regionOps=this.createRegionOps(),this.markerOps=this.createMarkerOps();var t={};this.regionOps&&(t.regions=this.regionOps),this.markerOps&&(t.markers=this.markerOps),this.mapContainer.empty(),this.map=$('<div style="height:100%;width:100%;" class="map_inside_container"></div>').appendTo(this.mapContainer).vectorMap($.extend(!0,{regionStyle:{initial:{fill:"#CCCCCC","fill-opacity":1,stroke:"none","stroke-width":0,"stroke-opacity":1},hover:{"fill-opacity":.8},selected:{fill:"yellow"}},series:t,onRegionClick:function(t,n){e.regionClicked.dispatch(n.toUpperCase(),t)},onMarkerClick:function(t,n){e.markerClicked.dispatch(e.options.markers[n],t)},zoomOnScroll:!1},this.options)),this.worldMap=this.mapContainer.find(".jvectormap-container").data("mapObject")},createLegend:function(e,t){},getCurrentColors:function(){var e={};return $.each(jvm.WorldMap.maps[this.basemap].paths,function(t,n){e[t]=""}),$.extend(e,this.colors[this.animation.iteration])},getCurrentCounts:function(){return this.counts[this.animation.iteration]},destroy:function(){this.worldMap&&this.worldMap.remove(),this.mapContainer.empty(),this.legendContainer.empty(),this.titleContainer.empty()},assignColors:function(e,t,n){},exportMap:function(e){if(!window.SVGAngle)throw"SVG not supported";var t="white",n=$(".jvectormap-container").html(),r=$(".jvectormap-container").html(),i=$(".jvectormap-container").find("svg").attr("height");i=parseInt(i)+20;var s=n.indexOf("height");s=n.indexOf('"',s);var o=n.indexOf('"',s+1);n=n.slice(0,s+1)+i+n.slice(o),n=n.replace(/<div[^<]+<\/div>/gi,""),n=n.replace(/<svg /gi,'<svg xmlns="http://www.w3.org/2000/svg"  version="1.1" '),n=n.replace(/<g><\/g>/gi,""),n=n.replace(/<g/,'<rect x="0" y="0" width="100%" height="100%" fill="'+t+'"></rect><g'),n=n.replace(/zIndex="[^"]+"/g,"").replace(/isShadow="[^"]+"/g,"").replace(/symbolName="[^"]+"/g,"").replace(/jQuery[0-9]+="[^"]+"/g,"").replace(/isTracker="[^"]+"/g,"").replace(/url\([^#]+#/g,"url(#").replace(/&nbsp;/g,"Â ").replace(/&shy;/g,"Â­").replace(/id=([^" >]+)/g,'id="$1"').replace(/class=([^" ]+)/g,'class="$1"').replace(/ transform /g," ").replace(/:(path|rect)/g,"$1").replace(/style="([^"]+)"/g,function(e){return e.toLowerCase()}),n=n.replace(/(url\(#highcharts-[0-9]+)&quot;/g,"$1").replace(/&quot;/g,"'"),n.match(/ xmlns="/g)&&n.match(/ xmlns="/g).length===2&&(n=n.replace(/xmlns="[^"]+"/,""));var u="/global/scripts/jquery/highcharts/exporting-server/index.cfm",a="";switch(e){case"svg":a="image/svg+xml";break;case"pdf":a="application/pdf";break;case"png":default:a="image/png"}String.prototype.replaceAll=function(e,t){return t?this.replace(new RegExp("["+e+"]","g"),t):this};var f=$('<form action="'+u+'" method="POST">'+'<input type="hidden" name="svg" id="hiddensvg">'+'<input type="hidden" name="type" value="'+a+'">'+'<input type="hidden" name="filename" value="map_of_'+this.titleContainer.text().replaceAll(":",",").replaceAll(" ","_")+'">'+"</form>");$("body").append(f),f.find("input[id=hiddensvg]").val(n),f.submit(),f.remove()},__classvars__:{palette:["#7ce3ff","#4cc9ff","#0196d8","#00628c","#00355b"]}})}),define("continuousMap",["signals","map","order!jVectorMap","order!usa-en"],function(e,t,n){return t.$extend({__init__:function(e,t){this.$super(e,t)},createLegend:function(e){var t=this,n=this,r,i,s,o,u,a;this.legendContainer.empty();var f=$('<span style="display: inline-block; text-align:center;"></span>').appendTo(this.legendContainer);this.options.legendTitle&&($('<span class="map_legend_title">'+this.options.legendTitle+"</span>").appendTo(f),$("<br />").appendTo(f)),t.options.legendItemFormatter?(u=t.options.legendItemFormatter.call(t,this.min),a=t.options.legendItemFormatter.call(t,this.max)):(u=this.min,a=this.max),t.$class.drawGradient(f,t.$class.palette[0],t.$class.palette[t.$class.palette.length-1],u,a),$("<br />").appendTo(f),$("<br />").appendTo(f);var l=$("<div/>").appendTo(f);$("<span/>").appendTo(l).attr("style","display:inline-block;margin-right:10px;width:20px;height:20px;background-color:#CCC"),$("<span>Value is not available</span>").appendTo(l).attr("style","margin-top:3px;display:inline-block;")},assignColors:function(){var e=[],t=this.max,n=this.min,r=parseInt(this.$class.palette[0].substring(1,3),16),i=parseInt(this.$class.palette[this.$class.palette.length-1].substring(1,3),16),s=parseInt(this.$class.palette[0].substring(3,5),16),o=parseInt(this.$class.palette[this.$class.palette.length-1].substring(3,5),16),u=parseInt(this.$class.palette[0].substring(5),16),a=parseInt(this.$class.palette[this.$class.palette.length-1].substring(5),16),f,l,c,h,p,d;for(var v=0;v<this.counts.length;v++)for(f in this.counts[v]){e[v]||(e[v]={}),l=parseFloat(Highcharts.numberFormat(this.counts[v][f],this.options.dataPrecision,".","")),c=(l-n)/(t-n);switch(this.scaleType){case"logarithmic":c=(Math.log(l)-Math.log(n))/(Math.log(t)-Math.log(n))}h=parseInt(c*i-(c-1)*r,10).toString(16).replace(/^(\w{1})$/,"0$1"),p=parseInt(c*o-(c-1)*s,10).toString(16).replace(/^(\w{1})$/,"0$1"),d=parseInt(c*a-(c-1)*u,10).toString(16).replace(/^(\w{1})$/,"0$1"),e[v][f]="#"+h+p+d}this.colors=e},__classvars__:{drawGradient:function(e,t,n,r,i){var s="";s+="background-image: -ms-linear-gradient(left, "+t+" 0%, "+n+" 100%);",s+='-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr='+t+", endColorstr="+n+', gradientType=1)";',s+="filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="+t+", endColorstr="+n+", gradientType=1)",s+="background-image: -webkit-gradient(linear, left bottom, right bottom, from("+t+"), to("+n+"));",s+="background-image: -webkit-linear-gradient(left, "+t+", "+n+");",s+="background-image:    -moz-linear-gradient(left, "+t+", "+n+");",s+="background-image:      -o-linear-gradient(left, "+t+", "+n+";",s+="background-image:         linear-gradient(to left, "+t+","+n+");",$("<span>"+r+"</span>").appendTo(e),$('<span class="map_legend_gradient"></span>').appendTo(e).attr("style",s),$("<span>"+i+"</span>").appendTo(e)}}})}),define("growthMap",["map"],function(e){return e.$extend({__init__:function(e,t){this.$super(e,t)},update:function(e,t,n){e=$.map(e,function(t,n){var r={};for(var i in t)t.hasOwnProperty(i)&&n>0&&typeof e[n-1]!="undefined"&&e[n-1].hasOwnProperty(i)&&t[i]*e[n-1][i]>0&&(r[i]=100*(t[i]-e[n-1][i])/e[n-1][i]);return r}),this.$super(e,t,$.extend({},n,{backgroundColor:"#ffffff"}))},createRegionOps:function(){return[{attributes:this.getCurrentColors()}]},createLegend:function(){var e=this,t,n,r,i,s,o;this.legendContainer.empty();var u=$('<span style="display: inline-block; text-align:center;"></span>').appendTo(this.legendContainer);this.options.legendTitle&&($('<span class="map_legend_title">'+this.options.legendTitle+"</span>").appendTo(u),$("<br />").appendTo(u)),e.options.legendItemFormatter?(s=e.options.legendItemFormatter.call(e,this.min),o=e.options.legendItemFormatter.call(e,this.max)):(s=this.min,o=this.max);var a="",f="";a+="background-image: -ms-linear-gradient(left, "+this.$class.palette[0]+" 0%, "+this.$class.palette[1]+" 100%);",a+='-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr='+this.$class.palette[0]+", endColorstr="+this.$class.palette[1]+', gradientType=1)";',a+="filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="+this.$class.palette[0]+", endColorstr="+this.$class.palette[1]+", gradientType=1)",a+="background-image: -webkit-gradient(linear, left bottom, right bottom, from("+this.$class.palette[0]+"), to("+this.$class.palette[1]+"));",a+="background-image: -webkit-linear-gradient(left, "+this.$class.palette[0]+", "+this.$class.palette[1]+");",a+="background-image:    -moz-linear-gradient(left, "+this.$class.palette[0]+", "+this.$class.palette[1]+");",a+="background-image:      -o-linear-gradient(left, "+this.$class.palette[0]+", "+this.$class.palette[1]+";",a+="background-image:         linear-gradient(to left, "+this.$class.palette[0]+","+this.$class.palette[1]+");",f+="background-image: -ms-linear-gradient(left, "+this.$class.palette[3]+" 0%, "+this.$class.palette[4]+" 100%);",f+='-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr='+this.$class.palette[3]+", endColorstr="+this.$class.palette[4]+', gradientType=1)";',f+="filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="+this.$class.palette[3]+", endColorstr="+this.$class.palette[4]+", gradientType=1)",f+="background-image: -webkit-gradient(linear, left bottom, right bottom, from("+this.$class.palette[3]+"), to("+this.$class.palette[4]+"));",f+="background-image: -webkit-linear-gradient(left, "+this.$class.palette[3]+", "+this.$class.palette[4]+");",f+="background-image:    -moz-linear-gradient(left, "+this.$class.palette[3]+", "+this.$class.palette[4]+");",f+="background-image:      -o-linear-gradient(left, "+this.$class.palette[3]+", "+this.$class.palette[4]+";",f+="background-image:         linear-gradient(to left, "+this.$class.palette[3]+","+this.$class.palette[4]+");",$("<span>"+s+"</span>").appendTo(u);var l=$('<span class="map_legend_gradient"></span>').appendTo(u);$('<span class="growth_gradient_component"></span>').attr("style",a).appendTo(l),$('<span class="growth_gradient_component"></span>').attr("style",f).appendTo(l),$("<span>"+o+"</span>").appendTo(u),$("<br />").appendTo(u),$("<br />").appendTo(u);var c=$("<div/>").appendTo(u);$("<span></span").appendTo(c).attr("style","display:inline-block;margin-right:10px;width:20px;height:20px;background-color:#CCC"),$("<span>Value is not available</span>").appendTo(c).attr("style","margin-top:3px;display:inline-block;")},calculateMinMax:function(){this.options.extremes!==void 0?(this.min=this.options.extremes.min,this.max=this.options.extremes.max):(this.$super(),this.max>0&&this.min<0&&(Math.abs(this.min)>this.max?this.max=Math.abs(this.min):this.min=-1*this.max))},assignColors:function(){var e=[],t=this.max,n=this.min,r,i,s,o,u,a,f,l,c,h,p,d,v;for(var m=0;m<this.counts.length;m++)for(f in this.counts[m])l=parseFloat(Highcharts.numberFormat(this.counts[m][f],this.options.dataPrecision,".","")),l<0?(h=(l-n)/(-1*n),r=parseInt(this.$class.palette[0].substring(1,3),16),i=parseInt(this.$class.palette[1].substring(1,3),16),s=parseInt(this.$class.palette[0].substring(3,5),16),o=parseInt(this.$class.palette[1].substring(3,5),16),u=parseInt(this.$class.palette[0].substring(5),16),a=parseInt(this.$class.palette[1].substring(5),16),p=(r<i?Math.max:Math.min).call(window,parseInt(h*i-(h-1)*r,10),r).toString(16).replace(/^(\w{1})$/,"0$1"),d=(s<o?Math.max:Math.min).call(window,parseInt(h*o-(h-1)*s,10),s).toString(16).replace(/^(\w{1})$/,"0$1"),v=(u<a?Math.max:Math.min).call(window,parseInt(h*a-(h-1)*u,10),u).toString(16).replace(/^(\w{1})$/,"0$1")):l>0?(h=l/t,r=parseInt(this.$class.palette[3].substring(1,3),16),i=parseInt(this.$class.palette[4].substring(1,3),16),s=parseInt(this.$class.palette[3].substring(3,5),16),o=parseInt(this.$class.palette[4].substring(3,5),16),u=parseInt(this.$class.palette[3].substring(5),16),a=parseInt(this.$class.palette[4].substring(5),16),p=(r>i?Math.max:Math.min).call(window,parseInt(h*i-(h-1)*r,10),i).toString(16).replace(/^(\w{1})$/,"0$1"),d=(s>o?Math.max:Math.min).call(window,parseInt(h*o-(h-1)*s,10),o).toString(16).replace(/^(\w{1})$/,"0$1"),v=(u>a?Math.max:Math.min).call(window,parseInt(h*a-(h-1)*u,10),a).toString(16).replace(/^(\w{1})$/,"0$1")):(p=this.$class.palette[2].substring(1,3),d=this.$class.palette[2].substring(3,5),v=this.$class.palette[2].substring(5)),e[m]||(e[m]={}),e[m][f]="#"+p+d+v;this.colors=e},__classvars__:{palette:["#6F2EA4","#C5ABDB","#CCCCCC","#BED5AD","#5D9732"]}})}),define("text!templates/animatedMap.html",[],function(){return'<!-- This Mustache template displays the jVectorMap -->\r\n<h2 id="mapTitle"></h2>\r\n<div id="mapContainer"></div>\r\n<div id="map_controls_container">\r\n	<h2>Map controls &amp; legend</h2>\r\n	<div class="animated_map_button_container">\r\n		<div id="animated_map_type_container">\r\n			<span class="optionsLabel">Value options:</span>\r\n			{{#mapTypes}}\r\n			<input id="radio_{{id}}" type="radio" name="animated_map_type_radio" value="{{id}}" /><label for="radio_{{id}}">{{title}}</label>\r\n			{{/mapTypes}}\r\n		</div>\r\n		<br/>	\r\n		<div id="animated_map_slider"></div>\r\n		<br/>\r\n		<div id="animated_map_transport_container">\r\n			<input type="checkbox" id="play_button"></input><label for="play_button">Play</label>\r\n			<input type="checkbox" id="pause_button"></input><label for="pause_button">Pause</label>\r\n			<button id="reset_button">Reset</button>\r\n		</div>\r\n		<hr>\r\n		<div id="map_units_label_container">\r\n			<span id="map_units_label"></span>\r\n		</div>\r\n		<div id="map_legend"></div>\r\n	</div>\r\n</div>\r\n'}),define("js/view/components/AnimatedMap",["classy","continuousMap","growthMap","signals","js/view/components/DateCodeUtil","text!templates/animatedMap.html","mustache","us-census-merc-en"],function(e,t,n,r,i,s){return e.$extend({__init__:function(e){this.ContinuousMapClass=t=t.$extend({__classvars__:{palette:["#b0efff","#001F37"]}}),this.GrowthMapClass=n;var i=this;this.container=e,this.container.html(Mustache.render(s,{mapTypes:[{id:this.$class.CONTINUOUS_MAP,title:"Values"},{id:this.$class.GROWTH_MAP,title:"Growth"}]})),this.createPlayerControls(),this.mapTypeButtonset=$("#animated_map_type_container",this.container).buttonset(),this.mapTypeSelector=$("[name=animated_map_type_radio]",this.container),this.unitsLabel=$("#map_units_label",this.container),this.mapTypeChangeRequested=new r.Signal,this.mapTypeSelectorHandler=function(e){i.mapTypeChangeRequested.dispatch(i.mapTypeSelector.filter(":checked").val())}},createPlayerControls:function(){var e=this;this.playButton=$("#play_button",this.container).button({icons:{primary:"map_play_icon"}}),this.pauseButton=$("#pause_button",this.container).button({icons:{primary:"map_pause_icon"}}),this.resetButton=$("#reset_button",this.container).button({icons:{primary:"map_reset_icon"}}),this.slider=$("#animated_map_slider",this.container).slider(),this.handle=$("#animated_map_slider",this.container).children(".ui-slider-handle"),this.sliderLabel=$('<div class="map_slider_tooltip" style="margin-top: -18px;"></div>').css({position:"absolute"}).appendTo(this.handle),this.playHandler=function(){e.map.stop(),e.position==e.displayColumns[e.displayColumns.length-1]&&e.map.reset(0),e.setButtonState(!0),e.map.play(!1,300)},this.pauseHandler=function(){e.map.stop(),e.setButtonState(!1)},this.resetHandler=function(){e.map.stop(),e.map.reset(e.displayColumns.length-1),e.position=e.displayColumns[e.displayColumns.length-1],e.map.setTitle(e.title+" "+e.displayColumns[e.displayColumns.length-1]),e.setButtonState(!1),$("#reset_button").removeClass("red")},this.sliderHandler=function(t,n){e.map.stop(),e.map.reset(n.value),e.position=e.displayColumns[n.value],e.setButtonState(!1)},$('label[for="'+this.pauseButton.attr("id")+'"]').hide()},destroy:function(){this.map&&this.map.destroy()},update:function(e,t,n,r,s,o,u){var a=this,f=0;this.displayColumns=[],this.counts=[],this.basemap=typeof u=="undefined"?"us_census_merc_en":u,this.title=e.TITLE,this.data=e,this.mapType=t,this.start=n,this.end=r,this.options=o,this.map&&(this.map.stop(),this.map.destroy()),this.setButtonState(!1);switch(t){case this.$class.GROWTH_MAP:this.map=new this.GrowthMapClass(this.container,this.basemap),this.units="Percent change from prior",this.precision=2;break;default:this.map=new this.ContinuousMapClass(this.container,this.basemap),this.units=e.UNITS||"",this.precision=e.PRECISION}this.unitsLabel.text(this.units),this.mapTypeSelector.filter("[value="+t+"]").attr("checked","true"),this.mapTypeButtonset.buttonset("refresh"),$.each(e.DATACOLUMNS,function(t,i){i>=n&&i<=r&&(a.displayColumns.push(i),a.counts.push(e.DATA[i]))}),this.position!==void 0?(f=$.inArray(this.position,this.displayColumns),~f||(f=this.displayColumns.length-1)):f=this.displayColumns.length-1,this.map.animation.enabled=!0,this.map.update(this.counts,this.title+" "+this.displayColumns[f],$.extend({animation:{enabled:!0,callback:function(e){this.colors?this.worldMap.series.regions[0].setValues(this.getCurrentColors()):this.worldMap.series.regions&&this.worldMap.series.regions.length>0&&this.worldMap.series.regions[0].setValues(this.getCurrentCounts());var t={},n=a.displayColumns[e];a.position=n;var r=typeof n=="undefined"||n==null?"":i.formatDateCode(n,s);a.map.setTitle(a.title+" "+r),a.sliderLabel.text(r),t.left=-0.5*a.sliderLabel.width()+.5*a.handle.width(),a.sliderLabel.height()>1.5*parseInt(a.sliderLabel.css("font-size").slice(0,-2),10)?t.top=-0.5*a.sliderLabel.height():t.top=0,a.sliderLabel.css(t),a.slider.slider("option","value",e),e==a.displayColumns.length-1&&a.setButtonState(!1)},iteration:f},continuous:!0,isGrowth:!0,dataPrecision:3,extremes:{min:-100,max:100},legendItemFormatter:function(e){var n;return t==a.$class.GROWTH_MAP?(n=Highcharts.numberFormat(e,a.precision)+"%",e>0&&(n+="+")):n=Highcharts.numberFormat(e,a.precision),n},zoomOnScroll:!0,onRegionLabelShow:function(e,t,n){if(n){var r=a.map.getCurrentCounts()[n];r!==void 0&&$(t).html($(t).html()+" "+Highcharts.numberFormat(r,a.precision)+" "+(a.mapType==a.$class.GROWTH_MAP?"% change from "+i.formatDateCode(i.deincrementDateCode(a.position,s),s)+" to "+i.formatDateCode(a.position,s):a.units))}else t.empty()}},o)),this.map.reset(f),this.slider.slider("option","min",0),this.slider.slider("option","max",this.displayColumns.length-1),this.slider.slider("option","value",f),typeof this.sliderHandler=="function"&&this.slider.unbind("slide",this.sliderHandler),this.slider.bind("slide",this.sliderHandler),typeof this.playHandler=="function"&&this.playButton.unbind("click",this.playHandler),this.playButton.bind("click",this.playHandler),typeof this.pauseHandler=="function"&&this.pauseButton.unbind("click",this.pauseHandler),this.pauseButton.bind("click",this.pauseHandler),typeof this.resetHandler=="function"&&this.resetButton.unbind("click",this.resetHandler),this.resetButton.bind("click",this.resetHandler),typeof this.mapTypeSelectorHandler=="function"&&this.mapTypeSelector.unbind("change",this.mapTypeSelectorHandler),this.mapTypeSelector.bind("change",this.mapTypeSelectorHandler)},setButtonState:function(e){e&&(this.playButton.attr("checked",!1),$('label[for="'+this.playButton.attr("id")+'"]').hide(),$('label[for="'+this.pauseButton.attr("id")+'"]').show()),e||(this.pauseButton.attr("checked",!1),$('label[for="'+this.pauseButton.attr("id")+'"]').hide(),$('label[for="'+this.playButton.attr("id")+'"]').show()),this.playButton.button("refresh"),this.pauseButton.button("refresh")},outputToArrOfArrs:function(){var e=[],t=[],n=this.map.worldMap.regions,r,i,s,o;for(r in n)n.hasOwnProperty(r)&&t.push(r);t.sort(),e.push(["Units: "+(this.mapType==this.$class.GROWTH_MAP?"percent change from previous period":this.data.UNITS)]);var u=this.displayColumns.slice();u.unshift(""),e.push(u);for(s=0;s<t.length;s++){r=t[s],e.push(o=['"'+r+'"']);for(i=0;i<this.counts.length;i++)o.push(this.map.counts[i][r]||"")}return e},__classvars__:{CONTINUOUS_MAP:"0",GROWTH_MAP:"1"}})}),define("text!templates/downloadBox.html",[],function(){return'<!-- This Mustache template displays the Download modal dialog  -->\r\n<div class="style2">\r\n		<dl class="download_menu">\r\n			{{#downloadItems}}\r\n			<dt>{{#id}}<a id="{{id}}" class="download_option {{class}}">{{/id}}{{label}}{{#id}}</a>{{/id}}</dt>\r\n			{{#children}}\r\n				<dd><a id="{{id}}" class="download_option {{class}}">{{label}}</a></dd>\r\n			{{/children}}\r\n			{{/downloadItems}}\r\n			<dt class="clear"/>\r\n		</dl>\r\n</div>'}),define("js/view/components/Download",["classy","text!templates/downloadBox.html","signals","mustache","simpleModal"],function(e,t,n){return e.$extend({__init__:function(e){var t=this;this.container=e,this.button=$("#main_download_button"),this.downloadButtonClicked=new n.Signal,this.downloadOptionClicked=new n.Signal,this.button.click(function(e){t.button.hasClass("disabled")||t.downloadButtonClicked.dispatch()}),this.container.delegate(".download_option","click",function(e){t.hideDownload(),t.downloadOptionClicked.dispatch(t.idMap[$(e.target).attr("id")])}),this.modalCloseHandler=function(e){$(e.target).parents("#download_dialog_container").length==0&&t.hideDownload()}},generateDownload:function(e,n){this.idMap=function(){var e={};for(var t=0;t<n.length;t++){var r=n[t];if(r.id)e[r.id]=r;else if(n[t].children)for(var i=0;i<r.children.length;i++)e[r.children[i].id]=r.children[i]}return e}(),e.empty();var r=$(Mustache.to_html(t,{downloadItems:n}));e.append(r)},showDownload:function(e){var t=this,n=t.button.offset();this.generateDownload(this.container,e),$("#download_dialog_container").modal({autoPosition:!1,overlayClose:!0,fixed:!1,close:!1,persist:!0}),$("#simplemodal-container").css({top:n.top,left:n.left}),$("body").one("click",function(){$("body").bind("click",t.modalCloseHandler)}),this.container.css({left:this.button.outerWidth()-this.container.outerWidth()}),$(window).resize(this.resizeCallback=function(){var e=t.button.offset();$("#simplemodal-container").css({top:e.top,left:e.left})})},hideDownload:function(){$.modal.close(),typeof this.resizeCallback=="function"&&$(window).unbind("resize",this.resizeCallback),typeof this.modalCloseHandler=="function"&&$("body").unbind("click",this.modalCloseHandler),this.resizeCallback=null}})}),define("text!templates/footnotes.html",[],function(){return"<!-- This Mustache template is used to display all the footnotes -->\r\n{{#footnotes}}\r\n	<div class='footnote' style='font-size: 12px;'>{{&.}}</div>\r\n{{/footnotes}}\r\n"}),define("js/view/components/Footnotes",["classy","signals","text!templates/footnotes.html","mustache","simpleModal","json2"],function(e,t,n){return e.$extend({__init__:function(e){this.container=e},create:function(e){},updateFootnotes:function(e){var t=this;this.footnotes=e,this.container.html(Mustache.render(n,{footnotes:e}))}})}),!function(e){e("datagrid",["signals","classy","order!dragevent","order!mousewheel","order!slickcore","order!slickgrid","order!slickdataview"],function(e,t){return t.$extend({__init__:function(t){var n=this;this.isFiltered=!1,this.slickgrid=null,this.container=t.empty(),this.innerGridContainer=$(this.$class.innerSlickGridHTML).appendTo(this.container),this.vSlider=null,this.hSliderTop=null,this.hSliderBottom=null,this.filteredColumns=[],this.columns=[],this.data=[],this.options={},this.onClick=new e.Signal,this.onColumnOrderChanged=new e.Signal,this.onHeaderClick=new e.Signal,this.onHeaderCellRendered=new e.Signal,this.onViewRowCountChanged=function(e,t){n.slickgrid.updateRowCount(),n.slickgrid.render()},this.onViewRowsChanged=function(e,t){n.slickgrid.invalidateRows(t.rows),n.slickgrid.render()}},update:function(e,t,n,r,i){var s=this,o=r!==void 0&&i!==void 0,u;t=typeof t=="undefined"?this.columns:t,n=typeof n=="undefined"?this.options:n,this.slickgrid?(this.setData(e),this.setColumns(t,!0),this.setOptions(n),o?this.filterNumericColumns(r,i):this.slickgrid.setColumns(t),this.resetHSliders(),this.checkScroll()):(this.setData(e),this.setColumns(t),this.setOptions(n),o?u=this.filterNumericColumns(r,i):u=this.filterHiddenColumns(this.options.addSpacerColumn?this.columns.concat([this.$class.spacerColumnOps]):this.columns),this.slickgrid=new Slick.Grid(this.innerGridContainer,this.data,u,this.options),this.slickgrid.onClick.subscribe(function(e,t){s.onClick.dispatch(t.row,t.cell,s.slickgrid.getDataItem(t.row),e)}),this.slickgrid.onSort.subscribe(function(e,t){s.data.sort(function(e,n){var r=t.sortCol.field,i=t.sortAsc?1:-1,s=e[r],o=n[r],u=(s==o?0:s>o?1:-1)*i;return u=typeof s=="undefined"||typeof s=="string"&&s==""?1:typeof o=="undefined"||typeof o=="string"&&o==""?-1:u,u!=0?u:0}),s.slickgrid.invalidate(),s.slickgrid.render()}),this.slickgrid.onColumnsReordered.subscribe(function(e,t){s.resetHSliders(),s.checkScroll(),s.onColumnOrderChanged.dispatch(e,t)}),this.slickgrid.onColumnsResized.subscribe(function(e,t){s.resetHSliders(),s.checkScroll()}),this.slickgrid.onHeaderClick.subscribe(function(e,t){s.onHeaderClick.dispatch(e,t)}),this.slickgrid.onHeaderCellRendered.subscribe(function(e,t){s.onHeaderCellRendered.dispatch(e,t)}),this.checkScroll(),this.options.scrollToRight&&this.scrollToRight())},outputToArrOfArrs:function(e){e=e!==void 0?e:!0;var t=e&&this.isFiltered?this.filteredColumns:this.columns,n=[],r,i,s,o,u,a,f,l,c;n.push(o=[]);for(r=0;r<t.length;r++)u=t[r],a=u.output!==void 0?u.output:!0,a&&o.push('"'+(typeof u.name!="undefined"?u.name:u.id)+'"');for(r=0;r<(this.data.getLength?this.data.getLength():this.data.length);r++){s=this.data.getItem?this.data.getItem(r):this.data[r],n.push(o=[]);for(i=0;i<t.length;i++)u=t[i],a=u.output!==void 0?u.output:!0,a&&(f=[r,i,u&&typeof this.options.dataItemColumnValueExtractor=="function"?this.options.dataItemColumnValueExtractor(s,u):s[u.field],u,s],l=u.outputFormatter?u.outputFormatter.apply(this,f):u.dataFormatter?u.dataFormatter.apply(this,f):f[2]||"",l&&(c=l?l.toString().replace(/,/g,""):NaN),o.push(isNaN(c)?'"'+(l?l:"")+'"':c))}return n},processColumns:function(e){var t,n;for(t=0;t<e.length;t++)n=e[t],n.formatter=this.$class.defaultFormatter;return e},filterHiddenColumns:function(e){return $.map(e,function(e){return e.display===!1?null:e})},checkScroll:function(){var e=this,t=$(".slick-viewport",this.container),n=$(".slick-pane",this.container),r,i,s,o;this.options.frozenColumn>=0?(i=t.filter(".slick-viewport-top.slick-viewport-right"),r=n.filter(".slick-pane-top.slick-pane-right")):(i=t.filter(".slick-viewport-top.slick-viewport-left"),r=n.filter(".slick-pane-top.slick-pane-left")),(s=function(){this.vSlider?this.vSlider.css("height",i.height()-30):(this.vSlider=$("<div/>").appendTo(this.container).css({position:"relative","float":"left",height:i.height()-30,marginTop:20,marginBottom:10,marginLeft:10}).slider({orientation:"vertical",min:0,max:100,value:100,slide:function(e,t){(function(){this.scrollTop=(this.scrollHeight-this.offsetHeight)*((100-t.value)/100)}).call(i.get(0))}}),i.scroll(function(){e.vSlider.slider("value",100-100*this.scrollTop/(this.scrollHeight-this.offsetHeight))}),this.innerGridContainer.width(this.container.width()-this.vSlider.width()-20).css("float","left"),this.slickgrid.resizeCanvas()),i.get(0).scrollHeight>i.height()?this.vSlider.slider("option","disabled",!1):this.vSlider.slider("option","disabled",!0)}).call(this),(o=function(){var e=this,t,o,u;!this.hSliderTop&&!this.hSliderBottom?(t=n.find(".slick-header").eq(0),u=t.position(),o=r.position(),this.hSliderTop=$("<div/>").appendTo(this.container).css({position:"absolute",top:u.top+t.height()-13,left:o.left,width:i.width()-28,marginRight:30}).slider({min:0,max:100,value:0,slide:function(t,n){(function(){this.scrollLeft=(this.scrollWidth-this.offsetWidth)*(n.value/100),e.hSliderBottom.slider("value",n.value)}).call(i.get(0))}}).addClass("hSliderTop"),this.hSliderBottom=$("<div/>").appendTo(this.container).css({position:"absolute",bottom:0,left:o.left,width:i.width()-28,marginRight:30}).slider({min:0,max:100,value:0,slide:function(t,n){(function(){this.scrollLeft=(this.scrollWidth-this.offsetWidth)*(n.value/100),e.hSliderTop.slider("value",n.value)}).call(i.get(0))}}).addClass("hSliderBottom"),i.scroll(function(){e.hSliderTop.slider("value",100*this.scrollLeft/(this.scrollWidth-this.offsetWidth)),e.hSliderBottom.slider("value",100*this.scrollLeft/(this.scrollWidth-this.offsetWidth))}),this.innerGridContainer.height(this.container.height()-this.hSliderBottom.height()-20),s.call(this)):(this.hSliderTop.css("width",i.width()-28),this.hSliderBottom.css("width",i.width()-28)),i.get(0).scrollWidth>i.width()?(this.hSliderBottom.slider("option","disabled",!1),this.hSliderTop.slider("option","disabled",!1),i.scroll()):(i.scroll(),this.hSliderBottom.slider("option","disabled",!0),this.hSliderTop.slider("option","disabled",!0),this.slickgrid.autosizeColumns())}).call(this)},scrollToRight:function(){var e=$(".slick-viewport",this.container),t;this.options.frozenColumn>=0?t=e.filter(".slick-viewport-top.slick-viewport-right"):t=e.filter(".slick-viewport-top.slick-viewport-left"),t.get(0).scrollLeft=t.get(0).scrollWidth},filterNumericColumns:function(e,t){var n,r;this.filteredColumns=[];for(n=0;n<this.columns.length;n++)r=this.columns[n],isNaN(r.id)?this.filteredColumns.push(r):r.id>=e&&r.id<=t&&this.filteredColumns.push(r);var i=this.filterHiddenColumns(this.options.addSpacerColumn?this.filteredColumns.concat([this.$class.spacerColumnOps]):this.filteredColumns);return this.slickgrid&&(this.slickgrid.setColumns(i),this.isFiltered=!0,this.resetHSliders(),this.checkScroll(),this.options.scrollToRight&&this.scrollToRight()),i},setColumns:function(e,t){this.columns=this.processColumns(e),this.isFiltered=!1,this.slickgrid&&!t&&(this.slickgrid.setColumns(this.filterHiddenColumns(this.options.addSpacerColumn?this.columns.concat([this.$class.spacerColumnOps]):this.columns)),this.resetHSliders(),this.checkScroll(),this.options.scrollToRight&&this.scrollToRight())},setData:function(e){this.data=e,this.slickgrid&&(this.slickgrid.setData(e),this.resetHSliders(),this.checkScroll())},setOptions:function(e){this.options=$.extend(!0,{},this.$class.defaultOptions,e),this.slickgrid&&this.slickgrid.setOptions(this.options)},redraw:function(e){e?this.slickgrid.invalidateRows(e):this.slickgrid.invalidateAllRows(),this.slickgrid.render()},resetHSliders:function(){this.hSliderBottom.remove(),this.hSliderTop.remove(),this.hSliderBottom=this.hSliderTop=null},destroy:function(){this.slickgrid&&this.slickgrid.destroy()},__classvars__:{defaultOptions:{enableCellNavigation:!1,enableColumnReorder:!1},spacerColumnOps:{id:"spacer",name:" ",autoWidth:!0},innerSlickGridHTML:'<div class="inner-slickgrid-container"></div>',defaultFormatter:function(e,t,n,r,i){var s=r.dataFormatter?r.dataFormatter.apply(this,arguments):n,o=r.displayFormatter?r.displayFormatter.call(this,e,t,s,r,i):s;return o},autosizeColumn:function(e,t,n,r){var i=$("<div/>").addClass("slick-cell").addClass("ui-widget").css({width:"auto",position:"absolute",top:1e3,left:0}).appendTo("body"),s=e[t],o=0,u,a,f,l;for(u=0;u<(n.getLength?n.getLength():n.length);u++)a=n.getItem?n.getItem(u):n[u],f=a[s.field],i.html(s.formatter?s.formatter(u,t,f,s,a):s.displayFormatter?s.displayFormatter(u,t,f,s,a):s.dataFormatter?s.dataFormatter(u,t,f,s,a):f),o=Math.max(o,i.outerWidth());l=o+(r!=void 0?r:0),i.remove(),s.width=s.maxWidth!==void 0?Math.min(l,s.maxWidth):l},linkSelectorFunction:function(e,t,n){var r={},i=$(e),s=i.offset(),o=$(),u=0,a,f,l,c;return r[e]||(r[e]=$(".slick-row",i).get(),r[e].sort(function(e,t){var n=$(e).offset().top,r=$(t).offset().top;return n<r?-1:n>r?1:0})),$.each(r[e],function(e,r){l=$(r);var i=l.offset();return i.top>s.top?(c=$(t,l),c.each(function(t,r){o=$(r);var i=o.offset();if(i.left>s.left){a===void 0&&(a=Math.min(n,c.length-e));if(u==a)return!1;u++}}),!1):!0}),o}}})})}(typeof define=="function"&&typeof define.amd=="object"?define:function(e,t){var n;for(n=0;n<e.length;n++)e[n]=this[e[n]];this.datagrid=t.apply(this,e)}),define("qTipsHelp",["classy","signals","qtips"],function(e,t){return e.$extend({__init__:function(){var e=this;this.tooltipsShown=!1,this.button=$("#help_button"),this.helpButtonClicked=new t.Signal,this.button.click(function(t){e.button.hasClass("disabled")||e.helpButtonClicked.dispatch()}),this.windowMouseDownHandler=function(t){var n=function(e){var n=t.target;while(n.parentNode){if(n.parentNode==e)return!0;n=n.parentNode}return!1}(e.button.get(0));e.tooltipsShown&&!n&&e.hideHelpTooltips()}},toggleHelpTooltips:function(e){this.tooltipsShown?this.hideHelpTooltips():this.showHelpTooltips(e)},showHelpTooltips:function(e){var t=this;this.button.css("cursor","wait").addClass("selected");for(var n=0;n<e.length;n++){var r=typeof e[n].selector=="function"?e[n].selector():$(e[n].selector);$.each($(r),function(r,s){$(s).is(":visible")&&($(s).attr("class",$(s).attr("class")+" help_target"),$(s).qtip({content:{prerender:!0,text:e[n].tip},show:"null",hide:"null",style:{tip:!0,name:"cream",width:e[n].width?e[n].width:250},position:{corner:{target:e[n].position,tooltip:t.$class.qtipsOpposite[e[n].position]},adjust:{x:e[n].xAdjust?e[n].xAdjust:0,y:e[n].yAdjust?e[n].yAdjust:0}}}))})}$(".help_target").qtip("show"),this.button.css("cursor","default"),$("body").width(Math.max($(window).width(),1600)).mousedown(this.windowMouseDownHandler),$(window).scrollLeft(($("body").width()-$(window).width())/2).resize(),this.tooltipsShown=!0},hideHelpTooltips:function(){this.button.removeClass("selected"),$(".qtip iframe").hide(),$(".help_target").removeClass("help_target").qtip("destroy"),$("body").width("100%").scroll().unbind("mousedown",this.windowMouseDownHandler),this.tooltipsShown=!1,$(window).resize()},__classvars__:{qtipsOpposite:{topLeft:"bottomRight",topMiddle:"bottomMiddle",topRight:"bottomLeft",bottomLeft:"topRight",bottomMiddle:"topMiddle",bottomRight:"topLeft",leftTop:"rightBottom",leftMiddle:"rightMiddle",leftBottom:"rightTop",rightTop:"leftBottom",rightMiddle:"leftMiddle",rightBottom:"leftTop",center:"center"}}})}),define("viewStack",["classy"],function(e){return e.$extend({__init__:function(e){this.container=e,this.viewNames=[],this.viewsMap={}},addView:function(e,t){return t||(t=$("<div/>").attr("id",e)),this.container.append(t),this.viewNames.push(e),this.viewsMap[e]=t,this.viewNames.length==1?this.setActiveView(e):this.positionView(t,!1),t},removeView:function(e){if(this.viewsMap.hasOwnProperty(e)){var t=this.viewsMap[e];delete this.viewsMap[e],this.viewNames.splice($.indexOf(this.viewNames,e),1),t.remove(),this.activeName==e&&this.viewNames.length>0&&this.setActiveView(this.viewNames[0])}},getView:function(e){return this.viewsMap[e]},hasView:function(e){return e in this.viewsMap},setActiveView:function(e){if(e==this.activeName)return;if(!(e in this.viewsMap))throw new Error("Invalid View Name");this.activeName=e;for(var t in this.viewsMap)if(this.viewsMap.hasOwnProperty(t)){var n=this.viewsMap[t];this.positionView(n,t==e)}},positionView:function(e,t){e.css({display:t?"block":"none"})}})}),define("js/view/mediators/Selection",["puremvc","js/Facade","js/model/ParameterProxy","js/model/ConfigProxy","js/model/TableDataProxy"],function(e,t,n,r,i){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this,s=this.facade.retrieveProxy(n.NAME),o=this.facade.retrieveProxy(r.NAME),u=this.facade.retrieveProxy(i.NAME);this.getViewComponent().create(s.getSelectedStudy(),o.getStudies(),s.getSelectedTable()),this.getViewComponent().tableSelectionChanged.add(function(n){e.sendNotification(t.TABLE_SELECTION_CHANGED,{id:n,newStudy:n.split("-")[1],oldStudy:s.getSelectedStudy().id},"TableChanged")})},listNotificationInterests:function(){return this.$super().concat([t.TABLE_PARAMS_UPDATED])},handleNotification:function(e){var s=this.facade.retrieveProxy(n.NAME),o=this.facade.retrieveProxy(r.NAME),u=this.facade.retrieveProxy(i.NAME);switch(e.getName()){case t.TABLE_PARAMS_UPDATED:this.getViewComponent().updateTableSelection(s.getSelectedStudy(),o.getStudies(),s.getSelectedTable());break;default:this.$super(e)}},__classvars__:{NAME:"SelectionMediator"}})}),define("js/view/mediators/TimeSelection",["puremvc","js/Facade","js/model/TableDataProxy","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,n,r,i){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().timeSelectionChanged.add(function(n,r){e.sendNotification(t.TIME_SELECTION_UPDATED,{start:n,end:r})}),this.getViewComponent().frequencySelectionChanged.add(function(n){e.sendNotification(t.FREQUENCY_SELECTION_UPDATED,{f:n},"FrequencyChanged")}),this.getViewComponent().visualizationSelectionChanged.add(function(n){var r={};r.ctype=n,e.sendNotification(t.CHART_SELECTION_UPDATED,r)})},listNotificationInterests:function(){return this.$super().concat([t.FREQUENCY_PARAM_UPDATED,t.TIME_PERIOD_PARAM_UPDATED,t.TABLEDATA_UPDATED,t.CHART_PARAMS_UPDATED,t.CTYPE_PARAM_UPDATED])},handleNotification:function(e){var s=this.facade.retrieveProxy(i.NAME),o=this.facade.retrieveProxy(n.NAME),u=this.facade.retrieveProxy(r.NAME),a=s.getTimeParams();switch(e.getName()){case t.FREQUENCY_PARAM_UPDATED:case t.TIME_PERIOD_PARAM_UPDATED:case t.TABLEDATA_UPDATED:case t.CHART_PARAMS_UPDATED:case t.CTYPE_PARAM_UPDATED:if(!o.isUpdating){this.getViewComponent().isCreated?this.getViewComponent().updateTimeSelection(a.f,o.getDataColsNoGrowth(a.f),a.start,a.end,a.ctype):this.getViewComponent().create({},a.f,o.getDataColsNoGrowth(),a.start,a.end,a.ctype);var f=s.isMappable(s.getSelectedTable()),l=s.getPinnedIds();for(var c=0;c<l.length;c++)if(l[c]){var h=l[c].split(".")[1].split("-");h=h[1]+"-"+h[2],f=f||s.isMappable(s.getTableById(h))}this.getViewComponent().disableMapButton(!f)}break;default:this.$super(e)}},__classvars__:{NAME:"TimeSelectionMediator"}})}),define("js/view/mediators/CaseSelection",["puremvc","js/Facade","js/model/ParameterProxy","js/model/ConfigProxy"],function(e,t,n,r){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this,i=this.facade.retrieveProxy(n.NAME),s=this.facade.retrieveProxy(r.NAME);this.getViewComponent().create(i.getSelectedStudy(),s.getStudies(),i.getSelectedTable(),i.getSelectedCases()),this.getViewComponent().caseSelectionChanged.add(function(n){e.sendNotification(t.CASE_SELECTION_CHANGED,{cases:n},"CasesChanged")})},listNotificationInterests:function(){return this.$super().concat([t.TABLE_PARAMS_UPDATED,t.CASE_PARAM_UPDATED])},handleNotification:function(e){var i=this.facade.retrieveProxy(n.NAME),s=this.facade.retrieveProxy(r.NAME);switch(e.getName()){case t.CASE_PARAM_UPDATED:case t.TABLE_PARAMS_UPDATED:this.getViewComponent().updateCaseSubtitle(i.getSelectedStudy(),s.getStudies(),i.getSelectedTable(),i.getSelectedCases());break;default:this.$super(e)}},__classvars__:{NAME:"CaseSelectionMediator"}})}),define("js/view/mediators/RegionSelection",["puremvc","js/Facade","js/model/ParameterProxy","js/model/ConfigProxy"],function(e,t,n,r){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this,i=this.facade.retrieveProxy(n.NAME),s=this.facade.retrieveProxy(r.NAME);this.getViewComponent().create(i.getSelectedTable(),i.getSelectedRegion(),i.hasRegions(i.getSelectedTable())),this.getViewComponent().regionSelectionChanged.add(function(n){e.sendNotification(t.REGION_SELECTION_UPDATED,{region:n},"RegionSelectionUpdated")})},listNotificationInterests:function(){return this.$super().concat([t.TABLE_PARAMS_UPDATED,t.CASE_PARAM_UPDATED,t.REGION_PARAM_UPDATED])},handleNotification:function(e){var i=this.facade.retrieveProxy(n.NAME),s=this.facade.retrieveProxy(r.NAME);switch(e.getName()){case t.CASE_PARAM_UPDATED:case t.TABLE_PARAMS_UPDATED:case t.REGION_PARAM_UPDATED:this.getViewComponent().update(i.getSelectedTable(),i.getSelectedRegion(),i.hasRegions(i.getSelectedTable()));if(e.getName()==t.REGION_PARAM_UPDATED){var o=i.getSelectedRegion(),u=["linechart","map"],a={};for(var f in u){var l=i.getChartedIds(u[f]),c=i.getPinnedIds(),h=[];for(var p=0;p<l.length;p++)if(l[p]=="")h.push(l[p]);else{var d=l[p].split(".");d.length<=2?h.indexOf(l[p])<0&&h.push(l[p]):(o=="0.0"?newid=d[0]+"."+d[1]:newid=d[0]+"."+d[1]+"."+o,h.indexOf(newid)<0&&h.push(newid),c.indexOf(l[p])>=0&&h.indexOf(l[p])<0&&h.push(l[p]))}a[u[f]]=h.join("~")}var v=!1;for(var f in u)a[u[f]]!=""&&(v=!0);v&&this.sendNotification(t.CHART_SELECTION_UPDATED,a)}break;default:this.$super(e)}},__classvars__:{NAME:"RegionSelectionMediator"}})}),define("js/view/mediators/ViewStack",["puremvc","js/Facade","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,n,r){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this.facade.retrieveProxy(n.NAME);typeof e.setViews=="function"&&e.setViews(this.getViewComponent().viewNames)},listNotificationInterests:function(){return this.$super().concat([t.UPDATE_VISUALIZATION_VIEW_STACK])},handleNotification:function(e){var i=this.getViewComponent(),s=this.facade.retrieveProxy(r.NAME),o=this.facade.retrieveProxy(n.NAME);switch(e.getName()){case t.UPDATE_VISUALIZATION_VIEW_STACK:var u=s.getChartType();i.hasView(u)&&(typeof o.setCurrentView=="function"&&o.setCurrentView(u),i.setActiveView(u));break;default:this.$super(e)}},__classvars__:{NAME:"ViewStackMediator"}})}),define("js/view/mediators/LineChart",["puremvc","js/Facade","js/model/TableDataProxy","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,n,r,i){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().indexingChanged.add(function(n){e.sendNotification(t.CHART_SELECTION_UPDATED,{chartindexed:n})})},listNotificationInterests:function(){return this.$super().concat([t.TABLEDATA_UPDATED,t.CHART_DATA_UPDATED,t.TIME_PERIOD_PARAM_UPDATED,t.UNLOAD,t.DOWNLOAD_OPTION_SELECTED])},handleNotification:function(e){var s=this.facade.retrieveProxy(n.NAME),o=this.facade.retrieveProxy(i.NAME),u=this.facade.retrieveProxy(r.NAME),a=o.getChartParams(),f=o.getChartType(),l=[],c=[],h=o.getChartedIds("linechart"),p=s.getTableData();for(var d=0;d<h.length;d++)for(var v in p){var m=[];$.isArray(p[v].uuid)?m=p[v].uuid:m.push(p[v].uuid);for(var g in m)if(h[d]&&m[g]==h[d]){var y,b;y=m[g].split(".")[0],b=m[g].split(".")[1].split("-"),b=b[1]+"-"+b[2];var w=o.getStudyByTableId(b),E=o.getTableById(b),S=o.hasRegions(E);if(S){var x=m[g].split(".")[2];for(var T=0;T<E.regions.length;T++)E.regions[T].id==x&&c.indexOf(E.regions[T].title)<0&&c.push(E.regions[T].title)}else c.push("");for(var T=0;T<w.cases.length;T++)w.cases[T].scenario==y.split("-")[0]&&l.indexOf(w.cases[T].description)<0&&l.push(w.cases[T].description)}}var N="";l.length==1&&(N=l[0]);if(N.length)var C="Case: "+N;else var C="";c.length==1&&c[0]!=""&&(C.length&&(C+=" |  "),C+="Region: "+c[0]);switch(e.getName()){case t.TABLEDATA_UPDATED:case t.CHART_DATA_UPDATED:if(f=="linechart"||f=="pin"||f=="sourcekey"){var k=$.extend(!0,[],s.getChartData("linechart"));if(k.length==0){var L="";regionString=""}else if(k.length==1)oneSeriesObject=k[0],L=oneSeriesObject.chart_name;else{var A=[],O=[];for(oneSeries in k){oneSeriesObject=k[oneSeries];var M=oneSeriesObject.chart_name.split(": ");O.push(M),M.length>A.length&&(A=M)}var _="";for(onePiece in A){var D=!0;for(var P=0;P<O.length;P++)if(A[onePiece]!=O[P][onePiece]){D=!1;break}if(!D)break;_.length&&(_+=": "),_+=A[onePiece]}if(!_.length)L="Custom Chart";else{L=_;for(oneSeries in k)oneSeriesObject=k[oneSeries],newSeriesName=oneSeriesObject.chart_name.substr(_.length+2),newSeriesName?oneSeriesObject.chart_name=newSeriesName:oneSeriesObject.chart_name="All"}}this.getViewComponent().update(L,k,s.getDataColumns(),"A",a.chartindexed,o.getTimeParams().start,o.getTimeParams().end,!1,!1,C,u.getStudies())}break;case t.TIME_PERIOD_PARAM_UPDATED:!s.isUpdating&&(f=="linechart"||f=="pin"||f=="sourcekey")&&this.getViewComponent().setStartEnd(o.getTimeParams().start,o.getTimeParams().end,"A");break;case t.UNLOAD:this.getViewComponent().destroy();break;case t.DOWNLOAD_OPTION_SELECTED:e.body.type=="embed"?this.getViewComponent().embed():e.body.target=="linechart"&&this.getViewComponent().download(e.body.type);break;default:this.$super(e)}},__classvars__:{NAME:"ChartMediator"}})}),define("text!templates/pin_sourcekey_header.html",[],function(){return'<div class="pin_button {{#pin}}selected{{/pin}}">\r\n    <span class="ico"></span>\r\n    <span class="text">Pin</span>\r\n</div>\r\n<div class="api_button {{#sourcekey}}selected{{/sourcekey}}">\r\n    <span class="ico"></span>\r\n    <span class="text">API</span>\r\n</div>'}),define("js/view/mediators/DataGrid",["puremvc","js/Facade","js/model/ConfigProxy","js/model/ParameterProxy","js/model/TableDataProxy","js/view/components/DateCodeUtil","js/view/components/GridFormatters","datagrid","text!templates/pin_sourcekey_header.html"],function(e,t,n,r,i,s,o,u,a){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().onClick.add(this.dataGridClick,this),$(this.getViewComponent().container).on("click",".slick-header-column.deselect_header",function(n){var i=e.facade.retrieveProxy(r.NAME).getChartType(),s={};s[i]="",e.sendNotification(t.CHART_SELECTION_UPDATED,s)}),$(this.getViewComponent().container).on("click",".pinkey_header .slick-column-name > div",function(n){var r={};r.sourcekey=$(n.currentTarget).hasClass("pin_button")?0:1,e.sendNotification(t.PIN_SOURCEKEY_SELECTED,r)}),$("#tableContainer").css("height",this.calculateDataTableHeight()+"px"),$(window).on("resize.datagrid",function(){e.resizeDataTable()})},listNotificationInterests:function(){return this.$super().concat([t.TABLEDATA_UPDATED,t.TIME_PERIOD_PARAM_UPDATED,t.CHART_DATA_UPDATED,t.DOWNLOAD_OPTION_SELECTED,t.UNLOAD,t.PIN_SOURCEKEY_PARAM_UPDATED,t.FREQUENCY_PARAM_UPDATED,t.CTYPE_PARAM_UPDATED])},handleNotification:function(e){var s=this.getViewComponent();switch(e.getName()){case t.TABLEDATA_UPDATED:var u=this.facade.retrieveProxy(i.NAME),a=this.facade.retrieveProxy(r.NAME),f=this.facade.retrieveProxy(n.NAME),l=a.getTimeParams(),c=u.getTableTitle(),h=u.getCombinedData(),p=u.data.tabledata.footnotes,d,v={};for(var m=0;m<p.length;m++){if(p[m].substring(0,3)=="Btu")break;p[m].indexOf("<sup>")>=0?(d=p[m].split("</sup>"),v[d[0].split("<sup>")[1]]=$.trim(d[1]),d=d[0].split("<sup>")[1]):d&&(v[d]=v[d].concat(" "+p[m]))}$(".pagecontent").off().on("mouseover","span.description_text_wrapper",function(e){if($(e.currentTarget).find("sup").length){var t=$(e.currentTarget).find("sup")[0].innerText;t!=""&&typeof t!="undefined"&&$(e.currentTarget).qtip({content:"Footnote "+t+": "+v[t],show:{when:!1,ready:!0},hide:"mouseout",position:{corner:{target:"topRight",tooltip:"bottomLeft"}},style:{name:"blue",width:500}})}});var g=this.generateColumns(u.getDataColumns(l.f),h,"A",u.getTableUnits(),c,a.getPinSourcekey());this.getViewComponent().update(h,g,{frozenColumn:2,dataItemColumnValueExtractor:function(e,t){return t&&t.field?o.nestedPropertyResolver(t.field,e):null},scrollToRight:!0,addSpacerColumn:!0,rowHeight:22},l.start,l.end),l["ctype"]=="map"&&$("div.deselect_header").css("display","none"),this.sendNotification(t.TABLE_RENDERED);break;case t.TIME_PERIOD_PARAM_UPDATED:var u=this.facade.retrieveProxy(i.NAME),a=this.facade.retrieveProxy(r.NAME);if(!u.isUpdating){var l=a.getTimeParams();this.getViewComponent().filterNumericColumns(l.start,l.end,!0),l["ctype"]=="map"&&$("div.deselect_header").css("display","none")}break;case t.FREQUENCY_PARAM_UPDATED:case t.CTYPE_PARAM_UPDATED:case t.PIN_SOURCEKEY_PARAM_UPDATED:var u=this.facade.retrieveProxy(i.NAME),a=this.facade.retrieveProxy(r.NAME);if(!u.isUpdating){var l=a.getTimeParams(),g=this.generateColumns(u.getDataColumns(l.f),u.getCombinedData(),"A",u.getTableUnits(),u.getTableTitle(),a.getPinSourcekey());this.getViewComponent().setColumns(g),this.getViewComponent().filterNumericColumns(l.start,l.end,!0),l["ctype"]=="map"&&$("div.deselect_header").css("display","none")}break;case t.CHART_DATA_UPDATED:this.getViewComponent().redraw();break;case t.DOWNLOAD_OPTION_SELECTED:if(e.body.target=="table"&&e.body.type=="csv"){var u=this.facade.retrieveProxy(i.NAME),a=this.facade.retrieveProxy(r.NAME),y=this.getViewComponent().outputToArrOfArrs();y[0][1]="full name",y[0][2]="api key";var b=a.getPinnedIds(),w=[];for(var E=0;E<u.combinedRows.length;E++){datum=u.combinedRows[E],y[1+E][1]=='"true"'&&(y[1+E][1]=y[1+E][0]);var S=document.createElement("div");S.innerHTML=datum.description,$("sup",$(S)).remove(),y[1+E][0]=S.textContent||S.innerText||"",datum.caseTitle&&(y[1+E][1]+=": "+datum.caseTitle),datum.series_id&&(y[1+E][2]+=datum.series_id)}for(var E=0;E<b.length;E++)b[E]&&w.push(b[E]);if(w.length)for(var E=0;E<w.length;E++)y[2+E][0]=u.combinedRows[1+E].description;var x=[['"'+u.getTableTitle()+'"'],['"'+window.location.href+'"'],['"'+Date()+'"'],['"Source: U.S. Energy Information Administration"']].concat(y);this.sendNotification(t.CSV_DATA_GENERATED,x)}break;case t.UNLOAD:this.getViewComponent().destroy();break;default:this.$super(e)}},generateColumns:function(e,t,i,a,f,l){var c,h=this.facade.retrieveProxy(r.NAME),p=this.facade.retrieveProxy(n.NAME),d=h.getChartType(),v;$(".description").length&&(v=$(".description").outerWidth());var m=[this.getPinSourcekeyColumn(parseInt(l)),{id:"description",name:"",field:"description",displayFormatter:o.descriptionFormatter,outputFormatter:this.$class.descriptionOutputFormatter,cssClass:"description aggregate",headerCssClass:"description",maxWidth:600,width:v||375},{id:d,field:"is_chartable",width:25,displayFormatter:o.chartButtonFormatter,output:!0,cssClass:"chart_column",iconClass:d,resizable:!1,headerCssClass:"deselect_header",toolTip:"Click to clear this table"},{id:"source key",name:"source key",field:"id",display:!1},{id:"units",name:"units",field:"units",display:!1}];u.autosizeColumn(m,0,t,5);for(c=0;c<e.length-1;c++){var g=parseInt(e[c]).toString();g=="NaN"&&(g="9999"),m.push({id:g,name:s.formatDateCode(g,i),field:"data."+g.toString(),displayFormatter:o.numericalDataFormatter,dataFormatter:null,f:i,width:70})}var y=e[e.length-1],b=y.split(" ");return y="Growth "+b[2],m.push({id:y,name:y,toolTip:"Growth Rate "+b[2],field:"data.9999",displayFormatter:null,dataFormatter:function(e,t,n,r,i){var s=o.numericalDataFormatter(e,t,n,r,i);return isNaN(parseFloat(s))?s:s+"%"},f:i,width:127,precision:1}),m},getPinSourcekeyColumn:function(e){return{id:e?"sourcekey":"pin",field:"series_id",width:40,displayFormatter:e?o.sourceKeyFormatter:o.pinSeriesFormatter,output:!1,cssClass:"chart_column",iconClass:e?"sourcekey":"pin",resizable:!1,headerCssClass:"pinkey_header",name:function(e){var t=e?{sourcekey:!0}:{pin:!0};return Mustache.render(a,t)}(e)}},dataGridClick:function(e,n,s){var o=this.getViewComponent(),u=o.columns,a=u[n].iconClass;if(u[n].id=="linechart"||u[n].id=="map"||u[n].id=="pin"||u[n].id=="sourcekey")if(s.ACTION){var f={};f[a]="",this.sendNotification(t.CHART_SELECTION_UPDATED,f)}else switch(u[n].id){case"linechart":var l=this.facade.retrieveProxy(i.NAME),c=this.facade.retrieveProxy(r.NAME);if(s.has_data){var f={};f[a]=c.getUpdatedCharted(s.uuid,a),f.ctype=u[n].id,this.sendNotification(t.CHART_SELECTION_UPDATED,f)}else{var l=this.facade.retrieveProxy(i.NAME),h=l.getChildData(e),p=!0,d=$.map(h,function(e){return e.has_data&&!e.linechart&&(p=!1),e.has_data?e.uuid:null});if(d.length>0){var f={};f[a]=c.getUpdatedCharted(d,a,p),this.sendNotification(t.CHART_SELECTION_UPDATED,f)}}break;case"map":if(s.is_mappable){var c=this.facade.retrieveProxy(r.NAME);if(s.has_data){var f={};f[a]=s.uuid,f.ctype=u[n].id,this.sendNotification(t.CHART_SELECTION_UPDATED,f)}}break;case"pin":var c=this.facade.retrieveProxy(r.NAME);if(s.uuid){var f={};f.sid=c.getUpdatedPinned(s.uuid),this.sendNotification(t.CHART_SELECTION_UPDATED,f)}break;case"sourcekey":var v=s.uuid.split(".")[1].split("-")[2].replace("ER","").replace("AEO",""),m=s.uuid.split(".")[0].split("-")[0],g="AEO."+v+"."+m+"."+s.varName+".A";this.sendNotification(t.SOURCE_KEY_SELECTED,g.toUpperCase())}},calculateDataTableHeight:function(){var e=$(window).height();return e*.85},resizeDataTable:function(){$("#tableContainer").css("height",this.calculateDataTableHeight()+"px"),$(".inner-slickgrid-container").css("height",this.calculateDataTableHeight()+"px"),this.getViewComponent().slickgrid.resizeCanvas(),this.getViewComponent().checkScroll()},__classvars__:{NAME:"DataGridMediator",linkCellFormatter:function(e,t,n,r,i){return n!==""&&i.filterQuery?'<span class="link_cell">'+n+"</span>":n},descriptionOutputFormatter:function(e,t,n,r,i){return i.chart_name||n}}})}),define("js/view/mediators/HelpTooltip",["puremvc","js/Facade","js/model/HelpTooltipProxy"],function(e,t,n){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},listNotificationInterests:function(){return this.$super().concat([t.UNLOAD])},onRegister:function(){var e=this;this.getViewComponent().helpButtonClicked.add(function(){var t=e.facade.retrieveProxy(n.NAME);e.getViewComponent().toggleHelpTooltips(t.getHelpTooltips())})},handleNotification:function(e){switch(e.getName()){case t.UNLOAD:this.getViewComponent().hideHelpTooltips();break;default:this.$super(e)}},onRemove:function(){this.$super(),this.getViewComponent().hideHelpTooltips()},__classvars__:{NAME:"HelpTooltipMediator"}})}),define("js/view/mediators/AnimatedMap",["puremvc","js/Facade","js/model/TableDataProxy","js/model/MapDataProxy","js/model/ConfigProxy","js/model/ParameterProxy","us-merc-en","coal-basin-merc-en"],function(e,t,n,r,i,s){return e.Mediator.$extend({__init__:function(e,t){this.$super(typeof t=="undefined"?this.$class.NAME:t,e)},onRegister:function(){var e=this;this.viewComponent.mapTypeChangeRequested.add(function(n){e.sendNotification(t.MAP_TYPE_SELECTION_UPDATED,{maptype:n})})},listNotificationInterests:function(){return this.$super().concat([t.MAP_DATA_UPDATED,t.TIME_PARAMS_UPDATED,t.MAP_TYPE_PARAM_UPDATED,t.DOWNLOAD_OPTION_SELECTED,t.REGION_TYPE_PARAM_UPDATED,t.TIME_PERIOD_PARAM_UPDATED,t.CTYPE_PARAM_UPDATED,t.UNLOAD])},handleNotification:function(e){var o=this.facade.retrieveProxy(n.NAME),u=this.facade.retrieveProxy(s.NAME),a=this.facade.retrieveProxy(r.NAME),f=this.facade.retrieveProxy(i.NAME);switch(e.name){case t.TIME_PARAMS_UPDATED:case t.MAP_DATA_UPDATED:case t.MAP_TYPE_PARAM_UPDATED:case t.REGION_TYPE_PARAM_UPDATED:case t.TIME_PERIOD_PARAM_UPDATED:case t.CTYPE_PARAM_UPDATED:if(!o.isUpdating&&a.hasData){var l=this,c=u.getTimeParams(),h=a.getData(),p=[];$.each(h.data,function(e,t){p.push(e)}),this.viewComponent.update({DATA:h.data,DATACOLUMNS:p,PRECISION:h.precision,TITLE:h.title,UNITS:h.units},u.getMapType(),c.start,c.end,"A",{onRegionOver:function(e,t){return!0},regionStyle:{hover:{stroke:"#FFFF96","fill-opacity":1,"stroke-width":3,"stroke-opacity":1}}},"us_census_merc_en")}break;case t.DOWNLOAD_OPTION_SELECTED:if(e.body.target=="map"&&e.body.type=="csv"){h=a.getData();var d=[['"'+h.title+'"'],['"'+window.location.href+'"'],['"'+Date()+'"'],['"Source: U.S. Energy Information Administration"']].concat(this.getViewComponent().outputToArrOfArrs());this.sendNotification(t.CSV_DATA_GENERATED,d)}else e.body.target=="map"&&e.body.type=="png"&&this.getViewComponent().map.exportMap(e.body.type);break;case t.UNLOAD:this.getViewComponent().destroy();break;default:this.$super(e)}},onRemove:function(){this.$super(),this.getViewComponent().destroy()},__classvars:{NAME:"AnimatedMapMediator"}})}),define("js/view/mediators/Download",["puremvc","js/Facade","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,n,r){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().downloadButtonClicked.add(function(t){var i=e.facade.retrieveProxy(r.NAME),s=e.facade.retrieveProxy(n.NAME);e.getViewComponent().showDownload(s.getDownloadParameters()[i.getChartType()])}),this.getViewComponent().downloadOptionClicked.add(function(n){e.getViewComponent().hideDownload(),e.sendNotification(t.DOWNLOAD_OPTION_SELECTED,n)})},__classvars__:{NAME:"DownloadMediator"}})}),define("js/view/mediators/Footnotes",["puremvc","js/Facade","js/model/TableDataProxy"],function(e,t,n){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this,t=this.facade.retrieveProxy(n.NAME);this.getViewComponent().create(t.getFootnotes())},listNotificationInterests:function(){return this.$super().concat([t.TABLEDATA_UPDATED])},handleNotification:function(e){var r=this.facade.retrieveProxy(n.NAME);switch(e.getName()){case t.TABLEDATA_UPDATED:this.getViewComponent().updateFootnotes(r.getFootnotes());break;default:this.$super(e)}},__classvars__:{NAME:"FootnotesMediator"}})}),define("js/pages/DefaultPage",["hasher","signals","puremvc","classy","page","js/Facade","js/Controller","js/model/ConfigProxy","js/model/RequestProxy","js/model/ParameterProxy","js/model/TableDataProxy","js/model/HelpTooltipProxy","js/model/MapDataProxy","js/view/components/DateCodeUtil","js/view/components/GridFormatters","js/view/components/PageLayout","js/view/components/Selection","js/view/components/TimeSelection","js/view/components/CaseSelection","js/view/components/RegionSelection","js/view/components/LineChart","js/view/components/AnimatedMap","js/view/components/Download","js/view/components/Footnotes","datagrid","qTipsHelp","viewStack","js/view/mediators/Selection","js/view/mediators/TimeSelection","js/view/mediators/CaseSelection","js/view/mediators/RegionSelection","js/view/mediators/ViewStack","js/view/mediators/LineChart","js/view/mediators/DataGrid","js/view/mediators/HelpTooltip","js/view/mediators/AnimatedMap","js/view/mediators/Download","js/view/mediators/Footnotes","simpleModal"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j){var F=null,I=i.$extend({load:function(e){this.$super(e),i.clearErrorMessage(),F?F.sendNotification(q.RELOAD,e):(F=q.getInstance(this.name),F.sendNotification(q.STARTUP,e))},unload:function(){F.sendNotification(q.UNLOAD),q.removeCore(this.name),F=null,this.$super()}})("js/pages/defaultPage"),q=s.$extend({initializeController:function(){this.$super(),this.registerCommand(this.$class.STARTUP,R),this.registerCommand(this.$class.RELOAD,U),this.registerCommand(this.$class.TABLE_PARAMS_UPDATED,o.TableParamsUpdatedCommand),this.registerCommand(this.$class.TABLE_RENDERED,o.HideLoadMaskCommand),this.registerCommand(this.$class.CHART_DATA_UPDATED,K),this.registerCommand(this.$class.TABLEDATA_UPDATED,K),this.registerCommand(this.$class.TABLE_SELECTION_CHANGED,X),this.registerCommand(this.$class.CASE_SELECTION_CHANGED,J),this.registerCommand(this.$class.TIME_SELECTION_UPDATED,V),this.registerCommand(this.$class.CHART_SELECTION_UPDATED,o.UpdateHashCommand),this.registerCommand(this.$class.PIN_SOURCEKEY_SELECTED,o.UpdateHashCommand),this.registerCommand(this.$class.CHART_PARAMS_UPDATED,o.UpdateChartDataCommand),this.registerCommand(this.$class.FREQUENCY_SELECTION_UPDATED,o.FrequencySelectionUpdatedCommand),this.registerCommand(this.$class.CSV_DATA_GENERATED,o.OutputToCSVCommand),this.registerCommand(this.$class.ERROR,o.ErrorCommand),this.registerCommand(this.$class.REGION_SELECTION_UPDATED,o.RegionSelectionUpdatedCommand),this.registerCommand(this.$class.MAP_TYPE_SELECTION_UPDATED,o.UpdateHashCommand),this.registerCommand(this.$class.SOURCE_KEY_SELECTED,o.OpenAPIWindowCommand)},__classvars__:{getInstance:function(e){return n.Facade.hasCore(e)||new q(e),n.Facade.getInstance(e)}}}),R=n.MacroCommand.$extend({initializeMacroCommand:function(e){this.addSubCommand(z),this.addSubCommand(W),this.addSubCommand(o.UpdateParameterProxyCommand)}}),U=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.UpdateRequestProxyCommand),this.addSubCommand(o.UpdateParameterProxyCommand)}}),z=n.SimpleCommand.$extend({execute:function(e){var t=new u;this.facade.registerProxy(t);var n=new a(e.getBody());this.facade.registerProxy(n);var r=new f;this.facade.registerProxy(r);var i=new l;this.facade.registerProxy(i);var s=new c;this.facade.registerProxy(s);var o=new h;this.facade.registerProxy(o),t.setVisualizations([{name:"visualizations","class":"linechart",description:"Time-series chart",label:"Time-series"},{name:"visualizations","class":"map",description:"U.S. map over time",label:"U.S. map"}]);var p={id:"csv_table",type:"csv","class":"ico_csv",target:"table",label:"Table (CSV)"};t.setDownloadParameters({map:window.SVGAngle?[{label:"Map",children:[{id:"map_png",type:"png","class":"ico_img",target:"map",label:"Map (PNG)"},{id:"map_embed",type:"embed","class":"ico_embed",target:"map",label:"Map Embed"}]},{label:"Data",children:[{id:"map_csv",type:"csv","class":"ico_csv",target:"map",label:"Map (CSV)"},p]}]:[{label:"Data",children:[{id:"map_csv",type:"csv","class":"ico_csv",target:"map",label:"Map (CSV)"},p]}],linechart:[{label:"Chart",children:[{id:"linechart_pdf",type:"pdf","class":"ico_pdf",target:"linechart",label:"PDF"},{id:"linechart_png",type:"png","class":"ico_img",target:"linechart",label:"PNG"},{id:"linechart_embed",type:"embed","class":"ico_embed",target:"linechart",label:"EMBED"}]},{label:"Data",children:[{id:"linechart_csv",type:"csv","class":"ico_csv",target:"linechart",label:"Chart (CSV)"},p]}]})}}),W=n.SimpleCommand.$extend({execute:function(){var e=new v($("#pagecontent")),t=new Q(e);this.facade.registerMediator(t)}}),X=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.ResetRegionCommand),this.addSubCommand(o.ResetChartedCommand),this.addSubCommand(o.ResetChartindexedCommand),this.addSubCommand(o.ResetCaseCommand),this.addSubCommand(o.ResetFrequencyCommand),this.addSubCommand(o.FrequencySelectionUpdatedCommand),this.addSubCommand(o.UpdateHashCommand)}}),V=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.UpdateHashCommand)}}),J=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.ResetChartedCommand),this.addSubCommand(o.UpdateHashCommand)}}),K=n.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(f.NAME),n=this.facade.retrieveProxy(l.NAME),r=this.facade.retrieveProxy(h.NAME);t.getChartType()=="map"&&r.updateMapData(n.getChartData("map")[0])}}),Q=n.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this,t=this.getViewComponent(),n=this.facade.retrieveProxy(u.NAME),r=this.facade.retrieveProxy(a.NAME),i=this.facade.retrieveProxy(f.NAME),s=new T(t.getTableContainer()),o=new m(t.getSelectionContainer()),l=new g(t.getTimeSelectionContainer()),c=new y(t.getCaseSelectionContainer()),h=new b(t.getRegionSelectionContainer()),p=new N,d=new C(t.getChartContainer()),v=d.addView("linechart"),F=d.addView("map"),I=new w(v),q=new E(F),R=new S(t.getDownloadContainer()),U=new x(t.getFootnoteContainer()),z=new D(s),W=new k(o),X=new L(l),V=new A(c),$=new O(h),J=new P(p),K=new M(d),Q=new _(I),G=new H(q),Y=new B(R),Z=new j(U);this.facade.registerMediator(z),this.facade.registerMediator(W),this.facade.registerMediator(X),this.facade.registerMediator(V),this.facade.registerMediator($),this.facade.registerMediator(J),this.facade.registerMediator(K),this.facade.registerMediator(Q),this.facade.registerMediator(G),this.facade.registerMediator(Y),this.facade.registerMediator(Z)},listNotificationInterests:function(){return this.$super().concat([s.PARAMETER_PROXY_UPDATED,s.TABLEDATA_UPDATED,s.TABLE_RENDERED])},handleNotification:function(e){var t=this.getViewComponent(),n=this.facade.retrieveProxy(a.NAME),r=this.facade.retrieveProxy(l.NAME),i=this.facade.retrieveProxy(f.NAME),o=this.facade.retrieveProxy(u.NAME);switch(e.getName()){case s.PARAMETER_PROXY_UPDATED:break;default:this.$super(e)}},__classvars__:{NAME:"PageMediator"}}),v=v.$extend({__init__:function(){this.$super($("#pagecontent"),{mainDownloadButtonOpts:{selected:!1,id:"main_download_button"},overlayDownloadButtonOpts:{selected:!0,id:"overlay_download_button"}})}});return I}),define("js/routes",["js/pages/DefaultPage"],{defaultHash:"",patterns:[{pattern:/.*/,moduleURI:"js/pages/DefaultPage"}]}),define("js/router",["js/routes","crossroads","hasher","page","text!status.json","json2"],function(e,t,n,r,i){function a(e,t){if(e.indexOf)return e.indexOf(t);var n=e.length;while(n--)if(e[n]===t)return n;return-1}function f(e){var t=(e||"").replace("?","").split("&"),n=t.length,r={},i,s;while(n--)t[n]=t[n].split("="),i=t[n][1],r[t[n][0]]=i;return r}function l(e,t){function s(t,i){if(t)if(typeof t=="object"){var o={};$.extend(o,t,r.query),r.query=o}else typeof t=="function"?s(t.call(n,e,r),i):r[i]==void 0&&(r[i]=t)}var n=this,r={query:{}},i;for(i in t)t.hasOwnProperty(i)&&t[i]!==void 0&&(r[i]=t[i],(i=="query"||typeof t[i]=="string"&&t[i].indexOf("?")==0)&&$.extend(r.query,f(t[i])));if(n.defaults)for(i in t)t.hasOwnProperty(i)&&s(n.defaults[i],i);return[r]}function c(e){var t,n,r;if(t=e.rules)for(n in t)t.hasOwnProperty(n)&&n!="normalize_"&&(r=t[n],t[n]=function(t){return function(n,r,i){var s=!0;return t instanceof RegExp?s=t.test(n):t instanceof Array?s=a(t,n)!==-1:t instanceof Function&&(s=t(n,r,i)),!s&&e.defaultHash&&(u=e.defaultHash),s}}(r));else t=e.rules={};return t.normalize_=function(t,n){return l.call(e,t,n)},e}function h(e,t){typeof console!="undefined"&&typeof console.log=="function"&&console.log(e)}function p(n){var r;if(u){if(u==n)throw"Bad redirect hash: "+u;r=u,u=null,t.parse(r)}else t.parse(e.defaultHash)}function d(){var e=arguments;try{require([this.moduleURI],function(t){var n;o!=t&&v();try{t.load.apply(t,e)}catch(i){if(s.debug)throw i;r.errorHandler({module:t.toString(),route:e[0],error:i.name+" "+i.message,stack:i.stack})}o=t})}catch(t){if(s.debug)throw t;r.errorHandler({module:this.moduleURI,route:e[0],error:t.name+" "+t.message,stack:t.stack})}}function v(){o&&(o.unload(),o=null)}function m(e,n,r){var i=t.addRoute(e);r&&(i.rules=r),i.matched.add(d,{moduleURI:n})}function g(){var r,i;for(r=0;r<e.patterns.length;r++)i=c(e.patterns[r]),m(i.pattern,i.moduleURI,i.rules);t.routed.add(h),t.bypassed.add(p),t.shouldTypecast=!0,n.initialized.add(t.parse,t),n.changed.add(t.parse,t),n.init(),n.getHash()==""&&e.defaultHash&&e.defaultHash!=""&&t.parse(e.defaultHash)}var s=JSON.parse(i),o=null,u;return{init:g}}),require(["js/router","page"],function(e,t){t.showLoadMask(),$(e.init)}),define("js/main",function(){})