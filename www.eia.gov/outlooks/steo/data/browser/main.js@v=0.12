/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 0.7.2 - Build: 248 (2012/01/12 10:39 PM)
 */

/*!!
 * Hasher <http://github.com/millermedeiros/hasher>
 * @author Miller Medeiros
 * @version 1.1.0 (2011/11/01 07:15 PM)
 * Released under the MIT License
 */

/**
 * Classy - classy classes for JavaScript
 *
 * :copyright: (c) 2011 by Armin Ronacher. 
 * :license: BSD.
 */

/**
 * PureMVC MultiCore Framework for Javascript (Ported) - Copyright © 2011-2012 David Foley, Frédéric Saunier, Alain Duchesneau 
 * PureMVC - Copyright © 2006-2012 Futurescale, Inc.
 * All rights reserved.

 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
 * Neither the name of Futurescale, Inc., PureMVC.org, nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.

 *THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/**
 * @fileOverview
 * PureMVC JS Curl and Classy Port by Ryan Lynch 
 * Copyright(c) 2006-2012 Futurescale, Inc., Some rights reserved.
 * Reuse governed by Creative Commons Attribution 3.0 
 * http://creativecommons.org/licenses/by/3.0/us/
 */

/**
 * @author PureMVC JS AMD Classy Port by Ryan Lynch
 * @author Copyright(c) 2006-2012 Futurescale, Inc., Some rights reserved.
 * 
 * @class puremvc.Observer
 * 
 * A base Observer implementation.
 * 
 * An Observer is an object that encapsulates information
 * about an interested object with a method that should 
 * be called when a particular Notification is broadcast. 
 * 
 * In PureMVC, the Observer class assumes these responsibilities:
 * 
 * - Encapsulate the notification (callback) method of the interested object.
 * - Encapsulate the notification context (this) of the interested object.
 * - Provide methods for setting the notification method and context.
 * - Provide a method for notifying the interested object.
 * 
 * 
 * The notification method on the interested object should take 
 * one parameter of type Notification.
 * 
 * 
 * @param {Function} notifyMethod 
 *  the notification method of the interested object
 * @param {Object} notifyContext 
 *  the notification context of the interested object
 * @constructor
 */

/**
 * @author PureMVC JS Native Port by David Foley, Frédéric Saunier, & Alain Duchesneau 
 * @author Copyright(c) 2006-2012 Futurescale, Inc., Some rights reserved.
 * 
 * @class puremvc.Notification
 * 
 * A base Notification implementation.
 * 
 * PureMVC does not rely upon underlying event models such as the one provided 
 * with the DOM or other browser centric W3C event models.
 * 
 * The Observer Pattern as implemented within PureMVC exists to support 
 * event-driven communication between the application and the actors of the MVC 
 * triad.
 * 
 * Notifications are not meant to be a replacement for events in the browser. 
 * Generally, Mediator implementors place event listeners on their view 
 * components, which they then handle in the usual way. This may lead to the 
 * broadcast of Notifications to trigger commands or to communicate with other 
 * Mediators. {@link puremvc.Proxy Proxy},
 * {@link puremvc.SimpleCommand SimpleCommand}
 * and {@link puremvc.MacroCommand MacroCommand}
 * instances communicate with each other and 
 * {@link puremvc.Mediator Mediator}s
 * by broadcasting Notifications.
 * 
 * A key difference between browser events and PureMVC Notifications is that
 * events follow the 'Chain of Responsibility' pattern, 'bubbling' up the 
 * display hierarchy until some parent component handles the event, while 
 * PureMVC Notification follow a 'Publish/Subscribe' pattern. PureMVC classes 
 * need not be related to each other in a parent/child relationship in order to 
 * communicate with one another using Notifications.
 * 
 * @constructor 
 * @param {string} name
 *  The Notification name
 * @param {Object} [body]
 *  The Notification body
 * @param {Object} [type]
 *  The Notification type
 */

/**
 * @author PureMVC JS AMD Classy Port by Ryan Lynch
 * @author Copyright(c) 2006-2012 Futurescale, Inc., Some rights reserved.
 * 
 * @class puremvc.Notifier
 * 
 * A Base Notifier implementation.
 * 
 * {@link puremvc.MacroCommand MacroCommand}, 
 * {@link puremvc.SimpleCommand SimpleCommand}, 
 * {@link puremvc.Mediator Mediator} and 
 * {@link puremvc.Proxy Proxy}
 * all have a need to send Notifications
 * 
 * The Notifier interface provides a common method called #sendNotification that 
 * relieves implementation code of the necessity to actually construct 
 * Notifications.
 * 
 * The Notifier class, which all of the above mentioned classes
 * extend, provides an initialized reference to the 
 * {@link puremvc.Facade Facade}
 * Multiton, which is required for the convienience method
 * for sending Notifications but also eases implementation as these
 * classes have frequent 
 * {@link puremvc.Facade Facade} interactions 
 * and usually require access to the facade anyway.
 * 
 * NOTE: In the MultiCore version of the framework, there is one caveat to
 * notifiers, they cannot send notifications or reach the facade until they
 * have a valid multitonKey. 
 * 
 * The multitonKey is set:
 *   - on a Command when it is executed by the Controller
 *   - on a Mediator is registered with the View
 *   - on a Proxy is registered with the Model. 
 * 
 * @constructor
 */

/**
 * @author PureMVC JS AMD Classy Port by Ryan Lynch 
 * @author Copyright(c) 2006-2012 Futurescale, Inc., Some rights reserved.
 * 
 * @class puremvc.SimpleCommand
 * @extends puremvc.Notifier
 *
 * SimpleCommands encapsulate the business logic of your application. Your 
 * subclass should override the #execute method where your business logic will
 * handle the 
 * {@link puremvc.Notification Notification}
 * 
 * Take a look at 
 * {@link puremvc.Facade#registerCommand Facade's registerCommand}
 * or {@link puremvc.Controller#registerCommand Controllers registerCommand}
 * methods to see how to add commands to your application.
 * 
 * @constructor
 */

/**
 * @author PureMVC JS AMD Classy Port by Ryan Lynch
 * @author Copyright(c) 2006-2012 Futurescale, Inc., Some rights reserved.
 * 
 * @class puremvc.MacroCommand
 * @extends puremvc.Notifier
 * 
 * A base command implementation that executes other commands, such as
 * {@link puremvc.SimpleCommand SimpleCommand}
 * or {@link puremvc.MacroCommand MacroCommand}
 * subclasses.
 *  
 * A MacroCommand maintains an list of
 * command constructor references called *SubCommands*.
 * 
 * When #execute is called, the MacroCommand
 * instantiates and calls #execute on each of its *SubCommands* in turn.
 * Each *SubCommand* will be passed a reference to the original
 * {@link puremvc.Notification Notification} 
 * that was passed to the MacroCommands #execute method
 * 
 * Unlike {@link puremvc.SimpleCommand SimpleCommand}, 
 * your subclass should not override #execute but instead, should 
 * override the #initializeMacroCommand method, calling #addSubCommand once for 
 * each *SubCommand* to be executed.
 * 
 * If your subclass does define a constructor, be sure to call "super" like so
 * 
 *     function MyMacroCommand ()
 *     {
 *         MacroCommand.call(this);
 *     };
 * @constructor
 */

/**
 * @author PureMVC JS AMD Classy Port by Ryan Lynch 
 * @author Copyright(c) 2006-2012 Futurescale, Inc., Some rights reserved.
 * 
 * @class puremvc.Mediator
 * @extends puremvc.Notifier
 * 
 * A base Mediator implementation.
 *
 * In PureMVC, Mediator classes are used to mediate communication between a view 
 * component and the rest of the application.
 *
 * A Mediator should listen to its view components for events, and handle them 
 * by sending notifications (to be handled by other Mediators, 
 * {@link puremvc.SimpleCommand SimpleCommands} 
 * or
 * {@link puremvc.MacroCommand MacroCommands}) 
 * or passing data from the view component directly to a 
 * {@link puremvc.Proxy Proxy}, such as submitting 
 * the contents of a form to a service.
 * 
 * Mediators should not perform business logic, maintain state or other 
 * information for its view component, or break the encapsulation of the view 
 * component by manipulating the view component's children. It should only call 
 * methods or set properties on the view component.
 *  
 * The view component should encapsulate its own behavior and implementation by 
 * exposing methods and properties that the Mediator can call without having to 
 * know about the view component's children.
 * 
 * @constructor
 * @param {string} [mediatorName]
 *  The Mediators name. The Mediators static #NAME value is used by default
 * @param {Object} [viewComponent]
 *  The Mediators {@link #setViewComponent viewComponent}.
 */

/**
 * @author PureMVC JS Native Port by David Foley, Frédéric Saunier, & Alain Duchesneau 
 * @author Copyright(c) 2006-2012 Futurescale, Inc., Some rights reserved.
 * 
 * @class puremvc.Proxy
 * @extends puremvc.Notifier
 *
 * A base Proxy implementation. 
 * 
 * In PureMVC, Proxy classes are used to manage parts of the application's data 
 * model.
 * 
 * A Proxy might simply manage a reference to a local data object, in which case 
 * interacting with it might involve setting and getting of its data in 
 * synchronous fashion.
 * 
 * Proxy classes are also used to encapsulate the application's interaction with 
 * remote services to save or retrieve data, in which case, we adopt an 
 * asyncronous idiom; setting data (or calling a method) on the Proxy and 
 * listening for a 
 * {@link puremvc.Notification Notification} 
 * to be sent  when the Proxy has retrieved the data from the service. 
 * 
 * 
 * @param {string} [proxyName]
 *  The Proxy's name. If none is provided, the Proxy will use its constructors
 *  NAME property.
 * @param {Object} [data]
 *  The Proxy's data object
 * @constructor
 */

/**
 * @author PureMVC JS AMD Class Port by Ryan Lynch 
 * @author Copyright(c) 2006-2012 Futurescale, Inc., Some rights reserved.
 * 
 * @class puremvc.Facade
 * Facade exposes the functionality of the Controller, Model and View
 * actors to client facing code. 
 * 
 * This Facade implementation is a Multiton, so you should not call the 
 * constructor directly, but instead call the static Factory method, 
 * passing the unique key for this instance to #getInstance
 *
 * @constructor
 * @param {string} key
 * 	The multiton key to use to retrieve the Facade instance.
 * @throws {Error} 
 *  If an attempt is made to instantiate Facade directly
 */

/**
 * @author PureMVC JS AMD Classy Port author Ryan Lynch
 * @author Copyright(c) 2006-2012 Futurescale, Inc., Some rights reserved.
 * 
 * @class puremvc.View
 * 
 * A Multiton View implementation.
 * 
 * In PureMVC, the View class assumes these responsibilities
 * 
 * - Maintain a cache of {@link puremvc.Mediator Mediator}
 *   instances.
 * 
 * - Provide methods for registering, retrieving, and removing 
 *   {@link puremvc.Mediator Mediator}.
 * 
 * - Notifiying {@link puremvc.Mediator Mediator} when they are registered or 
 *   removed.
 * 
 * - Managing the observer lists for each {@link puremvc.Notification Notification}  
 *   in the application.
 * 
 * - Providing a method for attaching {@link puremvc.Observer Observer} to an 
 *   {@link puremvc.Notification Notification}'s observer list.
 * 
 * - Providing a method for broadcasting a {@link puremvc.Notification Notification}.
 * 
 * - Notifying the {@link puremvc.Observer Observer}s of a given 
 *   {@link puremvc.Notification Notification} when it broadcast.
 * 
 * This View implementation is a Multiton, so you should not call the 
 * constructor directly, but instead call the static Multiton 
 * Factory #getInstance method.
 * 
 * @param {string} key
 * @constructor
 * @throws {Error} 
 *  if instance for this Multiton key has already been constructed
 */

/**
 * @author PureMVC JS AMD CLassy Port by Ryan Lynch 
 * @author Copyright(c) 2006-2012 Futurescale, Inc., Some rights reserved.
 * 
 * @class puremvc.Model
 *
 * A Multiton Model implementation.
 *
 * In PureMVC, the Model class provides
 * access to model objects (Proxies) by named lookup.
 *
 * The Model assumes these responsibilities:
 *
 * - Maintain a cache of {@link puremvc.Proxy Proxy}
 *   instances.
 * - Provide methods for registering, retrieving, and removing
 *   {@link puremvc.Proxy Proxy} instances.
 *
 * Your application must register 
 * {@link puremvc.Proxy Proxy} instances with the Model. 
 * Typically, you use a 
 * {@link puremvc.SimpleCommand SimpleCommand} 
 * or
 * {@link puremvc.MacroCommand MacroCommand} 
 * to create and register Proxy instances once the Facade has initialized the 
 * *Core* actors.
 *
 * This Model implementation is a Multiton, so you should not call the 
 * constructor directly, but instead call the 
 * {@link #getInstance static Multiton Factory method} 
 * @constructor
 * @param {string} key
 *  The Models multiton key
 * @throws {Error}
 *  An error is thrown if this multitons key is already in use by another instance
 */

/**
 * @author PureMVC JS AMD Classy Port by Ryan Lynch
 * @author Copyright(c) 2006-2012 Futurescale, Inc., Some rights reserved.
 * 
 * @class puremvc.Controller
 * 
 * In PureMVC, the Controller class follows the 'Command and Controller' 
 * strategy, and assumes these responsibilities:
 * 
 * - Remembering which
 * {@link puremvc.SimpleCommand SimpleCommand}s
 * or 
 * {@link puremvc.MacroCommand MacroCommand}s
 * are intended to handle which 
 * {@link puremvc.Notification Notification}s
 * - Registering itself as an 
 * {@link puremvc.Observer Observer} with
 * the {@link puremvc.View View} for each 
 * {@link puremvc.Notification Notification}
 * that it has an 
 * {@link puremvc.SimpleCommand SimpleCommand} 
 * or {@link puremvc.MacroCommand MacroCommand} 
 * mapping for.
 * - Creating a new instance of the proper 
 * {@link puremvc.SimpleCommand SimpleCommand}s
 * or 
 * {@link puremvc.MacroCommand MacroCommand}s
 * to handle a given 
 * {@link puremvc.Notification Notification} 
 * when notified by the
 * {@link puremvc.View View}.
 * - Calling the command's execute method, passing in the 
 * {@link puremvc.Notification Notification}.
 *
 * Your application must register 
 * {@link puremvc.SimpleCommand SimpleCommand}s
 * or {@link puremvc.MacroCommand MacroCommand}s 
 * with the Controller.
 *
 * The simplest way is to subclass 
 * {@link puremvc.Facade Facade},
 * and use its 
 * {@link puremvc.Facade#initializeController initializeController} 
 * method to add your registrations.
 *
 * @constructor
 * This Controller implementation is a Multiton, so you should not call the 
 * constructor directly, but instead call the static #getInstance factory method, 
 * passing the unique key for this instance to it.
 * @param {string} key
 * @throws {Error}
 *  If instance for this Multiton key has already been constructed
 */

/*!
  * Kizzy - a cross-browser LocalStorage API
  * Copyright: Dustin Diaz 2012
  * https://github.com/ded/kizzy
  * License: MIT
  */

/**
 * @license RequireJS text 2.0.10 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*
 RequireJS order 1.0.5 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

/** @license
 * Crossroads.js <http://millermedeiros.github.com/crossroads.js>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 0.7.1 - Build: 88 (2012/01/06 05:17 PM)
 */

define("signals",[],function(){function e(e,t,i,n,s){this._listener=t,this._isOnce=i,this.context=n,this._signal=e,this._priority=s||0}function t(e,t){if("function"!=typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}var i={VERSION:"0.7.2"};return e.prototype={active:!0,params:null,execute:function(e){var t,i;return this.active&&this._listener&&(i=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,i),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener):null},isBound:function(){return!!this._signal&&!!this._listener},getListener:function(){return this._listener},_destroy:function(){delete this._signal,delete this._listener,delete this.context},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},i.Signal=function(){this._bindings=[],this._prevParams=null},i.Signal.prototype={memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(t,i,n,s){var a,r=this._indexOfListener(t);if(r!==-1&&this._bindings[r].context===n){if(a=this._bindings[r],a.isOnce()!==i)throw new Error("You cannot add"+(i?"":"Once")+"() then add"+(i?"Once":"")+"() the same listener without removing the relationship first.")}else a=new e(this,t,i,n,s),this._addBinding(a);return this.memorize&&this._prevParams&&a.execute(this._prevParams),a},_addBinding:function(e){var t=this._bindings.length;do--t;while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e){for(var t=this._bindings.length;t--;)if(this._bindings[t]._listener===e)return t;return-1},has:function(e){return this._indexOfListener(e)!==-1},add:function(e,i,n){return t(e,"add"),this._registerListener(e,!1,i,n)},addOnce:function(e,i,n){return t(e,"addOnce"),this._registerListener(e,!0,i,n)},remove:function(e){t(e,"remove");var i=this._indexOfListener(e);return i!==-1&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,i=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=i),n){t=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(t[n]&&this._shouldPropagate&&t[n].execute(i)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},i}),define("hasher",["signals"],function(e){var t=function(t){function i(e){if(!e)return"";var t=new RegExp("^\\"+h.prependHash+"|\\"+h.appendHash+"$","g");return e.replace(t,"")}function n(){var e=w.exec(h.getURL());return e&&e[1]?decodeURIComponent(e[1]):""}function s(){return f?f.contentWindow.frameHash:null}function a(){f=_.createElement("iframe"),f.src="about:blank",f.style.display="none",_.body.appendChild(f)}function r(){if(f&&u!==s()){var e=f.contentWindow.document;e.open(),e.write("<html><head><title>"+_.title+'</title><script type="text/javascript">var frameHash="'+u+'";</script></head><body>&nbsp;</body></html>'),e.close()}}function o(e,t){if(e=decodeURIComponent(e),u!==e){var n=u;u=e,x&&(t?f.contentWindow.frameHash=e:r()),h.changed.dispatch(i(e),i(n))}}function l(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)}function c(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent&&e.detachEvent("on"+t,i)}function d(e){e=Array.prototype.slice.call(arguments);var t=e.join(h.separator);return t=t?h.prependHash+t.replace(A,"")+h.appendHash:t,b&&T&&(t=t.replace(/\?/,"%3F")),t}var h,u,p,m,f,g,v=25,_=t.document,C=t.location,y=(t.history,e.Signal),w=/#(.*)$/,S=/(\?.*)|(\#.*)/,A=/^\#/,b=!1,E="onhashchange"in t,x=b&&!E,T="file:"===C.protocol;return g=x?function(){var e=n(),t=s();t!==u&&t!==e?h.setHash(i(t)):e!==u&&o(e)}:function(){var e=n();e!==u&&o(e)},h={VERSION:"1.1.0",appendHash:"",prependHash:"/",separator:"/",changed:new y,stopped:new y,initialized:new y,init:function(){m||(u=n(),E?l(t,"hashchange",g):(x&&(f||a(),r()),p=setInterval(g,v)),m=!0,h.initialized.dispatch(i(u)))},stop:function(){m&&(E?c(t,"hashchange",g):(clearInterval(p),p=null),m=!1,h.stopped.dispatch(i(u)))},isActive:function(){return m},getURL:function(){return C.href},getBaseURL:function(){return h.getURL().replace(S,"")},setHash:function(e){e=d.apply(null,arguments),e!==u&&(o(e),C.hash="#"+encodeURI(e))},replaceHash:function(e){e=d.apply(null,arguments),e!==u&&(o(e,!0),C.replace("#"+encodeURI(e)))},getHash:function(){return i(u)},getHashAsArray:function(){return h.getHash().split(h.separator)},dispose:function(){h.stop(),h.initialized.dispose(),h.stopped.dispose(),h.changed.dispose(),f=h=t.hasher=null},toString:function(){return'[hasher version="'+h.VERSION+'" hash="'+h.getHash()+'"]'}},h.initialized.memorize=!0,h}(window);return t}),define("classy",[],function(){function e(e){return!l||/\B\$super\b/.test(e.toString())}function t(e,t,i){void 0===i?delete e[t]:e[t]=i}function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function n(e){o=!0;var t=new e;return o=!1,t}var s="1.4",a=this,r=a.Class,o=!1,l=function(){$super()}.toString().indexOf("$super")>0,c=function(){};return c.$noConflict=function(){try{t(a,"Class",r)}catch(e){a.Class=r}return c},c.$classyVersion=s,c.$extend=function(s){var r=this.prototype,l=n(this);if(s.__include__)for(var d=0,h=s.__include__.length;d!=h;++d){var u=s.__include__[d];for(var p in u){var m=i(u,p);void 0!==m&&(l[p]=u[p])}}if(s.__classvars__=s.__classvars__||{},l.__classvars__)for(var f in l.__classvars__)if(!s.__classvars__[f]){var m=i(l.__classvars__,f);s.__classvars__[f]=m}for(var p in s){var m=i(s,p);"__include__"!==p&&void 0!==m&&(l[p]="function"==typeof m&&e(m)?function(e,n){return function(){var s=i(this,"$super");this.$super=r[n];try{return e.apply(this,arguments)}finally{t(this,"$super",s)}}}(m,p):m)}var g=function(){if(!o){var e=a===this?n(arguments.callee):this;return e.$class=g,e.__init__&&e.__init__.apply(e,arguments),e}};for(var f in s.__classvars__){var m=i(s.__classvars__,f);void 0!==m&&(g[f]=m)}return g.prototype=l,g.constructor=g,g.$extend=c.$extend,g.$withData=c.$withData,g},c.$withData=function(e){var t=n(this);for(var s in e){var a=i(e,s);void 0!==a&&(t[s]=a)}return t},c}),define("puremvc",["classy"],function(e){var t=e.$extend({__init__:function(e,t){this.setNotifyMethod(e),this.setNotifyContext(t)},setNotifyMethod:function(e){this.notify=e},setNotifyContext:function(e){this.context=e},getNotifyMethod:function(){return this.notify},getNotifyContext:function(){return this.context},notifyObserver:function(e){this.getNotifyMethod().call(this.getNotifyContext(),e)},compareNotifyContext:function(e){return e===this.context},notify:null,context:null}),i=e.$extend({__init__:function(e,t,i){this.name=e,this.body=t,this.type=i},getName:function(){return this.name},setBody:function(e){this.body=e},getBody:function(){return this.body},setType:function(e){this.type=e},getType:function(){return this.type},toString:function(){var e="Notification Name: "+this.getName();return e+="\nBody:"+(null==this.body?"null":this.body.toString()),e+="\nType:"+(null==this.type?"null":this.type)},name:null,type:null,body:null}),n=e.$extend({sendNotification:function(e,t,i){var n=this.getFacade();n&&n.sendNotification(e,t,i)},facade:null,initializeNotifier:function(e){this.multitonKey=String(e),this.facade=this.getFacade()},getFacade:function(){if(null==this.multitonKey)throw new Error(n.MULTITON_MSG);return l.getInstance(this.multitonKey)},multitonKey:null,__classvars__:{MULTITON_MSG:"multitonKey for this Notifier not yet initialized!"}}),s=n.$extend({execute:function(e){}}),a=n.$extend({__init__:function(){this.subCommands=[],this.initializeMacroCommand()},subCommands:null,initializeMacroCommand:function(){},addSubCommand:function(e){this.subCommands.push(e)},execute:function(e){for(;this.subCommands.length>0;){var t=this.subCommands.shift(),i=new t;i.initializeNotifier(this.multitonKey),i.execute(e)}}}),r=n.$extend({__init__:function(e,t){this.mediatorName=e||this.$class.NAME,this.viewComponent=t},getMediatorName:function(){return this.mediatorName},setViewComponent:function(e){this.viewComponent=e},getViewComponent:function(){return this.viewComponent},listNotificationInterests:function(){return[]},handleNotification:function(e){},onRegister:function(){},onRemove:function(){},mediatorName:null,viewComponent:null,__classvars:{NAME:"Mediator"}}),o=n.$extend({__init__:function(e,t){this.proxyName=e||this.$class.NAME,null!=t&&this.setData(t)},getProxyName:function(){return this.proxyName},setData:function(e){this.data=e},getData:function(){return this.data},onRegister:function(){},onRemove:function(){},proxyName:null,data:null,__classvars__:{NAME:"Proxy"}}),l=e.$extend({__init__:function(e){if(null!=this.$class.instanceMap[e])throw new Error(this.$class.MULTITON_MSG);this.initializeNotifier(e),this.$class.instanceMap[e]=this,this.initializeFacade()},initializeFacade:function(){this.initializeModel(),this.initializeController(),this.initializeView()},initializeController:function(){null==this.controller&&(this.controller=h.getInstance(this.multitonKey))},initializeModel:function(){null==this.model&&(this.model=d.getInstance(this.multitonKey))},initializeView:function(){null==this.view&&(this.view=c.getInstance(this.multitonKey))},registerCommand:function(e,t){this.controller.registerCommand(e,t)},removeCommand:function(e){this.controller.removeCommand(e)},hasCommand:function(e){return this.controller.hasCommand(e)},registerProxy:function(e){this.model.registerProxy(e)},retrieveProxy:function(e){return this.model.retrieveProxy(e)},removeProxy:function(e){var t=null;return null!=this.model&&(t=this.model.removeProxy(e)),t},hasProxy:function(e){return this.model.hasProxy(e)},registerMediator:function(e){null!=this.view&&this.view.registerMediator(e)},retrieveMediator:function(e){return this.view.retrieveMediator(e)},removeMediator:function(e){var t=null;return null!=this.view&&(t=this.view.removeMediator(e)),t},hasMediator:function(e){return this.view.hasMediator(e)},sendNotification:function(e,t,n){this.notifyObservers(new i(e,t,n))},notifyObservers:function(e){null!=this.view&&this.view.notifyObservers(e)},initializeNotifier:function(e){this.multitonKey=e},controller:null,model:null,view:null,multitonKey:null,__classvars__:{getInstance:function(e){return null==this.instanceMap[e]&&(this.instanceMap[e]=new this(e)),this.instanceMap[e]},hasCore:function(e){return null!=this.instanceMap[e]},removeCore:function(e){null!=this.instanceMap[e]&&(d.removeModel(e),c.removeView(e),h.removeController(e),delete this.instanceMap[e])},instanceMap:[],MULTITON_MSG:"Facade instance for this Multiton key already constructed!"}}),c=e.$extend({__init__:function(e){if(null!=this.$class.instanceMap[e])throw new Error(this.$class.MULTITON_MSG);this.multitonKey=e,this.$class.instanceMap[this.multitonKey]=this,this.mediatorMap=[],this.observerMap=[],this.initializeView()},initializeView:function(){},registerObserver:function(e,t){null!=this.observerMap[e]?this.observerMap[e].push(t):this.observerMap[e]=[t]},notifyObservers:function(e){if(null!=this.observerMap[e.getName()]){for(var t,i=this.observerMap[e.getName()],n=[],s=0;s<i.length;s++)t=i[s],n.push(t);for(var s=0;s<n.length;s++)t=n[s],t.notifyObserver(e)}},removeObserver:function(e,t){for(var i=this.observerMap[e],n=0;n<i.length;n++)if(1==i[n].compareNotifyContext(t)){i.splice(n,1);break}0==i.length&&delete this.observerMap[e]},registerMediator:function(e){if(null==this.mediatorMap[e.getMediatorName()]){e.initializeNotifier(this.multitonKey),this.mediatorMap[e.getMediatorName()]=e;var i=e.listNotificationInterests();if(i.length>0)for(var n=new t(e.handleNotification,e),s=0;s<i.length;s++)this.registerObserver(i[s],n);e.onRegister()}},retrieveMediator:function(e){return this.mediatorMap[e]},removeMediator:function(e){var t=this.mediatorMap[e];if(t){for(var i=t.listNotificationInterests(),n=0;n<i.length;n++)this.removeObserver(i[n],t);delete this.mediatorMap[e],t.onRemove()}return t},hasMediator:function(e){return null!=this.mediatorMap[e]},multitonKey:null,mediatorMap:null,observerMap:null,__classvars__:{getInstance:function(e){return null==this.instanceMap[e]&&(this.instanceMap[e]=new this(e)),this.instanceMap[e]},removeView:function(e){delete this.instanceMap[e]},instanceMap:[],MULTITON_MSG:"View instance for this Multiton key already constructed!"}}),d=e.$extend({__init__:function(e){if(this.$class.instanceMap[e])throw new Error(this.$class.MULTITON_MSG);this.multitonKey=e,this.$class.instanceMap[e]=this,this.proxyMap=[],this.initializeModel()},initializeModel:function(){},registerProxy:function(e){e.initializeNotifier(this.multitonKey),this.proxyMap[e.getProxyName()]=e,e.onRegister()},retrieveProxy:function(e){return this.proxyMap[e]},hasProxy:function(e){return null!=this.proxyMap[e]},removeProxy:function(e){var t=this.proxyMap[e];return t&&(this.proxyMap[e]=null,t.onRemove()),t},proxyMap:null,multitonKey:"",__classvars__:{getInstance:function(e){return null==this.instanceMap[e]&&(this.instanceMap[e]=new this(e)),this.instanceMap[e]},removeModel:function(e){delete this.instanceMap[e]},instanceMap:[],MULTITON_MSG:"Model instance for this Multiton key already constructed!"}}),h=e.$extend({__init__:function(e){if(null!=this.$class.instanceMap[e])throw new Error(this.$class.MULTITON_MSG);this.multitonKey=e,this.$class.instanceMap[this.multitonKey]=this,this.commandMap=new Array,this.initializeController()},initializeController:function(){this.view=c.getInstance(this.multitonKey)},executeCommand:function(e){var t=this.commandMap[e.getName()];if(null!=t){var i=new t;i.initializeNotifier(this.multitonKey),i.execute(e)}},registerCommand:function(e,i){null==this.commandMap[e]&&this.view.registerObserver(e,new t(this.executeCommand,this)),this.commandMap[e]=i},hasCommand:function(e){return null!=this.commandMap[e]},removeCommand:function(e){this.hasCommand(e)&&(this.view.removeObserver(e,this),this.commandMap[e]=null)},view:null,commandMap:null,multitonKey:null,__classvars__:{getInstance:function(e){return null==this.instanceMap[e]&&(this.instanceMap[e]=new this(e)),this.instanceMap[e]},removeController:function(e){delete this.instanceMap[e]},instanceMap:[],MULTITON_MSG:"controller key for this Multiton key already constructed"}});return{View:c,Model:d,Controller:h,SimpleCommand:s,MacroCommand:a,Facade:l,Mediator:r,Observer:t,Notification:i,Notifier:n,Proxy:o,define:define}}),define("kizzy",[],function(){function e(){}function t(){return+new Date}function i(e,i){e._[i]&&e._[i].e&&e._[i].e<t()&&e.remove(i)}function n(e){return"number"==typeof e&&isFinite(e)}function s(e){return localStorage[e]}function a(e,t){return localStorage[e]=t,t}function r(e){delete localStorage[e]}function o(){localStorage.clear()}function l(e){for(var t,i=A.childNodes,n=null,s=0,a=i.length;s<a;s++)if(t=i.item(s),t.getAttribute("key")==e){n=t;break}return n}function c(e){var t=l(e),i=null;return t&&(i=t.getAttribute("value")),i}function d(e,t){var i=l(e);return i?i.setAttribute("value",t):(i=S.createNode(1,"item",""),i.setAttribute("key",e),i.setAttribute("value",t),A.appendChild(i)),w.save(_),t}function h(e){l(e)&&A.removeChild(node),w.save(_)}function u(){for(;A.firstChild;)A.removeChild(A.firstChild);w.save(_)}function p(){this._={}}function m(e){this.ns=e,this._=JSON.parse(E(e)||"{}")}function f(e){return new m(e)}var g,v=document,_=v.domain,C=0,y=function(){return 1};try{g=!!localStorage||!!globalStorage,localStorage||(localStorage=globalStorage[_]),C=1}catch(e){C=0;try{if(v.documentElement.addBehavior){C=0,g=1;var w=v.documentElement;w.addBehavior("#default#userData"),w.load(_);var S=w.xmlDocument,A=S.documentElement}}catch(e){g=!1}}var b=e,E=e,x=e,T=e;return g&&(b=C?a:d,E=C?s:c,x=C?r:h,T=C?o:u,y=function(e){try{var t=JSON.stringify(e._);return"{}"==t?x(e.ns):b(e.ns,t),1}catch(e){return 0}}),p.prototype={set:function(e,i,s){return this._[e]={value:i,e:n(s)?t()+s:0},y(this)||this.remove(e),i},get:function(e){return i(this,e),this._[e]?this._[e].value:void 0},remove:function(e){delete this._[e],y(this)},clear:function(){this._={},y(this)},clearExpireds:function(){for(var e in this._)i(this,e);y(this)}},m.prototype=p.prototype,f.remove=x,f.clear=T,f}),define("page",["classy","kizzy","signals","hasher","loadmask","json2"],function(e,t,i,n){return e.$extend({__init__:function(e){this.name=e,this.settings=t(this.name),this.loadSignal=new i.Signal,this.unloadSignal=new i.Signal},load:function(e){this.settings.clearExpireds(),this.$class.pushRequest(e),this.loadSignal.dispatch(e),this.isLoaded=!0},unload:function(){this.settings.clearExpireds(),this.unloadSignal.dispatch(),this.isLoaded=!1},toString:function(){return"[Page "+this.name+"]"},__classvars__:{requests:[],setHash:function(e){n.setHash(e)},showLoadMask:function(e,t){t=t||$("#pagecontent"),e='<span class="loading">'+(e||this.LOADING_MESSAGE)+"</span>",t.mask(e)},hideLoadMask:function(e){e=e||$("#pagecontent"),e.unmask()},pushRequest:function(e){this.requests.length>=10&&this.requests.shift(),this.requests.push(e)},errorHandler:function(e,t){var i=$("#pagecontent");if(e&&t){var n=this.generateErrorJSON(e);$.ajax({url:t,type:"POST",data:{json:n}})}var s='An error has occurred, and has been logged.  </br>If refreshing the page does not solve the issue, </br>try returning to the <a href="./">main page</a> and making</br> another selection';i.mask(s)},clearErrorMessage:function(){var e=$("#pagecontent");e.unmask()},generateErrorJSON:function(e){return JSON.stringify($.extend(!0,{},e,{browser:$.browser,requests:this.requests}))},LOADING_MESSAGE:"Loading..."}})}),define("js/Facade",["puremvc"],function(e){return e.Facade.$extend({sendNotification:function(e,t,i){"undefined"!=typeof console&&"function"==typeof console.log&&console.log(Date.now()+" : "+e+(i?" : "+i:""));try{this.$super(e,t,i)}catch(t){if("undefined"!=typeof console&&"function"==typeof console.log&&console.log("ERROR: "+t.name+" : "+t.message+"\n"+t.stack),location.host.indexOf("wwwdev")!=-1||location.host.indexOf("vdc")!=-1)throw t;this.$super(this.$class.ERROR,t,e)}},__classvars__:{STARTUP:"startup",RELOAD:"reload",UNLOAD:"unload",CHART_PARAMS_UPDATED:"chartParamsUpdated",MAP_TYPE_PARAM_UPDATED:"mapTypeParamUpdated",CTYPE_PARAM_UPDATED:"ctypeParamUpdated",TIME_PARAMS_UPDATED:"timeParamsUpdated",VIEW_PARAM_UPDATED:"viewParamUpdated",SERIES_PARAM_UPDATED:"seriesParamUpdated",FREQUENCY_PARAM_UPDATED:"frequencyParamUpdated",TIME_PERIOD_PARAM_UPDATED:"timePeriodParamUpdated",TABLE_PARAMS_UPDATED:"tableParamsUpdated",TABLEDATA_UPDATED:"tableDataUpdated",CHART_DATA_UPDATED:"chartDataUpdated",DEFAULT_CHART_SET:"defaultChartSet",MAP_DATA_UPDATED:"mapDataUpdated",CSV_DATA_GENERATED:"csvDownloadDataGenerated",VIEW_SELECTION_CHANGED:"viewSelectionChanged",SERIES_SELECTION_CHANGED:"seriesSelectionChanged",FREQUENCY_SELECTION_UPDATED:"frequencySelectionUpdated",TIME_SELECTION_UPDATED:"timeSelectionUpdated",CHART_SELECTION_UPDATED:"chartSelectionUpdated",SOURCE_KEY_SELECTED:"sourceKeySelected",DOWNLOAD_OPTION_SELECTED:"donwloadOptionSelected",MAP_TYPE_SELECTION_UPDATED:"mapTypeSelectionUpdated",REMOVE_ROWS:"removeRows",TABLE_NEEDS_TRIMMING:"tableNeedsTrimming",TABLE_RENDERED:"tableRendered",UPDATE_VISUALIZATION_VIEW_STACK:"updateVisualizationViewStack",ERROR:"error"}})}),define("text",["module"],function(e){"use strict";var t,i,n,s,a,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,d=c&&location.protocol&&location.protocol.replace(/\:/,""),h=c&&location.hostname,u=c&&(location.port||void 0),p={},m=e.config&&e.config()||{};return t={version:"2.0.10",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:m.createXhr||function(){var e,t,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){i=r[t];try{e=new ActiveXObject(i)}catch(e){}if(e){r=[i];break}}return e},parseName:function(e){var t,i,n,s=!1,a=e.indexOf("."),r=0===e.indexOf("./")||0===e.indexOf("../");return a!==-1&&(!r||a>1)?(t=e.substring(0,a),i=e.substring(a+1,e.length)):t=e,n=i||t,a=n.indexOf("!"),a!==-1&&(s="strip"===n.substring(a+1),n=n.substring(0,a),i?i=n:t=n),{moduleName:t,ext:i,strip:s}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,i,n,s){var a,r,o,l=t.xdRegExp.exec(e);return!l||(a=l[2],r=l[3],r=r.split(":"),o=r[1],r=r[0],!(a&&a!==i||r&&r.toLowerCase()!==n.toLowerCase()||(o||r)&&o!==s))},finishLoad:function(e,i,n,s){n=i?t.strip(n):n,m.isBuild&&(p[e]=n),s(n)},load:function(e,i,n,s){if(s.isBuild&&!s.inlineText)return void n();m.isBuild=s.isBuild;var a=t.parseName(e),r=a.moduleName+(a.ext?"."+a.ext:""),o=i.toUrl(r),l=m.useXhr||t.useXhr;return 0===o.indexOf("empty:")?void n():void(!c||l(o,d,h,u)?t.get(o,function(i){t.finishLoad(e,a.strip,i,n)},function(e){n.error&&n.error(e)}):i([r],function(e){t.finishLoad(a.moduleName+"."+a.ext,a.strip,e,n)}))},write:function(e,i,n,s){if(p.hasOwnProperty(i)){var a=t.jsEscape(p[i]);n.asModule(e+"!"+i,"define(function () { return '"+a+"';});\n")}},writeFile:function(e,i,n,s,a){var r=t.parseName(i),o=r.ext?"."+r.ext:"",l=r.moduleName+o,c=n.toUrl(r.moduleName+o)+".js";t.load(l,n,function(i){var n=function(e){return s(c,e)};n.asModule=function(e,t){return s.asModule(e,c,t)},t.write(e,l,n,a)},a)}},"node"===m.env||!m.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(i=require.nodeRequire("fs"),t.get=function(e,t,n){try{var s=i.readFileSync(e,"utf8");0===s.indexOf("\ufeff")&&(s=s.substring(1)),t(s)}catch(e){n(e)}}):"xhr"===m.env||!m.env&&t.createXhr()?t.get=function(e,i,n,s){var a,r=t.createXhr();if(r.open("GET",e,!0),s)for(a in s)s.hasOwnProperty(a)&&r.setRequestHeader(a.toLowerCase(),s[a]);m.onXhr&&m.onXhr(r,e),r.onreadystatechange=function(t){var s,a;4===r.readyState&&(s=r.status,s>399&&s<600?(a=new Error(e+" HTTP status: "+s),a.xhr=r,n(a)):i(r.responseText),m.onXhrComplete&&m.onXhrComplete(r,e))},r.send(null)}:"rhino"===m.env||!m.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var i,n,s="utf-8",a=new java.io.File(e),r=java.lang.System.getProperty("line.separator"),o=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(a),s)),l="";try{for(i=new java.lang.StringBuffer,n=o.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=o.readLine());)i.append(r),i.append(n);l=String(i.toString())}finally{o.close()}t(l)}:("xpconnect"===m.env||!m.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,s=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),a="@mozilla.org/windows-registry-key;1"in n,t.get=function(e,t){var i,r,o,l={};a&&(e=e.replace(/\//g,"\\")),o=new FileUtils.File(e);try{i=n["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream),i.init(o,1,0,!1),r=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream),r.init(i,"utf-8",i.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),r.readString(i.available(),l),r.close(),i.close(),t(l.value)}catch(e){throw new Error((o&&o.path||"")+": "+e)}}),t}),define("js/model/ConfigProxy",["puremvc","text!configJSON","json2"],function(e,t){var i=JSON.parse(t);return e.Proxy.$extend({topicMap:null,__init__:function(){var e=this;this.$super(this.$class.NAME,i),this.getData().dataColumns={},$.each(this.getValidFrequencies(),function(t,i){switch(e.getData().dataColumns[i]=[],i){case"A":for(var n=e.getMinYear();n<=e.getMaxYear();n++)e.getData().dataColumns[i].push(n);break;case"M":for(var n=e.getMinYear();n<=e.getMaxYear();n++)for(var s=1;s<=12;s++)e.getData().dataColumns[i].push(100*n+s);break;case"Q":for(var n=e.getMinYear();n<=e.getMaxYear();n++)for(var s=1;s<=4;s++)e.getData().dataColumns[i].push(100*n+s)}})},getViews:function(){return this.getData().views},getViewById:function(e){for(var t=this.getViews(),i=0;i<t.length;i++)if(t[i].id==e)return t[i];return!1},getSeries:function(){return this.getData().series},getSeriesByID:function(){return this.getData().seriesByID},getDefaults:function(){return this.getData().defaults},getValidFrequencies:function(){return this.getDefaults().validFrequencies},getValidViews:function(){return this.getDefaults().validViews},getMinYear:function(){return this.getDefaults().minYear},getMaxYear:function(){return this.getDefaults().maxYear},getMinPeriod:function(e){switch(e){case"A":return parseInt(this.getMinYear());case"M":case"Q":return parseInt(this.getMinYear()+"01")}},getMaxPeriod:function(e){switch(e){case"A":return parseInt(this.getMaxYear());case"M":return parseInt(this.getMaxYear()+"12");case"Q":return parseInt(this.getMaxYear()+"04")}},getDefaultView:function(){return this.getDefaults().defaultView},getDefaultFrequency:function(){return this.getDefaults().defaultFrequency},getDefaultStartYear:function(){return this.getDefaults().defaultStartYear},getDefaultEndYear:function(){return this.getDefaults().defaultEndYear},getDefaultStart:function(e){switch(e){case"M":case"Q":return parseInt(this.getDefaultStartYear()+"01");case"A":return parseInt(this.getDefaultStartYear())}},getDefaultEnd:function(e){switch(e){case"M":return parseInt(this.getDefaultEndYear()+"12");case"Q":return parseInt(this.getDefaultEndYear()+"04");case"A":return parseInt(this.getDefaultEndYear())}},getDefaultChartType:function(){return this.getDefaults().defaultChartType},getDefaultParams:function(){var e={};return e.f=this.getDefaultFrequency(),e.start=this.getDefaultStartYear(),e.end=this.getDefaultEndYear(),e.v=this.getDefaultView(),e.ctype=this.getDefaultChartType(),e},getDataColumns:function(e){return this.getData().dataColumns[e]},getVisualizations:function(){return this.getData().visualizations},setVisualizations:function(e){this.getData().visualizations=e},setDownloadParameters:function(e){this.getData().downloadParameters=e},getDownloadParameters:function(){return this.getData().downloadParameters},__classvars__:{NAME:"ConfigProxy"}})}),define("js/model/RequestProxy",["puremvc"],function(e){return e.Proxy.$extend({__init__:function(e){e.query=$.extend({id:"",v:"",s:"",f:"",start:"",end:""},e.query),this.$super(this.$class.NAME,e)},getQuery:function(){return this.getData().query},getSelectedTable:function(){return this.getQuery().id},getSelectedView:function(){return this.getQuery().v},getSelectedSeries:function(){return this.getQuery().s},getFrequency:function(){return this.getQuery().f},getStartPeriod:function(){return this.getQuery().start},getEndPeriod:function(){return this.getQuery().end},__classvars__:{NAME:"RequestProxy"}})}),define("js/model/ParameterProxy",["puremvc","js/Facade","js/model/ConfigProxy","js/model/RequestProxy"],function(e,t,i,n){return e.Proxy.$extend({__init__:function(){this.$super(this.$class.NAME,{query:{}})},getQuery:function(){return this.getData().query},getQueryKeys:function(){return["v","f","s","start","end"]},maskToBits:function(e){var t=this;return this.bits=[],e=e.toString(),$.each(e.split(""),function(e,i){for(var n=parseInt(i,32).toString(2).split("");n.length<5;)n.splice(0,0,"0");$.each(n,function(e,i){t.bits.push(i)})}),this.bits},bitsToMask:function(e){var t=this;this.mask=[];for(var i=e.slice(0);i.length>0;){var n=i.splice(0,5);t.mask.push(parseInt(n.join(""),2).toString(32))}return this.mask.join("")},createEmptyMask:function(e){return $.map(Array.apply(null,new Array(5*Math.ceil((Math.max.apply(Math,$.map(e,function(e){return e.formulaId?e.formulaId:0}))+1)/5))),function(e){return 0})},convertToBitmap:function(e){for(var t=this.facade.retrieveProxy(i.NAME),n=e.split("~"),s=t.getSeriesByID(),a=this.createEmptyMask(t.getSeries()),r=0;r<n.length;r++)n[r]&&(a[s[n[r]].formulaId]=1);return this.bitsToMask(a)},getQueryString:function(e){var t,i,n=$.extend({},this.getQuery(),e),s="?",a=this.getQueryKeys();for(t=0;t<a.length;t++)i=a[t],n.hasOwnProperty(i)&&(s+=i+"="+n[i]+"&");return $.each(n,function(e,t){$.inArray(e,a)==-1&&"ps"!=e&&(s+=e+"="+t+"&")}),s.substring(0,s.length-1)},getSelectedView:function(){return this.getQuery().v},getSelectedSeriesIDs:function(){return"undefined"!=typeof this.getQuery().si?this.getQuery().si:""},getSelectedSeries:function(){return"undefined"!=typeof this.getQuery().s?this.getQuery().s:[]},getPreviousSeries:function(){return"undefined"!=typeof this.previousSeries?this.previousSeries:[]},setPreviousSeries:function(e){this.previousSeries=e},getFrequency:function(){return this.getQuery().f},getStart:function(){return this.getQuery().start},getEnd:function(){return this.getQuery().end},getTimeParams:function(){return{start:this.getStart(),end:this.getEnd(),f:this.getFrequency()}},update:function(){var e=this.facade.retrieveProxy(n.NAME),i="undefined"==typeof this.getSelectedView(),s=!1,a=!1,r=!1,o=!1,l=!("ctype"in e.getQuery()),c=!("ctype"in e.getQuery());mapTypeParamUpdated=!1,this.updateQuery(e.getQuery(),function(e,t,i){s|="v"==e,a|="s"==e,r|="f"==e,o|="start"==e||"end"==e,$.each(["linechart","columnchart","map"],function(t,i){l|=e==i}),l|=c|="ctype"==e,l|="chartindexed"==e,l|="columnendpoints"==e,l|="columnvalues"==e,mapTypeParamUpdated|="maptype"==e});var d=!1,h=[];if(a)if("undefined"!=typeof this.getSelectedSeries()&&this.getPreviousSeries().length>1)for(var u=this.maskToBits(this.getSelectedSeries()),p=this.maskToBits(this.getPreviousSeries()),m=0;m<p.length;m++)1==p[m]&&0==u[m]?h.push(m):0==p[m]&&1==u[m]&&(d=!0);else d=!0;h.length>0&&!d&&this.sendNotification(t.REMOVE_ROWS,h),(i||s||r||a&&d)&&this.sendNotification(t.TABLE_PARAMS_UPDATED),c&&this.sendNotification(t.UPDATE_VISUALIZATION_VIEW_STACK),s&&this.sendNotification(t.VIEW_PARAM_UPDATED),a&&this.sendNotification(t.SERIES_PARAM_UPDATED),r&&this.sendNotification(t.FREQUENCY_PARAM_UPDATED),o&&this.sendNotification(t.TIME_PERIOD_PARAM_UPDATED),l&&this.sendNotification(t.CHART_PARAMS_UPDATED),mapTypeParamUpdated&&this.sendNotification(t.MAP_TYPE_PARAM_UPDATED)},copyQuery:function(e,t,i,n){var s,a,r={},o={};for(s in t)t.hasOwnProperty(s)&&(a=s.toLowerCase(),e[a]=t[s],i[a]!=t[s]?r[a]=s:o[a]=s);for(a in i)i.hasOwnProperty(a)&&(a in r||a in o||(e[a]=void 0,r[a]=a));for(a in r)r.hasOwnProperty(a)&&n.call(this,a,e[a],i[a])},updateQuery:function(e,t){var i={};this.copyQuery(i,e,this.getQuery(),t),this.validateQuery(i),$.extend(this.getData(),{query:i})},validateQuery:function(e){this.validateFrequency(e),this.validateStartEnd(e),this.validateView(e),this.validateChartParams(e),this.validateSeries(e)},validateSeries:function(e){var t=(this.facade.retrieveProxy(i.NAME),"0");this.checkVal(e,"s",t,function(e){var t=/^[a-vA-V0-9]*$/g;return t.test(e)})},validateFrequency:function(e){var t=this.facade.retrieveProxy(i.NAME),n=t.getDefaultFrequency();this.checkVal(e,"f",n,function(e){return $.inArray(e,t.getValidFrequencies())>-1})},validateStartEnd:function(e){e.start=parseInt(e.start),e.end=parseInt(e.end);var t=this.facade.retrieveProxy(i.NAME);this.checkVal(e,"start",t.getDefaultStart(e.f),function(i){return i>=t.getMinPeriod(e.f)&&i<=t.getMaxPeriod(e.f)}),this.checkVal(e,"end",t.getDefaultEnd(e.f),function(i){
return i>e.start&&i<=t.getMaxPeriod(e.f)})},validateView:function(e){var t=this.facade.retrieveProxy(i.NAME),n=t.getDefaultView();this.checkVal(e,"v",n,function(e){return $.inArray(parseInt(e),t.getValidViews())>-1})},validateChartParams:function(e){var t=this.facade.retrieveProxy(i.NAME),n=t.getDefaultChartType(),s=t.getVisualizations();this.checkVal(e,"maptype","0",function(e){return"0"===e||"1"===e}),this.checkVal(e,"ctype",n,function(e){var t=!1;return $.each(s,function(i,n){n.class==e&&(t=!0)}),t})},getGAString:function(e){return this.getQueryString(e)},getTableParamsString:function(){return this.getQueryString(this.getQuery())},checkVal:function(e,t,i,n){e[t]=void 0===e[t]||n&&!n(e[t])?i:e[t]},resetStartEnd:function(e){var t=(this.facade.retrieveProxy(n.NAME),this.getQuery());if(e){var i=[t.start.toString(),t.end.toString()];switch(e){case"A":t.start=parseInt(i[0].slice(0,4)),t.end=parseInt(i[1].slice(0,4));break;case"Q":if("A"==t.f)t.start=parseInt(i[0].slice(0,4)+"01"),t.end=parseInt(i[1].slice(0,4)+"04");else{for(var s=0;s<i.length;s++)switch(i[s].slice(4,6)){case"01":case"02":case"03":i[s]=parseInt(i[s].slice(0,4)+"01");break;case"04":case"05":case"06":i[s]=parseInt(i[s].slice(0,4)+"02");break;case"07":case"08":case"09":i[s]=parseInt(i[s].slice(0,4)+"03");break;case"10":case"11":case"12":i[s]=parseInt(i[s].slice(0,4)+"04")}t.start=i[0],t.end=i[1]}break;case"M":if("A"==t.f)t.start=parseInt(i[0].slice(0,4)+"01"),t.end=parseInt(i[1].slice(0,4)+"12");else{switch(i[0].slice(4,6)){case"01":t.start=parseInt(i[0]);break;case"02":t.start=parseInt(i[0].slice(0,4)+"04");break;case"03":t.start=parseInt(i[0].slice(0,4)+"07");break;case"04":t.start=parseInt(i[0].slice(0,4)+"10")}switch(i[1].slice(4,6)){case"01":t.end=parseInt(i[1].slice(0,4)+"03");break;case"02":t.end=parseInt(i[1].slice(0,4)+"06");break;case"03":t.end=parseInt(i[1].slice(0,4)+"09");break;case"04":t.end=parseInt(i[1].slice(0,4)+"12")}}}}else delete t.start,delete t.end},getChartParams:function(){var e=(this.facade.retrieveProxy(i.NAME),{chartindexed:this.getChartIndexed(),ctype:this.getChartType(),columnendpoints:this.getColumnEndpoints(),columnvalues:this.getColumnValues()});return $.extend(e,this.getTimeParams())},getStillChartedSeries:function(e){for(var t=this.getChartedIds(this.getQuery().ctype),i=[],n=t.length-1;n>=0;n--)e.indexOf(t[n])>=0&&i.push(t[n]);return i.join("~")},getChartIndexed:function(){return this.getQuery().chartindexed},getChartType:function(){return this.getQuery().ctype},getColumnEndpoints:function(){return this.getQuery().columnendpoints},getColumnValues:function(){return this.getQuery().columnvalues},isUserGenerated:function(e){return!1},arePinnedSeriesCharted:function(){return!1},getChartedIds:function(e){var t=this.getCharted(e),i=t?t.split("~"):[];return $.each(i,function(e,t){""==i[e]&&(i[e]=null)}),i},getCharted:function(e){return this.getQuery()[e]},resetCharted:function(e){if(void 0!==e)this.deleteNonSeriesIds(e);else for(var t=this.facade.retrieveProxy(i.NAME),n=t.getVisualizations(),s=0;s<n.length;s++){var a=n[s].class;this.deleteNonSeriesIds(a)}},resetChartindexed:function(){var e=this.getQuery();delete e.chartindexed},deleteNonSeriesIds:function(e){var t=this.getQuery();if(void 0!==t[e]&&void 0!==t.s){var i={};$.each(t.s.split("~"),function(e,t){i[t]=!0});var n=$.map(t[e].split("~"),function(e){return e in i?e:null}).join("~");""===n?delete t[e]:t[e]=n}else delete t[e]},updateCharted:function(e,t){var i=this.getQuery();e=e instanceof Array?e:[e],i[t]=e.join("~")},getUpdatedCharted:function(e,t,i){return this.getUpdatedChartedIds(e,t,i).join("~")},getUpdatedChartedIds:function(e,t,i){var n=this.getChartedIds(t).slice();e=e instanceof Array?e:[e];for(var s=0;s<e.length;s++){var a=e[s],r=$.inArray(a,n);if(~r||i===!0)~r&&i!==!1&&(n[r]=null);else{var o=$.inArray(null,n);~o?n[o]=a:n.push(a)}}return n},getMapType:function(){return this.getQuery().maptype},__classvars__:{NAME:"ParameterProxy"}})}),define("js/model/DataProxy",["puremvc"],function(e){return e.Proxy.$extend({__init__:function(){this.$super(this.$class.NAME),this.cache={},this.cacheKeys=[]},setData:function(e,t){this.$super(t),this.addToCache(e,t)},setDataFromCache:function(e){this.data=this.getFromCache(e)},inCache:function(e){return e in this.cache},addToCache:function(e,t){this.inCache(e)?this.cache[e]=t:(this.cacheKeys.length>=this.$class.CACHE_LIMIT&&delete this.cache[this.cacheKeys.shift()],this.cacheKeys.push(e),this.cache[e]=t)},getFromCache:function(e){return this.cache[e]},__classvars__:{CACHE_LIMIT:5}})}),define("js/model/MapDataProxy",["js/Facade","js/model/DataProxy","js/model/ParameterProxy","js/model/ConfigProxy"],function(e,t,i,n){return t.$extend({__init__:function(){this.hasData=!1,this.$super(this.$class.NAME)},updateMapData:function(t){var s=this;if(t&&"undefined"!=typeof t){var a=t.SERIES_ID,r="",o=t.UNITS,l=t.PRECISION,c=this.facade.retrieveProxy(i.NAME),d=(this.facade.retrieveProxy(n.NAME),c.getFrequency()),h=a+"_"+d;a&&(h in this.cache?(this.data=this.cache[h],this.hasData=!0,this.sendNotification(e.MAP_DATA_UPDATED)):$.getJSON("data/index.php",{method:"getMapData",seriesId:a,freq:d},function(t){r=t.TITLE;for(var i in t.DATA)if(t.DATA.hasOwnProperty(i)){var n=t.DATA[i];for(var a in n)n.hasOwnProperty(a)&&isNaN(n[a])&&delete n[a]}s.data=s.cache[h]=$.extend(t,{TITLE:r,UNITS:o,PRECISION:l}),s.hasData=!0,s.sendNotification(e.MAP_DATA_UPDATED)}))}},__classvars__:{NAME:"MapDataProxy"}})}),define("js/model/TableDataProxy",["js/Facade","js/model/DataProxy","js/model/ParameterProxy","js/model/ConfigProxy","js/model/MapDataProxy"],function(e,t,n,s,a){return t.$extend({getItemMetadata:function(e){var t={cssClasses:""},i=this[e];return t.cssClasses+="level_"+i.LEVEL,i.HAS_DATA||(t.cssClasses+=" NO_DATA"),t},getDataColumns:function(){return this.getData().VIEWSDATA.DATACOLUMNS},getMinColumn:function(){return this.getDataColumns[0]},getMaxColumn:function(){return this.getDataColumns()[this.getDataColumns().length-1]},getViewData:function(){return this.getData().VIEWSDATA.ROWS},getSeriesData:function(){return this.getData().SERIESDATA.ROWS},getCombinedData:function(){var e=[],t=this.getSeriesData(),i=this.getTableTitle(),n=this.getViewData(),s={TITLE:i,CHART_NAME:"",DATA:{},DESCRIPTION:i,HAS_DATA:0,LEVEL:0,PRECISION:"",SERIES_ID:"",SUPER:"",UNITS:""};return 0==e.length&&(s.ACTION=this.$class.CLEAR),e=e.concat(t),e.push(s),e=e.concat(n)},getTableUnits:function(){return"Unknown Units"},getTableTitle:function(){var e=this.facade.retrieveProxy(n.NAME),t=this.facade.retrieveProxy(s.NAME);return t.getViewById(e.getSelectedView()).name},getChildRows:function(e){for(var t=[],i=this.getCombinedData(),n=e+1;n<i.length&&i[n].LEVEL>i[e].LEVEL;n++)i[n].HAS_DATA&&t.push(n);return t},getChildData:function(e){var t=this.getChildRows(e),n=this.getCombinedData(),s=[];for(i=0;i<t.length;i++)s.push(n[t[i]]);return s},removeRows:function(t){for(var i=this.getIDMap(),n=this.getSeriesData(),s=[],a=0;a<n.length;a++)if(t.indexOf(n[a].FORMULAID)>=0)for(var r=i[n[a].SERIES_ID],o=0;o<r.length;o++)s.push(r[o]);this.sendNotification(e.TABLE_NEEDS_TRIMMING,s),this.refreshTableData()},isFetching:!1,refreshTableData:function(){this.processChartData(),this.createIDMap(),this.isUpdating=!1,this.sendNotification(e.TABLEDATA_UPDATED)},loadTableData:function(){var t=this.facade.retrieveProxy(n.NAME),i=t.getTableParamsString(),a=(this.facade.retrieveProxy(s.NAME),this);this.isUpdating=!0,this.inCache(i)?(this.setDataFromCache(i),this.processChartData(),this.createIDMap(),this.isUpdating=!1,this.sendNotification(e.TABLEDATA_UPDATED)):this.isFetching||(this.isFetching=!0,a=this,$.ajax(encodeURI(this.$class.PROXY_URL+i+"&method="+this.$class.PROXY_METHOD),{dataType:"json",error:function(){a.sendNotification(e.ERROR)},success:function(t){a.isFetching=!1;var n=t.VIEWSDATA.ROWS.concat(t.SERIESDATA.DATA);$.each(n,function(){}),n=$.extend(n,{getRowMetadata:a.$class.getRowMetadata}),t.chartData={},a.setData(i,t),a.createIDMap(),a.processLevels(),a.processChartData("linechart"),a.processChartData("map"),a.isUpdating=!1,a.sendNotification(e.TABLEDATA_UPDATED)}}))},processLevels:function(){var e,t,i,n,s,a=this.getViewData(),r=[],o=[];for(e=a.length-1;e>=0;e--){for(s=a[e],s.levelGroups=[],n=s.LEVEL,t=r.slice(0).length-1;t>n;t--)r.pop();for(i=n;i>0;i--)void 0===r[i]?i==n&&(s.isLast=!0,s.levelGroups[i]=r[i]=void 0!==o[i]?++o[i]:o[i]=0):s.levelGroups[i]=r[i]}},processChartData:function(t,i){for(var a,r,o,l,c,d,h=this.facade.retrieveProxy(n.NAME),u=this.facade.retrieveProxy(s.NAME),p=[],m=[],f=this.getCombinedData(),g=this.getTableData(),v=this.getIDMap(),_=void 0!==t?[t]:$.map(u.getVisualizations(),function(e){return e.class}),o=0;o<_.length;o++){m=[],t=_[o];var C=h.getChartedIds(t),y=C.slice(),w=this.getChartData(t)||[];if(h.getChartType()==t){if(y.length>0)for(a=0;a<y.length;a++){var S,A=!1;if(S="map"==t?this.getMappedSeries(y[a],v):v[y[a]]){for(r=0;r<S.length;r++)if(l=f[S[r]],l.HAS_DATA&&(l[t]=!0,p.push(S[r]),!A)){A=!0,m.push(l);var b=$.inArray(l,w);b>=0&&w.splice(b,1)}}else null!=y[a]&&C.splice(a,1)}if(C.length<1&&"pin"!=t&&"sourcekey"!=t){if(!i||"map"==t){u.getViewById(h.getSelectedView()),h.getQuery();for(a=0,r=0;a<g.length&&r<1;r++){for(l=null,a;a<g.length&&(!l||!l.HAS_DATA);l=g[a++]);l[t]=!0,m.push(l),C.push(l.SERIES_ID),p=p.concat(v[l.SERIES_ID])}if("map"==t&&1==C.length){var S=this.getMappedSeries(C[0],v);$.each(S,function(e,i){var n=f[i];n[t]=!0})}}this.sendNotification(e.DEFAULT_CHART_SET,C,t)}for(a=0;a<w.length;a++)if(l=w[a],null!=l&&!~$.inArray(l.SERIES_ID,C)){var S=[];S="map"==t?this.getMappedSeries(l.SERIES_ID,v):v[l.SERIES_ID];for(var r=0;r<S.length;r++)l=f[S[r]],l.HAS_DATA&&("pin"==t&&l.PINNED||(l[t]=!1),p.push(S[r]))}for(a=0;a<f.length;a++)if(l=f[a],!l.HAS_DATA&&l.levelGroups){for(c=this.getChildData(a),d=c.length>0,r=0;r<c.length;r++)d&=c[r][t];l[t]!=d&&p.push(a),l[t]=d}var E=!1;$.each(m,function(e,t){E|=null!==t}),this.getData().chartData[t]=E?m:[]}else for(var x=0;x<f.length;x++)f[x][t]&&(f[x][t]=!1,$.inArray(x,p)==-1&&p.push(x))}return p},getMappedSeries:function(e,t){var i=[],n=e.split("_"),s=this;switch(n.length){case 1:$.each(t,function(e,t){s.getCombinedData()[t[0]].IS_MAPPABLE&&e.search(n[0].substring(0,n[0].length))!=-1&&1==e.split("_").length&&(i=i.concat(t))});break;case 2:$.each(t,function(e,t){s.getCombinedData()[t[0]].IS_MAPPABLE&&e.search(n[0])!=-1&&2==e.split("_").length&&(i=i.concat(t))});break;case 3:$.each(t,function(e,t){s.getCombinedData()[t[0]].IS_MAPPABLE&&e.search(n[0])!=-1&&3==e.split("_").length&&(i=i.concat(t))})}return i},createIDMap:function(){for(var e=this.getCombinedData(),t={},i=0;i<e.length;i++){var n=e[i].SERIES_ID;t[n]||(t[n]=[]),t[n].push(i)}return this.getData().IDMAP=t,t},getIDMap:function(){return this.getData().IDMAP||[]},getChartData:function(e){return void 0!==e?this.getData().chartData[e]:this.getData().chartData},getTableData:function(){return this.getData().VIEWSDATA.ROWS},updateChartData:function(){var t=this.facade.retrieveProxy(n.NAME),i=t.getChartType(),s=this.processChartData(void 0,!0);"pin"!=i?this.sendNotification(e.CHART_DATA_UPDATED,s):this.updatePinnedSeries()},__classvars__:{NAME:"TableDataProxy",PROXY_URL:"data/index.php",PROXY_METHOD:"getData"}})}),define("js/Controller",["puremvc","page","js/model/ConfigProxy","js/model/RequestProxy","js/model/ParameterProxy","js/model/TableDataProxy","json2"],function(e,t,i,n,s,a){var r=e.SimpleCommand.$extend({execute:function(e){var i=e.getBody(),s=this.facade.retrieveProxy(n.NAME);t.errorHandler(i?{route:s?s.getData():null,notification:e.getType(),error:i.name+" "+i.message,stack:i.stack}:void 0,"data/errorService.php?method=logError")}}),o=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(n.NAME);t.setData(e.getBody())}}),l=e.SimpleCommand.$extend({execute:function(){var e=this.facade.retrieveProxy(s.NAME);e.update()}}),c=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(s.NAME);t.resetCharted(e.getType()),t.updateCharted(t.getUpdatedCharted(e.getBody(),e.getType()),e.getType())}}),d=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(a.NAME);t.isUpdating||t.updateChartData()}}),h=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(a.NAME);t.removeRows(e.body)}}),u=e.SimpleCommand.$extend({execute:function(){t.showLoadMask()}}),p=e.SimpleCommand.$extend({execute:function(e){t.hideLoadMask()}}),m=e.SimpleCommand.$extend({execute:function(e){var i=this.facade.retrieveProxy(s.NAME),n=e.getBody(),a=e.getType();if(a){var r=i.getGAString(n);"undefined"!=typeof _gaq?_gaq.push(["_trackEvent","STEO",a,r]):"undefined"!=typeof console&&"function"==typeof console.log&&console.log("_trackEvent : STEO : "+a+" : "+r)}t.setHash(i.getGAString(n))}}),f=e.SimpleCommand.$extend({execute:function(e){var t,i,n=this.facade.retrieveProxy(a.NAME),r=this.facade.retrieveProxy(s.NAME),o=e.getType();if(o){var l=r.getGAString({});"undefined"!=typeof _gaq?_gaq.push(["_trackEvent","STEO",o,l]):"undefined"!=typeof console&&"function"==typeof console.log&&console.log("_trackEvent : STEO : "+o+" : "+l)}t=$('<input type="hidden" name="csvArr"/>').val(JSON.stringify(e.getBody())),i=$('<input type="hidden" name="fileName"/>').val(n.getTableTitle().replace(/,/g,"").replace(/\s+/g,"_")),jQuery('<form style="display:none;" action="'+this.$class.POST_URL+'" method="post"></form>').append(t).append(i).appendTo("body").submit().remove()},__classvars__:{POST_URL:"/global/scripts/jquery/highcharts/exporting-server/csv_exporter.cfm"}}),g=e.SimpleCommand.$extend({execute:function(e){window.open("/opendata/qb.cfm?sdid="+e.getBody())}}),v=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(s.NAME);t.resetCharted()}}),_=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(s.NAME);t.resetChartindexed()}}),C=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(s.NAME);this.facade.retrieveProxy(i.NAME);t.resetStartEnd(e.body.f)}}),y=e.SimpleCommand.$extend({execute:function(e){this.facade.retrieveProxy(s.NAME),e.getBody()}}),w=e.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(u),this.addSubCommand(S)}}),S=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(a.NAME);t.loadTableData()}}),A=e.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(y),this.addSubCommand(C),this.addSubCommand(m)}}),b=e.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(m)}});return{ErrorCommand:r,UpdateRequestProxyCommand:o,UpdateParameterProxyCommand:l,UpdateChartedCommand:c,UpdateChartDataCommand:d,ShowLoadMaskCommand:u,HideLoadMaskCommand:p,UpdateHashCommand:m,OpenAPIWindowCommand:g,ResetChartedCommand:v,ResetChartindexedCommand:_,ResetStartEndCommand:C,OutputToCSVCommand:f,UpdateParameterFrequencies:y,TableParamsUpdatedCommand:w,FrequencySelectionUpdatedCommand:A,TimeSelectionUpdatedCommand:b,RemoveRows:h}}),define("js/view/HelpTooltipsSTEO",[],function(){return function(){return[{selector:"#help_button",tip:'<iframe width="230" height="200" src="//www.youtube.com/embed/8jZlmpOMRtU" frameborder="0" allowfullscreen=""></iframe>Play the short video to learn how to use this tool.  Click anywhere else to close these help tips.',position:"topMiddle"},{selector:"#series_container",tip:"This is the supplemental top level selector for the <b><i>Short Term Energy Outlook Browser</i></b>.  Browse the many data series by category and select as many as you like to add to your selected dataset.  Alternatively, you can search the series for matching names by typing in the text field.",position:"bottomMiddle",yAdjust:-10},{selector:"#views_container",tip:"This is the top level selector for the <b><i>Short Term Energy Outlook Browser</i></b>.  Choose a highlighted table to automatically select a dataset. In addition, you can customize this dataset using the Customize Table builder selector.  It may be helpful to use the highlighted tables as a starting point and then modify them using the Customize Table builder.",position:"bottomMiddle",yAdjust:-15},{selector:".linechart:first",tip:'Click on the<span class="ico linechart selected"></span> icons to add or remove series from the table to the graph.',position:"rightMiddle",xAdjust:0,yAdjust:178},{selector:"#main_download_button",tip:'This menu provides options to download the table or graphic data in <span class="ico_csv">CSV</span> format, as well as an <span class="ico_img ico_pdf">image</span> or <span class="ico_pdf">PDF</span> of the graphic.',position:"bottomLeft",xAdjust:75},{selector:"#termsLink",tip:"Click this link to see any notes and definitions of terms.",position:"topMiddle"},{selector:"#time_selection_container",tip:"Use these slider controls to adjust the time span shown in the table below and the chart above. Use the Annual/Quarterly/Monthly buttons to adjust the granularity of the data.",position:"bottomRight",xAdjust:-555,yAdjust:-10},{selector:".chartIndexing:visible",tip:"These controls change the charting options. For time-series charts, you may index the chart to the first point by value or percent.",position:"topRight",yAdjust:5,xAdjust:-930},{selector:".slick-viewport.slick-viewport-top.slick-viewport-left:has(.description.aggregate)",tip:"Bolded rows, if any, reflect entries added using the Customize Table builder above. Non-bolded rows reflect the entries from the selected highlighted table. These two groups can be edited independent of one another.",position:"center",yAdjust:-100}]}}),define("js/model/HelpTooltipProxy",["puremvc","js/view/HelpTooltipsSTEO"],function(e,t){return e.Proxy.$extend({__init__:function(){this.$super(this.$class.NAME,t)},getHelpTooltips:function(){return this.getData()()},__classvars__:{NAME:"HelpTooltipProxy"}})}),define("js/view/DateCodeUtil",[],function(){return{months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],parseDateCode:function(e,t){e=e.toString();var i,n,s=e.substring(0,4);switch(t.toUpperCase()){case"A":n=0;break;case"Q":n=3*(e.substring(4)-1);break;case"M":n=e.substring(4)-1}return void 0!==n&&(i=new Date(s,n)),i},createDateCode:function(e,t){var i,n,s=e.getFullYear().toString();switch(t.toUpperCase()){case"A":n="";break;case"Q":n=Math.ceil((e.getMonth()+1)/3),n=n<10?"0"+n:n;break;case"M":n=e.getMonth()+1,n=n<10?"0"+n:n}return void 0!==n&&(i=s+""+n),i},formatDateCode:function(e,t){var i=e.toString().substring(0,4),n=e.toString().substring(4,6),s="";switch(t){case"A":s=i;break;case"Q":s="Q"+parseInt(n,10)+" "+i;break;case"M":s=this.months[parseInt(n,10)-1]+" "+i}return s},deincrementDateCode:function(e,t){return this.deincrementOrIncrementDateCode(e,t,!1)},incrementDateCode:function(e,t){return this.deincrementOrIncrementDateCode(e,t,!0)},deincrementOrIncrementDateCode:function(e,t,i){var n=this.parseDateCode(e,t);switch(t){case"A":n=new Date(n.getFullYear()+(i?1:-1),0);break;case"Q":n=new Date(n.getFullYear(),n.getMonth()+(i?3:-3));break;case"M":n=new Date(n.getFullYear(),n.getMonth()+(i?1:-1))}return this.createDateCode(n,t)},getNumberOfDataPoints:function(e,t,i){var n=0,s=this.parseDateCode(e,i),a=this.parseDateCode(t,i);switch(i){case"A":n=a.getFullYear()-s.getFullYear()+1;break;case"Q":n=4*(a.getFullYear()-s.getFullYear()+1)-s.getMonth()/3-(3-a.getMonth()/3);break;case"M":n=12*(a.getFullYear()-s.getFullYear()+1)-s.getMonth()-(11-a.getMonth())}return n}}}),define("js/view/GridFormatters",[],function(){var e={nestedPropertyResolver:function(e,t){for(var i=e.split("."),n=t,s=0;s<i.length&&(n=n[i[s]],n&&"undefined"!=typeof n);s++);return n},descriptionFormatter:function(e,t,i,n,s){var a=s.LEVEL,r=s.levelGroups,o='<span class="description_wrapper '+(r?"level_group_"+a+"_"+r[a]:"")+'">',l='<span class="description_text_wrapper '+(void 0===a?"bold":"")+'"';s.CHART_NAME&&(l+=' title="'+s.CHART_NAME),l+='">';var c,d,h="</span></span>",u="";for(c=a;c>0;c--)d='<span class="description_spacer',(r&&void 0!==r[c]||c==a)&&(d+=" spacer_group_"+c+"_"+r[c]),d+=c!=a?void 0!==r[c]?" pre":" blank":s.isLast?" last":" intermediate",d+='"></span>',u=d+u;var p="";return 1==s.HAS_DATA&&(p=" ("+s.UNITS+")"),o+u+l+(i+p)+h},numericalDataFormatter:function(t,i,n,s,a){if(0==a.HAS_DATA)return"";var r=isNaN(parseFloat(n))?n:Highcharts.numberFormat(n,void 0!==a.PRECISION?a.PRECISION:0,void 0,","),o=s.rseField?e.nestedPropertyResolver(s.rseField,a):void 0;return(void 0===r||""==r?"--":r)+(s.showRSE?" ("+(void 0!==o?o:"--")+")":"")},rseNumericalDataFormatter:function(e,t,i,n,s){},removeButtonFormatter:function(e,t,i,n,s){var a="ico",r="";return s.HAS_DATA&&"undefined"==typeof s.SUPER?(a+=" remove",r="Click to clear this series",'<span class="'+a+'" title="'+r+'"></span>'):s.HAS_DATA||0!=s.LEVEL?"":(a+=" remove",r="Click to clear this table",'<span class="'+a+'" title="'+r+'"></span>')},mapButtonFormatter:function(t,i,n,s,a){return a.IS_MAPPABLE?e.chartButtonFormatter(t,i,n,s,a):""},chartButtonFormatter:function(e,t,i,n,s){var a="ico",r="";return"map"===n.iconClass&&(s.SERIES_ID&&"PLANT"===s.SERIES_ID.split(".")[1]||!i||s.ACTION)?"":s.ACTION?(a+=" remove",r="Click to clear chart",'<span class="'+a+'" title="'+r+'"></span>'):(a+=" "+n.iconClass,"map"==n.iconClass?s[n.iconClass]?(a+=" selected",r="Click to remove the U.S. map above"):r="Click to view a U.S. map of this series":i?s[n.iconClass]?(a+=" selected",r="Click to remove this series from the chart"):r="Click to add this series to the chart":(a+=" parent",s[n.iconClass]?(a+=" selected",r="Click to remove all child series from the chart"):r="Click to add all child series to the chart"),i||s.LEVEL_GROUPS?'<span class="'+a+'" title="'+r+'"></span>':"")},pinSeriesFormatter:function(e,t,i,n,s){var a="ico",r="";return"sourcekey"!=n.iconClass||i&&!s.ACTION?s.ACTION&&"pin"==n.iconClass?(a+=" remove",r="Click to remove all pinned series",'<span class="'+a+'" title="'+r+'"></span>'):(a+=" "+n.iconClass,"sourcekey"==n.iconClass?r="Click to view series in API Browser":i?s[n.iconClass]?(a+=" selected",r="Click to unpin this series"):r="Click to pin this series for comparison across data sets":(a+=" parent",s[n.iconClass]?(a+=" selected",r="Click to unpin all child series"):r="Click to pin all child series for comparison across data sets"),i||s.LEVEL_GROUPS?'<span class="'+a+'" title="'+r+'"></span>':""):""},sourceKeyFormatter:function(e,t,i,n,s){return i||s.LEVEL_GROUPS?'<span class="ico '+n.iconClass+(i?"":" parent")+(s[n.iconClass]?" selected":"")+'"></span>':""}};return e}),define("text!templates/main.html",[],function(){return'<span id="selection_container" class="grey_side ltblue"></span>\r\n<div class="carousel blue_top" id="chart_area"></div>\r\n<hr />\r\n<div id="controls_container" class="grey_side ltblue">\r\n\t<div id="download_dialog_wrap">\r\n\t\t<div id="download_dialog_container">\r\n\t\t\t\t{{#overlayDownloadButtonOpts}}\r\n\t\t\t\t\t{{>download_button}}\r\n\t\t\t\t{{/overlayDownloadButtonOpts}}\r\n\t\t\t<div id="download_dialog"></div>\r\n\t\t</div>\r\n\t</div>\r\n\t{{#mainDownloadButtonOpts}}\r\n\t\t{{>download_button}}\r\n\t{{/mainDownloadButtonOpts}}\r\n\t<div id="help_button"\tclass="help_button">\r\n\t\t<span class="help_icon">&nbsp;</span><span class="help_button_text">Help</span>\r\n\t</div>\r\n\t<div id="frequency_container"></div>\r\n\t<div id="time_selection_container"></div>\r\n\t\r\n</div>\r\n<div class="clear"></div>\r\n<div id="tableContainer"></div>\r\n<div class="clear"></div>\r\n<div id="footnote_container"></div>'}),define("text!templates/download_button.html",[],function(){return'<div\r\n\t{{#id}}\r\n\t\tid="{{id}}"\r\n\t{{/id}}\r\n\tclass="download_button\r\n\t\t{{#selected}}\r\n\t\t\tselected\r\n\t\t{{/selected}}\r\n\t"\r\n>\r\n\t<span class="download_icon">&nbsp;</span><span class="download_button_text">Download</span>\r\n</div>'}),define("js/view/VC_PageLayout",["classy","text!templates/main.html","text!templates/download_button.html","mustache"],function(e,t,i){return e.$extend({container:null,__init__:function(e,n){this.container=$("#pagecontent"),this.container.empty().html(Mustache.render(t,n,{download_button:i}))},getSelectionContainer:function(){return $("#selection_container",this.container)},getSeriesSelectionContainer:function(){return $("#series_container",this.container)},getTimeSelectionContainer:function(){return $("#time_selection_container",this.container)},getChartContainer:function(){return $("#chart_area",this.container)},getTableContainer:function(){return $("#tableContainer",this.container)},getDownloadContainer:function(){return $("#download_dialog",this.container)}})}),define("text!templates/selection.html",[],function(){return'<div class="inner_container" id="views_container">\r\n    <h1>Standard Tables</h1>\r\n    <form id="choose_view" name="choose_view">\r\n        <select class="link_prompt" id="view_select" size="1" name="view_select">\r\n            <option value="">Choose a standard table</option>\r\n            {{#views}}\r\n            <option class="link_option" viewIndex="{{id}}" value="{{json}}">{{{name}}}</option>\r\n            {{/views}}\r\n        </select>\r\n    </form>\r\n</div>\r\n<div class="inner_container or">\r\n    <h1></h1>\r\n</div>\r\n<div class="inner_container" id="series_container">  \r\n</div>\r\n<div class="clear"></div>'}),define("js/view/VC_Selection",["classy","signals","text!templates/selection.html","json2"],function(e,t,i){return e.$extend({viewSelect:null,viewSelectionChanged:null,__init__:function(e){this.container=e,this.viewSelectionChanged=new t.Signal},create:function(e,t){function n(e){var t=$(e.data);return e.data!=e.target?t.data("open")?(t.css("width",t.data("originalWidth")),t.data("open",!1)):t.data("open",!0):setTimeout(function(){t.data("open")?(t.css("width",t.data("originalWidth")),t.data("open",!1)):t.data("open",!0)},100),"function"==typeof n&&$("body").unbind("mouseup",n),!0}var s=this;if(this.container.html(Mustache.render(i,{views:t})),this.viewSelect=$("#view_select",this.container).change(function(){var e=$(s.viewSelect.find(":selected")).attr("viewIndex");""!=e&&"undefined"!=typeof e&&s.viewSelectionChanged.dispatch(JSON.parse(e))}),null!=e&&$(this.viewSelect.find("option[viewIndex='"+e+"']")).prop("selected",!0),this.updateViewSelection(e),"Microsoft Internet Explorer"==navigator.appName){var a=navigator.userAgent,r=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=r.exec(a)&&(rv=parseFloat(RegExp.$1),rv<9&&this.container.find("select").each(function(){var e=$(this);e.css("min-width",e.width()),e.data("originalWidth",e.width())}).bind("mousedown",function(e){var t=$(this),i=$(this).clone();return i.css("width","auto"),t.parent().append(i.css("visible","false")),i.width()>t.width()&&t.css("width","auto"),i.remove(),t.css("position","relative"),$("body").bind("mouseup",this,n),!0}).bind("change blur",function(e){var t=$(this);return t.css("width",t.data("originalWidth")),t.data("open",!1),!0}))}},updateViewSelection:function(e){null!=e&&$(this.viewSelect.find("option[viewIndex='"+e+"']")).prop("selected",!0)}})}),define("text!templates/series_selection.html",[],function(){return'<h1>Customize Table</h1>\r\n<form id="choose_series" name="choose_series">\r\n    <!---label id="topic_select_label" for="topic_select">Change Data Set: </label-->\r\n    <div id="series_select" size="1" name="series_select" class="link_prompt">\r\n    \t<input id="series_search" type="text" onfocus="if(this.value == \'Browse series or type to search\') { this.value = \'\'; }"  value="Browse series or type to search">\t\r\n    \t</input>\r\n    \t<div id="series_tree" tabindex=\'1\'>\r\n            <UL class="seriesTree">\r\n    \t\t{{{seriesTreeFunction}}}\r\n            </UL>\r\n    \t</div>\r\n    </div>\r\n</form>'}),define("text!templates/selection_item.html",[],function(){return'{{{img}}}\r\n<input class="hidden" type="checkbox" id="{{id}}_CB" name="{{id}}_CB" value="{{seriesId}}" level="{{level}}" disabled="true">\r\n<img id="{{id}}" src="css/images/img_trans.gif" height="1" width="1" series="{{seriesId}}" name="{{id}}" level="{{level}}" class="checkBox unchecked {{seriesId}}" style="margin-left: {{margin}}px;">\r\n{{{name}}}'}),define("js/view/VC_SeriesSelection",["classy","signals","text!templates/series_selection.html","text!templates/selection_item.html","json2"],function(e,t,i,n){return e.$extend({seriesSelect:null,seriesSelectionChanged:null,__init__:function(e){this.container=e,this.seriesSelectionChanged=new t.Signal},create:function(e,t){var s=this,a=e;this.container.html(Mustache.render(i,{series:t,indent:function(){return 15*this.level+10},seriesTreeFunction:function(){for(var e="",t=this.series,i=0,s=0,a=0,r=0;r<t.length;r++){if(s=t[r].level,a=r<t.length-1?t[r+1].level:0,s<i)for(var o=0;o<i-s;o++)e+="</ul></li>";else s>i&&(e+='<ul class="menuHide">');a>s?img='<img src="css/images/img_trans.gif" id="Image_'+t[r].id+'" class="accordion closed">':img='<img src="css/images/img_trans.gif" id="Image_'+t[r].id+'" class="accordion spacer">';var l=t[r].level?t[r].level:0,c={id:t[r].id,seriesId:t[r].seriesId,name:t[r].name,level:l,img:img};e+='<li search="'+t[r].name+'" level="'+l+'">'+Mustache.to_html(n,c)+(a<=s?"</li>":""),i=s}return e}})),this.checkIntialBoxes(a),$("#series_search").on("keyup",function(e){var t=($(this),$(this).val().toLowerCase()),i=[];if(t.length<1)$("#series_tree").find("li").each(function(e,t){$(t).hasClass("hidden")&&$(t).removeClass("hidden"),$($(t).find("img.accordion")[0]).hasClass("open")&&($($(t).find("img.accordion")[0]).removeClass("open"),$($(t).find("img.accordion")[0]).addClass("closed"))}),$("#series_tree").find("ul").each(function(e,t){$(t).hasClass("menuHide")||$(t).hasClass("seriesTree")||$(t).addClass("menuHide")});else if(t.length>=3){$("#series_tree").find("li").each(function(e,n){$(n).hasClass("hidden")&&$(n).removeClass("hidden"),lival=$(n).attr("search"),lival.toLowerCase().indexOf(t)==-1?$(n).hasClass("hidden")||$(n).addClass("hidden"):i.push(n)});for(var n=i.length-1;n>=0;n--)s.updateRelativeLis(i[n])}}),$("#series_search").on("focus",function(){$("#series_tree").show()}),$("#series_search").on("blur",function(e){setTimeout(function(){$(":focus")[0]!=$("#series_tree")[0]&&($("#series_tree").hide(),""==$("#series_search").attr("value")&&$("#series_search").attr("value","Browse series or type to search"))},100)}),$("#series_tree").on("blur",function(e){setTimeout(function(){$(":focus")[0]!=$("#series_search")[0]&&($("#series_tree").hide(),""==$("#series_search").attr("value")&&$("#series_search").attr("value","Browse series or type to search"))},100),a=$.grep(a,function(e,t){if(""!=e)return t==$.inArray(e,a)}),s.seriesSelectionChanged.dispatch(a)}),$(".checkBox").on("click",function(e){var t=$(this),i="";t.hasClass("unchecked")?(t.removeClass("unchecked"),i="checked",t.addClass("checked"),a.push(t.attr("series"))):t.hasClass("intermediate")?(t.removeClass("intermediate"),i="checked",t.addClass("checked")):t.hasClass("checked")&&(t.removeClass("checked"),i="unchecked",t.addClass("unchecked"),a=$.grep(a,function(e){return e!=t.attr("series")}),$.each($("img[series='"+t.attr("series")+"']"),function(e,t){$(t).removeClass("checked"),$(t).addClass("unchecked"),a=s.updateRelativeCheckboxes($(t),i,a)})),a=s.updateRelativeCheckboxes(t,i,a),s.checkIntialBoxes(a)}),$(".accordion").on("click",function(e){var t=$(this);t.hasClass("closed")?(t.removeClass("closed"),t.parent().children("ul").removeClass("menuHide"),t.addClass("open")):t.hasClass("open")&&(t.removeClass("open"),t.parent().children("ul").addClass("menuHide"),t.addClass("closed"))})},checkIntialBoxes:function(e){var t;e=$.grep(e,function(t,i){return i==$.inArray(t,e)});for(var i=e.length-1;i>=0;i--)if(""!=e[i]){t=$("#series_tree").find("img.checkBox[series='"+e[i]+"']");for(var n=t.length-1;n>=0;n--)$(t[n]).removeClass("unchecked"),$(t[n]).removeClass("intermediate"),$(t[n]).addClass("checked"),this.updateParentCheckboxes($(t[n]),"checked");
}},updateRelativeCheckboxes:function(e,t,i){return i=this.updateChildCheckboxes(e,t,i),this.updateParentCheckboxes(e,t),i},updateRelativeLis:function(e){this.updateParentLis($(e)),this.updateChildLis($(e))},updateChildCheckboxes:function(e,t,i){for(var n=t,s=e.parent().find($("li")),a=s.find($("img.checkBox")),r=a.length-1;r>=0;r--)$(a[r]).hasClass("checked")&&(i=$.grep(i,function(e){return e!=$(a[r]).attr("series")})),$(a[r]).removeClass("checked"),$(a[r]).removeClass("unchecked"),$(a[r]).removeClass("intermediate"),$(a[r]).addClass(n),"checked"==n&&i.push($(a[r]).attr("series"));return i},updateChildLis:function(e){for(var t=e.find($("li")),i=t.length-1;i>=0;i--)$(t[i]).removeClass("hidden")},updateParentCheckboxes:function(e,t){if(e.attr("level")>0){var i=t,n=e.parent().parent().children($("li")),s=n.find($("img.checkBox")),a=$(e.parent().parent().parent().find("img.checkBox")[0]);if("checked"==i)for(var r=s.length-1;r>=0;r--)$(s[r]).hasClass("checked")||(i="intermediate",r=-1);else if("unchecked"==i)for(var r=s.length-1;r>=0;r--)$(s[r]).hasClass("unchecked")||(i="intermediate",r=-1);a.removeClass("unchecked"),a.removeClass("intermediate"),a.removeClass("checked"),a.addClass(i),this.updateParentCheckboxes(a,i)}},updateParentLis:function(e){var t=e.attr("level"),i=e.parent().parent();$(i).removeClass("hidden"),$(i.find("img.accordion")[0]).hasClass("closed")&&($(i.find("img.accordion")[0]).removeClass("closed"),$(i.find("img.accordion")[0]).addClass("open")),$(i.children("ul")).removeClass("menuHide"),t>0&&this.updateParentLis(i)}})}),define("text!/global/scripts/modules/src/timeSlider/time_slider.html",[],function(){return'<div id="timeSliderContainer">\r\n\t<div class="labelContainer"></div>\r\n\t<div class="timeSlider{{#selectDateRange}} range{{/selectDateRange}}"></div>\r\n</div>'}),define("dateCodeUtils",[],{months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],parseDateCode:function(e,t){e=e.toString();var i,n,s=e.substring(0,4);switch(t.toUpperCase()){case"A":n=0;break;case"Q":n=3*(e.substring(4)-1);break;case"M":n=e.substring(4)-1}return void 0!==n&&(i=new Date(s,n)),i},createDateCode:function(e,t){var i,n,s=e.getFullYear().toString();switch(t.toUpperCase()){case"A":n="";break;case"Q":n=Math.ceil((e.getMonth()+1)/3),n=n<10?"0"+n:n;break;case"M":n=e.getMonth()+1,n=n<10?"0"+n:n}return void 0!==n&&(i=s+""+n),i},formatDateCode:function(e,t){var i=e.toString().substring(0,4),n=e.toString().substring(4,6),s="";switch(t){case"A":s=i;break;case"Q":s="Q"+parseInt(n,10)+" "+i;break;case"M":s=this.months[parseInt(n,10)-1]+" "+i}return s},deincrementDateCode:function(e,t){return this.deincrementOrIncrementDateCode(e,t,!1)},incrementDateCode:function(e,t){return this.deincrementOrIncrementDateCode(e,t,!0)},deincrementOrIncrementDateCode:function(e,t,i){var n=this.parseDateCode(e,t);switch(t){case"A":n=new Date(n.getFullYear()+(i?1:-1),0);break;case"Q":n=new Date(n.getFullYear(),n.getMonth()+(i?3:-3));break;case"M":n=new Date(n.getFullYear(),n.getMonth()+(i?1:-1))}return this.createDateCode(n,t)}}),define("timeSlider",["signals","classy","text!/global/scripts/modules/src/timeSlider/time_slider.html","dateCodeUtils","mustache"],function(e,t,i,n){return t.$extend({sliderType:null,timeSelectionChanged:null,suppressSignals:!1,isCreated:!1,timeSlider:null,lowLabel:null,highLabel:null,lowHandle:null,highHandle:null,values:null,highVal:null,lowVal:null,freq:null,__init__:function(t){this.container=t,this.timeSelectionChanged=new e.Signal},create:function(e,t,n,s,a){this.freq=t.toUpperCase(),this.values=n,this.lowVal=s,this.highVal=a,this.container.html(Mustache.render(i,e)),this.timeSlider=$(".timeSlider",this.container),this.sliderType=this.timeSlider.hasClass("range")?this.$class.RANGE_SLIDER:this.$class.SINGLE_SLIDER,this.createSlider(),this.isCreated=!0,this.updateTimeSelection(t,n,s,a)},createSlider:function(){var e,t,i,n=this;switch(this.sliderType){case this.$class.RANGE_SLIDER:e=function(e,t){return!(t.values[0]>=t.values[1]||t.values[0]<0||t.values[0]>n.values.length||t.values[1]<0||t.values[1]>n.values.length)&&(n.lowVal=n.values[t.values[0]],n.highVal=n.values[t.values[1]],n.updateLabel(!0),n.updateLabel(!1),!0)},t=function(e,t){n.lowVal=t.values[0]<0||t.values[0]>n.values.length?n.values[0]:n.values[t.values[0]],n.highVal=t.values[1]<0||t.values[1]>n.values.length?n.values[n.values.length-1]:n.values[t.values[1]],n.updateLabel(!0),n.updateLabel(!1),n.suppressSignals||n.timeSelectionChanged.dispatch(n.lowVal,n.highVal)},i=!0;break;case this.$class.SINGLE_SLIDER:e=function(e,t){return n.lowVal=n.values[t.value],n.updateLabel(!0),!0},t=function(e,t){n.lowVal=n.values[t.value],n.updateLabel(!0),n.suppressSignals||n.timeSelectionChanged.dispatch(n.lowVal)},i=!1}this.timeSlider.slider({orientation:"horizontal",slide:e,change:t,range:i});var s=this.timeSlider.children(".ui-slider-handle");switch(this.lowHandle=s.eq(0),this.highHandle=s.eq(1),this.lowLabel=$('<div class="time_slider_tooltip"></div>').append("<span/>").css({position:"absolute"}),this.sliderType===this.$class.SINGLE_SLIDER?this.lowLabel.appendTo(this.lowHandle):(this.highLabel=$('<div class="time_slider_tooltip"></div>').append("<span/>"),this.lowLabel.appendTo(this.timeSlider),this.highLabel.appendTo(this.timeSlider),this.lowLabel.css({left:0}),this.highLabel.css({position:"absolute"})),this.updateLabel(!0),this.updateLabel(!1),this.sliderType){case this.$class.RANGE_SLIDER:this.lowHandle.add(this.highHandle).addClass("dual_slider_handle");break;case this.$class.SINGLE_SLIDER:this.lowHandle.addClass("single_slider_handle")}},updateTimeSelection:function(e,t,i,n){this.suppressSignals=!0,this.values=t,this.freq=e,this.lowVal=i,this.highVal=n,this.updateTimeSlider(),this.suppressSignals=!1},updateLabel:function(e){var t=e?this.lowLabel:this.highLabel;if(t&&t.length>0){var i=e?this.lowVal:this.highVal,n=e?this.lowHandle:this.highHandle,s=t.find("span");s.text(this.formatLabel(i)),this.sliderType===this.$class.SINGLE_SLIDER?t.css({left:-.5*s.width()+.5*n.width()}):e||t.css({left:this.timeSlider.width()-s.width()})}},updateTimeSlider:function(){switch(this.timeSlider.slider("option",{min:0,max:this.values.length-1}),this.sliderType){case this.$class.RANGE_SLIDER:this.timeSlider.slider("option",{values:[$.inArray(this.lowVal,this.values),$.inArray(this.highVal,this.values)]});break;case this.$class.SINGLE_SLIDER:this.timeSlider.slider("option",{value:$.inArray(this.lowVal,this.values)})}},formatLabel:function(e){return n.formatDateCode(e,this.freq)},__classvars__:{RANGE_SLIDER:"rangeSlider",SINGLE_SLIDER:"singleSlider"}})}),define("text!templates/time_selector.html",[],function(){return'<div id="frequencySelectorContainer">\r\n\t<div class="labelContainer"></div>\r\n\t<input type="radio" name="freqSelectorGroup" value="A" id="annual"/><label for="annual">Annual</label>\r\n\t<input type="radio" name="freqSelectorGroup" value="Q" id="quarterly"/><label for="quarterly">Quarterly</label>\r\n\t<input type="radio" name="freqSelectorGroup" value="M" id="monthly"/><label for="monthly">Monthly</label>\r\n</div>\r\n<div id="timeSliderContainer">\r\n\t<div class="labelContainer"></div>\r\n\t<div class="timeSlider range"></div>\r\n</div>'}),define("js/view/VC_TimeSelection",["timeSlider","signals","text!templates/time_selector.html"],function(e,t,i){return e.$extend({frequencySelectionChanged:null,freqSelectors:null,isCreated:!1,__init__:function(e){this.$super(e),this.frequencySelectionChanged=new t.Signal},create:function(e,t,n,s,a){var r=this;this.freq=t,this.values=n,this.lowVal=s,this.highVal=a,this.container.html(Mustache.render(i,e)),$("#frequencySelectorContainer",this.container).buttonset(),this.freqSelectors=$("input:radio[name=freqSelectorGroup]",this.container),this.freqSelectors.change(function(){r.suppressSignals||r.frequencySelectionChanged.dispatch(r.freqSelectors.filter(":checked").val())}),this.timeSlider=$(".timeSlider",this.container),this.sliderType=this.timeSlider.hasClass("range")?this.$class.RANGE_SLIDER:this.$class.SINGLE_SLIDER,this.createSlider(),this.isCreated=!0,this.updateTimeSelection(t,n,s,a)},updateTimeSelection:function(e,t,i,n){this.$super(e,t,i,n),this.suppressSignals=!0,this.updateFreqSelectors(),this.suppressSignals=!1},updateFreqSelectors:function(){this.freqSelectors.filter("[value="+this.freq+"]").prop("checked",!0),$("#frequencySelectorContainer",this.container).buttonset("refresh")}})}),define("text!templates/lineChart.html",[],function(){return'<div id="lineChartContainer"></div>\r\n<div class="chartIndexing">\r\n\t<form id="chartOptions">\r\n\t\t<div id="indexContainer">\r\n\t\t\t<span class="optionsLabel">Chart Indexing Options: </span>\r\n\t\t\t<input type="radio" id="index0" name="index" value="0" checked="checked"/><label for="index0">None</label>\r\n\t\t\t<input type="radio" id="index1" name="index" value="1"/><label for="index1">Index to Start as Percent</label> \r\n\t\t\t<input type="radio" id="index2" name="index" value="2"/><label for="index2">Index to Start as Value</label>\r\n\t\t</div>\r\n\t</form>\r\n</div>'}),define("js/view/VC_LineChart",["signals","classy","js/view/DateCodeUtil","text!templates/lineChart.html"],function(e,t,i,n){return t.$extend({container:null,chart:null,indexingChanged:null,indexing:null,data:null,dataMap:null,dataColumns:null,freq:null,units:null,axis:null,series:null,seriesMap:null,seriesColorQueue:null,seriesSymbolQueue:null,__init__:function(t){var i=this;this.indexing=null,this.data=[],this.dataMap={},this.dataColumns=[],this.freq="",this.units={},this.axis=[],this.series=[],this.seriesMap={},this.seriesColorQueue=this.$class.seriesColors.slice(0),this.container=t,this.indexingChanged=new e.Signal,this.container.html(Mustache.render(n)),$("#indexContainer",this.container).buttonset(),$('form input[name="index"]',this.container).on("change",function(e){i.indexingChanged.dispatch($(e.target).val())})},createSeriesOpts:function(e,t,i,n,s,a){var r={data:[],color:this.claimNextColor(),marker:{symbol:this.claimNextSymbol()},tooltip:{units:e.UNITS,precision:1==this.indexing?2:0==e.PRECISION?1:e.PRECISION},stickyTracking:!1,xType:function(){switch(i){case"A":return Highcharts.xTypes.annual;case"Q":return Highcharts.xTypes.quarterly;case"M":return Highcharts.xTypes.monthly}}()};r.name=(s?e.PINNED_NAME:e.CHART_NAME)+(n?" ("+e.UNITS+")":"");return this.indexSeries(e,t,i,r,a)},resetColorQueue:function(){this.seriesColorQueue=this.$class.seriesColors.slice(0)},claimNextColor:function(){return color=this.seriesColorQueue.shift(),this.seriesColorQueue.push(color),color},releaseColor:function(e){this.seriesColorQueue.splice($.inArray(e,this.seriesColorQueue),1),this.seriesColorQueue.unshift(e)},resetSymbolQueue:function(){this.seriesSymbolQueue=this.$class.seriesSymbols.slice(0)},claimNextSymbol:function(){return symbol=this.seriesSymbolQueue.shift(),this.seriesSymbolQueue.push(symbol),symbol},releaseSymbol:function(e){this.seriesSymbolQueue.splice($.inArray(e,this.seriesSymbolQueue),1),this.seriesSymbolQueue.unshift(e)},update:function(e,t,n,s,a,r,o,l,c){var d,h,u,p,m=this,f=[],g=[],v={};if(this.data=t,this.dataColumns=n,this.freq=s,this.indexing=a,this.seriesMap={},this.resetColorQueue(),this.resetSymbolQueue(),this.setIndexed(this.indexing),1!=this.indexing)for(d=0;d<this.data.length;d++)null!=t[d]&&(u=t[d],p=u.UNITS,p in v||(v[p]=g.length,g.push($.extend(!0,{title:{text:p},opposite:g.length%2},this.$class.defaultYAxisOptions))));else p="Percent",v[p]=0,g.push($.extend({title:{text:p}},this.$class.defaultYAxisOptions));for(d=0;d<this.data.length;d++)if(null!=t[d]){u=t[d];var _=null;("1"!==a&&"2"!==a||isNaN(u.DATA[r]))&&"0"!==a&&"undefined"!=typeof a||(_=this.createSeriesOpts(u,n,s,g.length>1,l,r),$.each(_,function(e,t){_[e]=$.extend(_[e],{yAxis:"1"===a?0:v[u.UNITS]}),f.push(_[e])}))}else this.claimNextColor(),this.claimNextSymbol();this.destroy(),h=$.extend(!0,{chart:{renderTo:$("#lineChartContainer",this.container).get(0),spacingBottom:0},title:{text:e},tooltip:{formatter:function(){var e,t=this.y+" "+this.series.tooltipOptions.units;switch(s){case"A":e="Year: "+Highcharts.dateFormat("%Y",new Date(this.x));break;case"M":e="Month: "+Highcharts.dateFormat("%b %Y",new Date(this.x));break;case"Q":e="Quarter: Q"+Math.ceil(Highcharts.dateFormat("%m",new Date(this.x))/3)+" "+Highcharts.dateFormat("%Y",new Date(this.x))}return!this.series.linkedSeries.length&&this.series.data.indexOf(this.point)>0&&(e+=" (Projected)"),"<b>"+this.point.series.name+"</b><br>"+e+"<br>"+t}},yAxis:g,xAxis:{min:i.parseDateCode(r,s).getTime(),max:i.parseDateCode(o,s).getTime()},series:f,userGenerated:c},this.$class.defaultChartOptions),$.extend(!0,h,{exporting:{embedOptions:{series_id:null,analysis:2==this.indexing?"indexval":1==this.indexing?"indexpct":"none",relation_mode:"line"}}});for(var C=[],d=0;d<t.length;d++)C.push("STEO."+t[d].SERIES_ID+"."+s);switch(C.length>0&&(h.exporting.embedOptions.series_id=C.join(";")),"A"==s&&(h.xAxis.tickInterval=31536e6),a){case"1":$.extend(!0,h,{subtitle:{text:"Indexed to "+i.formatDateCode(r,s)+" as percent"},yAxis:Highcharts.map(h.yAxis,function(e){return $.extend(!0,e,{min:null,title:{align:h.yAxis.length>2?"middle":"above"}})})});break;case"2":$.extend(!0,h,{subtitle:{text:"Indexed to "+i.formatDateCode(r,s)+" as value"},yAxis:Highcharts.map(h.yAxis,function(e){return $.extend(!0,e,{min:null,title:{align:h.yAxis.length>2?"middle":"above"}})})});break;default:$.extend(!0,h,{yAxis:Highcharts.map(h.yAxis,function(e){return $.extend(!0,e,{min:0,title:{align:h.yAxis.length>2?"middle":"above"}})})})}this.units=v,this.axis=g,this.chart=new this.$class.chartConstructor(h),this.series=this.chart.series.slice(0),$.each(this.series,function(e,t){m.seriesMap[t.name]=e})},setStartEnd:function(e,t,n){switch(this.chart.xAxis&&this.chart.xAxis.length>0&&this.chart.xAxis[0].setExtremes(i.parseDateCode(e,n).getTime(),i.parseDateCode(t,n).getTime()),this.indexing){case"1":this.chart.setTitle(null,{text:"Indexed to "+i.formatDateCode(e,n)+" as percent"});break;case"2":this.chart.setTitle(null,{text:"Indexed to "+i.formatDateCode(e,n)+" as value"})}for(var s=[],a=0;a<this.data.length;a++)null!=this.data[a]&&(s=s.concat(this.indexSeries(this.data[a],this.dataColumns,n,{data:[]},e)));for(var a=0;a<s.length;a++)this.chart.series[a].setData(s[a].data,!1);this.chart.redraw()},download:function(e){if(this.chart)if("csv"==e)this.chart.generateCSV();else{var t;switch(e){case"pdf":t={url:"/global/scripts/jquery/highcharts/exporting-server/index.cfm",type:"application/pdf"};break;case"png":default:t={url:"/global/scripts/jquery/highcharts/exporting-server/index.cfm"}}this.chart.exportChart(t)}},setIndexed:function(e){$('form input[name="index"]').filter("[value="+e+"]").prop("checked",!0),$("#indexContainer",this.container).buttonset("refresh")},removeSeries:function(e){this.highchartSeries[e.CHART_NAME].remove(),delete this.seriesOptions[e.CHART_NAME]},indexSeries:function(e,t,n,s,a){var r=null;switch(e.INDEXED={},this.indexing){case"1":$.each(e.DATA,function(t,i){t>=a&&""!=i&&null==r&&(r=i),null!=r?e.INDEXED[t]=i/r*100-100:e.INDEXED[t]=null});break;case"2":$.each(e.DATA,function(t,i){t>=a&&""!=i&&null==r&&(r=i),null!=r?e.INDEXED[t]=i-r:e.INDEXED[t]=null});break;default:e.INDEXED=e.DATA}var o,l,c=[];for(l=0;l<t.length;l++){var d=parseInt(t[l].toString());d<=e.LAST_HISTORICAL&&(0==c.length&&c.push($.extend(!0,{},s)),c[0].data.push([i.parseDateCode(d,n).getTime(),isNaN(o=parseFloat(e.INDEXED[d]))?null:o])),d>=e.LAST_HISTORICAL&&(0==c.length?c.push($.extend(!0,{},s)):1==c.length&&c.push($.extend(!0,{linkedTo:":previous",dashStyle:"Dash"},s)),c[c.length-1].data.push([i.parseDateCode(d,n).getTime(),isNaN(o=parseFloat(e.INDEXED[d]))?null:o]))}return c},embed:function(){this.chart.openAPIEmbed()},destroy:function(){null!=this.chart&&(1==this.chart.hasRendered&&this.chart.destroy(),$(".chartCaptionsContainer",this.container).remove(),this.chart=null)},__classvars__:{chartConstructor:Highcharts.Chart,seriesColors:Highcharts.getOptions().colors,seriesSymbols:Highcharts.getOptions().symbols,defaultYAxisOptions:{labels:{x:null,y:null}},defaultChartOptions:{chart:{zoomType:"",panning:!1,lineUpYAxisZeros:!0},xAxis:{maxZoom:1,type:"datetime",labels:{y:20},startOnTick:!1,showFirstLabel:!0},navigator:{enabled:!1},rangeSelector:{enabled:!1},scrollbar:{enabled:!1}}}})}),define("text!templates/downloadBox.html",[],function(){return'<div class="style2">\r\n\t\t<dl class="download_menu">\r\n\t\t\t{{#downloadItems}}\r\n\t\t\t<dt>{{#id}}<a id="{{id}}" class="download_option {{class}}">{{/id}}{{label}}{{#id}}</a>{{/id}}</dt>\r\n\t\t\t{{#children}}\r\n\t\t\t\t<dd><a id="{{id}}" class="download_option {{class}}">{{label}}</a></dd>\r\n\t\t\t{{/children}}\r\n\t\t\t{{/downloadItems}}\r\n\t\t\t<dt class="clear"/>\r\n\t\t</dl>\r\n</div>'}),define("js/view/VC_Download",["classy","text!templates/downloadBox.html","signals","mustache","simpleModal"],function(e,t,i){return e.$extend({__init__:function(e){var t=this;this.container=e,this.button=$("#main_download_button"),this.downloadButtonClicked=new i.Signal,this.downloadOptionClicked=new i.Signal,this.button.click(function(e){t.button.hasClass("disabled")||t.downloadButtonClicked.dispatch()}),this.container.delegate(".download_option","click",function(e){t.hideDownload(),t.downloadOptionClicked.dispatch(t.idMap[$(e.target).attr("id")])}),this.modalCloseHandler=function(e){0==$(e.target).parents("#download_dialog_container").length&&t.hideDownload()}},generateDownload:function(e,i){this.idMap=function(){for(var e={},t=0;t<i.length;t++){var n=i[t];if(n.id)e[n.id]=n;else if(i[t].children)for(var s=0;s<n.children.length;s++)e[n.children[s].id]=n.children[s]}return e}(),e.empty();var n=$(Mustache.to_html(t,{downloadItems:i}));e.append(n)},showDownload:function(e){var t=this,i=t.button.offset();this.generateDownload(this.container,e),$("#download_dialog_container").modal({autoPosition:!1,overlayClose:!0,fixed:!1,close:!1,persist:!0}),$("#simplemodal-container").css({top:i.top,left:i.left}),$("body").one("click",function(){$("body").bind("click",t.modalCloseHandler)}),this.container.css({left:this.button.outerWidth()-this.container.outerWidth()}),$(window).resize(this.resizeCallback=function(){var e=t.button.offset();$("#simplemodal-container").css({top:e.top,left:e.left})})},hideDownload:function(){$.modal.close(),"function"==typeof this.resizeCallback&&$(window).unbind("resize",this.resizeCallback),"function"==typeof this.modalCloseHandler&&$("body").unbind("click",this.modalCloseHandler),this.resizeCallback=null}})}),define("animatedComponent",["classy"],function(e){return e.$extend({__init__:function(){this.animation={enabled:!1,stepSize:1e3,iteration:0,interval:null}},update:function(e){$.extend(this.animation,e)},play:function(e,t){var i=this,n=function(){var t;i.animation.maxIteration&&(e?t=i.animation.iteration%i.animation.maxIteration:(t=Math.min(i.animation.iteration,i.animation.maxIteration),t==i.animation.maxIteration&&i.stop())),i.animation.callback&&i.animation.callback.call(i,t),(void 0===i.animation.maxIteration||t+1<=i.animation.maxIteration)&&(i.animation.iteration=t+1)};this.animation.interval&&this.stop(),n(),this.animation.interval=setInterval(n,t||this.animation.stepSize)},stop:function(){clearInterval(this.animation.interval),this.animation.interval=null},reset:function(e){this.animation.iteration=Math.min(e,this.animation.maxIteration),this.animation.callback&&this.animation.callback.call(this,e)},destroy:function(){this.stop()}})}),function(){function e(e){var t,i=e.currentTarget||e.srcElement;if("load"===e.type||a.test(i.readyState)){for(e=i.getAttribute("data-requiremodule"),o[e]=!0,e=0;(t=r[e])&&o[t.name];e++)t.req([t.name],t.onLoad);e>0&&r.splice(0,e),setTimeout(function(){i.parentNode.removeChild(i)},15)}}function t(e){var t,i;for(e.setAttribute("data-orderloaded","loaded"),e=0;(i=c[e])&&((t=l[i])&&"loaded"===t.getAttribute("data-orderloaded"));e++)delete l[i],require.addScriptToDom(t);e>0&&c.splice(0,e)}var i="undefined"!=typeof document&&"undefined"!=typeof window&&document.createElement("script"),n=i&&(i.async||window.opera&&"[object Opera]"===Object.prototype.toString.call(window.opera)||"MozAppearance"in document.documentElement.style),s=i&&"uninitialized"===i.readyState,a=/^(complete|loaded)$/,r=[],o={},l={},c=[],i=null;define("order",{version:"1.0.5",load:function(i,a,o,d){var h;a.nameToUrl?(h=a.nameToUrl(i,null),require.s.skipAsync[h]=!0,n||d.isBuild?a([i],o):s?(d=require.s.contexts._,!d.urlFetched[h]&&!d.loaded[i]&&(d.urlFetched[h]=!0,require.resourcesReady(!1),d.scriptCount+=1,h=require.attach(h,d,i,null,null,t),l[i]=h,c.push(i)),a([i],o)):a.specified(i)?a([i],o):(r.push({name:i,req:a,onLoad:o}),require.attach(h,null,i,e,"script/cache"))):a([i],o)}})}(),define("map",["animatedComponent","signals","order!jVectorMap","order!usa-en"],function(e,t,i){return e.$extend({__init__:function(e,i){this.$super(),this.container=e,this.regionClicked=new t.Signal,this.markerClicked=new t.Signal,this.mapContainer=$("#mapContainer",this.container),this.legendContainer=$("#map_legend",this.container),this.titleContainer=$("#mapTitle",this.container),0==this.titleContainer.length&&(this.titleContainer=$('<h2 id="mapTitle"></h2>').appendTo(this.container)),0==this.mapContainer.length&&(this.mapContainer=$('<div id="mapContainer"></div>').appendTo(this.container)),0==this.legendContainer.length&&(this.legendContainer=$('<div id="map_legend"></div>').appendTo(this.container)),this.counts=null,this.map=null,this.colors={},this.basemap=null==i?"usa_en":i,this.options={animation:{callback:function(e){this.colors?this.worldMap.series.regions[0].setValues(this.getCurrentColors()):this.worldMap.series.regions&&this.worldMap.series.regions.length>0?this.worldMap.series.regions[0].setValues(this.getCurrentCounts()):this.worldMap.series.markers&&this.worldMap.series.markers.length>0&&this.worldMap.series.markers[0].setValues(this.getCurrentCounts())}},map:this.basemap,normalizeFunction:"polynomial",hoverOpacity:.7,hoverColor:!1,backgroundColor:"white",dataPrecision:0}},play:function(e,t){this.$super(e,t)},update:function(e,t,i){var n=this;"undefined"!=typeof i&&"undefined"!=typeof i.map&&(this.basemap=i.map,this.options.map=i.map),this.counts=$.map(e instanceof Array?e:[e],function(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(jvm.WorldMap.maps[n.basemap].paths.hasOwnProperty(i.toUpperCase())?t[i.toUpperCase()]=e[i]:jvm.WorldMap.maps[n.basemap].paths.hasOwnProperty(i.toLowerCase())?t[i.toLowerCase()]=e[i]:t[i]=e[i]);return t}),this.options=$.extend(this.options||{},i),this.$super($.extend(!0,this.animation,this.options.animation,{maxIteration:e.length-1})),this.setTitle(t),this.calculateMinMax(),"function"==typeof this.assignColors&&this.assignColors(),this.createLegend(),this.setContainerHeight(),this.createMap()},setContainerHeight:function(){this.mapContainer.height(this.mapContainer.parent().height()-(this.titleContainer.outerHeight(!0)+this.legendContainer.outerHeight(!0)+parseInt(this.mapContainer.css("paddingTop"))+parseInt(this.mapContainer.css("paddingBottom"))+10))},calculateMinMax:function(){this.min=this.max=null;for(var e=0;e<this.counts.length;e++)for(var t in this.counts[e])this.counts[e].hasOwnProperty(t)&&(this.min=null==this.min||this.counts[e][t]<this.min?this.counts[e][t]:this.min,this.max=null==this.max||this.counts[e][t]>this.max?this.counts[e][t]:this.max);null!==this.min&&(this.min=parseFloat(Highcharts.numberFormat(this.min,this.options.dataPrecision,".",""))),null!==this.max&&(this.max=parseFloat(Highcharts.numberFormat(this.max,this.options.dataPrecision,".","")))},setTitle:function(e){this.titleContainer.text(e)},createRegionOps:function(){return[{values:this.colors?this.getCurrentColors():this.getCurrentCounts(),min:this.min,max:this.max,scale:this.colors?void 0:this.$class.palette}]},createMarkerOps:function(){return this.options.markers?[{values:this.colors?this.getCurrentColors():this.getCurrentCounts(),min:this.min,max:this.max,scale:this.colors?void 0:this.$class.palette}]:null},createMap:function(){var e=this;this.worldMap&&this.worldMap.remove(),this.regionOps=this.createRegionOps(),this.markerOps=this.createMarkerOps();var t={};this.regionOps&&(t.regions=this.regionOps),this.markerOps&&(t.markers=this.markerOps),this.mapContainer.empty(),this.map=$('<div style="height:100%;width:100%;" class="map_inside_container"></div>').appendTo(this.mapContainer).vectorMap($.extend(!0,{regionStyle:{initial:{fill:"#CCCCCC","fill-opacity":1,stroke:"none","stroke-width":0,"stroke-opacity":1},hover:{"fill-opacity":.8},selected:{fill:"yellow"}},series:t,onRegionClick:function(t,i){e.regionClicked.dispatch(i.toUpperCase(),t)},onMarkerClick:function(t,i){e.markerClicked.dispatch(e.options.markers[i],t)},zoomOnScroll:!1},this.options)),this.worldMap=this.mapContainer.find(".jvectormap-container").data("mapObject")},createLegend:function(e,t){},getCurrentColors:function(){var e={};return $.each(jvm.WorldMap.maps[this.basemap].paths,function(t,i){e[t]=""}),$.extend(e,this.colors[this.animation.iteration])},getCurrentCounts:function(){return this.counts[this.animation.iteration]},destroy:function(){this.worldMap&&this.worldMap.remove(),this.mapContainer.empty(),this.legendContainer.empty(),this.titleContainer.empty()},assignColors:function(e,t,i){},exportMap:function(e){if(!window.SVGAngle)throw"SVG not supported";var t="white",i=$(".jvectormap-container").html(),n=($(".jvectormap-container").html(),$(".jvectormap-container").find("svg").attr("height"));n=parseInt(n)+20;var s=i.indexOf("height");s=i.indexOf('"',s);var a=i.indexOf('"',s+1);i=i.slice(0,s+1)+n+i.slice(a),i=i.replace(/<div[^<]+<\/div>/gi,""),i=i.replace(/<svg /gi,'<svg xmlns="http://www.w3.org/2000/svg"  version="1.1" '),i=i.replace(/<g><\/g>/gi,""),i=i.replace(/<g/,'<rect x="0" y="0" width="100%" height="100%" fill="'+t+'"></rect><g'),i=i.replace(/zIndex="[^"]+"/g,"").replace(/isShadow="[^"]+"/g,"").replace(/symbolName="[^"]+"/g,"").replace(/jQuery[0-9]+="[^"]+"/g,"").replace(/isTracker="[^"]+"/g,"").replace(/url\([^#]+#/g,"url(#").replace(/&nbsp;/g," ").replace(/&shy;/g,"­").replace(/id=([^" >]+)/g,'id="$1"').replace(/class=([^" ]+)/g,'class="$1"').replace(/ transform /g," ").replace(/:(path|rect)/g,"$1").replace(/style="([^"]+)"/g,function(e){return e.toLowerCase()}),i=i.replace(/(url\(#highcharts-[0-9]+)&quot;/g,"$1").replace(/&quot;/g,"'"),i.match(/ xmlns="/g)&&2===i.match(/ xmlns="/g).length&&(i=i.replace(/xmlns="[^"]+"/,""));var r="/global/scripts/jquery/highcharts/exporting-server/index.cfm",o="";switch(e){case"svg":o="image/svg+xml";break;case"pdf":o="application/pdf";break;case"png":default:o="image/png"}String.prototype.replaceAll=function(e,t){return t?this.replace(new RegExp("["+e+"]","g"),t):this};var l=$('<form action="'+r+'" method="POST"><input type="hidden" name="svg" id="hiddensvg"><input type="hidden" name="type" value="'+o+'"><input type="hidden" name="filename" value="map_of_'+this.titleContainer.text().replaceAll(":",",").replaceAll(" ","_")+'"></form>');$("body").append(l),l.find("input[id=hiddensvg]").val(i),l.submit(),l.remove()},__classvars__:{palette:["#7ce3ff","#4cc9ff","#0196d8","#00628c","#00355b"]}})}),define("continuousMap",["signals","map","order!jVectorMap","order!usa-en"],function(e,t,i){return t.$extend({__init__:function(e,t){this.$super(e,t)},createLegend:function(e){var t,i,n=this;this.legendContainer.empty();var s=$('<span style="display: inline-block; text-align:center;"></span>').appendTo(this.legendContainer);this.options.legendTitle&&($('<span class="map_legend_title">'+this.options.legendTitle+"</span>").appendTo(s),$("<br />").appendTo(s)),n.options.legendItemFormatter?(t=n.options.legendItemFormatter.call(n,this.min),i=n.options.legendItemFormatter.call(n,this.max)):(t=this.min,i=this.max),n.$class.drawGradient(s,n.$class.palette[0],n.$class.palette[n.$class.palette.length-1],t,i),$("<br />").appendTo(s),$("<br />").appendTo(s);var a=$("<div/>").appendTo(s);$("<span/>").appendTo(a).attr("style","display:inline-block;margin-right:10px;width:20px;height:20px;background-color:#CCC"),$("<span>Value is not available</span>").appendTo(a).attr("style","margin-top:3px;display:inline-block;")},assignColors:function(){for(var e,t,i,n,s,a,r=[],o=this.max,l=this.min,c=parseInt(this.$class.palette[0].substring(1,3),16),d=parseInt(this.$class.palette[this.$class.palette.length-1].substring(1,3),16),h=parseInt(this.$class.palette[0].substring(3,5),16),u=parseInt(this.$class.palette[this.$class.palette.length-1].substring(3,5),16),p=parseInt(this.$class.palette[0].substring(5),16),m=parseInt(this.$class.palette[this.$class.palette.length-1].substring(5),16),f=0;f<this.counts.length;f++)for(e in this.counts[f]){switch(r[f]||(r[f]={}),t=parseFloat(Highcharts.numberFormat(this.counts[f][e],this.options.dataPrecision,".","")),i=(t-l)/(o-l),this.scaleType){case"logarithmic":i=(Math.log(t)-Math.log(l))/(Math.log(o)-Math.log(l))}n=parseInt(i*d-(i-1)*c,10).toString(16).replace(/^(\w{1})$/,"0$1"),s=parseInt(i*u-(i-1)*h,10).toString(16).replace(/^(\w{1})$/,"0$1"),a=parseInt(i*m-(i-1)*p,10).toString(16).replace(/^(\w{1})$/,"0$1"),r[f][e]="#"+n+s+a}this.colors=r},__classvars__:{drawGradient:function(e,t,i,n,s){var a="";a+="background-image: -ms-linear-gradient(left, "+t+" 0%, "+i+" 100%);",a+='-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr='+t+", endColorstr="+i+', gradientType=1)";',a+="filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="+t+", endColorstr="+i+", gradientType=1)",a+="background-image: -webkit-gradient(linear, left bottom, right bottom, from("+t+"), to("+i+"));",a+="background-image: -webkit-linear-gradient(left, "+t+", "+i+");",a+="background-image:    -moz-linear-gradient(left, "+t+", "+i+");",a+="background-image:      -o-linear-gradient(left, "+t+", "+i+";",a+="background-image:         linear-gradient(to left, "+t+","+i+");",$("<span>"+n+"</span>").appendTo(e),$('<span class="map_legend_gradient"></span>').appendTo(e).attr("style",a),$("<span>"+s+"</span>").appendTo(e)}}})}),define("growthMap",["map"],function(e){return e.$extend({__init__:function(e,t){this.$super(e,t)},update:function(e,t,i){e=$.map(e,function(t,i){var n={};for(var s in t)t.hasOwnProperty(s)&&i>0&&"undefined"!=typeof e[i-1]&&e[i-1].hasOwnProperty(s)&&t[s]*e[i-1][s]>0&&(n[s]=100*(t[s]-e[i-1][s])/e[i-1][s]);return n}),this.$super(e,t,$.extend({},i,{backgroundColor:"#ffffff"}))},createRegionOps:function(){return[{attributes:this.getCurrentColors()}]},createLegend:function(){var e,t,i=this;this.legendContainer.empty();var n=$('<span style="display: inline-block; text-align:center;"></span>').appendTo(this.legendContainer);this.options.legendTitle&&($('<span class="map_legend_title">'+this.options.legendTitle+"</span>").appendTo(n),$("<br />").appendTo(n)),i.options.legendItemFormatter?(e=i.options.legendItemFormatter.call(i,this.min),t=i.options.legendItemFormatter.call(i,this.max)):(e=this.min,t=this.max);var s="",a="";s+="background-image: -ms-linear-gradient(left, "+this.$class.palette[0]+" 0%, "+this.$class.palette[1]+" 100%);",s+='-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr='+this.$class.palette[0]+", endColorstr="+this.$class.palette[1]+', gradientType=1)";',s+="filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="+this.$class.palette[0]+", endColorstr="+this.$class.palette[1]+", gradientType=1)",s+="background-image: -webkit-gradient(linear, left bottom, right bottom, from("+this.$class.palette[0]+"), to("+this.$class.palette[1]+"));",s+="background-image: -webkit-linear-gradient(left, "+this.$class.palette[0]+", "+this.$class.palette[1]+");",s+="background-image:    -moz-linear-gradient(left, "+this.$class.palette[0]+", "+this.$class.palette[1]+");",s+="background-image:      -o-linear-gradient(left, "+this.$class.palette[0]+", "+this.$class.palette[1]+";",s+="background-image:         linear-gradient(to left, "+this.$class.palette[0]+","+this.$class.palette[1]+");",
a+="background-image: -ms-linear-gradient(left, "+this.$class.palette[3]+" 0%, "+this.$class.palette[4]+" 100%);",a+='-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr='+this.$class.palette[3]+", endColorstr="+this.$class.palette[4]+', gradientType=1)";',a+="filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="+this.$class.palette[3]+", endColorstr="+this.$class.palette[4]+", gradientType=1)",a+="background-image: -webkit-gradient(linear, left bottom, right bottom, from("+this.$class.palette[3]+"), to("+this.$class.palette[4]+"));",a+="background-image: -webkit-linear-gradient(left, "+this.$class.palette[3]+", "+this.$class.palette[4]+");",a+="background-image:    -moz-linear-gradient(left, "+this.$class.palette[3]+", "+this.$class.palette[4]+");",a+="background-image:      -o-linear-gradient(left, "+this.$class.palette[3]+", "+this.$class.palette[4]+";",a+="background-image:         linear-gradient(to left, "+this.$class.palette[3]+","+this.$class.palette[4]+");",$("<span>"+e+"</span>").appendTo(n);var r=$('<span class="map_legend_gradient"></span>').appendTo(n);$('<span class="growth_gradient_component"></span>').attr("style",s).appendTo(r),$('<span class="growth_gradient_component"></span>').attr("style",a).appendTo(r),$("<span>"+t+"</span>").appendTo(n),$("<br />").appendTo(n),$("<br />").appendTo(n);var o=$("<div/>").appendTo(n);$("<span></span").appendTo(o).attr("style","display:inline-block;margin-right:10px;width:20px;height:20px;background-color:#CCC"),$("<span>Value is not available</span>").appendTo(o).attr("style","margin-top:3px;display:inline-block;")},calculateMinMax:function(){void 0!==this.options.extremes?(this.min=this.options.extremes.min,this.max=this.options.extremes.max):(this.$super(),this.max>0&&this.min<0&&(Math.abs(this.min)>this.max?this.max=Math.abs(this.min):this.min=-1*this.max))},assignColors:function(){for(var e,t,i,n,s,a,r,o,l,c,d,h,u=[],p=this.max,m=this.min,f=0;f<this.counts.length;f++)for(r in this.counts[f])o=parseFloat(Highcharts.numberFormat(this.counts[f][r],this.options.dataPrecision,".","")),o<0?(l=(o-m)/(-1*m),e=parseInt(this.$class.palette[0].substring(1,3),16),t=parseInt(this.$class.palette[1].substring(1,3),16),i=parseInt(this.$class.palette[0].substring(3,5),16),n=parseInt(this.$class.palette[1].substring(3,5),16),s=parseInt(this.$class.palette[0].substring(5),16),a=parseInt(this.$class.palette[1].substring(5),16),c=(e<t?Math.max:Math.min).call(window,parseInt(l*t-(l-1)*e,10),e).toString(16).replace(/^(\w{1})$/,"0$1"),d=(i<n?Math.max:Math.min).call(window,parseInt(l*n-(l-1)*i,10),i).toString(16).replace(/^(\w{1})$/,"0$1"),h=(s<a?Math.max:Math.min).call(window,parseInt(l*a-(l-1)*s,10),s).toString(16).replace(/^(\w{1})$/,"0$1")):o>0?(l=o/p,e=parseInt(this.$class.palette[3].substring(1,3),16),t=parseInt(this.$class.palette[4].substring(1,3),16),i=parseInt(this.$class.palette[3].substring(3,5),16),n=parseInt(this.$class.palette[4].substring(3,5),16),s=parseInt(this.$class.palette[3].substring(5),16),a=parseInt(this.$class.palette[4].substring(5),16),c=(e>t?Math.max:Math.min).call(window,parseInt(l*t-(l-1)*e,10),t).toString(16).replace(/^(\w{1})$/,"0$1"),d=(i>n?Math.max:Math.min).call(window,parseInt(l*n-(l-1)*i,10),n).toString(16).replace(/^(\w{1})$/,"0$1"),h=(s>a?Math.max:Math.min).call(window,parseInt(l*a-(l-1)*s,10),a).toString(16).replace(/^(\w{1})$/,"0$1")):(c=this.$class.palette[2].substring(1,3),d=this.$class.palette[2].substring(3,5),h=this.$class.palette[2].substring(5)),u[f]||(u[f]={}),u[f][r]="#"+c+d+h;this.colors=u},__classvars__:{palette:["#6F2EA4","#C5ABDB","#CCCCCC","#BED5AD","#5D9732"]}})}),define("text!templates/animatedMap.html",[],function(){return'<h2 id="mapTitle"></h2>\r\n<div id="mapContainer"></div>\r\n<div id="map_controls_container">\r\n\t<h2>Map controls &amp; legend</h2>\r\n\t<div class="animated_map_button_container">\r\n\t\t<div id="animated_map_type_container">\r\n\t\t\t<span class="optionsLabel">Value options:</span>\r\n\t\t\t{{#mapTypes}}\r\n\t\t\t<input id="radio_{{id}}" type="radio" name="animated_map_type_radio" value="{{id}}" /><label for="radio_{{id}}">{{title}}</label>\r\n\t\t\t{{/mapTypes}}\r\n\t\t</div>\r\n\t\t<br/>\t\r\n\t\t<div id="animated_map_slider"></div>\r\n\t\t<br/>\r\n\t\t<div id="animated_map_transport_container">\r\n\t\t\t<input type="checkbox" id="play_button"></input><label for="play_button">Play</label>\r\n\t\t\t<input type="checkbox" id="pause_button"></input><label for="pause_button">Pause</label>\r\n\t\t\t<button id="reset_button">Reset</button>\r\n\t\t</div>\r\n\t\t<hr>\r\n\t\t<div id="map_units_label_container">\r\n\t\t\t<span id="map_units_label"></span>\r\n\t\t</div>\r\n\t\t<div id="map_legend"></div>\r\n\t</div>\r\n</div>\r\n'}),define("js/view/VC_AnimatedMap",["classy","continuousMap","growthMap","signals","js/view/DateCodeUtil","text!templates/animatedMap.html","mustache","us-census-merc-en"],function(e,t,i,n,s,a){return e.$extend({__init__:function(e){this.ContinuousMapClass=t=t.$extend({__classvars__:{palette:["#b0efff","#001F37"]}}),this.GrowthMapClass=i;var s=this;this.container=e,this.container.html(Mustache.render(a,{mapTypes:[{id:this.$class.CONTINUOUS_MAP,title:"Values"},{id:this.$class.GROWTH_MAP,title:"Growth"}]})),this.createPlayerControls(),this.mapTypeButtonset=$("#animated_map_type_container",this.container).buttonset(),this.mapTypeSelector=$("[name=animated_map_type_radio]",this.container),this.unitsLabel=$("#map_units_label",this.container),this.mapTypeChangeRequested=new n.Signal,this.mapTypeSelectorHandler=function(e){s.mapTypeChangeRequested.dispatch(s.mapTypeSelector.filter(":checked").val())}},embed:function(){var e=this.options.embedOptions,t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i+"="+e[i]);window.open("/opendata/embed.cfm?"+t.join("&"))},createPlayerControls:function(){var e=this;this.playButton=$("#play_button",this.container).button({icons:{primary:"map_play_icon"}}),this.pauseButton=$("#pause_button",this.container).button({icons:{primary:"map_pause_icon"}}),this.resetButton=$("#reset_button",this.container).button({icons:{primary:"map_reset_icon"}}),this.slider=$("#animated_map_slider",this.container).slider(),this.handle=$("#animated_map_slider",this.container).children(".ui-slider-handle"),this.sliderLabel=$('<div class="map_slider_tooltip" style="margin-top: -18px;"></div>').css({position:"absolute"}).appendTo(this.handle),this.playHandler=function(){e.map.stop(),e.position==e.displayColumns[e.displayColumns.length-1]&&e.map.reset(0),e.setButtonState(!0),e.map.play(!1,300)},this.pauseHandler=function(){e.map.stop(),e.setButtonState(!1)},this.resetHandler=function(){e.map.stop(),e.map.reset(e.displayColumns.length-1),e.position=e.displayColumns[e.displayColumns.length-1],e.map.setTitle(e.title+" "+e.displayColumns[e.displayColumns.length-1]),e.setButtonState(!1),$("#reset_button").removeClass("red")},this.sliderHandler=function(t,i){e.map.stop(),e.map.reset(i.value),e.position=e.displayColumns[i.value],e.setButtonState(!1)},$('label[for="'+this.pauseButton.attr("id")+'"]').hide()},destroy:function(){this.map&&this.map.destroy()},update:function(e,t,i,n,a,r,o){var l=this,c=0;switch(this.displayColumns=[],this.counts=[],this.basemap="undefined"==typeof o?"us_census_merc_en":o,this.title=e.TITLE,this.data=e,this.mapType=t,this.start=i,this.end=n,this.options=r,this.map&&(this.map.stop(),this.map.destroy()),this.setButtonState(!1),t){case this.$class.GROWTH_MAP:this.map=new this.GrowthMapClass(this.container,this.basemap),this.units="Percent change from prior",this.precision=2;break;default:this.map=new this.ContinuousMapClass(this.container,this.basemap),this.units=e.UNITS||"",this.precision=e.PRECISION}this.unitsLabel.text(this.units),this.mapTypeSelector.filter("[value="+t+"]").attr("checked","true"),this.mapTypeButtonset.buttonset("refresh"),$.each(e.DATACOLUMNS,function(t,s){s>=i&&s<=n&&(l.displayColumns.push(s),l.counts.push(e.DATA[s]))}),void 0!==this.position?(c=$.inArray(this.position,this.displayColumns),~c||(c=this.displayColumns.length-1)):c=this.displayColumns.length-1,this.map.animation.enabled=!0,this.map.update(this.counts,this.title+" "+this.displayColumns[c],$.extend({animation:{enabled:!0,callback:function(e){this.colors?this.worldMap.series.regions[0].setValues(this.getCurrentColors()):this.worldMap.series.regions&&this.worldMap.series.regions.length>0&&this.worldMap.series.regions[0].setValues(this.getCurrentCounts());var t={},i=l.displayColumns[e];l.position=i;var n="undefined"==typeof i||null==i?"":s.formatDateCode(i,a);l.map.setTitle(l.title+" "+n),l.sliderLabel.text(n),t.left=-.5*l.sliderLabel.width()+.5*l.handle.width(),l.sliderLabel.height()>1.5*parseInt(l.sliderLabel.css("font-size").slice(0,-2),10)?t.top=-.5*l.sliderLabel.height():t.top=0,l.sliderLabel.css(t),l.slider.slider("option","value",e),e==l.displayColumns.length-1&&l.setButtonState(!1)},iteration:c},continuous:!0,isGrowth:!0,dataPrecision:2,extremes:{min:-100,max:100},legendItemFormatter:function(e){var i;return t==l.$class.GROWTH_MAP?(i=Highcharts.numberFormat(e,l.precision)+"%",e>0&&(i+="+")):i=Highcharts.numberFormat(e,l.precision),i},zoomOnScroll:!0,onRegionLabelShow:function(e,t,i){if(i){var n=l.map.getCurrentCounts()[i];void 0!==n&&$(t).html($(t).html()+" "+Highcharts.numberFormat(n,l.precision)+" "+(l.mapType==l.$class.GROWTH_MAP?"% change from "+s.formatDateCode(s.deincrementDateCode(l.position,a),a)+" to "+s.formatDateCode(l.position,a):l.units))}else t.empty()}},r)),this.map.reset(c),this.slider.slider("option","min",0),this.slider.slider("option","max",this.displayColumns.length-1),this.slider.slider("option","value",c),"function"==typeof this.sliderHandler&&this.slider.unbind("slide",this.sliderHandler),this.slider.bind("slide",this.sliderHandler),"function"==typeof this.playHandler&&this.playButton.unbind("click",this.playHandler),this.playButton.bind("click",this.playHandler),"function"==typeof this.pauseHandler&&this.pauseButton.unbind("click",this.pauseHandler),this.pauseButton.bind("click",this.pauseHandler),"function"==typeof this.resetHandler&&this.resetButton.unbind("click",this.resetHandler),this.resetButton.bind("click",this.resetHandler),"function"==typeof this.mapTypeSelectorHandler&&this.mapTypeSelector.unbind("change",this.mapTypeSelectorHandler),this.mapTypeSelector.bind("change",this.mapTypeSelectorHandler)},setButtonState:function(e){e&&(this.playButton.attr("checked",!1),$('label[for="'+this.playButton.attr("id")+'"]').hide(),$('label[for="'+this.pauseButton.attr("id")+'"]').show()),e||(this.pauseButton.attr("checked",!1),$('label[for="'+this.pauseButton.attr("id")+'"]').hide(),$('label[for="'+this.playButton.attr("id")+'"]').show()),this.playButton.button("refresh"),this.pauseButton.button("refresh")},outputToArrOfArrs:function(){var e,t,i,n,s=[],a=[],r=this.map.worldMap.regions;for(e in r)r.hasOwnProperty(e)&&a.push(e);a.sort(),s.push(["Units: "+(this.mapType==this.$class.GROWTH_MAP?"percent change from previous period":this.data.UNITS)]);var o=this.displayColumns.slice();for(o.unshift(""),s.push(o),i=0;i<a.length;i++)for(e=a[i],s.push(n=['"'+e+'"']),t=0;t<this.counts.length;t++)n.push(this.map.counts[t][e]||"");return s},__classvars__:{CONTINUOUS_MAP:"0",GROWTH_MAP:"1"}})}),define("js/view/MediatorSelection",["puremvc","js/Facade","js/model/ParameterProxy","js/model/ConfigProxy"],function(e,t,i,n){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this,s=this.facade.retrieveProxy(i.NAME),a=this.facade.retrieveProxy(n.NAME);this.getViewComponent().create(s.getSelectedView(),a.getViews()),this.getViewComponent().viewSelectionChanged.add(function(i){e.sendNotification(t.VIEW_SELECTION_CHANGED,{v:i},"ViewChanged")})},listNotificationInterests:function(){return this.$super().concat([t.VIEW_PARAM_UPDATED])},handleNotification:function(e){var n=this.facade.retrieveProxy(i.NAME);switch(e.getName()){case t.VIEW_PARAM_UPDATED:this.getViewComponent().updateViewSelection(n.getSelectedView());break;default:this.$super(e)}},__classvars__:{NAME:"SelectionMediator"}})}),define("js/view/MediatorSeriesSelection",["puremvc","js/Facade","js/model/ParameterProxy","js/model/ConfigProxy"],function(e,t,i,n){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){for(var e=this,s=this.facade.retrieveProxy(i.NAME),a=this.facade.retrieveProxy(n.NAME),r=s.maskToBits(s.getSelectedSeries()),o=a.getSeries(),l=[],c=0;c<o.length;c++)1==r[o[c].formulaId]&&l.push(o[c].seriesId);this.getViewComponent().create(l,a.getSeries()),this.getViewComponent().seriesSelectionChanged.add(function(i){"linechart"==s.getChartType()?e.sendNotification(t.SERIES_SELECTION_CHANGED,{s:s.convertToBitmap(i.join("~")),linechart:s.getStillChartedSeries(i)},"SeriesChanged"):e.sendNotification(t.SERIES_SELECTION_CHANGED,{s:s.convertToBitmap(i.join("~"))},"SeriesChanged")})},listNotificationInterests:function(){return this.$super().concat([t.SERIES_PARAM_UPDATED])},handleNotification:function(e){var s=this.facade.retrieveProxy(i.NAME),a=this.facade.retrieveProxy(n.NAME);switch(e.getName()){case t.SERIES_PARAM_UPDATED:for(var r=s.maskToBits(s.getSelectedSeries()),o=a.getSeries(),l=[],c=0;c<o.length;c++)1==r[o[c].formulaId]&&l.push(o[c].seriesId);this.getViewComponent().create(l,a.getSeries());break;default:this.$super(e)}},__classvars__:{NAME:"SeriesSelectionMediator"}})}),define("js/view/MediatorTimeSelection",["puremvc","js/Facade","js/model/TableDataProxy","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,i,n,s){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().timeSelectionChanged.add(function(i,n){e.sendNotification(t.TIME_SELECTION_UPDATED,{start:i,end:n})}),this.getViewComponent().frequencySelectionChanged.add(function(i){e.sendNotification(t.FREQUENCY_SELECTION_UPDATED,{f:i},"FrequencyChanged")})},listNotificationInterests:function(){return this.$super().concat([t.TIME_PERIOD_PARAM_UPDATED,t.FREQUENCY_PARAM_UPDATED])},handleNotification:function(e){var a,r=this.facade.retrieveProxy(s.NAME),o=(this.facade.retrieveProxy(i.NAME),this.facade.retrieveProxy(n.NAME)),l=r.getTimeParams();switch(e.getName()){case t.FREQUENCY_PARAM_UPDATED:case t.TIME_PERIOD_PARAM_UPDATED:a=o.getDataColumns(l.f),this.getViewComponent().isCreated?this.getViewComponent().updateTimeSelection(l.f,a,l.start,l.end):this.getViewComponent().create({},l.f,a,l.start,l.end);break;default:this.$super(e)}},__classvars__:{NAME:"TimeSelectionMediator"}})}),!function(e){e("datagrid",["signals","classy","order!dragevent","order!mousewheel","order!slickcore","order!slickgrid","order!slickdataview"],function(e,t){return t.$extend({__init__:function(t){var i=this;this.isFiltered=!1,this.slickgrid=null,this.container=t.empty(),this.innerGridContainer=$(this.$class.innerSlickGridHTML).appendTo(this.container),this.vSlider=null,this.hSliderTop=null,this.hSliderBottom=null,this.filteredColumns=[],this.columns=[],this.data=[],this.options={},this.onClick=new e.Signal,this.onColumnOrderChanged=new e.Signal,this.onHeaderClick=new e.Signal,this.onHeaderCellRendered=new e.Signal,this.onViewRowCountChanged=function(e,t){i.slickgrid.updateRowCount(),i.slickgrid.render()},this.onViewRowsChanged=function(e,t){i.slickgrid.invalidateRows(t.rows),i.slickgrid.render()}},update:function(e,t,i,n,s){var a,r=this,o=void 0!==n&&void 0!==s;t="undefined"==typeof t?this.columns:t,i="undefined"==typeof i?this.options:i,this.slickgrid?(this.setData(e),this.setColumns(t,!0),this.setOptions(i),o?this.filterNumericColumns(n,s):this.slickgrid.setColumns(t),this.resetHSliders(),this.checkScroll()):(this.setData(e),this.setColumns(t),this.setOptions(i),a=o?this.filterNumericColumns(n,s):this.filterHiddenColumns(this.options.addSpacerColumn?this.columns.concat([this.$class.spacerColumnOps]):this.columns),this.slickgrid=new Slick.Grid(this.innerGridContainer,this.data,a,this.options),this.slickgrid.onClick.subscribe(function(e,t){r.onClick.dispatch(t.row,t.cell,r.slickgrid.getDataItem(t.row),e)}),this.slickgrid.onSort.subscribe(function(e,t){r.data.sort(function(e,i){var n=t.sortCol.field,s=t.sortAsc?1:-1,a=e[n],r=i[n],o=(a==r?0:a>r?1:-1)*s;return o="undefined"==typeof a||"string"==typeof a&&""==a?1:"undefined"==typeof r||"string"==typeof r&&""==r?-1:o,0!=o?o:0}),r.slickgrid.invalidate(),r.slickgrid.render()}),this.slickgrid.onColumnsReordered.subscribe(function(e,t){r.resetHSliders(),r.checkScroll(),r.onColumnOrderChanged.dispatch(e,t)}),this.slickgrid.onColumnsResized.subscribe(function(e,t){r.resetHSliders(),r.checkScroll()}),this.slickgrid.onHeaderClick.subscribe(function(e,t){r.onHeaderClick.dispatch(e,t)}),this.slickgrid.onHeaderCellRendered.subscribe(function(e,t){r.onHeaderCellRendered.dispatch(e,t)}),this.checkScroll(),this.options.scrollToRight&&this.scrollToRight())},outputToArrOfArrs:function(e){e=void 0===e||e;var t,i,n,s,a,r,o,l,c,d=e&&this.isFiltered?this.filteredColumns:this.columns,h=[];for(h.push(s=[]),t=0;t<d.length;t++)a=d[t],r=void 0===a.output||a.output,r&&s.push('"'+("undefined"!=typeof a.name?a.name:a.id)+'"');for(t=0;t<(this.data.getLength?this.data.getLength():this.data.length);t++)for(n=this.data.getItem?this.data.getItem(t):this.data[t],h.push(s=[]),i=0;i<d.length;i++)a=d[i],r=void 0===a.output||a.output,r&&(o=[t,i,a&&"function"==typeof this.options.dataItemColumnValueExtractor?this.options.dataItemColumnValueExtractor(n,a):n[a.field],a,n],l=a.outputFormatter?a.outputFormatter.apply(this,o):a.dataFormatter?a.dataFormatter.apply(this,o):o[2]||"",void 0!==l&&(c=l.toString().replace(/,/g,"")),s.push(isNaN(c)?'"'+(l?l:"")+'"':c));return h},processColumns:function(e){var t,i;for(t=0;t<e.length;t++)i=e[t],i.formatter=this.$class.defaultFormatter;return e},filterHiddenColumns:function(e){return $.map(e,function(e){return e.display===!1?null:e})},checkScroll:function(){var e,t,i,n,s=this,a=$(".slick-viewport",this.container),r=$(".slick-pane",this.container);this.options.frozenColumn>=0?(t=a.filter(".slick-viewport-top.slick-viewport-right"),e=r.filter(".slick-pane-top.slick-pane-right")):(t=a.filter(".slick-viewport-top.slick-viewport-left"),e=r.filter(".slick-pane-top.slick-pane-left")),(i=function(){this.vSlider?this.vSlider.css("height",t.height()-30):(this.vSlider=$("<div/>").appendTo(this.container).css({position:"relative",float:"left",height:t.height()-30,marginTop:20,marginBottom:10,marginLeft:10}).slider({orientation:"vertical",min:0,max:100,value:100,slide:function(e,i){(function(){this.scrollTop=(this.scrollHeight-this.offsetHeight)*((100-i.value)/100)}).call(t.get(0))}}),t.scroll(function(){s.vSlider.slider("value",100-100*this.scrollTop/(this.scrollHeight-this.offsetHeight))}),this.innerGridContainer.width(this.container.width()-this.vSlider.width()-20).css("float","left"),this.slickgrid.resizeCanvas()),t.get(0).scrollHeight>t.height()?this.vSlider.slider("option","disabled",!1):this.vSlider.slider("option","disabled",!0)}).call(this),(n=function(){var n,s,a,o=this;this.hSliderTop||this.hSliderBottom?(this.hSliderTop.css("width",t.width()-28),this.hSliderBottom.css("width",t.width()-28)):(n=r.find(".slick-header").eq(0),a=n.position(),s=e.position(),this.hSliderTop=$("<div/>").appendTo(this.container).css({position:"absolute",top:a.top+n.height()-13,left:s.left,width:t.width()-28,marginRight:30}).slider({min:0,max:100,value:0,slide:function(e,i){(function(){this.scrollLeft=(this.scrollWidth-this.offsetWidth)*(i.value/100),o.hSliderBottom.slider("value",i.value)}).call(t.get(0))}}).addClass("hSliderTop"),this.hSliderBottom=$("<div/>").appendTo(this.container).css({position:"absolute",bottom:0,left:s.left,width:t.width()-28,marginRight:30}).slider({min:0,max:100,value:0,slide:function(e,i){(function(){this.scrollLeft=(this.scrollWidth-this.offsetWidth)*(i.value/100),o.hSliderTop.slider("value",i.value)}).call(t.get(0))}}).addClass("hSliderBottom"),t.scroll(function(){o.hSliderTop.slider("value",100*this.scrollLeft/(this.scrollWidth-this.offsetWidth)),o.hSliderBottom.slider("value",100*this.scrollLeft/(this.scrollWidth-this.offsetWidth))}),this.innerGridContainer.height(this.container.height()-this.hSliderBottom.height()-20),i.call(this)),t.get(0).scrollWidth>t.width()?(this.hSliderBottom.slider("option","disabled",!1),this.hSliderTop.slider("option","disabled",!1),t.scroll()):(t.scroll(),this.hSliderBottom.slider("option","disabled",!0),this.hSliderTop.slider("option","disabled",!0),this.slickgrid.autosizeColumns())}).call(this)},scrollToRight:function(){var e,t=$(".slick-viewport",this.container);e=this.options.frozenColumn>=0?t.filter(".slick-viewport-top.slick-viewport-right"):t.filter(".slick-viewport-top.slick-viewport-left"),e.get(0).scrollLeft=e.get(0).scrollWidth},filterNumericColumns:function(e,t){var i,n;for(this.filteredColumns=[],i=0;i<this.columns.length;i++)n=this.columns[i],isNaN(n.id)?this.filteredColumns.push(n):n.id>=e&&n.id<=t&&this.filteredColumns.push(n);var s=this.filterHiddenColumns(this.options.addSpacerColumn?this.filteredColumns.concat([this.$class.spacerColumnOps]):this.filteredColumns);return this.slickgrid&&(this.slickgrid.setColumns(s),this.isFiltered=!0,this.resetHSliders(),this.checkScroll(),this.options.scrollToRight&&this.scrollToRight()),s},setColumns:function(e,t){this.columns=this.processColumns(e),this.isFiltered=!1,this.slickgrid&&!t&&(this.slickgrid.setColumns(this.filterHiddenColumns(this.options.addSpacerColumn?this.columns.concat([this.$class.spacerColumnOps]):this.columns)),this.resetHSliders(),this.checkScroll(),this.options.scrollToRight&&this.scrollToRight())},setData:function(e){this.data=e,this.slickgrid&&(this.slickgrid.setData(e),this.resetHSliders(),this.checkScroll())},setOptions:function(e){this.options=$.extend(!0,{},this.$class.defaultOptions,e),this.slickgrid&&this.slickgrid.setOptions(this.options)},redraw:function(e){e?this.slickgrid.invalidateRows(e):this.slickgrid.invalidateAllRows(),this.slickgrid.render()},resetHSliders:function(){this.hSliderBottom.remove(),this.hSliderTop.remove(),this.hSliderBottom=this.hSliderTop=null},destroy:function(){this.slickgrid&&this.slickgrid.destroy()},__classvars__:{defaultOptions:{enableCellNavigation:!1,enableColumnReorder:!1},spacerColumnOps:{id:"spacer",name:" ",autoWidth:!0},innerSlickGridHTML:'<div class="inner-slickgrid-container"></div>',defaultFormatter:function(e,t,i,n,s){var a=n.dataFormatter?n.dataFormatter.apply(this,arguments):i,r=n.displayFormatter?n.displayFormatter.call(this,e,t,a,n,s):a;return r},autosizeColumn:function(e,t,i,n){var s,a,r,o,l=$("<div/>").addClass("slick-cell").addClass("ui-widget").css({width:"auto",position:"absolute",top:1e3,left:0}).appendTo("body"),c=e[t],d=0;for(s=0;s<(i.getLength?i.getLength():i.length);s++)a=i.getItem?i.getItem(s):i[s],r=a[c.field],l.html(c.formatter?c.formatter(s,t,r,c,a):c.displayFormatter?c.displayFormatter(s,t,r,c,a):c.dataFormatter?c.dataFormatter(s,t,r,c,a):r),d=Math.max(d,l.outerWidth());o=d+(void 0!=n?n:0),l.remove(),c.width=void 0!==c.maxWidth?Math.min(o,c.maxWidth):o},linkSelectorFunction:function(e,t,i){var n,s,a,r={},o=$(e),l=o.offset(),c=$(),d=0;return r[e]||(r[e]=$(".slick-row",o).get(),r[e].sort(function(e,t){var i=$(e).offset().top,n=$(t).offset().top;return i<n?-1:i>n?1:0})),$.each(r[e],function(e,r){s=$(r);var o=s.offset();return!(o.top>l.top)||(a=$(t,s),a.each(function(t,s){c=$(s);var r=c.offset();if(r.left>l.left){if(void 0===n&&(n=Math.min(i,a.length-e)),d==n)return!1;d++}}),!1)}),c}}})})}("function"==typeof define&&"object"==typeof define.amd?define:function(e,t){var i;for(i=0;i<e.length;i++)e[i]=this[e[i]];this.datagrid=t.apply(this,e)}),define("js/view/MediatorDataGrid",["puremvc","js/Facade","js/model/ConfigProxy","js/model/ParameterProxy","js/model/TableDataProxy","js/view/DateCodeUtil","js/view/GridFormatters","datagrid"],function(e,t,i,n,s,a,r,o){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){this.getViewComponent().onClick.add(this.dataGridClick,this)},listNotificationInterests:function(){return this.$super().concat([t.TABLEDATA_UPDATED,t.TIME_PERIOD_PARAM_UPDATED,t.CHART_DATA_UPDATED,t.DOWNLOAD_OPTION_SELECTED,t.UNLOAD,t.TABLE_NEEDS_TRIMMING,t.RSE_PARAM_UPDATED,t.PIN_KEY_PARAM_UPDATED])},handleNotification:function(e){switch(e.getName()){case t.TABLE_NEEDS_TRIMMING:for(var a=this.facade.retrieveProxy(s.NAME),o=this.facade.retrieveProxy(n.NAME),l=this.facade.retrieveProxy(i.NAME),c=a.getSeriesData(),d=0,h=0;h<e.body.length;h++)c.splice(e.body[h]-d++,1);break;case t.TABLEDATA_UPDATED:var a=this.facade.retrieveProxy(s.NAME),o=this.facade.retrieveProxy(n.NAME),l=this.facade.retrieveProxy(i.NAME),u=o.getTimeParams(),p=l.getViewById(o.getSelectedView()),c=a.getCombinedData();columns=this.generateColumns(a.getDataColumns(),c,u.f,a.getTableUnits(),p),this.getViewComponent().update(c,columns,{frozenColumn:4,dataItemColumnValueExtractor:function(e,t){return t&&t.field?r.nestedPropertyResolver(t.field,e):null},scrollToRight:!0,addSpacerColumn:!0},u.start,u.end),this.sendNotification(t.TABLE_RENDERED);break;case t.TIME_PERIOD_PARAM_UPDATED:var a=this.facade.retrieveProxy(s.NAME),o=this.facade.retrieveProxy(n.NAME);if(!a.isUpdating){var u=o.getTimeParams();this.getViewComponent().filterNumericColumns(u.start,u.end,!0)}break;case t.CHART_DATA_UPDATED:this.getViewComponent().redraw(e.getBody());break;case t.DOWNLOAD_OPTION_SELECTED:if("table"==e.body.target&&"csv"==e.body.type){var a=this.facade.retrieveProxy(s.NAME),m=[['"'+a.getTableTitle()+'"'],['"'+window.location.href+'"'],['"'+Date()+'"'],['"Source: U.S. Energy Information Administration"']].concat(this.getViewComponent().outputToArrOfArrs());this.sendNotification(t.CSV_DATA_GENERATED,m)}break;case t.UNLOAD:this.getViewComponent().destroy();break;default:this.$super(e)}},generateColumns:function(e,t,s,l,c,d){var h;this.facade.retrieveProxy(n.NAME),this.facade.retrieveProxy(i.NAME);for(columns=[{id:"sourcekey",field:"HAS_DATA",width:30,displayFormatter:r.pinSeriesFormatter,output:!1,cssClass:"chart_column",iconClass:"sourcekey",resizable:!1},{id:"remove",field:"DESCRIPTION",width:30,displayFormatter:r.removeButtonFormatter,output:!0,cssClass:"chart_column",iconClass:"remove",resizable:!1},{id:"description",name:"",field:"DESCRIPTION",displayFormatter:r.descriptionFormatter,outputFormatter:this.$class.descriptionOutputFormatter,cssClass:"description aggregate",maxWidth:904,width:400},{id:"map",field:"HAS_DATA",width:30,displayFormatter:r.mapButtonFormatter,output:!0,cssClass:"chart_column",iconClass:"map",resizable:!1},{id:"linechart",field:"HAS_DATA",width:30,displayFormatter:r.chartButtonFormatter,output:!0,cssClass:"chart_column",iconClass:"linechart",resizable:!1},{id:"units",name:"units",field:"UNITS",display:!1},{id:"source key",name:"source key",field:"SERIES_ID",display:!1}],o.autosizeColumn(columns,0,t,5),h=0;h<e.length;h++){var u=parseInt(e[h]).toString();columns.push({id:u,name:a.formatDateCode(u,s),field:"DATA."+u.toString(),displayFormatter:null,dataFormatter:r.numericalDataFormatter,f:s,width:d?150:100})}return columns},dataGridClick:function(e,a,r){var o=this.getViewComponent(),l=o.columns,c=l[a].iconClass;if("linechart"==l[a].id||"map"==l[a].id||"remove"==l[a].id||"sourcekey"==l[a].id)if(r.ACTION){var d={};d[c]="",this.sendNotification(t.CHART_SELECTION_UPDATED,d)}else switch(l[a].id){case"sourcekey":if(r.SERIES_ID&&r.HAS_DATA){var h=this.facade.retrieveProxy(n.NAME),u="STEO."+r.SERIES_ID+"."+h.getFrequency();this.sendNotification(t.SOURCE_KEY_SELECTED,u)}break;case"remove":if(r.HAS_DATA){for(var p=this.facade.retrieveProxy(i.NAME),h=this.facade.retrieveProxy(n.NAME),p=this.facade.retrieveProxy(i.NAME),m=[],f=h.maskToBits(h.getSelectedSeries()),g=p.getSeries(),v=0;v<g.length;v++)1==f[g[v].formulaId]&&m.push(g[v].seriesId);for(var _=m.length-1;_>=0;_--)m[_]==r.SERIES_ID&&m.splice(_,1);for(var C=h.getChartedIds(h.getChartType()),_=C.length-1;_>=0;_--)C[_]==r.SERIES_ID&&C.splice(_,1);var y={};h.setPreviousSeries(h.getSelectedSeries()),y.s=h.convertToBitmap(m.join("~")),y[h.getChartType()]=C.join("~"),this.sendNotification(t.CHART_SELECTION_UPDATED,y)}else{var y={};y.v=0,this.sendNotification(t.CHART_SELECTION_UPDATED,y)}break;case"linechart":var h=(this.facade.retrieveProxy(s.NAME),this.facade.retrieveProxy(n.NAME));if(r.HAS_DATA){var d={};d[c]=h.getUpdatedCharted(r.SERIES_ID,c),d.map="",d.ctype=l[a].id,this.sendNotification(t.CHART_SELECTION_UPDATED,d)}break;case"map":if(r.IS_MAPPABLE){var h=this.facade.retrieveProxy(n.NAME);if(r.HAS_DATA){var d={};d[c]=r.SERIES_ID,d.linechart="",d.ctype=l[a].id,this.sendNotification(t.CHART_SELECTION_UPDATED,d)}}}},__classvars__:{NAME:"DataGridMediator",linkCellFormatter:function(e,t,i,n,s){return""!==i&&s.filterQuery?'<span class="link_cell">'+i+"</span>":i},descriptionOutputFormatter:function(e,t,i,n,s){return s.CHART_NAME||i}}})}),define("js/view/MediatorHelpTooltip",["puremvc","js/Facade","js/model/HelpTooltipProxy"],function(e,t,i){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},listNotificationInterests:function(){return this.$super().concat([t.UNLOAD])},onRegister:function(){var e=this;this.getViewComponent().helpButtonClicked.add(function(){var t=e.facade.retrieveProxy(i.NAME);e.getViewComponent().toggleHelpTooltips(t.getHelpTooltips())})},handleNotification:function(e){switch(e.getName()){case t.UNLOAD:this.getViewComponent().hideHelpTooltips();break;default:this.$super(e)}},onRemove:function(){this.$super(),this.getViewComponent().hideHelpTooltips()},__classvars__:{NAME:"HelpTooltipMediator"}})}),define("js/view/MediatorViewStack",["puremvc","js/Facade","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,i,n){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this.facade.retrieveProxy(i.NAME);"function"==typeof e.setViews&&e.setViews(this.getViewComponent().viewNames)},listNotificationInterests:function(){return this.$super().concat([t.UPDATE_VISUALIZATION_VIEW_STACK])},handleNotification:function(e){var s=this.getViewComponent(),a=this.facade.retrieveProxy(n.NAME),r=this.facade.retrieveProxy(i.NAME);switch(e.getName()){case t.UPDATE_VISUALIZATION_VIEW_STACK:var o=a.getChartType();s.hasView(o)&&("function"==typeof r.setCurrentView&&r.setCurrentView(o),s.setActiveView(o));break;default:this.$super(e)}},__classvars__:{NAME:"ViewStackMediator"}})}),define("js/view/MediatorLineChart",["puremvc","js/Facade","js/model/TableDataProxy","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,i,n,s){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().indexingChanged.add(function(i){e.sendNotification(t.CHART_SELECTION_UPDATED,{chartindexed:i})})},listNotificationInterests:function(){return this.$super().concat([t.TABLEDATA_UPDATED,t.CHART_DATA_UPDATED,t.TIME_PERIOD_PARAM_UPDATED,t.UNLOAD,t.DOWNLOAD_OPTION_SELECTED])},handleNotification:function(e){var a=this.facade.retrieveProxy(i.NAME),r=this.facade.retrieveProxy(s.NAME),o=(this.facade.retrieveProxy(n.NAME),r.getChartParams()),l=r.getChartType();switch(e.getName()){case t.TABLEDATA_UPDATED:case t.CHART_DATA_UPDATED:if("linechart"==l||"pin"==l||"sourcekey"==l){var c=r.arePinnedSeriesCharted("linechart"),d=r.isUserGenerated("linechart"),h=a.getChartData("linechart");this.getViewComponent().update(h.length>1?"Custom Chart":0==h.length?"":h[0].CHART_NAME,h,a.getDataColumns(),r.getFrequency(),o.chartindexed,r.getStart(),r.getEnd(),c,d)}break;case t.TIME_PERIOD_PARAM_UPDATED:a.isUpdating||"linechart"!=l&&"pin"!=l&&"sourcekey"!=l||this.getViewComponent().setStartEnd(r.getStart(),r.getEnd(),r.getFrequency());break;case t.UNLOAD:this.getViewComponent().destroy();break;case t.DOWNLOAD_OPTION_SELECTED:"embed"==e.body.type?this.getViewComponent().embed():"linechart"==e.body.target&&this.getViewComponent().download(e.body.type);
break;default:this.$super(e)}},__classvars__:{NAME:"ChartMediator"}})}),define("js/view/MediatorDownload",["puremvc","js/Facade","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,i,n){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().downloadButtonClicked.add(function(t){var s=e.facade.retrieveProxy(n.NAME),a=e.facade.retrieveProxy(i.NAME);"function"==typeof a.getDefaultChartType&&e.getViewComponent().showDownload(a.getDownloadParameters()[s.getChartType()])}),this.getViewComponent().downloadOptionClicked.add(function(i){e.getViewComponent().hideDownload(),e.sendNotification(t.DOWNLOAD_OPTION_SELECTED,i)})},__classvars__:{NAME:"DownloadMediator"}})}),define("js/view/MediatorAnimatedMap",["puremvc","js/Facade","js/model/TableDataProxy","js/model/MapDataProxy","js/model/ConfigProxy","js/model/ParameterProxy","us-merc-en","coal-basin-merc-en"],function(e,t,i,n,s,a){return e.Mediator.$extend({__init__:function(e,t){this.$super("undefined"==typeof t?this.$class.NAME:t,e)},onRegister:function(){var e=this;this.viewComponent.mapTypeChangeRequested.add(function(i){e.sendNotification(t.MAP_TYPE_SELECTION_UPDATED,{maptype:i})})},listNotificationInterests:function(){return this.$super().concat([t.MAP_DATA_UPDATED,t.TIME_PARAMS_UPDATED,t.MAP_TYPE_PARAM_UPDATED,t.DOWNLOAD_OPTION_SELECTED,t.REGION_TYPE_PARAM_UPDATED,t.UNLOAD])},handleNotification:function(e){switch(e.name){case t.TIME_PARAMS_UPDATED:case t.MAP_DATA_UPDATED:case t.MAP_TYPE_PARAM_UPDATED:case t.REGION_TYPE_PARAM_UPDATED:var r=this.facade.retrieveProxy(i.NAME),o=this.facade.retrieveProxy(n.NAME),l=(this.facade.retrieveProxy(s.NAME),this.facade.retrieveProxy(a.NAME));if(!r.isUpdating&&o.hasData){var c=l.getTimeParams(),d=o.getData(),h=[];$.each(d.DATA,function(e,t){h.push(e)}),this.viewComponent.update({DATA:d.DATA,DATACOLUMNS:h,PRECISION:d.PRECISION,TITLE:"Custom Map",UNITS:d.UNITS},l.getMapType(),c.start,c.end,c.f,{onRegionOver:function(e,t){return!0},regionStyle:{hover:{stroke:"#FFFF96","fill-opacity":1,"stroke-width":3,"stroke-opacity":1}}},"us_census_merc_en")}break;case t.DOWNLOAD_OPTION_SELECTED:if("map"==e.body.target)switch(e.body.type){case"csv":var r=this.facade.retrieveProxy(i.NAME),o=this.facade.retrieveProxy(n.NAME);d=o.getData();var u=[['"'+r.getTableTitle()+" "+d.TITLE+'"'],['"'+window.location.href+'"'],['"'+Date()+'"'],['"Source: U.S. Energy Information Administration"']].concat(this.getViewComponent().outputToArrOfArrs());this.sendNotification(t.CSV_DATA_GENERATED,u);break;case"png":case"pdf":this.getViewComponent().map.exportMap(e.body.type);break;case"svg":window.SVGAngle?this.getViewComponent().map.exportMap(e.body.type):alert("Map download requires a modern browser, such as Chrome, Firefox or Internet Explorer 9+");break;case"embed":this.getViewComponent().embed()}break;case t.UNLOAD:this.getViewComponent().destroy();break;default:this.$super(e)}},onRemove:function(){this.$super(),this.getViewComponent().destroy()},__classvars:{NAME:"AnimatedMapMediator"}})}),define("qTipsHelp",["classy","signals","qtips"],function(e,t){return e.$extend({__init__:function(){var e=this;this.tooltipsShown=!1,this.button=$("#help_button"),this.helpButtonClicked=new t.Signal,this.button.click(function(t){e.button.hasClass("disabled")||e.helpButtonClicked.dispatch()}),this.windowMouseDownHandler=function(t){var i=function(e){for(var i=t.target;i.parentNode;){if(i.parentNode==e)return!0;i=i.parentNode}return!1}(e.button.get(0));e.tooltipsShown&&!i&&e.hideHelpTooltips()}},toggleHelpTooltips:function(e){this.tooltipsShown?this.hideHelpTooltips():this.showHelpTooltips(e)},showHelpTooltips:function(e){var t=this;this.button.css("cursor","wait").addClass("selected");for(var i=0;i<e.length;i++){var n="function"==typeof e[i].selector?e[i].selector():$(e[i].selector);$.each($(n),function(n,s){$(s).is(":visible")&&($(s).attr("class",$(s).attr("class")+" help_target"),$(s).qtip({content:{prerender:!0,text:e[i].tip},show:"null",hide:"null",style:{tip:!0,name:"cream",width:e[i].width?e[i].width:250},position:{corner:{target:e[i].position,tooltip:t.$class.qtipsOpposite[e[i].position]},adjust:{x:e[i].xAdjust?e[i].xAdjust:0,y:e[i].yAdjust?e[i].yAdjust:0}}}))})}$(".help_target").qtip("show"),this.button.css("cursor","default"),$("body").width(Math.max($(window).width(),1600)).mousedown(this.windowMouseDownHandler),$(window).scrollLeft(($("body").width()-$(window).width())/2).resize(),this.tooltipsShown=!0},hideHelpTooltips:function(){this.button.removeClass("selected"),$(".qtip iframe").hide(),$(".help_target").removeClass("help_target").qtip("destroy"),$("body").width("100%").scroll().unbind("mousedown",this.windowMouseDownHandler),this.tooltipsShown=!1,$(window).resize()},__classvars__:{qtipsOpposite:{topLeft:"bottomRight",topMiddle:"bottomMiddle",topRight:"bottomLeft",bottomLeft:"topRight",bottomMiddle:"topMiddle",bottomRight:"topLeft",leftTop:"rightBottom",leftMiddle:"rightMiddle",leftBottom:"rightTop",rightTop:"leftBottom",rightMiddle:"leftMiddle",rightBottom:"leftTop",center:"center"}}})}),define("viewStack",["classy"],function(e){return e.$extend({__init__:function(e){this.container=e,this.viewNames=[],this.viewsMap={}},addView:function(e,t){return t||(t=$("<div/>").attr("id",e)),this.container.append(t),this.viewNames.push(e),this.viewsMap[e]=t,1==this.viewNames.length?this.setActiveView(e):this.positionView(t,!1),t},removeView:function(e){if(this.viewsMap.hasOwnProperty(e)){var t=this.viewsMap[e];delete this.viewsMap[e],this.viewNames.splice($.indexOf(this.viewNames,e),1),t.remove(),this.activeName==e&&this.viewNames.length>0&&this.setActiveView(this.viewNames[0])}},getView:function(e){return this.viewsMap[e]},hasView:function(e){return e in this.viewsMap},setActiveView:function(e){if(e!=this.activeName){if(!(e in this.viewsMap))throw new Error("Invalid View Name");this.activeName=e;for(var t in this.viewsMap)if(this.viewsMap.hasOwnProperty(t)){var i=this.viewsMap[t];this.positionView(i,t==e)}}},positionView:function(e,t){e.css({display:t?"block":"none"})}})}),define("js/pages/steoBrowserPage",["hasher","signals","puremvc","classy","page","js/Facade","js/Controller","js/model/ConfigProxy","js/model/RequestProxy","js/model/ParameterProxy","js/model/TableDataProxy","js/model/HelpTooltipProxy","js/model/MapDataProxy","js/view/DateCodeUtil","js/view/GridFormatters","js/view/VC_PageLayout","js/view/VC_Selection","js/view/VC_SeriesSelection","js/view/VC_TimeSelection","js/view/VC_LineChart","js/view/VC_Download","js/view/VC_AnimatedMap","js/view/MediatorSelection","js/view/MediatorSeriesSelection","js/view/MediatorTimeSelection","js/view/MediatorDataGrid","js/view/MediatorHelpTooltip","js/view/MediatorViewStack","js/view/MediatorLineChart","js/view/MediatorDownload","js/view/MediatorAnimatedMap","datagrid","qTipsHelp","viewStack","simpleModal"],function(e,t,i,n,s,a,r,o,l,c,d,h,u,p,m,f,g,v,_,C,y,w,S,A,b,E,x,T,M,D,P,I,N,k){var R=null,O=s.$extend({load:function(e){$("#pagecontent").addClass("aggregate"),this.$super(e),s.clearErrorMessage(),R?R.sendNotification(L.RELOAD,e):(R=L.getInstance(this.name),R.sendNotification(L.STARTUP,e))},unload:function(){R.sendNotification(L.UNLOAD),L.removeCore(this.name),R=null,this.$super(),$("#pagecontent").removeClass("aggregate")}})("js/pages/steoBrowserPage"),L=a.$extend({initializeController:function(){this.$super(),this.registerCommand(this.$class.STARTUP,U),this.registerCommand(this.$class.RELOAD,V),this.registerCommand(this.$class.TABLE_PARAMS_UPDATED,r.TableParamsUpdatedCommand),this.registerCommand(this.$class.FREQUENCY_SELECTION_UPDATED,r.FrequencySelectionUpdatedCommand),this.registerCommand(this.$class.TIME_SELECTION_UPDATED,r.TimeSelectionUpdatedCommand),this.registerCommand(this.$class.CHART_PARAMS_UPDATED,r.UpdateChartDataCommand),this.registerCommand(this.$class.CHART_SELECTION_UPDATED,r.UpdateHashCommand),this.registerCommand(this.$class.VIEW_SELECTION_CHANGED,F),this.registerCommand(this.$class.SERIES_SELECTION_CHANGED,B),this.registerCommand(this.$class.TABLE_RENDERED,r.HideLoadMaskCommand),this.registerCommand(this.$class.CHART_DATA_UPDATED,q),this.registerCommand(this.$class.TABLEDATA_UPDATED,q),this.registerCommand(this.$class.DEFAULT_CHART_SET,r.UpdateChartedCommand),this.registerCommand(this.$class.CSV_DATA_GENERATED,r.OutputToCSVCommand),this.registerCommand(this.$class.MAP_TYPE_SELECTION_UPDATED,r.UpdateHashCommand),this.registerCommand(this.$class.SOURCE_KEY_SELECTED,r.OpenAPIWindowCommand),this.registerCommand(this.$class.REMOVE_ROWS,r.RemoveRows)},__classvars__:{getInstance:function(e){return i.Facade.hasCore(e)||new L(e),i.Facade.getInstance(e)}}}),U=i.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(H),this.addSubCommand(j),this.addSubCommand(r.UpdateParameterProxyCommand)}}),V=i.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(r.UpdateRequestProxyCommand),this.addSubCommand(r.UpdateParameterProxyCommand)}}),H=i.SimpleCommand.$extend({execute:function(e){var t={id:"csv_table",type:"csv",class:"ico_csv",target:"table",label:"Table (CSV)"},i=new o;this.facade.registerProxy(i);var n=new l(e.getBody());this.facade.registerProxy(n);var s=new c;this.facade.registerProxy(s);var a=new d;this.facade.registerProxy(a);var r=new h;this.facade.registerProxy(r);var p=new u;this.facade.registerProxy(p);var m=i.getSeries(),f=i.getData();f.seriesByID={};for(var g=0;g<m.length;g++)m[g].seriesId&&(f.seriesByID[m[g].seriesId]=m[g]);i.setVisualizations([{name:"visualizations",class:"linechart",description:"Time-series chart",label:"Time-series"},{name:"visualizations",class:"map",description:"U.S. map over time",label:"U.S. map"}]),i.setDownloadParameters({map:window.SVGAngle?[{label:"Map",children:[{id:"map_png",type:"png",class:"ico_img",target:"map",label:"Map (PNG)"},{id:"map_pdf",type:"pdf",class:"ico_pdf",target:"map",label:"Map (PDF)"},{id:"map_svg",type:"svg",class:"ico_img",target:"map",label:"Map (SVG)"}]},{label:"Data",children:[{id:"map_csv",type:"csv",class:"ico_csv",target:"map",label:"Map (CSV)"},t]}]:[{label:"Data",children:[{id:"map_csv",type:"csv",class:"ico_csv",target:"map",label:"Map (CSV)"},t]}],linechart:[{label:"Image",children:[{id:"linechart_pdf",type:"pdf",class:"ico_pdf",target:"linechart",label:"PDF"},{id:"linechart_png",type:"png",class:"ico_img",target:"linechart",label:"PNG"},{id:"linechart_svg",type:"svg",class:"ico_img",target:"linechart",label:"SVG"},{id:"linechart_embed",type:"embed",class:"ico_embed",target:"linechart",label:"EMBED"}]},{label:"Data",children:[{id:"linechart_csv",type:"csv",class:"ico_csv",target:"linechart",label:"Chart (CSV)"},t]}]})}}),j=i.SimpleCommand.$extend({execute:function(){var e=new f,t=new z(e);this.facade.registerMediator(t)}}),F=(i.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(r.ResetChartedCommand),this.addSubCommand(r.UpdateHashCommand)}}),i.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(r.ResetStartEndCommand),this.addSubCommand(r.ResetChartedCommand),this.addSubCommand(r.ResetChartindexedCommand),this.addSubCommand(r.UpdateHashCommand)}})),B=i.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(r.ResetChartindexedCommand),this.addSubCommand(r.UpdateHashCommand),this.addSubCommand(r.ResetChartedCommand)}}),q=i.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(c.NAME),i=this.facade.retrieveProxy(d.NAME),n=this.facade.retrieveProxy(u.NAME);"map"==t.getChartType()&&n.updateMapData(i.getChartData("map")[0])}}),z=i.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this.getViewComponent(),t=(this.facade.retrieveProxy(o.NAME),this.facade.retrieveProxy(l.NAME),this.facade.retrieveProxy(c.NAME),new I(e.getTableContainer())),i=new _(e.getTimeSelectionContainer()),n=new N,s=new k(e.getChartContainer()),a=s.addView("linechart"),r=s.addView("map"),d=new C(a),h=new y(e.getDownloadContainer()),u=new w(r),p=new E(t),m=new b(i),f=new x(n),$=new T(s),R=new M(d),O=new D(h),L=new P(u),U=new g(e.getSelectionContainer()),V=new S(U);this.facade.registerMediator(V);var H=new v(e.getSeriesSelectionContainer()),j=new A(H);this.facade.registerMediator(j),this.facade.registerMediator(p),this.facade.registerMediator(m),this.facade.registerMediator(f),this.facade.registerMediator($),this.facade.registerMediator(R),this.facade.registerMediator(O),this.facade.registerMediator(L)},listNotificationInterests:function(){return this.$super().concat([a.TABLEDATA_UPDATED,a.TABLE_RENDERED])},handleNotification:function(e){var t=(this.getViewComponent(),this.facade.retrieveProxy(l.NAME),this.facade.retrieveProxy(d.NAME)),i=this.facade.retrieveProxy(c.NAME),n=this.facade.retrieveProxy(o.NAME);switch(e.getName()){case L.TABLEDATA_UPDATED:var s=t.getTableTitle();null!=i.getSelectedView()&&(s=n.getViewById(i.getSelectedView()).name),window.document.title="STEO Data Browser - "+s;break;default:this.$super(e)}},__classvars__:{NAME:"PageMediator"}}),f=f.$extend({__init__:function(){this.$super($("#pagecontent"),{mainDownloadButtonOpts:{selected:!1,id:"main_download_button"},overlayDownloadButtonOpts:{selected:!0,id:"overlay_download_button"}})}});return O}),define("js/routes",["js/pages/steoBrowserPage"],{defaultHash:"",patterns:[{pattern:/.*/,moduleURI:"js/pages/steoBrowserPage"}]}),define("crossroads",["signals"],function(e){function t(e,t){if(e.indexOf)return e.indexOf(t);for(var i=e.length;i--;)if(e[i]===t)return i;return-1}function i(e,t){return"[object "+t+"]"===Object.prototype.toString.call(e)}function n(e){return i(e,"RegExp")}function s(e){return i(e,"Array")}function a(e){return i(e,"Function")}function r(e){var t;return t=null===e||"null"===e?null:"true"===e||"false"!==e&&(e===u||"undefined"===e?u:""===e||isNaN(e)?e:parseFloat(e))}function o(e){for(var t=e.length,i=[];t--;)i[t]=r(e[t]);return i}function l(){this._routes=[],this.bypassed=new e.Signal,this.routed=new e.Signal}function c(t,i,s,a){var r=n(t);this._router=a,this._pattern=t,this._paramsIds=r?null:h.getParamIds(this._pattern),this._optionalParamsIds=r?null:h.getOptionalParamsIds(this._pattern),this._matchRegexp=r?t:h.compilePattern(t),this.matched=new e.Signal,i&&this.matched.add(i),this._priority=s||0}var d,h,u;return l.prototype={normalizeFn:null,create:function(){return new l},shouldTypecast:!1,addRoute:function(e,t,i){var n=new c(e,t,i,this);return this._sortedInsert(n),n},removeRoute:function(e){var i=t(this._routes,e);i!==-1&&this._routes.splice(i,1),e._destroy()},removeAllRoutes:function(){for(var e=this.getNumRoutes();e--;)this._routes[e]._destroy();this._routes.length=0},parse:function(e){e=e||"";var t,i=this._getMatchedRoutes(e),n=0,s=i.length;if(s)for(;n<s;)t=i[n],t.route.matched.dispatch.apply(t.route.matched,t.params),t.isFirst=!n,this.routed.dispatch(e,t),n+=1;else this.bypassed.dispatch(e)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(e){var t=this._routes,i=t.length;do--i;while(t[i]&&e._priority<=t[i]._priority);t.splice(i+1,0,e)},_getMatchedRoutes:function(e){for(var t,i=[],n=this._routes,s=n.length;t=n[--s];)i.length&&!t.greedy||!t.match(e)||i.push({route:t,params:t._getParamsArray(e)});return i},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},d=new l,d.VERSION="0.7.1",c.prototype={greedy:!1,rules:void 0,match:function(e){return this._matchRegexp.test(e)&&this._validateParams(e)},_validateParams:function(e){var t,i=this.rules,n=this._getParamsObject(e);for(t in i)if("normalize_"!==t&&i.hasOwnProperty(t)&&!this._isValidParam(e,t,n))return!1;return!0},_isValidParam:function(e,i,r){var o=this.rules[i],l=r[i],c=!1;return null==l&&this._optionalParamsIds&&t(this._optionalParamsIds,i)!==-1?c=!0:n(o)?c=o.test(l):s(o)?c=t(o,l)!==-1:a(o)&&(c=o(l,e,r)),c},_getParamsObject:function(e){for(var t=this._router.shouldTypecast,i=h.getParamValues(e,this._matchRegexp,t),n={},s=i.length;s--;)n[s]=i[s],this._paramsIds&&(n[this._paramsIds[s]]=i[s]);return n.request_=t?r(e):e,n.vals_=i,n},_getParamsArray:function(e){var t,i=this.rules?this.rules.normalize_:null;return i=i||this._router.normalizeFn,t=i&&a(i)?i(e,this._getParamsObject(e)):h.getParamValues(e,this._matchRegexp,this._router.shouldTypecast)},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.matched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},h=d.patternLexer=function(){function e(e,t){for(var i,n=[];i=e.exec(t);)n.push(i[1]);return n}function t(t){return e(m,t)}function i(t){return e(p,t)}function n(e){return e=e||"",e&&(e=e.replace(c,""),e=s(e),e=e.replace(l,"\\$&"),e=a(e)),new RegExp("^"+e+"/?$")}function s(e){return e=e.replace(d,"$1"+_+"$2"),e=e.replace(h,"$1"+v+"$2"),e=e.replace(p,g),e.replace(u,f)}function a(e){return e=e.replace(w,"\\/?"),e=e.replace(S,"\\/"),e=e.replace(y,"([^\\/]+)?/?"),e.replace(C,"([^\\/]+)")}function r(e,t,i){var n=t.exec(e);return n&&(n.shift(),i&&(n=o(n))),n}var l=/[\\.+*?\^$\[\](){}\/'#]/g,c=/\/$/g,d=/([:}]|\w(?=\/))\/?(:)/g,h=/([:}])\/?(\{)/g,u=/\{([^}]+)\}/g,p=/:([^:]+):/g,m=/(?:\{|:)([^}:]+)(?:\}|:)/g,f="__CR_RP__",g="__CR_OP__",v="__CR_RS__",_="__CR_OS__",C=new RegExp(f,"g"),y=new RegExp(g,"g"),w=new RegExp(_,"g"),S=new RegExp(v,"g");return{getParamIds:t,getOptionalParamsIds:i,getParamValues:r,compilePattern:n}}(),d}),define("js/router",["js/routes","crossroads","hasher","page"],function(e,t,i,n){function s(e,t){if(e.indexOf)return e.indexOf(t);for(var i=e.length;i--;)if(e[i]===t)return i;return-1}function a(e){for(var t,i=(e||"").replace("?","").split("&"),n=i.length,s={};n--;)i[n]=i[n].split("="),t=i[n][1],s[i[n][0]]=t;return s}function r(e,t){function i(t,n){if(t)if("object"==typeof t){var a={};$.extend(a,t,r.query),r.query=a}else"function"==typeof t?i(t.call(s,e,r),n):void 0==r[n]&&(r[n]=t)}var n,s=this,r={query:{}};for(n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&(r[n]=t[n],("query"==n||"string"==typeof t[n]&&0==t[n].indexOf("?"))&&$.extend(r.query,a(t[n])));if(s.defaults)for(n in t)t.hasOwnProperty(n)&&i(s.defaults[n],n);return[r]}function o(e){var t,i,n;if(t=e.rules)for(i in t)t.hasOwnProperty(i)&&"normalize_"!=i&&(n=t[i],t[i]=function(t){return function(i,n,a){var r=!0;return t instanceof RegExp?r=t.test(i):t instanceof Array?r=s(t,i)!==-1:t instanceof Function&&(r=t(i,n,a)),!r&&e.defaultHash&&(m=e.defaultHash),r}}(n));else t=e.rules={};return t.normalize_=function(t,i){return r.call(e,t,i)},e}function l(e,t){"undefined"!=typeof console&&"function"==typeof console.log&&console.log(e)}function c(i){var n;if(m){if(m==i)throw"Bad redirect hash: "+m;n=m,m=null,t.parse(n)}else t.parse(e.defaultHash)}function d(){var e=arguments;try{require([this.moduleURI],function(t){f!=t&&h();try{t.load.apply(t,e)}catch(i){if(location.host.indexOf("wwwdev")!=-1||location.host.indexOf("vdc")!=-1)throw i;n.errorHandler({module:t.toString(),route:e[0],error:i.name+" "+i.message,stack:i.stack})}f=t})}catch(t){if(location.host.indexOf("wwwdev")!=-1||location.host.indexOf("vdc")!=-1)throw t;n.errorHandler({module:this.moduleURI,route:e[0],error:t.name+" "+t.message,stack:t.stack})}}function h(){f&&(f.unload(),f=null)}function u(e,i,n){var s=t.addRoute(e);n&&(s.rules=n),s.matched.add(d,{moduleURI:i})}function p(){var n,s;for(n=0;n<e.patterns.length;n++)s=o(e.patterns[n]),u(s.pattern,s.moduleURI,s.rules);t.routed.add(l),t.bypassed.add(c),t.shouldTypecast=!0,i.initialized.add(t.parse,t),i.changed.add(t.parse,t),i.init(),""==i.getHash()&&t.parse(e.defaultHash)}var m,f=null;return{init:p}}),require(["js/router","page"],function(e,t){t.showLoadMask(),$(e.init)}),define("js/main",function(){});