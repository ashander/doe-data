/**
 * @license RequireJS text 2.0.10 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*
 RequireJS order 1.0.5 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

define("page",["classy","kizzy","signals","hasher","loadmask","json2"],function(e,t,n,r){return e.$extend({__init__:function(e){this.name=e,this.settings=t(this.name),this.loadSignal=new n.Signal,this.unloadSignal=new n.Signal},load:function(e){this.settings.clearExpireds(),this.$class.pushRequest(e),this.loadSignal.dispatch(e),this.isLoaded=!0},unload:function(){this.settings.clearExpireds(),this.unloadSignal.dispatch(),this.isLoaded=!1},toString:function(){return"[Page "+this.name+"]"},__classvars__:{requests:[],setHash:function(e){r.setHash(e)},showLoadMask:function(e,t){t=t||$("#pagecontent"),e='<span class="loading">'+(e||this.LOADING_MESSAGE)+"</span>",t.mask(e)},hideLoadMask:function(e){e=e||$("#pagecontent"),e.unmask()},pushRequest:function(e){this.requests.length>=10&&this.requests.shift(),this.requests.push(e)},errorHandler:function(e,t){var n=$("#pagecontent");if(e&&t){var r=this.generateErrorJSON(e);$.ajax({url:t,type:"POST",data:{json:r}})}var i='An error has occurred, and has been logged.  </br>If refreshing the page does not solve the issue, </br>try returning to the <a href="./">main page</a> and making</br> another selection';n.mask(i)},clearErrorMessage:function(){var e=$("#pagecontent");e.unmask()},generateErrorJSON:function(e){return JSON.stringify($.extend(!0,{},e,{browser:$.browser,requests:this.requests}))},LOADING_MESSAGE:"Loading..."}})}),define("js/Facade",["puremvc"],function(e){return e.Facade.$extend({sendNotification:function(e,t,n){typeof console!="undefined"&&typeof console.log=="function"&&console.log(Date.now()+" : "+e+(n?" : "+n:""));try{this.$super(e,t,n)}catch(r){typeof console!="undefined"&&typeof console.log=="function"&&console.log("ERROR: "+r.name+" : "+r.message);if(location.host.indexOf("wwwdev")!=-1||location.host.indexOf("vdc")!=-1)throw r;this.$super(this.$class.ERROR,r,e)}},__classvars__:{STARTUP:"startup",RELOAD:"reload",UNLOAD:"unload",TOPIC_PARAMS_UPDATED:"topicParamsUpdated",TABLE_PARAMS_UPDATED:"tableParamsUpdated",CHART_PARAMS_UPDATED:"chartParamsUpdated",CTYPE_PARAM_UPDATED:"ctypeParamUpdated",MAP_TYPE_PARAM_UPDATED:"mapTypeParamUpdated",TIME_PARAMS_UPDATED:"timeParamsUpdated",DEFAULT_CHART_SET:"defaultChartSet",RSE_PARAM_UPDATED:"rseParameterUpdated",PIN_KEY_PARAM_UPDATED:"pinKeyParameterUpdated",REGION_TYPE_PARAM_UPDATED:"regionTypeParameterUpdated",CHART_DATA_UPDATED:"chartDataUpdated",TABLEDATA_UPDATED:"tableDataUpdated",MAP_DATA_UPDATED:"mapDataUpdated",CSV_DATA_GENERATED:"csvDownloadDataGenerated",CHART_SELECTION_UPDATED:"chartSelectionUpdated",FREQUENCY_SELECTION_UPDATED:"frequencySelectionUpdated",TABLE_SELECTION_UPDATED:"tableSelectionUpdated",TOPIC_SELECTION_UPDATED:"topicSelectionUpdated",REPORT_SELECTION_UPDATED:"reportSelectionUpdated",TIME_SELECTION_UPDATED:"timeSelectionUpdated",DOWNLOAD_OPTION_SELECTED:"downloadOptionSelected",SEARCH_STRING_UPDATED:"searchStringUpdated",MAP_TYPE_SELECTION_UPDATED:"mapTypeSelectionUpdated",PINNED_SERIES_UPDATED:"pinnedSeriesUpdated",RSE_SELECTION_UPDATED:"rseSelectionUpdated",PIN_KEY_SELECTION_UPDATED:"pinKeySelected",REGION_TYPE_SELECTION_UPDATED:"regionTypeSelected",STATE_MAP_CLICKED:"stateMapClicked",AGGREGATE_DATA_CLICK_THROUGH:"aggregateDataClickThrough",PLANT_LIST_CLICK_THROUGH:"plantListClickThrough",MINE_LIST_CLICK_THROUGH:"mineListClickThrough",SHIPMENT_LIST_CLICK_THROUGH:"shipmentListClickThrough",POWER_PLANT_HIGHLIGHT:"powerPlantHighlight",MINE_HIGHLIGHT:"mineHighlight",TABLE_RENDERED:"tableRendered",UPDATE_VISUALIZATION_VIEW_STACK:"updateVisualizationViewStack",IMPORT_EXPORT_PORT_SELECTED:"importExportPortSelected",IMPORT_EXPORT_COUNTRY_SELECTED:"importExportCountrySelected",SOURCE_KEY_SELECTED:"sourceKeySelected",ERROR:"error"}})}),define("text",["module"],function(e){var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.10",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}d.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("ï»¿")===0&&(i=i.substring(1)),t(i)}catch(s){r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("js/model/ConfigProxy",["puremvc","text!configJSON","json2"],function(e,t){var n=JSON.parse(t);return e.Proxy.$extend({topicMap:null,__init__:function(){var e={reports:n.reports,topics:n.topics};for(var t=0;t<e.topics.length;t++)for(var r=0;r<e.topics[t].aggColumns.length;r++)e.topics[t].aggColumns[r].filterGroup=n.filterGroups[e.topics[t].aggColumns[r].filterGroupId];this.$super(this.$class.NAME,e),this.generateTopicMap()},generateTopicMap:function(){var e={},t,n;for(t=0;t<this.getTopics().length;t++)n=this.getTopics()[t],e[n.dataTopicId]=n;this.topicMap=e},getTopics:function(){return this.getData().topics},getReports:function(){return this.getData().reports},getTopic:function(e){return this.topicMap[e]},getFilterQuery:function(e,t){var n=this.getTopic(e).aggColumns,r=t.split(".")[2].split("-"),i={},s,o,u,a,f,l,c;for(s=0;s<n.length;s++){f=n[s].filterGroup.filterValues;for(o=0;o<f.length;o++)if(f[o].filterValue==r[s]){l=f[o].valueId;break}c=new Array(1),c[l]=1,i[n[s].filterGroup.varName]="";var h="";for(var u=0;u<Math.ceil(c.length/5)*5;u++)c[u]&&c[u]==1?h+="1":h+="0",u%5==4&&(i[n[s].filterGroup.varName]=i[n[s].filterGroup.varName]+parseInt(h,2).toString(32),h="");if(i[n[s].filterGroup.varName]=="0")return null;i[n[s].filterGroup.varName]=i[n[s].filterGroup.varName]==""?"g":i[n[s].filterGroup.varName]}a="";for(s in i)i.hasOwnProperty(s)&&(a+=s+"="+i[s]+"&");return a.substring(0,a.length-1)},__classvars__:{NAME:"ConfigProxy"}})}),define("js/model/RequestProxy",["puremvc"],function(e){return e.Proxy.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},getQuery:function(){return this.getData().query},getPath:function(){var e=this.getData().request_,t;return e.indexOf("/")!=-1?e.indexOf("?")!=-1?t=Math.min(e.indexOf("/"),e.indexOf("/")):t=e.indexOf("/"):e.indexOf("?")!=-1?t=e.indexOf("?"):t=e.length,e.substring(0,t)},getTopicId:function(){return this.getData()[0]},__classvars__:{NAME:"RequestProxy"}})}),define("js/model/ParameterProxy",["puremvc"],function(e){return e.Proxy.$extend({__init__:function(){this.$super(this.$class.NAME,{query:{}})},getQuery:function(){return this.getData().query},getQueryString:function(e){var t=$.extend({},this.getQuery(),e),n="?",r=this.getQueryKeys(),i,s;for(i=0;i<r.length;i++)s=r[i],t.hasOwnProperty(s)&&(n+=s+"="+t[s]+"&");return $.each(t,function(e,t){$.inArray(e,r)==-1&&(n+=e+"="+t+"&")}),n.substring(0,n.length-1)},copyQuery:function(e,t,n,r){var i={},s={},o,u;for(o in t)t.hasOwnProperty(o)&&(u=o.toLowerCase(),e[u]=t[o],n[u]!=t[o]?i[u]=o:s[u]=o);for(u in n)n.hasOwnProperty(u)&&!(u in i)&&!(u in s)&&(e[u]=void 0,i[u]=u);for(u in i)i.hasOwnProperty(u)&&r.call(this,u,e[u],n[u])},updateQuery:function(e,t){var n={};this.copyQuery(n,e,this.getQuery(),t),this.validateQuery(n),$.extend(this.getData(),{query:n})},update:function(){},validateQuery:function(e){},getQueryKeys:function(){return[]},getGAString:function(e){return""},checkVal:function(e,t,n,r){e[t]=e[t]!==void 0&&(r?r(e[t]):!0)?e[t]:n},__classvars__:{NAME:"ParameterProxy"}})}),define("js/model/DataProxy",["puremvc"],function(e){return e.Proxy.$extend({__init__:function(){this.$super(this.$class.NAME),this.cache={},this.cacheKeys=[]},setData:function(e,t){this.$super(t),this.addToCache(e,t)},setDataFromCache:function(e){this.data=this.getFromCache(e)},inCache:function(e){return e in this.cache},addToCache:function(e,t){this.inCache(e)?this.cache[e]=t:(this.cacheKeys.length>=this.$class.CACHE_LIMIT&&delete this.cache[this.cacheKeys.shift()],this.cacheKeys.push(e),this.cache[e]=t)},getFromCache:function(e){return this.cache[e]},__classvars__:{CACHE_LIMIT:5}})}),define("js/model/TableDataProxy",["js/model/DataProxy"],function(e){return e.$extend({__classvars__:{NAME:"TableDataProxy",getItemMetadata:function(e){var t={cssClasses:""},n=this[e];return t.cssClasses+="level_"+n.LEVEL,n.HAS_DATA||(t.cssClasses+=" NO_DATA"),t}}})}),define("js/Controller",["puremvc","page","js/model/ConfigProxy","js/model/RequestProxy","js/model/ParameterProxy","js/model/TableDataProxy","json2"],function(e,t,n,r,i,s){var o=e.SimpleCommand.$extend({execute:function(e){var n=e.getBody(),i=this.facade.retrieveProxy(r.NAME);t.errorHandler(n?{route:i?i.getData():null,notification:e.getType(),error:n.name+" "+n.message,stack:n.stack}:void 0,"dataService/errorService.cfc?method=logError")}}),u=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(r.NAME);t.setData(e.getBody())}}),a=e.SimpleCommand.$extend({execute:function(){var e=this.facade.retrieveProxy(i.NAME);e.update()}}),f=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(s.NAME);t.loadTableData()}}),l=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(i.NAME);t.resetCharted(e.getType()),t.updateCharted(t.getUpdatedCharted(e.getBody(),e.getType()),e.getType())}}),c=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(s.NAME);t.isUpdating||t.updateChartData()}}),h=e.SimpleCommand.$extend({execute:function(){t.showLoadMask()}}),p=e.SimpleCommand.$extend({execute:function(e){t.hideLoadMask()}}),d=e.SimpleCommand.$extend({execute:function(e){var n=this.facade.retrieveProxy(i.NAME),r=e.getBody(),s=e.getType();if(s){var o=n.getGAString(r);typeof _gaq!="undefined"?_gaq.push(["_trackEvent","Enerdat",s,o]):typeof console!="undefined"&&typeof console.log=="function"&&console.log("_trackEvent : Enerdat : "+s+" : "+o)}t.setHash(n.getFullPath(r))}}),v=e.SimpleCommand.$extend({execute:function(e){var n=this.facade.retrieveProxy(i.NAME),r=e.getBody().topic,s=e.getBody().params||{},o=e.getType();if(o){var u=e.getBody().label||n.getGAStringByTopic({},r);typeof _gaq!="undefined"?_gaq.push(["_trackEvent","Enerdat",o,u]):typeof console!="undefined"&&typeof console.log=="function"&&console.log("_trackEvent : Enerdat : "+o+" : "+u)}t.setHash(n.getFullTopicPath(s,r))}}),m=e.SimpleCommand.$extend({execute:function(e){var n=e.getBody(),r=this.facade.retrieveProxy(i.NAME),s=e.getType();if(s){var o=r.getGAStringByTopic(n.query,n.topic);typeof _gaq!="undefined"?_gaq.push(["_trackEvent","Enerdat",s,o]):typeof console!="undefined"&&typeof console.log=="function"&&console.log("_trackEvent : Enerdat : "+s+" : "+o)}t.setHash(r.getFullTopicPath(n.query,n.topic))}}),g=e.SimpleCommand.$extend({execute:function(e){var n=e.getBody(),r=this.facade.retrieveProxy(i.NAME),s=r.getCharted("pin"),o=e.getType();if(o){var u=n.label;typeof _gaq!="undefined"?_gaq.push(["_trackEvent","Enerdat",o,u]):typeof console!="undefined"&&typeof console.log=="function"&&console.log("_trackEvent : Enerdat : "+o+" : "+u)}t.setHash("plant/"+n.code+"/?freq="+n.freq+(s!==void 0?"&pin="+s:""))}}),y=e.SimpleCommand.$extend({execute:function(e){var n=e.getBody(),r=this.facade.retrieveProxy(i.NAME),s=r.getCharted("pin"),o=e.getType();if(o){var u=n.label;typeof _gaq!="undefined"?_gaq.push(["_trackEvent","Enerdat",o,u]):typeof console!="undefined"&&typeof console.log=="function"&&console.log("_trackEvent : Enerdat : "+o+" : "+u)}t.setHash("mine/"+n.code+"/?freq="+n.freq+(s!==void 0?"&pin="+s:""))}}),b=e.SimpleCommand.$extend({execute:function(e){var n=e.getBody(),r=this.facade.retrieveProxy(i.NAME),s=r.getCharted("pin"),o=e.getType();if(o){var u=n.label;typeof _gaq!="undefined"?_gaq.push(["_trackEvent","Enerdat",o,u]):typeof console!="undefined"&&typeof console.log=="function"&&console.log("_trackEvent : Enerdat : "+o+" : "+u)}t.setHash("shipments/"+n.type+"/"+n.code+"/?freq="+n.freq+(s!==void 0?"&pin="+s:""))}}),w=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(s.NAME),n=this.facade.retrieveProxy(i.NAME),r,o,u=e.getType();if(u){var a=n.getGAString({});typeof _gaq!="undefined"?_gaq.push(["_trackEvent","Enerdat",u,a]):typeof console!="undefined"&&typeof console.log=="function"&&console.log("_trackEvent : Enerdat : "+u+" : "+a)}r=$('<input type="hidden" name="csvArr"/>').val(JSON.stringify(e.getBody())),o=$('<input type="hidden" name="fileName"/>').val(t.getTableTitle().replace(/,/g,"").replace(/\s+/g,"_")),jQuery('<form style="display:none;" action="'+this.$class.POST_URL+'" method="post"></form>').append(r).append(o).appendTo("body").submit().remove()},__classvars__:{POST_URL:"/global/scripts/jquery/highcharts/exporting-server/csv_exporter.cfm"}}),E=e.SimpleCommand.$extend({execute:function(e){window.open("/opendata/qb.cfm?sdid="+e.getBody())}}),S=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(i.NAME);t.resetCharted()}}),x=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(i.NAME);t.resetChartindexed()}}),T=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(i.NAME),r=this.facade.retrieveProxy(n.NAME),s=e.getBody().topic,o=r.getTopic(s);(!o||!o.selectDateRange)&&t.resetStartEnd()}}),N=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(i.NAME),r=this.facade.retrieveProxy(n.NAME),s=e.getBody().topic,o=r.getTopic(s);(!o||o.selectDateRange)&&t.resetDatecode()}}),C=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(i.NAME);t.resetAggColumns(e.getBody().topic)}}),k=e.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(i.NAME),n=e.getBody();t.updateChartIdFrequencies(n.freq)}}),L=e.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(h),this.addSubCommand(f)}}),A=e.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(k),this.addSubCommand(T),this.addSubCommand(d)}}),O=e.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(N),this.addSubCommand(d)}});return{ErrorCommand:o,UpdateRequestProxyCommand:u,UpdateParameterProxyCommand:a,UpdateTableDataProxyCommand:f,UpdateChartedCommand:l,UpdateChartDataCommand:c,ShowLoadMaskCommand:h,HideLoadMaskCommand:p,UpdateHashCommand:d,UpdateTopicHashCommand:v,UpdateReportHashCommand:m,UpdatePlantHashCommand:g,OpenAPIWindowCommand:E,ResetChartedCommand:S,ResetChartindexedCommand:x,ResetStartEndCommand:T,ResetDatecodeCommand:N,ResetAggColumnsCommand:C,OutputToCSVCommand:w,UpdateParameterFrequencies:k,TableParamsUpdatedCommand:L,UpdateMineHashCommand:y,FrequencySelectionUpdatedCommand:A,FrequencySelectionUpdatedSingleTimeSliderCommand:O,UpdateShipmentHashCommand:b}}),define("js/model/ConfigMixinVisualization",[],function(){return{getVisualizations:function(){return this.getData().visualizations},setVisualizations:function(e){this.getData().visualizations=e}}}),define("js/model/ConfigMixinDownload",[],function(){return{getDownloadParameters:function(){return this.getData().downloadParameters},setDownloadParameters:function(e){this.getData().downloadParameters=e}}}),define("js/model/ConfigMixinViewStack",[],function(){return{getViews:function(){return this.getData().views},setViews:function(e){this.getData().views=e,this.getData().currentView=this.getData().currentView?this.getData().currentView:e[0]},getCurrentView:function(){return this.getData().currentView},setCurrentView:function(e){return this.getData().currentView=$.inArray(e,this.getViews())==-1?this.getViews()[0]:e}}}),define("js/model/ConfigMixinLinkType",[],function(){return{getLinkTypes:function(){return this.getData().linkTypes},setLinkTypes:function(e){this.getData().linkTypes=e}}}),define("js/model/AggregateDataConfigProxy",["js/model/ConfigProxy","js/model/ConfigMixinVisualization","js/model/ConfigMixinDownload","js/model/ConfigMixinViewStack","js/model/ConfigMixinLinkType"],function(e,t,n,r,i){return e.$extend({__include__:[t,n,r,i]})}),define("js/model/RequestMixinTopic",[],function(){return{getTopicId:function(){return this.getData()[0]}}}),define("js/model/AggregateDataRequestProxy",["js/model/RequestProxy","js/model/RequestMixinTopic"],function(e,t){return e.$extend({__include__:[t]})}),define("js/model/ParameterMixinAggColumn",["js/model/ConfigProxy"],function(e){return{getAgg:function(){return this.getQuery().agg},getAggColumnParams:function(){var t=this.facade.retrieveProxy(e.NAME),n=t.getTopic(this.getTopicId()),r={},s;for(i=0;i<n.aggColumns.length;i++)s=n.aggColumns[i].filterGroup.varName,r[s]=this.getQuery()[s];return r},validateAggColumns:function(e,t){var n,r,i,s=$.parseJSON(t.defaultSelection).query;this.checkVal(e,"agg",s.agg,function(e){var n=e.length>0?e.split(","):[],r=n.length>0,i,s,o=!1;for(i=0;i<n.length;i++){o=!1;for(s=0;s<t.aggColumns.length;s++)if(n[i]==t["aggColumns"][s]["aggColumnId"]){o=!0;break}r&=o}return r}),n=e.agg.split(",");for(i=0;i<n.length;i++)r=t.aggColumns[i],this.checkVal(e,r.filterGroup.varName,s[r.filterGroup.varName],function(e){var t=e.length>0,n,r;for(n=0;n<e.length;n++)r=e.charCodeAt(n),t&=r>=48&&r<=57||r>=97&&r<=118;return t})},resetAggColumns:function(t){var n=this.facade.retrieveProxy(e.NAME),r=n.getTopic(t),i=this.getQuery(),s=this.getAggColumnParams(),o={},u,a;for(a=0;a<r.aggColumns.length;a++)o[r.aggColumns[a].filterGroup.varName]=null;for(u in s)u in o||delete i[u]}}}),define("js/model/ParameterMixinGetCharted",[],function(){return $.extend({getCharted:function(e){return this.getQuery()[e]}})}),define("js/model/ParameterMixinChart",["js/model/ParameterMixinGetCharted","js/model/ConfigProxy"],function(e,t){return e.extend({arePinnedSeriesCharted:function(e){var t=this.getChartedIds(e),n=this.getChartedIds("pin"),r={};for(var i=0;i<n.length;i++)r[n[i]]=!0;for(i=0;i<t.length;i++)if(t[i]in r)return!0;return!1},updateChartIdFrequencies:function(e){var n=this.facade.retrieveProxy(t.NAME),r=[];typeof n.getVisualizations!="undefined"&&(r=$.merge([],n.getVisualizations())),typeof n.getLinkTypes!="undefined"&&(r=$.merge(r,n.getLinkTypes()));for(var i=0;i<r.length;i++){var s=r[i]["class"];if(s!="sourcekey"){var o=this.getChartedIds(s);for(var u=0;u<o.length;u++)o[u]=o[u]!=null?o[u].substring(0,o[u].length-1)+e:null;this.updateCharted(o,s)}}},getUpdatedCharted:function(e,t,n){return this.getUpdatedChartedIds(e,t,n).join("~")},getUpdatedChartedIds:function(e,t,n){var r=this.getChartedIds(t).slice();e=e instanceof Array?e:[e];for(var i=0;i<e.length;i++){var s=e[i],o=$.inArray(s,r);if(!~o&&n!==!0){var u=$.inArray(null,r);~u?r[u]=s:r.push(s)}else~o&&n!==!1&&(r[o]=null)}return r},getChartedByType:function(e){return this.getQuery()[e]},getChartedIds:function(e){var t=this.getCharted(e),n=t?t.split("~"):[];return $.each(n,function(e,t){n[e]==""&&(n[e]=null)}),n},getChartIndexed:function(){return this.getQuery().chartindexed},getColumnEndpoints:function(){return this.getQuery().columnendpoints},getColumnValues:function(){return this.getQuery().columnvalues},resetCharted:function(e){if(e!==void 0)this.deleteNonPinnedIds(e);else{var n=this.facade.retrieveProxy(t.NAME),r=n.getVisualizations();for(var i=0;i<r.length;i++){var s=r[i]["class"];this.deleteNonPinnedIds(s)}}},deleteNonPinnedIds:function(e){var t=this.getQuery();if(t[e]!==void 0&&t.pin!==void 0){var n={};$.each(t.pin.split("~"),function(e,t){n[t]=!0});var r=$.map(t[e].split("~"),function(e){return e in n?e:null}).join("~");r===""?delete t[e]:t[e]=r}else delete t[e]},resetChartindexed:function(){var e=this.getQuery();delete e.chartindexed},updateCharted:function(e,t){var n=this.getQuery();e=e instanceof Array?e:[e],n[t]=e.join("~")},updateChartType:function(e){var t=this.getQuery();t[e]||(t[e]=""),t.ctype=e},getChartType:function(){return this.getQuery().ctype},getMapType:function(){return this.getQuery().maptype},validateChartParams:function(e,t,n){var r=$.parseJSON(t.defaultSelection);this.checkVal(e,"maptype","0",function(e){return e==="0"||e==="1"}),this.checkVal(e,"ctype",r.ctype?r.ctype:n[0]["class"],function(e){var t=!1;return $.each(n,function(n,r){r["class"]==e&&(t=!0)}),t})},isUserGenerated:function(e){var n=this.facade.retrieveProxy(t.NAME),r=n.getTopic(this.getTopicId()),i=$.parseJSON(r.defaultSelection),s=$.extend(!0,[],this.getChartedIds(e)).sort(),o=$.extend(!0,[],i[e]).sort();if(o.length!=s.length)return!0;for(var u=1;u<o.length;u++)if(o[u]!=s[u])return!0;return this.arePinnedSeriesCharted(e)||!1}})}),define("js/model/ParameterMixinFrequency",[],function(){return{getFreq:function(){return this.getQuery().freq},getFreqTitle:function(){var e="";switch(this.getFreq()){case"A":return"Annual";case"Q":return"Quarterly";case"M":return"Monthly"}return e},validateFrequency:function(e,t){var n=$.parseJSON(t.defaultSelection);this.checkVal(e,"freq",n.freq,function(e){switch(e){case"A":return t.hasAnnual;case"Q":return t.hasQuarterly;case"M":return t.hasMonthly}return!1})}}}),define("js/model/ParameterMixinLinkType",[],function(){return{getLinkType:function(){return this.getQuery().ltype},updateLinkType:function(e){this.getQuery().ltype=e},validateLinkType:function(e,t,n){var r=$.parseJSON(t.defaultSelection);this.checkVal(e,"ltype",r.ltype?r.ltype:n[0]["class"],function(e){var t=!1;return $.each(n,function(n,r){r["class"]==e&&(t=!0)}),t})}}}),define("js/model/ParameterMixinReport",["js/model/ConfigProxy"],function(e){return{getReportIndex:function(){return this.getData().reportIndex},updateReportIndex:function(){var t=this.facade.retrieveProxy(e.NAME),n=t.getReports();$.extend(this.getData(),{reportIndex:null});for(var r=0;r<n.length;r++){var i=$.parseJSON(n[r].json);if(this.getTopicId()==i.topic){var s=!0;for(var o in i.query)i.query[o]!=this.getQuery()[o]&&(s=!1);if(s){$.extend(this.getData(),{reportIndex:r});return}}}}}}),define("js/model/ParameterMixinRSE",[],function(){return{getShowRSE:function(){return this.getQuery().rse==="1"},validateShowRSE:function(e,t){this.checkVal(e,"rse","0",function(e){return e==="0"||e==="1"})}}}),define("js/model/ParameterMixinStartEnd",[],function(){return{getStart:function(){return this.getQuery().start},getEnd:function(){return this.getQuery().end},resetStartEnd:function(){var e=this.getQuery();delete e.start,delete e.end},validateStartEnd:function(e,t){var n,r;switch(e.freq){case"A":n=t.annualStart,r=t.annualEnd;break;case"Q":n=t.quarterlyStart,r=t.quarterlyEnd;break;case"M":n=t.monthlyStart,r=t.monthlyEnd}this.checkVal(e,"start",n,function(e){return e>=n&&e<r}),e.start=parseInt(e.start),this.checkVal(e,"end",r,function(t){return t>e.start&&t<=r}),e.end=parseInt(e.end)}}}),define("js/model/ParameterMixinTopic",[],function(){return{getTopicId:function(){return this.getData().topicId},updateTopicId:function(e){$.extend(this.getData(),{topicId:e})},getFullTopicPath:function(e,t){return"topic/"+(t!==void 0?t:this.getTopicId())+this.getQueryString(e)}}}),define("js/model/ParameterMixinStateBasinType",[],function(){return{getRegionType:function(){return this.getQuery().rtype},validateRegionType:function(e,t){var n=$.parseJSON(t.defaultSelection),r=this.hasStateBasinFilterGroup(t);this.checkVal(e,"rtype","s",function(e){switch(e){case"s":return!0;case"b":return r?!0:!1}return!1})},hasStateBasinFilterGroup:function(e){for(var t=0;t<e.aggColumns.length;t++)if(e.aggColumns[t].filterGroup.filterGroupId==13)return!0;return!1}}}),define("js/model/AggregateDataParameterProxy",["js/Facade","js/model/ConfigProxy","js/model/ParameterProxy","js/model/RequestProxy","js/model/ParameterMixinAggColumn","js/model/ParameterMixinChart","js/model/ParameterMixinFrequency","js/model/ParameterMixinLinkType","js/model/ParameterMixinReport","js/model/ParameterMixinRSE","js/model/ParameterMixinStartEnd","js/model/ParameterMixinTopic","js/model/ParameterMixinStateBasinType"],function(e,t,n,r,s,o,u,a,f,l,c,h,p){return n.$extend({__include__:[h,f,u,s,c,o,l,a,p],getQueryKeys:function(){var e=this.facade.retrieveProxy(t.NAME),n=e.getTopic(this.getTopicId()),r=["agg"],i;for(i=0;i<n.aggColumns.length;i++)r.push(n.aggColumns[i].filterGroup.varName);return $.each(e.getVisualizations(),function(e,t){r.push(t["class"])}),r.concat(["freq","start","end","chartindexed","ctype","ltype","columnendpoints","columnvalues","rtype"])},getFullPath:function(e,t){return this.getFullTopicPath(e,t)},getTableParamsString:function(){var e=this.facade.retrieveProxy(t.NAME),n=e.getTopic(this.getTopicId()),r="topic="+this.getTopicId()+"&agg="+this.getAgg(),s;for(i=0;i<n.aggColumns.length;i++)s=n.aggColumns[i].filterGroup.varName,typeof this.getQuery()[s]!="undefined"&&(r+="&"+s+"="+this.getQuery()[s]);return r+="&ids="+this.getCharted("pin"),r+="&freq="+this.getFreq(),r+="&rtype="+this.getRegionType(),r},getTableParams:function(){return $.extend({topic:this.getTopicId(),freq:this.getFreq(),agg:this.getAgg(),ids:this.getCharted("pin"),rtype:this.getRegionType()},this.getAggColumnParams())},getFormParams:function(){return $.extend({topic:this.getTopicId(),agg:this.getAgg()},this.getAggColumnParams())},getChartParams:function(){var e=this,n=this.facade.retrieveProxy(t.NAME),r={chartindexed:this.getChartIndexed(),ctype:this.getChartType(),columnendpoints:this.getColumnEndpoints(),columnvalues:this.getColumnValues()};return $.each(n.getVisualizations(),function(t,n){r[n["class"]]=e.getChartedByType(n["class"])}),$.extend(r,this.getTimeParams())},getTimeParams:function(){return{start:this.getStart(),end:this.getEnd(),freq:this.getFreq()}},getGAString:function(e,t){var n=$.extend({},this.getQuery(),e),r="topic/"+(t?t:this.getTopicId())+"/?"+(n.agg?"agg="+n.agg:"")+(n.freq?"&freq="+n.freq:"");return $.each(this.getAggColumnParams(),function(e,t){r+="&"+e+"="+n[e]}),r},getGAStringByTopic:function(e,t){return this.getGAString(e,t)},update:function(){var n=this.facade.retrieveProxy(r.NAME),i=this.facade.retrieveProxy(t.NAME),s=n.getTopicId(),o=i.getTopic(s),u=s!==this.getTopicId(),a=!1,f=!("ctype"in n.getQuery()),l=!("ctype"in n.getQuery()),c=!1,h=!1,p=!1,d=!1,v=!("rtype"in n.getQuery()),m=this;p|=s!=this.getTopicId(),this.updateTopicId(s),this.updateQuery(n.getQuery(),function(e,t,n){var r,s;a|=e=="start"||e=="end"||e=="freq",u|=e=="freq",u|=e=="agg",$.each(i.getVisualizations(),function(t,n){f|=e==n["class"]}),u|=e=="pin",f|=l|=e=="ctype",f|=e=="chartindexed",f|=e=="columnendpoints",f|=e=="columnvalues",c|=e=="maptype",v|=e=="rtype";for(r=0;r<o.aggColumns.length&&!u;r++)s=e==o["aggColumns"][r]["filterGroup"]["varName"],u|=s;h|=e=="rse",d|=e=="ltype"}),this.updateReportIndex(),this.updateChartIdFrequencies(this.getFreq()),p&&this.sendNotification(e.TOPIC_PARAMS_UPDATED),u&&this.sendNotification(e.TABLE_PARAMS_UPDATED),l&&(this.getChartType()!="pin"&&this.getChartType()!="sourcekey"&&this.sendNotification(e.UPDATE_VISUALIZATION_VIEW_STACK),this.sendNotification(e.CTYPE_PARAM_UPDATED)),c&&this.sendNotification(e.MAP_TYPE_PARAM_UPDATED),f&&this.sendNotification(e.CHART_PARAMS_UPDATED),a&&this.sendNotification(e.TIME_PARAMS_UPDATED),h&&this.sendNotification(e.RSE_PARAM_UPDATED),d&&this.sendNotification(e.PIN_KEY_PARAM_UPDATED),v&&this.sendNotification(e.REGION_TYPE_PARAM_UPDATED)},validateQuery:function(e){var n=this.facade.retrieveProxy(t.NAME),r=n.getTopic(this.getTopicId());this.validateFrequency(e,r),this.validateAggColumns(e,r),this.validateStartEnd(e,r),this.validateChartParams(e,r,n.getVisualizations()),this.validateShowRSE(e,r),this.validateLinkType(e,r,n.getLinkTypes()),this.validateRegionType(e,r)}})}),define("js/model/TableDataMixinAnalysis",[],function(){return{getRelatedAnalysis:function(){return this.getData().ANALYSIS.ARTICLES},getMoreAnalysisURL:function(){return this.getData().ANALYSIS.MORE_URL}}}),define("js/model/TableDataMixinChart",["js/Facade","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,n){return{getIDMap:function(){return this.getData().IDMAP},getChartData:function(e){return e!==void 0?this.getData().chartData[e]:this.getData().chartData},updateChartData:function(){var t=this.facade.retrieveProxy(n.NAME),r=t.getChartType(),i=this.processChartData(r,!0);r!="pin"?this.sendNotification(e.CHART_DATA_UPDATED,i):this.updatePinnedSeries()},createIDMap:function(){var e=this.getCombinedData(),t={};for(var n=0;n<e.length;n++){var r=e[n].SERIES_ID;t[r]||(t[r]=[]),t[r].push(n)}return this.getData().IDMAP=t,t},updatePinnedSeries:function(){var r=this.facade.retrieveProxy(n.NAME),i=this.facade.retrieveProxy(t.NAME),s=i.getVisualizations(),o=r.getTableParamsString(),u=this.getChartData(),a={},f=u.pin,l=this.getSeriesData().slice(),c=l.length-1,h=this.getIDMap(),p={},d={},v=!1,m,g,y,b;if(this.inCache(o))this.setDataFromCache(o);else{for(y=0;y<l.length;y++){var w=l[y];d[w.SERIES_ID]=!0}for(y=0;y<f.length;y++){var w=f[y];w.SERIES_ID in d||l.push($.extend({PINNED:!0},w,{LEVEL:0})),p[w.SERIES_ID]=!0}for(y=0;y<l.length;y++){var w=l[y];w.SERIES_ID in p||l.splice(y,1)}this.setData(o,$.extend({},this.getData(),{SERIESDATA:{DATA:l}}))}var h=this.createIDMap();for(y=0;y<s.length;y++){v=!1,g=s[y]["class"];if(g!=="pin"&&g!="sourcekey"){var E=u[g];for(b=0;b<E.length;b++){w=E[b];if(!(w.SERIES_ID in h)){E.splice(b,1);var v=!0}}v&&(this.sendNotification(e.DEFAULT_CHART_SET,$.map(E,function(e){return e.SERIES_ID}),g),this.processChartData(g))}}this.sendNotification(e.TABLEDATA_UPDATED)},processChartData:function(r,i){var s=this.facade.retrieveProxy(n.NAME),o=this.facade.retrieveProxy(t.NAME),u=[],a=[],f=this.getCombinedData(),l=this.getTableData(),c=this.getIDMap(),h,p,d,v,m,g,y,b,w=r!==void 0?[r]:$.map(o.getVisualizations(),function(e){return e["class"]});for(var d=0;d<w.length;d++){a=[],r=w[d];var E=s.getChartedIds(r),S=E.slice(),x=this.getChartData(r)||[];if(S.length>0)for(h=0;h<S.length;h++){var T=!1,N;r=="map"?N=this.getMappedSeries(S[h],c):N=c[S[h]];if(N)for(p=0;p<N.length;p++){m=f[N[p]];if(m.HAS_DATA){m[r]=!0,u.push(N[p]);if(!T){T=!0,a.push(m);var C=$.inArray(m,x);C>=0&&x.splice(C,1)}}}else S[h]==null?a.push(null):E.splice(h,1)}if(E.length<1&&r!="pin"&&r!="sourcekey"){if(!i||r=="map"){var k=o.getTopic(s.getTopicId()),L=s.getQuery(),A=$.parseJSON(k.defaultSelection),O=!0;$.each(A.query,function(e,t){L[e]!=t&&(O=!1)});if(O&&A[r])for(p=0;p<A[r].length;p++)for(h=0;h<l.length;h++){m=l[h];if(m.SERIES_ID.substr(0,m.SERIES_ID.length-1)==A[r][p].substr(0,A[r][p].length-1)){m[r]=!0,a.push(m),E.push(m.SERIES_ID),u=u.concat(c[m.SERIES_ID]);break}}else for(h=0,p=0;h<l.length&&p<1;p++){m=null;for(h;h<l.length&&(!m||!m.HAS_DATA);m=l[h++]);m[r]=!0,a.push(m),E.push(m.SERIES_ID),u=u.concat(c[m.SERIES_ID])}if(r=="map"&&E.length==1){var N=this.getMappedSeries(E[0],c);$.each(N,function(e,t){var n=f[t];n[r]=!0})}}this.sendNotification(e.DEFAULT_CHART_SET,E,r)}for(h=0;h<x.length;h++){m=x[h];if(m!=null&&!~$.inArray(m.SERIES_ID,E)){var N=[];r=="map"?N=this.getMappedSeries(m.SERIES_ID,c):N=c[m.SERIES_ID];for(var p=0;p<N.length;p++){m=f[N[p]];if(m.HAS_DATA){if(r!="pin"||!m.PINNED)m[r]=!1;u.push(N[p])}}}}for(h=0;h<f.length;h++){m=f[h];if(!m.HAS_DATA&&m.LEVEL_GROUPS){y=this.getChildData(h),b=y.length>0;for(p=0;p<y.length;p++)b&=y[p][r];m[r]!=b&&u.push(h),m[r]=b}}this.getData().chartData[r]=a}return u},getMappedSeries:function(e,r){var i=this.facade.retrieveProxy(n.NAME),s=this.facade.retrieveProxy(t.NAME),o=s.getTopic(i.getTopicId()),u=[],a=e.split("."),f=a[2].split("-");$.each(o.aggColumns,function(e,t){if(t.filterGroup.varName=="geo")return f[e]="[A-Za-z]+",!1}),a[2]=f.join("\\-");var l=new RegExp(a.join("\\."));return $.each(r,function(e,t){e.match(l)&&(u=u.concat(t))}),u}}}),define("js/model/TableDataMixinLevel",[],function(){return{processLevels:function(){var e=this.getTableData(),t=[],n=[],r,i,s,o,u;for(r=e.length-1;r>=0;r--){u=e[r],u.LEVEL_GROUPS=[],o=u.LEVEL;for(i=t.slice(0).length-1;i>o;i--)t.pop();for(s=o;s>0;s--)t[s]===void 0?s==o&&(u.IS_LAST=!0,u.LEVEL_GROUPS[s]=t[s]=n[s]!==void 0?++n[s]:n[s]=0):u.LEVEL_GROUPS[s]=t[s]}}}}),define("js/model/AggregateDataTableDataProxy",["js/Facade","js/model/ConfigProxy","js/model/ParameterProxy","js/model/TableDataProxy","js/model/TableDataMixinAnalysis","js/model/TableDataMixinChart","js/model/TableDataMixinLevel"],function(e,t,n,r,s,o,u){return r.$extend({isUpdating:!1,__include__:[u,o,s],getDataColumns:function(){return this.getData().TABLEDATA.DATACOLUMNS},getMinColumn:function(){return this.getDataColumns[0]},getMaxColumn:function(){return this.getDataColumns()[this.getDataColumns().length-1]},getTableData:function(){return this.getData().TABLEDATA.ROWS},getSeriesData:function(){return this.getData().SERIESDATA.DATA},getCombinedData:function(){var e=[],t=this.getSeriesData(),n=this.getTableTitle(),r=this.getTableData(),i=this.getTableUnits();t.length>0&&e.push({DESCRIPTION:"Pinned series",ACTION:this.$class.CLEAR}),e=e.concat(t);var s={DESCRIPTION:n,SHOW_UNITS:i!==null,UNITS:i};return e.length==0&&(s.ACTION=this.$class.CLEAR),e.push(s),e=e.concat(r),e},getTableUnits:function(){return this.getData().TABLEDATA.UNITS===""?null:this.getData().TABLEDATA.UNITS},getTableTitle:function(){return this.getData().TABLEDATA.DESCRIPTION},getChildRows:function(e){var t=[],n=this.getCombinedData();for(var r=e+1;r<n.length&&n[r].LEVEL>n[e].LEVEL;r++)n[r].HAS_DATA&&t.push(r);return t},getChildData:function(e){var t=this.getChildRows(e),n=this.getCombinedData(),r=[];for(i=0;i<t.length;i++)r.push(n[t[i]]);return r},loadTableData:function(){var r=this.facade.retrieveProxy(n.NAME),i=r.getTableParamsString(),s=this.facade.retrieveProxy(t.NAME),o=this;this.isUpdating=!0,this.inCache(i)?(this.setDataFromCache(i),this.processChartData(),this.createIDMap(),this.isUpdating=!1,this.sendNotification(e.TABLEDATA_UPDATED)):$.ajax(encodeURI(this.$class.PROXY_URL+"?method="+this.$class.PROXY_METHOD+"&"+i),{dataType:"json",error:function(){o.sendNotification(e.ERROR)},success:function(t){$.each(t.TABLEDATA.ROWS.concat(t.SERIESDATA.DATA),function(){this.filterQuery=s.getFilterQuery(r.getTopicId(),this.SERIES_ID),this.agg=r.getAgg()}),t.TABLEDATA.ROWS=$.extend(t.TABLEDATA.ROWS,{getRowMetadata:o.$class.getRowMetadata}),t.chartData={},o.setData(i,t),o.createIDMap(),o.processLevels(),o.processChartData("linechart"),o.processChartData("columnchart"),o.processChartData("map"),o.processChartData("pin"),o.isUpdating=!1,o.sendNotification(e.TABLEDATA_UPDATED)}})},__classvars__:{PROXY_URL:"dataService/dataService.cfc",PROXY_METHOD:"getAggregateData",CLEAR:"clear"}})}),function(){function e(e){var t=e.currentTarget||e.srcElement,n;if(e.type==="load"||s.test(t.readyState)){e=t.getAttribute("data-requiremodule"),u[e]=!0;for(e=0;n=o[e];e++){if(!u[n.name])break;n.req([n.name],n.onLoad)}e>0&&o.splice(0,e),setTimeout(function(){t.parentNode.removeChild(t)},15)}}function t(e){var t,n;e.setAttribute("data-orderloaded","loaded");for(e=0;n=f[e];e++){if(!(t=a[n])||t.getAttribute("data-orderloaded")!=="loaded")break;delete a[n],require.addScriptToDom(t)}e>0&&f.splice(0,e)}var n=typeof document!="undefined"&&typeof window!="undefined"&&document.createElement("script"),r=n&&(n.async||window.opera&&Object.prototype.toString.call(window.opera)==="[object Opera]"||"MozAppearance"in document.documentElement.style),i=n&&n.readyState==="uninitialized",s=/^(complete|loaded)$/,o=[],u={},a={},f=[],n=null;define("order",{version:"1.0.5",load:function(n,s,u,l){var c;s.nameToUrl?(c=s.nameToUrl(n,null),require.s.skipAsync[c]=!0,r||l.isBuild?s([n],u):i?(l=require.s.contexts._,!l.urlFetched[c]&&!l.loaded[n]&&(l.urlFetched[c]=!0,require.resourcesReady(!1),l.scriptCount+=1,c=require.attach(c,l,n,null,null,t),a[n]=c,f.push(n)),s([n],u)):s.specified(n)?s([n],u):(o.push({name:n,req:s,onLoad:u}),require.attach(c,null,n,e,"script/cache"))):s([n],u)}})}(),!function(e){e("datagrid",["signals","classy","order!dragevent","order!mousewheel","order!slickcore","order!slickgrid","order!slickdataview"],function(e,t){return t.$extend({__init__:function(t){var n=this;this.isFiltered=!1,this.slickgrid=null,this.container=t.empty(),this.innerGridContainer=$(this.$class.innerSlickGridHTML).appendTo(this.container),this.vSlider=null,this.hSliderTop=null,this.hSliderBottom=null,this.filteredColumns=[],this.columns=[],this.data=[],this.options={},this.onClick=new e.Signal,this.onColumnOrderChanged=new e.Signal,this.onHeaderClick=new e.Signal,this.onHeaderCellRendered=new e.Signal,this.onViewRowCountChanged=function(e,t){n.slickgrid.updateRowCount(),n.slickgrid.render()},this.onViewRowsChanged=function(e,t){n.slickgrid.invalidateRows(t.rows),n.slickgrid.render()}},update:function(e,t,n,r,i){var s=this,o=r!==void 0&&i!==void 0,u;t=typeof t=="undefined"?this.columns:t,n=typeof n=="undefined"?this.options:n,this.slickgrid?(this.setData(e),this.setColumns(t,!0),this.setOptions(n),o?this.filterNumericColumns(r,i):this.slickgrid.setColumns(t),this.resetHSliders(),this.checkScroll()):(this.setData(e),this.setColumns(t),this.setOptions(n),o?u=this.filterNumericColumns(r,i):u=this.filterHiddenColumns(this.options.addSpacerColumn?this.columns.concat([this.$class.spacerColumnOps]):this.columns),this.slickgrid=new Slick.Grid(this.innerGridContainer,this.data,u,this.options),this.slickgrid.onClick.subscribe(function(e,t){s.onClick.dispatch(t.row,t.cell,s.slickgrid.getDataItem(t.row),e)}),this.slickgrid.onSort.subscribe(function(e,t){s.data.sort(function(e,n){var r=t.sortCol.field,i=t.sortAsc?1:-1,s=e[r],o=n[r],u=(s==o?0:s>o?1:-1)*i;return u=typeof s=="undefined"||typeof s=="string"&&s==""?1:typeof o=="undefined"||typeof o=="string"&&o==""?-1:u,u!=0?u:0}),s.slickgrid.invalidate(),s.slickgrid.render()}),this.slickgrid.onColumnsReordered.subscribe(function(e,t){s.resetHSliders(),s.checkScroll(),s.onColumnOrderChanged.dispatch(e,t)}),this.slickgrid.onColumnsResized.subscribe(function(e,t){s.resetHSliders(),s.checkScroll()}),this.slickgrid.onHeaderClick.subscribe(function(e,t){s.onHeaderClick.dispatch(e,t)}),this.slickgrid.onHeaderCellRendered.subscribe(function(e,t){s.onHeaderCellRendered.dispatch(e,t)}),this.checkScroll(),this.options.scrollToRight&&this.scrollToRight())},outputToArrOfArrs:function(e){e=e!==void 0?e:!0;var t=e&&this.isFiltered?this.filteredColumns:this.columns,n=[],r,i,s,o,u,a,f,l,c;n.push(o=[]);for(r=0;r<t.length;r++)u=t[r],a=u.output!==void 0?u.output:!0,a&&o.push('"'+(typeof u.name!="undefined"?u.name:u.id)+'"');for(r=0;r<(this.data.getLength?this.data.getLength():this.data.length);r++){s=this.data.getItem?this.data.getItem(r):this.data[r],n.push(o=[]);for(i=0;i<t.length;i++)u=t[i],a=u.output!==void 0?u.output:!0,a&&(f=[r,i,u&&typeof this.options.dataItemColumnValueExtractor=="function"?this.options.dataItemColumnValueExtractor(s,u):s[u.field],u,s],l=u.outputFormatter?u.outputFormatter.apply(this,f):u.dataFormatter?u.dataFormatter.apply(this,f):f[2]||"",l&&(c=l?l.toString().replace(/,/g,""):NaN),o.push(isNaN(c)?'"'+(l?l:"")+'"':c))}return n},processColumns:function(e){var t,n;for(t=0;t<e.length;t++)n=e[t],n.formatter=this.$class.defaultFormatter;return e},filterHiddenColumns:function(e){return $.map(e,function(e){return e.display===!1?null:e})},checkScroll:function(){var e=this,t=$(".slick-viewport",this.container),n=$(".slick-pane",this.container),r,i,s,o;this.options.frozenColumn>=0?(i=t.filter(".slick-viewport-top.slick-viewport-right"),r=n.filter(".slick-pane-top.slick-pane-right")):(i=t.filter(".slick-viewport-top.slick-viewport-left"),r=n.filter(".slick-pane-top.slick-pane-left")),(s=function(){this.vSlider?this.vSlider.css("height",i.height()-30):(this.vSlider=$("<div/>").appendTo(this.container).css({position:"relative","float":"left",height:i.height()-30,marginTop:20,marginBottom:10,marginLeft:10}).slider({orientation:"vertical",min:0,max:100,value:100,slide:function(e,t){(function(){this.scrollTop=(this.scrollHeight-this.offsetHeight)*((100-t.value)/100)}).call(i.get(0))}}),i.scroll(function(){e.vSlider.slider("value",100-100*this.scrollTop/(this.scrollHeight-this.offsetHeight))}),this.innerGridContainer.width(this.container.width()-this.vSlider.width()-20).css("float","left"),this.slickgrid.resizeCanvas()),i.get(0).scrollHeight>i.height()?this.vSlider.slider("option","disabled",!1):this.vSlider.slider("option","disabled",!0)}).call(this),(o=function(){var e=this,t,o,u;!this.hSliderTop&&!this.hSliderBottom?(t=n.find(".slick-header").eq(0),u=t.position(),o=r.position(),this.hSliderTop=$("<div/>").appendTo(this.container).css({position:"absolute",top:u.top+t.height()-13,left:o.left,width:i.width()-28,marginRight:30}).slider({min:0,max:100,value:0,slide:function(t,n){(function(){this.scrollLeft=(this.scrollWidth-this.offsetWidth)*(n.value/100),e.hSliderBottom.slider("value",n.value)}).call(i.get(0))}}).addClass("hSliderTop"),this.hSliderBottom=$("<div/>").appendTo(this.container).css({position:"absolute",bottom:0,left:o.left,width:i.width()-28,marginRight:30}).slider({min:0,max:100,value:0,slide:function(t,n){(function(){this.scrollLeft=(this.scrollWidth-this.offsetWidth)*(n.value/100),e.hSliderTop.slider("value",n.value)}).call(i.get(0))}}).addClass("hSliderBottom"),i.scroll(function(){e.hSliderTop.slider("value",100*this.scrollLeft/(this.scrollWidth-this.offsetWidth)),e.hSliderBottom.slider("value",100*this.scrollLeft/(this.scrollWidth-this.offsetWidth))}),this.innerGridContainer.height(this.container.height()-this.hSliderBottom.height()-20),s.call(this)):(this.hSliderTop.css("width",i.width()-28),this.hSliderBottom.css("width",i.width()-28)),i.get(0).scrollWidth>i.width()?(this.hSliderBottom.slider("option","disabled",!1),this.hSliderTop.slider("option","disabled",!1),i.scroll()):(i.scroll(),this.hSliderBottom.slider("option","disabled",!0),this.hSliderTop.slider("option","disabled",!0),this.slickgrid.autosizeColumns())}).call(this)},scrollToRight:function(){var e=$(".slick-viewport",this.container),t;this.options.frozenColumn>=0?t=e.filter(".slick-viewport-top.slick-viewport-right"):t=e.filter(".slick-viewport-top.slick-viewport-left"),t.get(0).scrollLeft=t.get(0).scrollWidth},filterNumericColumns:function(e,t){var n,r;this.filteredColumns=[];for(n=0;n<this.columns.length;n++)r=this.columns[n],isNaN(r.id)?this.filteredColumns.push(r):r.id>=e&&r.id<=t&&this.filteredColumns.push(r);var i=this.filterHiddenColumns(this.options.addSpacerColumn?this.filteredColumns.concat([this.$class.spacerColumnOps]):this.filteredColumns);return this.slickgrid&&(this.slickgrid.setColumns(i),this.isFiltered=!0,this.resetHSliders(),this.checkScroll(),this.options.scrollToRight&&this.scrollToRight()),i},setColumns:function(e,t){this.columns=this.processColumns(e),this.isFiltered=!1,this.slickgrid&&!t&&(this.slickgrid.setColumns(this.filterHiddenColumns(this.options.addSpacerColumn?this.columns.concat([this.$class.spacerColumnOps]):this.columns)),this.resetHSliders(),this.checkScroll(),this.options.scrollToRight&&this.scrollToRight())},setData:function(e){this.data=e,this.slickgrid&&(this.slickgrid.setData(e),this.resetHSliders(),this.checkScroll())},setOptions:function(e){this.options=$.extend(!0,{},this.$class.defaultOptions,e),this.slickgrid&&this.slickgrid.setOptions(this.options)},redraw:function(e){e?this.slickgrid.invalidateRows(e):this.slickgrid.invalidateAllRows(),this.slickgrid.render()},resetHSliders:function(){this.hSliderBottom.remove(),this.hSliderTop.remove(),this.hSliderBottom=this.hSliderTop=null},destroy:function(){this.slickgrid&&this.slickgrid.destroy()},__classvars__:{defaultOptions:{enableCellNavigation:!1,enableColumnReorder:!1},spacerColumnOps:{id:"spacer",name:" ",autoWidth:!0},innerSlickGridHTML:'<div class="inner-slickgrid-container"></div>',defaultFormatter:function(e,t,n,r,i){var s=r.dataFormatter?r.dataFormatter.apply(this,arguments):n,o=r.displayFormatter?r.displayFormatter.call(this,e,t,s,r,i):s;return o},autosizeColumn:function(e,t,n,r){var i=$("<div/>").addClass("slick-cell").addClass("ui-widget").css({width:"auto",position:"absolute",top:1e3,left:0}).appendTo("body"),s=e[t],o=0,u,a,f,l;for(u=0;u<(n.getLength?n.getLength():n.length);u++)a=n.getItem?n.getItem(u):n[u],f=a[s.field],i.html(s.formatter?s.formatter(u,t,f,s,a):s.displayFormatter?s.displayFormatter(u,t,f,s,a):s.dataFormatter?s.dataFormatter(u,t,f,s,a):f),o=Math.max(o,i.outerWidth());l=o+(r!=void 0?r:0),i.remove(),s.width=s.maxWidth!==void 0?Math.min(l,s.maxWidth):l},linkSelectorFunction:function(e,t,n){var r={},i=$(e),s=i.offset(),o=$(),u=0,a,f,l,c;return r[e]||(r[e]=$(".slick-row",i).get(),r[e].sort(function(e,t){var n=$(e).offset().top,r=$(t).offset().top;return n<r?-1:n>r?1:0})),$.each(r[e],function(e,r){l=$(r);var i=l.offset();return i.top>s.top?(c=$(t,l),c.each(function(t,r){o=$(r);var i=o.offset();if(i.left>s.left){a===void 0&&(a=Math.min(n,c.length-e));if(u==a)return!1;u++}}),!1):!0}),o}}})})}(typeof define=="function"&&typeof define.amd=="object"?define:function(e,t){var n;for(n=0;n<e.length;n++)e[n]=this[e[n]];this.datagrid=t.apply(this,e)}),define("js/view/HelpTooltipsEDB",["datagrid"],function(e){return function(){return[{selector:"#help_button",tip:'<iframe width="230" height="200" src="http://www.youtube.com/embed/gQ70w2KDbPI?rel=0" frameborder="0" allowfullscreen=""></iframe>Play the short video to learn how to use this tool.  Click anywhere else to close these help tips.',position:"topMiddle"},{selector:"#top_topic_selection_container",tip:'This is the top level selector for the <b>Electricty Data Browser</b>.  Choose a report, which correspond to the chapters in the <a href="/electricity/monthly/">Electric Power Monthly</a>, to automatically select a dataset and configure the filter.  Alternatively, you can select a dataset directly but then you must configure the filter.  It may be helpful to use the reports as a starting point and then modify them using the FILTER/ORDER control below.',position:"leftMiddle"},{selector:"#middle_topic_selection_container",tip:'This is the top level selector for the <b>Electricty Data Browser</b>.  Choose a report, which correspond to the chapters in the <a href="/electricity/monthly/">Electric Power Monthly</a>, to automatically select a dataset and configure the filter.  Alternatively, you can select a dataset directly but then you must configure the filter.  It may be helpful to use the reports as a starting point and then modify them using the FILTER/ORDER control below.',position:"leftTop",yAdjust:15},{selector:".slick-pane-left .slick-row:nth-child(1) .chart_column:nth-child(3)",tip:'Click on the<span class="ico linechart selected"></span><span class="ico columnchart selected"></span><span class="ico map selected"></span> icons to add and remove series from the results table to the graph. Use the toggle buttons above the table to change the action.',position:"rightMiddle",xAdjust:0,yAdjust:178},{selector:".slick-pane-left .slick-row:nth-child(1) .chart_column:nth-child(1)",tip:'Click the <span class="ico pin selected"></span> icon to "pin" the series for comparison across data sets. Click the<span class="ico sourcekey selected"></span> icon to open a link to the series in EIA\'s API. Use the toggle buttons above the table to change the action.',position:"leftMiddle",xAdjust:0,yAdjust:178},{selector:"#main_download_button",tip:'This menu provides options to download the table or graphic data in <span class="ico_csv">CSV</span> format, as well as an <span class="ico_img ico_pdf">image</span> or <span class="ico_pdf">PDF</span> of the graphic.',position:"rightMiddle"},{selector:"#main_filter_button",tip:"Once you have choosen a dataset, open the FILTER/ORDER tool.  Use the left and right arrows to select the prime filter.  The prime filter only allows a single selection, creating manageable results set.  You will find that you can quickly get, visualize and download the electricity information you need by carefully choosing the category order and the filters.",position:"leftBottom",yAdjust:-15},{selector:"#main_visualization_button",tip:'Use this menu to change the action associated with the icons in the table. The<span class="ico linechart selected"></span>time-series chart,<span class="ico columnchart selected"></span>column chart, and<span class="ico map selected"></span>map selections change the type of graphic displayed above.',position:"bottomRight",xAdjust:-100},{selector:"#pinkey_container",tip:'Use this menu to change the action associated with the icons in the table. The<span class="ico sourcekey selected"></span>API icon provides a link to EIA\'s API for each series. The<span class="ico pin selected"></span>pin series icon allows you to preserve a series for comparison across data sets.',position:"bottomRight"},{selector:"#main_analysis_button",tip:"Click here to display analysis and links related to the current data being shown.",position:"topMiddle"},{selector:"#rse_checkbox",tip:"This checkbox enables the display of Relative Standard Error (RSE) values. These are shown as a percent value in parentheses next to the data values in the table above.",position:"rightMiddle"},{selector:"#termsLink",tip:"Click this link to see any notes and definitions of terms.",position:"topMiddle"},{selector:"#map #controls_container",tip:"The map controls allow you to switch between coloring the states based on the current period value or the percent change from the previous period. You can also play the map over time or scroll to a specific period.",position:"rightMiddle"},{selector:".chartIndexing:visible",tip:"These controls change the charting options. For time-series charts, you may index the chart to the first point by value or percent. For column charts, you may change between values and percent change, and change which data points are graphed.",position:"rightTop",yAdjust:20},{selector:".slick-viewport.slick-viewport-top.slick-viewport-right:has(.link_cell)",tip:"When possible, individual data points will be hyperlinks for drilling down to the electric plants that comprise that data point.",position:"center",yAdjust:100},{selector:".slick-viewport.slick-viewport-top.slick-viewport-left:has(.link_cell)",tip:"Click these links to see data for a particular plant.",position:"rightMiddle",yAdjust:-200,xAdjust:-800},{selector:".slick-viewport.slick-viewport-top.slick-viewport-left:has(.description.aggregate)",tip:"The categories displayed and the hierarchy can be change via the FILTER/ORDER control to the upper left of this table.",position:"center",yAdjust:-100},{selector:".aggregate .clickable-regions #mapContainer",tip:"When possible, click an individual state to drill down to the electric plants that comprise the data point for that state.",position:"center"},{selector:".plantList #mapContainer",tip:"When possible, click an individual state to see a map of that state with location markers for the queried power plants. Click on a power plant marker to see the data for it.",position:"center"}]}}),define("js/model/HelpTooltipProxy",["puremvc","js/view/HelpTooltipsEDB"],function(e,t){return e.Proxy.$extend({__init__:function(){this.$super(this.$class.NAME,t)},getHelpTooltips:function(){return this.getData()()},__classvars__:{NAME:"HelpTooltipProxy"}})}),define("js/model/MapDataProxy",["js/Facade","js/model/DataProxy","js/model/ParameterProxy","js/model/ConfigProxy"],function(e,t,n,r){return t.$extend({__init__:function(){this.hasData=!1,this.$super(this.$class.NAME)},updateMapData:function(t){var i=this;if(t&&typeof t!="undefined"){var s=t.GEOSET_ID,o="",u=t.UNITS,a=t.PRECISION,f=this.facade.retrieveProxy(n.NAME),l=this.facade.retrieveProxy(r.NAME),c=f.getFreq(),h=f.getTopicId(),p=s+"_"+c;s&&(p in this.cache?(this.data=this.cache[p],this.hasData=!0,this.sendNotification(e.MAP_DATA_UPDATED)):$.getJSON("dataservice/dataService.cfc",{method:"getMapData",geosetId:s,freq:c,topic:h},function(t){o=t.TITLE;for(var n in t.DATA)if(t.DATA.hasOwnProperty(n)){var r=t.DATA[n];for(var s in r)r.hasOwnProperty(s)&&isNaN(r[s])&&delete r[s]}if(f.hasStateBasinFilterGroup(l.getTopic(h)))for(var n in t.BASIN_DATA)if(t.BASIN_DATA.hasOwnProperty(n)){var r=t.BASIN_DATA[n];for(var s in r)r.hasOwnProperty(s)&&isNaN(r[s])&&delete r[s]}i.data=i.cache[p]=$.extend(t,{TITLE:o,UNITS:u,PRECISION:a}),i.hasData=!0,i.sendNotification(e.MAP_DATA_UPDATED)}))}},__classvars__:{NAME:"MapDataProxy"}})}),define("js/view/MediatorTopicSelection",["puremvc","js/Facade","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,n,r){return e.Mediator.$extend({__init__:function(e,t){this.$super(this.$class.NAME+(t?"_TOP":"_BOTTOM"),e)},onRegister:function(){var e=this;this.getViewComponent().topicSelectionChanged.add(function(n){e.sendNotification(t.TOPIC_SELECTION_UPDATED,{topic:n},"TopicChanged")}),this.getViewComponent().reportSelectionChanged.add(function(n){e.sendNotification(t.REPORT_SELECTION_UPDATED,n,"ReportChanged")})},listNotificationInterests:function(){return this.$super().concat([t.TABLE_PARAMS_UPDATED])},handleNotification:function(e){var i=this.facade.retrieveProxy(r.NAME),s=this.facade.retrieveProxy(n.NAME);switch(e.getName()){case t.TABLE_PARAMS_UPDATED:this.getViewComponent().create(i.getTopicId(),i.getReportIndex(),s.getTopics(),s.getReports());break;default:this.$super(e)}},__classvars__:{NAME:"TopicSelectionMediator"}})}),define("js/view/MediatorElectricityTopicSelection",["puremvc","js/Facade","js/model/ConfigProxy","js/model/ParameterProxy","js/view/MediatorTopicSelection"],function(e,t,n,r,i){return i.$extend({arrangeTopics:function(e,t){var n=[{label:"Electricity generation & consumption (EIA-906/EIA-920/EIA-923)",topics:[]},{label:"Sales of electricity (EIA-826/EIA-861)",topics:[]},{label:"Fuel quality & receipts (EIA-423/EIA-923)",topics:[]}];return $.each(e,function(e,t){switch(t.dataTopicId){case 0:case 1:case 2:case 3:case 4:case 8:case 9:case 10:case 57:n[0].topics.push(t);break;case 5:case 6:case 7:case 56:n[1].topics.push(t);break;case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 43:n[2].topics.push(t);break;default:n.push(t)}}),{selectedTopic:t,topicGroups:n}},handleNotification:function(e){var i=this.facade.retrieveProxy(r.NAME),s=this.facade.retrieveProxy(n.NAME);switch(e.getName()){case t.TABLE_PARAMS_UPDATED:var o=this.arrangeTopics(s.getTopics(),i.getTopicId());this.getViewComponent().create(o.selectedTopic,i.getReportIndex(),o.topicGroups,s.getReports());break;default:this.$super(e)}}})}),define("js/view/MediatorForm",["puremvc","js/Facade","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,n,r){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().formSubmitted.add(function(n){e.getViewComponent().hideForm(),e.sendNotification(t.TABLE_SELECTION_UPDATED,n,"FormSubmitted")}),this.getViewComponent().formCanceled.add(function(t){e.getViewComponent().hideForm()}),this.getViewComponent().formButtonClicked.add(function(t){var i=e.facade.retrieveProxy(r.NAME),s=e.facade.retrieveProxy(n.NAME),o=$.extend(!0,{},s.getTopic(i.getTopicId())),u=i.getRegionType();for(var a=0;a<o.aggColumns.length;a++)if(o.aggColumns[a].filterGroup.filterGroupId==13)for(var f=0;f<o.aggColumns[a].filterGroup.filterValues.length;f++)(u=="b"&&o.aggColumns[a].filterGroup.filterValues[f].valueId<68||u=="s"&&o.aggColumns[a].filterGroup.filterValues[f].valueId>=68)&&o.aggColumns[a].filterGroup.filterValues[f].valueId!=0&&(o.aggColumns[a].filterGroup.filterValues.splice(f,1),f--);e.getViewComponent().showForm(o,i.getFormParams())})},listNotificationInterests:function(){return this.$super().concat([t.RELOAD,t.REGION_TYPE_PARAM_UPDATED])},handleNotification:function(e){var n=this.getViewComponent();switch(e.getName()){case t.RELOAD:n.hideForm();break;case t.REGION_TYPE_PARAM_UPDATED:n.opened&&n.formButtonClicked.dispatch();break;default:this.$super.handleNotification(e)}},__classvars__:{NAME:"FormMediator"}})}),define("js/view/MediatorDownload",["puremvc","js/Facade","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,n,r){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().downloadButtonClicked.add(function(t){var i=e.facade.retrieveProxy(r.NAME),s=e.facade.retrieveProxy(n.NAME);typeof s.getCurrentView=="function"?e.getViewComponent().showDownload(s.getDownloadParameters()[s.getCurrentView()]):e.getViewComponent().showDownload(s.getDownloadParameters())}),this.getViewComponent().downloadOptionClicked.add(function(n){e.getViewComponent().hideDownload(),e.sendNotification(t.DOWNLOAD_OPTION_SELECTED,n)})},__classvars__:{NAME:"DownloadMediator"}})}),define("js/view/MediatorVisualization",["puremvc","js/Facade","js/model/ParameterProxy"],function(e,t,n){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},listNotificationInterests:function(){return this.$super().concat([t.CHART_PARAMS_UPDATED])},handleNotification:function(e){var r=this.facade.retrieveProxy(n.NAME);switch(e.getName()){case t.CHART_PARAMS_UPDATED:this.getViewComponent().updateSelection(r.getChartType());break;default:this.$super(e)}},onRegister:function(){var e=this;this.getViewComponent().visualizationSelected.add(function(n){e.sendNotification(t.CHART_SELECTION_UPDATED,{ctype:n.newClass})})},__classvars__:{NAME:"VisualizationMediator"}})}),define("js/view/MediatorPinKeyVisualization",["puremvc","js/Facade","js/model/ParameterProxy"],function(e,t,n){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},listNotificationInterests:function(){return[t.PIN_KEY_PARAM_UPDATED]},handleNotification:function(e){var r=this.facade.retrieveProxy(n.NAME);switch(e.getName()){case t.PIN_KEY_PARAM_UPDATED:this.getViewComponent().updateSelection(r.getLinkType());break;default:this.$super(e)}},onRegister:function(){var e=this;this.getViewComponent().visualizationSelected.add(function(n){e.sendNotification(t.PIN_KEY_SELECTION_UPDATED,{ltype:n.newClass})})},__classvars__:{NAME:"PinKeyVisualizationMediator"}})}),define("js/view/MediatorViewStack",["puremvc","js/Facade","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,n,r){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this.facade.retrieveProxy(n.NAME);typeof e.setViews=="function"&&e.setViews(this.getViewComponent().viewNames)},listNotificationInterests:function(){return this.$super().concat([t.UPDATE_VISUALIZATION_VIEW_STACK])},handleNotification:function(e){var i=this.getViewComponent(),s=this.facade.retrieveProxy(r.NAME),o=this.facade.retrieveProxy(n.NAME);switch(e.getName()){case t.UPDATE_VISUALIZATION_VIEW_STACK:var u=s.getChartType();i.hasView(u)&&(typeof o.setCurrentView=="function"&&o.setCurrentView(u),i.setActiveView(u));break;default:this.$super(e)}},__classvars__:{NAME:"ViewStackMediator"}})}),define("js/view/MediatorLineChart",["puremvc","js/Facade","js/model/TableDataProxy","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,n,r,i){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().indexingChanged.add(function(n){e.sendNotification(t.CHART_SELECTION_UPDATED,{chartindexed:n})})},listNotificationInterests:function(){return this.$super().concat([t.TABLEDATA_UPDATED,t.CHART_DATA_UPDATED,t.TIME_PARAMS_UPDATED,t.UNLOAD,t.DOWNLOAD_OPTION_SELECTED])},handleNotification:function(e){var s=this.facade.retrieveProxy(n.NAME),o=this.facade.retrieveProxy(i.NAME),u=this.facade.retrieveProxy(r.NAME),a=o.getTimeParams(),f=o.getChartParams(),l=o.getChartType();switch(e.getName()){case t.TABLEDATA_UPDATED:case t.CHART_DATA_UPDATED:if(l=="linechart"||l=="pin"||l=="sourcekey")var c=o.arePinnedSeriesCharted("linechart");var h=o.isUserGenerated("linechart");this.getViewComponent().update((c?"Custom chart":s.getTableTitle())+", "+o.getFreqTitle().toLowerCase(),s.getChartData("linechart"),s.getDataColumns(),a.freq,f.chartindexed,a.start,a.end,c,h);break;case t.TIME_PARAMS_UPDATED:!s.isUpdating&&(l=="linechart"||l=="pin"||l=="sourcekey")&&this.getViewComponent().setStartEnd(a.start,a.end,a.freq);break;case t.UNLOAD:this.getViewComponent().destroy();break;case t.DOWNLOAD_OPTION_SELECTED:e.body.target=="linechart"&&(e.body.type=="embed"?this.getViewComponent().embed():this.getViewComponent().download(e.body.type));default:this.$super(e)}},__classvars__:{NAME:"ChartMediator"}})}),define("js/view/MediatorColumnChart",["puremvc","js/Facade","js/model/TableDataProxy","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,n,r,i){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().endpointSelectionChanged.add(function(n){e.sendNotification(t.CHART_SELECTION_UPDATED,{columnendpoints:n})}),this.getViewComponent().valuesSelectionChanged.add(function(n){e.sendNotification(t.CHART_SELECTION_UPDATED,{columnvalues:n})})},listNotificationInterests:function(){return this.$super().concat([t.TABLEDATA_UPDATED,t.CHART_DATA_UPDATED,t.TIME_PARAMS_UPDATED,t.UNLOAD,t.DOWNLOAD_OPTION_SELECTED])},handleNotification:function(e){var s=this.facade.retrieveProxy(n.NAME),o=this.facade.retrieveProxy(i.NAME),u=this.facade.retrieveProxy(r.NAME),a=o.getTimeParams(),f=o.getChartParams(),l=o.getChartType();switch(e.getName()){case t.TABLEDATA_UPDATED:case t.CHART_DATA_UPDATED:if(l=="columnchart"||l=="pin"||l=="sourcekey")var c=o.arePinnedSeriesCharted("columnchart");var h=o.isUserGenerated("columnchart");this.getViewComponent().update((c?"Custom Chart":s.getTableTitle())+", "+o.getFreqTitle(),s.getChartData("columnchart"),s.getDataColumns(),a.freq,a.start,a.end,f.columnendpoints,f.columnvalues,c,h);break;case t.TIME_PARAMS_UPDATED:!s.isUpdating&&(l=="columnchart"||l=="pin"||l=="sourcekey")&&this.getViewComponent().setStartEnd(a.start,a.end,a.freq);break;case t.UNLOAD:this.getViewComponent().destroy();break;case t.DOWNLOAD_OPTION_SELECTED:e.body.target=="columnchart"&&(e.body.type=="embed"?this.getViewComponent().embed():this.getViewComponent().download(e.body.type));default:this.$super(e)}},__classvars__:{NAME:"ColumnChartMediator"}})}),define("js/view/MediatorDualSliderTimeSelection",["puremvc","js/Facade","js/model/TableDataProxy","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,n,r,i){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().timeSelectionChanged.add(function(n,r){e.sendNotification(t.TIME_SELECTION_UPDATED,{start:n,end:r})}),this.getViewComponent().frequencySelectionChanged.add(function(n){e.sendNotification(t.FREQUENCY_SELECTION_UPDATED,{freq:n},"FrequencyChanged")})},listNotificationInterests:function(){return this.$super().concat([t.TIME_PARAMS_UPDATED,t.TABLEDATA_UPDATED])},handleNotification:function(e){var s=this.facade.retrieveProxy(i.NAME),o=this.facade.retrieveProxy(n.NAME),u=this.facade.retrieveProxy(r.NAME),a=s.getTimeParams(),f=u.getTopic(s.getTopicId()),l;switch(e.getName()){case t.TABLEDATA_UPDATED:l=o.getDataColumns(),this.getViewComponent().create(f,a.freq,l,a.start,a.end);break;case t.TIME_PARAMS_UPDATED:o.isUpdating||(l=o.getDataColumns(),this.getViewComponent().updateTimeSelection(a.freq,l,a.start,a.end));break;default:this.$super(e)}},__classvars__:{NAME:"TimeSelectionMediator"}})}),define("js/view/MediatorHelpTooltip",["puremvc","js/Facade","js/model/HelpTooltipProxy"],function(e,t,n){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},listNotificationInterests:function(){return this.$super().concat([t.UNLOAD])},onRegister:function(){var e=this;this.getViewComponent().helpButtonClicked.add(function(){var t=e.facade.retrieveProxy(n.NAME);e.getViewComponent().toggleHelpTooltips(t.getHelpTooltips())})},handleNotification:function(e){switch(e.getName()){case t.UNLOAD:this.getViewComponent().hideHelpTooltips();break;default:this.$super(e)}},onRemove:function(){this.$super(),this.getViewComponent().hideHelpTooltips()},__classvars__:{NAME:"HelpTooltipMediator"}})}),define("js/view/MediatorAnimatedMap",["puremvc","js/Facade","js/model/TableDataProxy","js/model/MapDataProxy","js/model/ConfigProxy","js/model/ParameterProxy","us-merc-en","coal-basin-merc-en"],function(e,t,n,r,i,s){return e.Mediator.$extend({__init__:function(e,t){this.$super(typeof t=="undefined"?this.$class.NAME:t,e)},onRegister:function(){var e=this;this.viewComponent.mapTypeChangeRequested.add(function(n){e.sendNotification(t.MAP_TYPE_SELECTION_UPDATED,{maptype:n})})},listNotificationInterests:function(){return this.$super().concat([t.MAP_DATA_UPDATED,t.TIME_PARAMS_UPDATED,t.MAP_TYPE_PARAM_UPDATED,t.DOWNLOAD_OPTION_SELECTED,t.REGION_TYPE_PARAM_UPDATED,t.UNLOAD])},handleNotification:function(e){switch(e.name){case t.TIME_PARAMS_UPDATED:case t.MAP_DATA_UPDATED:case t.MAP_TYPE_PARAM_UPDATED:case t.REGION_TYPE_PARAM_UPDATED:var o=this.facade.retrieveProxy(n.NAME),u=this.facade.retrieveProxy(r.NAME),a=this.facade.retrieveProxy(i.NAME),f=this.facade.retrieveProxy(s.NAME),l=a.getTopic(f.getTopicId());l.drillDownTopicId!=""?this.viewComponent.container.addClass("clickable-regions").removeClass("clickable-markers"):this.viewComponent.container.removeClass("clickable-regions").removeClass("clickable-markers");if(!o.isUpdating&&u.hasData){var c=this,h=f.getTimeParams(),p=u.getData(),d={geoset_id:o.getChartData("map")[0].GEOSET_ID,type:"map",date_mode:"all"},v=function(e,t){switch(t){case"A":return e.annualStart;case"M":return e.monthlyStart;case"Q":return e.quarterlyStart}}(l,h.freq),m=function(e,t){switch(t){case"A":return e.annualEnd;case"M":return e.monthlyEnd;case"Q":return e.quarterlyEnd}}(l,h.freq);h.end!=m?(d.date_mode="range",d.start=h.freq=="Q"?h.start.toString().substr(1,1)+"Q"+h.start.toString().substr(2,4):h.start.toString(),d.end=h.freq=="Q"?h.end.toString().substr(1,1)+"Q"+h.end.toString().substr(2,4):h.end.toString()):h.start!=v&&(d.date_mode="start",d.start=h.freq=="Q"?h.start.toString().substr(1,1)+"Q"+h.start.toString().substr(2,4):h.start.toString()),this.viewComponent.update({DATA:f.getRegionType()=="b"?p.BASIN_DATA:p.DATA,DATACOLUMNS:p.DATACOLUMNS,PRECISION:p.PRECISION,TITLE:p.TITLE,UNITS:p.UNITS},f.getMapType(),h.start,h.end,h.freq,{onRegionOver:function(e,t){return t.split("-")[0]=="US"&&f.getRegionType()=="b"?!1:!0},regionStyle:{hover:{stroke:"#FFFF96","fill-opacity":1,"stroke-width":3,"stroke-opacity":1}},embedOptions:d},f.getRegionType()=="b"?"coal_basin_merc_en":"us_merc_en"),l.drillDownTopicId!=""&&this.getViewComponent().map.regionClicked.add(function(e,n){var r=[],i="",s=o.getChartData().map[0],u=c.getViewComponent().position;if(e.match(/(US-[A-Z][A-Z])|(BS-[A-Z][A-Z][A-Z])/)){e=e.split("-")[1];var a=function(e){var t={},n=$.map(e.split("&"),function(e){return[e.split("=")]});return $.each(n,function(e,n){t[n[0]]=n[1]}),t}(s.filterQuery);for(var h=0;h<l.aggColumns.length;h++)if(l.aggColumns[h].filterGroup.varName=="geo"){var p=l.aggColumns[h].filterGroup.filterValues;for(var d=0;d<p.length;d++)if(p[d].filterValue==e){r[p[d].valueId]=1;break}break}a.geo="";for(h=0;h<Math.ceil(r.length/5)*5;h++)r[h]&&r[h]==1?i+="1":i+="0",h%5==4&&(a.geo=a.geo+parseInt(i,2).toString(32),i="");a.geo=a["geo"]==""?"g":a.geo;var v="topic/"+l.drillDownTopicId+"?agg="+s.agg;$.each(a,function(e,t){v+="&"+e+"="+t}),v+="&freq="+f.getFreq()+"&datecode="+u;var m={topic:l.drillDownTopicId,params:$.extend({agg:s.agg,freq:f.getFreq(),datecode:u},a),label:v};c.sendNotification(t.AGGREGATE_DATA_CLICK_THROUGH,m,"AggregateClickThrough")}})}break;case t.DOWNLOAD_OPTION_SELECTED:if(e.body.target=="map")switch(e.body.type){case"csv":var o=this.facade.retrieveProxy(n.NAME),u=this.facade.retrieveProxy(r.NAME);p=u.getData();var g=[['"'+o.getTableTitle()+" "+p.TITLE+'"'],['"'+window.location.href+'"'],['"'+Date()+'"'],['"Source: U.S. Energy Information Administration"']].concat(this.getViewComponent().outputToArrOfArrs());this.sendNotification(t.CSV_DATA_GENERATED,g);break;case"png":case"pdf":this.getViewComponent().map.exportMap(e.body.type);break;case"svg":window.SVGAngle?this.getViewComponent().map.exportMap(e.body.type):alert("Map download requires a modern browser, such as Chrome, Firefox or Internet Explorer 9+");break;case"embed":this.getViewComponent().embed()}break;case t.UNLOAD:this.getViewComponent().destroy();break;default:this.$super(e)}},onRemove:function(){this.$super(),this.getViewComponent().destroy()},__classvars:{NAME:"AnimatedMapMediator"}})}),define("js/view/MediatorAnalysis",["puremvc","js/Facade","js/model/TableDataProxy"],function(e,t,n){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().analysisButtonClicked.add(function(){var t=e.facade.retrieveProxy(n.NAME);t.isUpdating||e.getViewComponent().showAnalysis(t.getRelatedAnalysis(),t.getMoreAnalysisURL())})},__classvars__:{NAME:"AnalysisMediator"}})}),define("js/view/DateCodeUtil",[],function(){return{months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],parseDateCode:function(e,t){e=e.toString();var n=e.substring(0,4),r,i;switch(t.toUpperCase()){case"A":i=0;break;case"Q":i=(e.substring(4)-1)*3;break;case"M":i=e.substring(4)-1}return i!==void 0&&(r=new Date(n,i)),r},createDateCode:function(e,t){var n=e.getFullYear().toString(),r,i;switch(t.toUpperCase()){case"A":i="";break;case"Q":i=Math.ceil((e.getMonth()+1)/3),i=i<10?"0"+i:i;break;case"M":i=e.getMonth()+1,i=i<10?"0"+i:i}return i!==void 0&&(r=n+""+i),r},formatDateCode:function(e,t){var n=e.toString().substring(0,4),r=e.toString().substring(4,6),i="";switch(t){case"A":i=n;break;case"Q":i="Q"+parseInt(r,10)+" "+n;break;case"M":i=this.months[parseInt(r,10)-1]+" "+n}return i},deincrementDateCode:function(e,t){return this.deincrementOrIncrementDateCode(e,t,!1)},incrementDateCode:function(e,t){return this.deincrementOrIncrementDateCode(e,t,!0)},deincrementOrIncrementDateCode:function(e,t,n){var r=this.parseDateCode(e,t);switch(t){case"A":r=new Date(r.getFullYear()+(n?1:-1),0);break;case"Q":r=new Date(r.getFullYear(),r.getMonth()+(n?3:-3));break;case"M":r=new Date(r.getFullYear(),r.getMonth()+(n?1:-1))}return this.createDateCode(r,t)},getNumberOfDataPoints:function(e,t,n){var r=0,i=this.parseDateCode(e,n),s=this.parseDateCode(t,n);switch(n){case"A":r=s.getFullYear()-i.getFullYear()+1;break;case"Q":r=(s.getFullYear()-i.getFullYear()+1)*4-i.getMonth()/3-(3-s.getMonth()/3);break;case"M":r=(s.getFullYear()-i.getFullYear()+1)*12-i.getMonth()-(11-s.getMonth())}return r}}}),define("js/view/GridFormatters",[],function(){var e={nestedPropertyResolver:function(e,t){var n=e.split("."),r=t;for(var i=0;i<n.length;i++){r=r[n[i]];if(!r||typeof r=="undefined")break}return r},descriptionFormatter:function(e,t,n,r,i){var s=i.LEVEL,o=i.LEVEL_GROUPS,u='<span class="description_wrapper '+(o?"level_group_"+s+"_"+o[s]:"")+'">',a='<span class="description_text_wrapper '+(s===void 0?"bold":"")+'"';i.CHART_NAME&&(a+=' title="'+i.CHART_NAME),a+='">';var f="</span></span>",l="",c,h,p;for(c=s;c>0;c--){p='<span class="description_spacer';if(o&&o[c]!==void 0||c==s)p+=" spacer_group_"+c+"_"+o[c];c!=s?o[c]!==void 0?p+=" pre":p+=" blank":i.IS_LAST?p+=" last":p+=" intermediate",p+='"></span>',l=p+l}return u+l+a+(i.PINNED?i.PINNED_NAME:n)+(i.PINNED||i.SHOW_UNITS?" ("+i.UNITS+")":"")+f},numericalDataFormatter:function(t,n,r,i,s){if(!s.HAS_DATA)return"";var o=isNaN(parseFloat(r))?r:Highcharts.numberFormat(r,s.PRECISION!==void 0?s.PRECISION:0,void 0,","),u=i.rseField?e.nestedPropertyResolver(i.rseField,s):void 0;return(o===void 0||o==""?"--":o)+(i.showRSE?" ("+(u!==void 0?u:"--")+")":"")},rseNumericalDataFormatter:function(e,t,n,r,i){},chartButtonFormatter:function(e,t,n,r,i){var s="ico",o="";return r.iconClass==="map"&&(i.SERIES_ID&&i.SERIES_ID.split(".")[1]==="PLANT"||!n||i.ACTION)?"":i.ACTION?(s+=" remove",o="Click to clear chart",'<span class="'+s+'" title="'+o+'"></span>'):(s+=" "+r.iconClass,r.iconClass=="map"?(i[r.iconClass]&&(s+=" selected"),o="Click to view a U.S. map of this series"):n?i[r.iconClass]?(s+=" selected",o="Click to remove this series from the chart"):o="Click to add this series to the chart":(s+=" parent",i[r.iconClass]?(s+=" selected",o="Click to remove all child series from the chart"):o="Click to add all child series to the chart"),n||i.LEVEL_GROUPS?'<span class="'+s+'" title="'+o+'"></span>':"")},pinSeriesFormatter:function(e,t,n,r,i){var s="ico",o="";return r.iconClass=="sourcekey"&&(!n||i.ACTION)?"":i.ACTION&&r.iconClass=="pin"?(s+=" remove",o="Click to remove all pinned series",'<span class="'+s+'" title="'+o+'"></span>'):(s+=" "+r.iconClass,r.iconClass=="sourcekey"?o="Click to view series in API browser":n?i[r.iconClass]?(s+=" selected",o="Click to unpin this series"):o="Click to pin this series for comparison across data sets":(s+=" parent",i[r.iconClass]?(s+=" selected",o="Click to unpin all child series"):o="Click to pin all child series for comparison across data sets"),n||i.LEVEL_GROUPS?'<span class="'+s+'" title="'+o+'"></span>':"")},sourceKeyFormatter:function(e,t,n,r,i){return n||i.LEVEL_GROUPS?'<span class="ico '+r.iconClass+(n?"":" parent")+(i[r.iconClass]?" selected":"")+'"></span>':""}};return e}),define("js/view/MediatorAggregateDataGrid",["puremvc","js/Facade","js/model/ConfigProxy","js/model/ParameterProxy","js/model/TableDataProxy","js/view/DateCodeUtil","js/view/GridFormatters","datagrid"],function(e,t,n,r,i,s,o,u){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().onClick.add(this.dataGridClick,this)},listNotificationInterests:function(){return this.$super().concat([t.TABLEDATA_UPDATED,t.TIME_PARAMS_UPDATED,t.CHART_DATA_UPDATED,t.DOWNLOAD_OPTION_SELECTED,t.UNLOAD,t.CTYPE_PARAM_UPDATED,t.RSE_PARAM_UPDATED,t.PIN_KEY_PARAM_UPDATED])},handleNotification:function(e){switch(e.getName()){case t.TABLEDATA_UPDATED:var s=this.facade.retrieveProxy(i.NAME),u=this.facade.retrieveProxy(r.NAME),a=this.facade.retrieveProxy(n.NAME),f=u.getTimeParams(),l=a.getTopic(u.getTopicId()),c=s.getCombinedData(),h=this.generateColumns(s.getDataColumns(),c,f.freq,s.getTableUnits(),l,u.getShowRSE());this.getViewComponent().update(c,h,{frozenColumn:2,dataItemColumnValueExtractor:function(e,t){return t&&t.field?o.nestedPropertyResolver(t.field,e):null},scrollToRight:!0,addSpacerColumn:!0},f.start,f.end),this.sendNotification(t.TABLE_RENDERED);break;case t.TIME_PARAMS_UPDATED:var s=this.facade.retrieveProxy(i.NAME),u=this.facade.retrieveProxy(r.NAME);if(!s.isUpdating){var f=u.getTimeParams();this.getViewComponent().filterNumericColumns(f.start,f.end,!0)}break;case t.CHART_DATA_UPDATED:this.getViewComponent().redraw(e.getBody());break;case t.DOWNLOAD_OPTION_SELECTED:if(e.body.target=="table"&&e.body.type=="csv"){var s=this.facade.retrieveProxy(i.NAME),p=[['"'+s.getTableTitle()+'"'],['"'+window.location.href+'"'],['"'+Date()+'"'],['"Source: U.S. Energy Information Administration"']].concat(this.getViewComponent().outputToArrOfArrs());this.sendNotification(t.CSV_DATA_GENERATED,p)}break;case t.UNLOAD:this.getViewComponent().destroy();break;case t.CTYPE_PARAM_UPDATED:var u=this.facade.retrieveProxy(r.NAME),d=this.getViewComponent(),h=d.columns,f=u.getTimeParams(),s=this.facade.retrieveProxy(i.NAME);$.each(h,function(e,t){t.id=="chart"&&(t.iconClass=u.getChartType())}),s.isUpdating||(d.setColumns(h),d.filterNumericColumns(f.start,f.end,!0));break;case t.RSE_PARAM_UPDATED:var s=this.facade.retrieveProxy(i.NAME);if(!s.isUpdating){var u=this.facade.retrieveProxy(r.NAME),a=this.facade.retrieveProxy(n.NAME),d=this.getViewComponent(),f=u.getTimeParams(),c=s.getCombinedData(),l=a.getTopic(u.getTopicId()),h=this.generateColumns(s.getDataColumns(),c,f.freq,s.getTableUnits(),l,u.getShowRSE());d.setColumns(h)}break;case t.PIN_KEY_PARAM_UPDATED:var u=this.facade.retrieveProxy(r.NAME),d=this.getViewComponent(),h=d.columns,f=u.getTimeParams(),s=this.facade.retrieveProxy(i.NAME);$.each(h,function(e,t){t.id=="pinKey"&&(t.iconClass=u.getLinkType())}),s.isUpdating||(d.setColumns(h),d.filterNumericColumns(f.start,f.end,!0));break;default:this.$super(e)}},generateColumns:function(e,t,n,i,a,f){var l,c=this.facade.retrieveProxy(r.NAME),h=[{id:"pinKey",field:"HAS_DATA",width:30,displayFormatter:o.pinSeriesFormatter,output:!1,cssClass:"chart_column",iconClass:c.getLinkType(),resizable:!1},{id:"description",field:"DESCRIPTION",displayFormatter:o.descriptionFormatter,outputFormatter:this.$class.descriptionOutputFormatter,cssClass:"description aggregate",maxWidth:904,width:400},{id:"chart",field:"HAS_DATA",width:30,displayFormatter:o.chartButtonFormatter,output:!1,cssClass:"chart_column",iconClass:c.getChartType(),resizable:!1},{id:"units",name:"units",field:"UNITS",display:!1},{id:"source key",name:"source key",field:"SERIES_ID",display:!1}];u.autosizeColumn(h,0,t,5);for(l=0;l<e.length;l++){var p=parseInt(e[l]).toString();h.push({id:p,name:s.formatDateCode(p,n),field:"DATA."+p.toString(),rseField:"RSE_DATA."+p.toString(),drillDownTopicId:a.drillDownTopicId,displayFormatter:a.drillDownTopicId?this.$class.linkCellFormatter:null,showRSE:f,dataFormatter:o.numericalDataFormatter,freq:n,width:f?150:100})}return h},dataGridClick:function(e,n,s){var o=this.getViewComponent(),u=o.columns,a=u[n].iconClass;if(u[n].id=="chart"||u[n].id=="pinKey")if(s.ACTION){var f={};f[a]="",this.sendNotification(t.CHART_SELECTION_UPDATED,f)}else switch(a){case"linechart":case"columnchart":case"pin":var l=this.facade.retrieveProxy(i.NAME),c=this.facade.retrieveProxy(r.NAME);if(s.HAS_DATA){var f={};f[a]=c.getUpdatedCharted(s.SERIES_ID,a),this.sendNotification(t.CHART_SELECTION_UPDATED,f)}else{var l=this.facade.retrieveProxy(i.NAME),h=l.getChildData(e),p=$.map(h,function(e){return e.HAS_DATA?e.SERIES_ID:null});if(p.length>0){var f={};f[a]=c.getUpdatedCharted(p,a,Boolean(s[a])),this.sendNotification(t.CHART_SELECTION_UPDATED,f)}}break;case"map":var c=this.facade.retrieveProxy(r.NAME),a=c.getChartType();s.HAS_DATA&&(f={},f[a]=s.SERIES_ID,this.sendNotification(t.CHART_SELECTION_UPDATED,f));break;case"sourcekey":s.SERIES_ID&&s.HAS_DATA&&this.sendNotification(t.SOURCE_KEY_SELECTED,s.SERIES_ID)}else if(n>2){var d=this.getViewComponent().columns[n+2];if(d&&s.HAS_DATA&&s.filterQuery&&d.drillDownTopicId&&!s.NO_DATA_BREAKDOWN){var v="topic/"+d.drillDownTopicId+"?agg="+s.agg+"&"+s.filterQuery+"&freq="+d.freq+"&datecode="+d.id,m=function(e){var t={},n=$.map(e.split("&"),function(e){return[e.split("=")]});return $.each(n,function(e,n){t[n[0]]=n[1]}),t}(s.filterQuery),g={topic:d.drillDownTopicId,params:$.extend({agg:s.agg,freq:d.freq,datecode:d.id},m),label:v};this.sendNotification(t.AGGREGATE_DATA_CLICK_THROUGH,g,"AggregateClickThrough")}}},__classvars__:{NAME:"DataGridMediator",linkCellFormatter:function(e,t,n,r,i){return n!==""&&i.filterQuery&&!i.NO_DATA_BREAKDOWN?'<span class="link_cell">'+n+"</span>":n},descriptionOutputFormatter:function(e,t,n,r,i){return i.CHART_NAME||n}}})}),define("text!templates/main.html",[],function(){return'<span id="top_topic_selection_container" class="grey_side ltblue"></span>\r\n<div class="carousel blue_top" id="chart_area"></div>\r\n<hr />\r\n<div id="middle_topic_selection_container" class="grey_side ltblue"></div>\r\n<div id="title_container"></div>\r\n{{#mainDownloadButtonOpts}}\r\n	{{>download_button}}\r\n{{/mainDownloadButtonOpts}}\r\n<div id="help_button"	class="help_button">\r\n	<span class="help_icon">&nbsp;</span><span class="help_button_text">Help</span>\r\n</div>\r\n{{#mainFilterButtonOpts}}\r\n	{{>filter_button}}\r\n{{/mainFilterButtonOpts}}\r\n{{#mainAnalysisButtonOpts}}\r\n	{{>analysis_button}}\r\n{{/mainAnalysisButtonOpts}}\r\n{{#mainVisualizationButtonOpts}}\r\n	{{>visualization_button}}\r\n{{/mainVisualizationButtonOpts}}\r\n<div class="clear"></div>\r\n<div id="search_time_container">\r\n	<div id="search_container"></div>\r\n	<div id="pinkey_container"></div>\r\n	<div id="time_selection_container"></div>\r\n</div>\r\n<div class="clear"></div>\r\n<div id="tableContainer">\r\n</div>\r\n<div id="footnote_container">\r\n	\r\n</div>\r\n<div class="clear"></div>\r\n<div id="filter_dialog_wrap">\r\n	<div id="filter_dialog_container">\r\n		{{#overlayFilterButtonOpts}}\r\n			{{>filter_button}}\r\n		{{/overlayFilterButtonOpts}}\r\n		<div id="filter_dialog"></div>\r\n	</div>\r\n</div>\r\n<div id="download_dialog_wrap">\r\n	<div id="download_dialog_container">\r\n			{{#overlayDownloadButtonOpts}}\r\n				{{>download_button}}\r\n			{{/overlayDownloadButtonOpts}}\r\n		<div id="download_dialog"></div>\r\n	</div>\r\n</div>\r\n<div id="analysis_dialog_wrap">\r\n	<div id="analysis_dialog_container">\r\n			{{#overlayAnalysisButtonOpts}}\r\n				{{>analysis_button}}\r\n			{{/overlayAnalysisButtonOpts}}\r\n		<div id="analysis_dialog"></div>\r\n	</div>\r\n</div>'}),define("text!templates/filter_button.html",[],function(){return'<div\r\n	{{#id}}\r\n		id="{{id}}"\r\n	{{/id}}\r\n	class="filter_button\r\n		{{#selected}}\r\n			selected\r\n		{{/selected}}\r\n		{{#disabled}}\r\n			disabled\r\n		{{/disabled}}\r\n		\r\n	"\r\n>\r\n	<span class="filter_icon">&nbsp;</span><span class="filter_button_text">Filter/order</span>\r\n</div>'}),define("text!templates/download_button.html",[],function(){return'<div\r\n	{{#id}}\r\n		id="{{id}}"\r\n	{{/id}}\r\n	class="download_button\r\n		{{#selected}}\r\n			selected\r\n		{{/selected}}\r\n	"\r\n>\r\n	<span class="download_icon">&nbsp;</span><span class="download_button_text">Download</span>\r\n</div>'}),define("text!templates/visualization_button.html",[],function(){return'<div\r\n	{{#id}}\r\n		id="{{id}}"\r\n	{{/id}}\r\n	class="\r\n		{{#disabled}}\r\n			disabled\r\n		{{/disabled}}\r\n		\r\n	"\r\n>\r\n</div>'}),define("text!templates/analysis_button.html",[],function(){return'<div\r\n	{{#id}}\r\n		id="{{id}}"\r\n	{{/id}}\r\n	class="analysis_button\r\n		{{#selected}}\r\n			selected\r\n		{{/selected}}\r\n		{{#disabled}}\r\n			disabled\r\n		{{/disabled}}\r\n		\r\n	"\r\n>\r\n	<span class="analysis_icon">&nbsp;</span><span class="analysis_button_text">Analysis</span>\r\n</div>'}),define("js/view/VC_PageLayout",["classy","text!templates/main.html","text!templates/filter_button.html","text!templates/download_button.html","text!templates/visualization_button.html","text!templates/analysis_button.html"],function(e,t,n,r,i,s){return e.$extend({container:null,__init__:function(e,o){this.container=e,this.container.empty().html(Mustache.render(t,o,{filter_button:n,download_button:r,visualization_button:i,analysis_button:s}))},getFormContainer:function(){return $("#filter_dialog",this.container)},getVisualizationContainer:function(){return $("#main_visualization_button",this.container)},getPinKeyVisualizationContainer:function(){return $("#pinkey_container",this.container)},getDownloadContainer:function(){return $("#download_dialog",this.container)},getTopTopicSelectionContainer:function(){return $("#top_topic_selection_container",this.container)},getMiddleTopicSelectionContainer:function(){return $("#middle_topic_selection_container",this.container)},getTimeSelectionContainer:function(){return $("#time_selection_container",this.container)},getSearchContainer:function(){return $("#search_container",this.container)},getTitleContainer:function(){return $("#title_container",this.container)},getTableContainer:function(){return $("#tableContainer",this.container)},getChartContainer:function(){return $("#chart_area",this.container)},getFootnoteContainer:function(){return $("#footnote_container",this.container)},getAnalysisContainer:function(){return $("#analysis_dialog",this.container)},getImportExportSelectionContainer:function(){return $("#import_export_container",this.container)},getRegionTypeSelectionContainer:function(){return $("#region_type_selection_container",this.container)},getMinePlantSelectionContainer:function(){return $("#mine_plant_container",this.container)}})}),define("text!templates/filterBox.html",[],function(){return'<div class="style2">\r\n	<div class="filter_buttons">\r\n		<span id="cancelButton"><span>Cancel</span><div>&nbsp;</div></span>\r\n		<!--<span id="resetButton"><span>Clear</span><div>&nbsp;</div></span>-->\r\n		<span id="submitButton"><span>Submit</span><div>&nbsp;</div></span>\r\n	</div>\r\n	<ul class="filter_menu">\r\n	{{#aggColumns}}\r\n	<li class="filter_menu_item" id="aggId={{aggColumnId}}">\r\n		<div class="filter_menu_header">\r\n			<h3></h3>\r\n		</div>\r\n		<div class="filter_menu_title">\r\n			<span class="arrow left">&nbsp;</span>\r\n			<span class="title_text">{{description}}</span>\r\n			<span class="arrow right">&nbsp;</span>\r\n		</div>\r\n		<div class="filter_tree_div">\r\n		\r\n			<div class="filter_all">\r\n				<span><a class="check">Check all</a></span>\r\n				<span>  |  </span>\r\n				<span><a class="uncheck">Uncheck all</a></span>\r\n			</div>\r\n			<div class="filter_tree_scroller"/>\r\n			<ul class="filter_tree" id="{{filterGroup.varName}}">\r\n				<form>\r\n				{{{filterTreeFunction}}}\r\n				</form>\r\n			</ul>\r\n		</div>\r\n	</li>\r\n	{{/aggColumns}}\r\n	<li class="clear"/>\r\n	</ul>\r\n</div>'}),define("text!templates/selectionItem.html",[],function(){return'<input type="checkbox" value="{{valueId}}" name="{{filterGroupId}}" data-filterValue="{{filterValue}}"/><p>{{description}}</p>'}),define("js/view/VC_Form",["classy","text!templates/filterBox.html","text!templates/selectionItem.html","signals","mousewheel","mustache","simpleModal"],function(e,t,n,r){var i=function(){$.each($(".filter_menu_header > h3"),function(e,t){e==0&&e<$(".filter_menu_header > h3").length-2?$(t).html("Order by <span class='note'>(choose one)</span>"):e<$(".filter_menu_header > h3").length-2?$(t).html("Then by <span class='note'>(choose one)</span>"):e==0?$(t).html("Order by <span class='note'>(choose one or more)</span>"):$(t).html("Then by <span class='note'>(choose one or more)</span>")})},s=function(){var e=$(".filter_menu_title > span");e.addClass("arrow"),$(e.get(0)).toggleClass("arrow"),$(e.get(e.length-1)).toggleClass("arrow")},o=function(){console.log("setCheckBoxesRadios");var e=$(".filter_menu_item");$.each(e,function(t){if(t<e.length-2){var n=!1;$(this).find('input[type="checkbox"]').each(function(e){var t=$(this).parent(),r=$('<input type="radio" value="'+$(this).attr("value")+'" name="'+$(this).attr("name")+'"/>');r.data("filtervalue",$(this).data("filtervalue")),$(this).is(":checked")&&!n&&(r.attr("checked",!0),n=!0),t.prepend(r),$(this).remove()}),$(this).find(".filter_all").css("visibility","hidden")}else $(this).find('input[type="radio"]').each(function(e){var t=$(this).parent(),n=$('<input type="checkbox" value="'+$(this).attr("value")+'" name="'+$(this).attr("name")+'"/>');n.data("filtervalue",$(this).data("filtervalue")),$(this).is(":checked")&&n.attr("checked",!0),t.prepend(n),$(this).remove()}),$(this).find(".filter_all").css("visibility","visible")})},u=function(e){var t=$(e.target).parents(".filter_menu_item");$(this).hasClass("left")?t.insertBefore(t.prev()):t.insertAfter(t.next()),s(),i(),o()},a=function(e,t){s(),i(),o()},f=function(e,t){var n=t.item.find(".filter_tree_scroller");n.slider("option","slide").call(n,null,{handle:n.find("a"),value:n.slider("value")})},l=function(e,t,n,r){var i=this,s=1,o=1;if(r){var u=parseInt(i.scrollTop,10)+(r>0?-120:120);i.scrollTop=u,s=i.scrollHeight-i.offsetHeight-u}if(n){var a=parseInt(i.scrollLeft,10)+(n<0?-120:120);i.scrollLeft=a,o=i.scrollWidth-i.offsetWidth-a}return!1},c=function(){$(this).toggleClass("disabled"),$(this).parent().parent().toggleClass("disabled")},h=function(e){var t="",r=this.filterGroup.filterValues,i=0,s=0,o=0;for(var u=0;u<r.length;u++){s=r[u].level,o=u<r.length-1?r[u+1].level:0;if(s<i)for(var a=0;a<i-s;a++)t+="</ul></li>";else s>i&&(t+="<ul>");var f={description:r[u].description,valueId:r[u].valueId,filterGroupId:r[u].filterGroupId,filterValue:r[u].filterValue};f.description=f.description.charAt(0).toUpperCase()+f.description.slice(1),t+="<li>"+Mustache.to_html(n,f)+(o<=s?"</li>":""),i=s}return t},p=function(e){var t=g();e.data.dispatch(g())},d=function(e){e.data.dispatch()},v=function(e){$(".filter_tree").find("input:checked").attr("checked",!1),e.data.dispatch()},m=function(e){$(e.delegateTarget).parent().find("input").attr("checked",$(e.target).hasClass("check"))},g=function(){var e={},t="",n="",r="";return $.each($(".filter_menu_item"),function(e){$("input",this).attr("type").toLowerCase()=="radio"?t+=this.id.substr(this.id.indexOf("=")+1)+",":$(":checked",this).length>1?r+=this.id.substr(this.id.indexOf("=")+1)+",":n+=this.id.substr(this.id.indexOf("=")+1)+","}),t=t+n+r,e.agg=t.substr(0,t.length-1),$(".filter_tree").each(function(){var t=$(this).find(":checked");e[this.id]="1";var n=[];t.each(function(){n[$(this).attr("value")]=1});var r="";e[this.id]="";for(var i=0;i<Math.ceil(n.length/5)*5;i++)n[i]&&n[i]==1?r+="1":r+="0",i%5==4&&(e[this.id]=e[this.id]+parseInt(r,2).toString(32),r="");e[this.id]=e[this.id]==""?"g":e[this.id]}),e},y=function(e){var t=$(".filter_menu_item");if(e.agg!=null){var n=e.agg.toString().split(",");for(var r=0;r<n.length;r++){var u=$(".filter_menu_item[id$=\\="+n[r]+"]");$(u).insertBefore($(u).parent().find(">.clear"))}}i(),s(),o(),t.each(function(){var t=this,n=$(t).find(".filter_tree").get(0).id,r=$(t).find("input");if(e[n]!=null){var i="";$.each(e[n].toString().split(""),function(e,t){var n=parseInt(t.toString(),32).toString(2);while(n.length%5!=0)n="0"+n;i+=n}),$.each(r,function(e){$(this).attr("checked",!1)});if(r.length>0&&$(r[0]).attr("type")=="radio"){var s=$(t).find("input[value="+i.indexOf("1")+"]");s.length>0&&$(s[0]).attr("checked",!0)}else $.each(i.split(""),function(e,n){if(n==1){var r=$(t).find("input[value="+e+"]");r.length>0&&$(r[0]).attr("checked",!0)}})}$.each($("input:checkbox",t),function(e,t){var n=$(this).prop("checked"),r=$(this).data("filtervalue"),i=$(this).parents(".filter_tree").find("input:checkbox");$.each(i,function(e,t){$(t).data("filtervalue")==r&&$(t).prop("checked",n)})});var o=$(t).find("input:checked");o.length==0&&r.length>0&&$(r[0]).attr("checked",!0)})};return e.$extend({form:null,button:null,formSubmitted:null,formCanceled:null,formButtonClicked:null,formReset:null,resizeCallback:null,opened:!1,__init__:function(e){var t=this;this.container=e,this.button=$("#main_filter_button"),this.formSubmitted=new r.Signal,this.formCanceled=new r.Signal,this.formReset=new r.Signal,this.formButtonClicked=new r.Signal,this.button.click(function(e){t.button.hasClass("disabled")||t.formButtonClicked.dispatch()})},generateForm:function(e,n,r){switch(n.aggColumns.length){case 1:$(this.container).addClass("oneWide");break;case 2:$(this.container).addClass("twoWide");break;case 3:$(this.container).addClass("threeWide");break;case 4:$(this.container).addClass("fourWide")}for(var i=0;i<n.aggColumns.length;i++)n.aggColumns[i].filterTreeFunction=h;var s=$(Mustache.to_html(t,n));e.empty(),e.append(s),s.find(".filter_tree").bind("scroll",function(){$(this).siblings(".filter_tree_scroller").slider("value",this.scrollHeight-this.offsetHeight==0?100:100-100*this.scrollTop/(this.scrollHeight-this.offsetHeight))}).bind("mousewheel",l),s.find(".arrow").bind("click",u),s.find("#submitButton").bind("click",this.formSubmitted,p),s.find("#cancelButton").bind("click",this.formCanceled,d),s.find("#resetButton").bind("click",this.formReset,v),s.on("change","input:checkbox",function(e){var t=$(this).prop("checked"),n=$(this).data("filtervalue"),r=$(this).parents(".filter_tree").find("input:checkbox");$.each(r,function(e,r){$(r).data("filtervalue")==n&&$(r).prop("checked",t)})}),s.find(".filter_all").on("click","a",m),y(r)},showForm:function(e,t){var n=this.button.offset(),r=this;this.generateForm(this.container,e,t);var i=$("#filter_dialog_container"),s=i.parent();i.appendTo("body").css({position:"absolute",display:"block",left:-9999,top:-9999});var o=i.height();i.appendTo(s).css({position:"relative",left:0,top:0}),i.modal({autoPosition:!1,overlayClose:!0,fixed:!1,persist:!0,minHeight:o,maxHeight:o,onShow:function(){$(".filter_tree_scroller").each(function(){ele=$(this),ele.slider({orientation:"vertical",min:0,max:100,value:100,slide:function(e,t){(function(){this.scrollTop=(this.scrollHeight-this.offsetHeight)*((100-t.value)/100)}).call($(t.handle).parent().siblings(".filter_tree").get(0))}}).mousedown(function(e){$.browser.msie&&e.stopPropagation()});var e=ele.siblings(".filter_tree");e.innerHeight()>=e.get(0).scrollHeight&&ele.slider("option","disabled",!0)}),$(".filter_menu").sortable({update:a,items:".filter_menu_item",axis:"x",stop:f})},close:!1}),$("#simplemodal-container").css({top:n.top,left:n.left}),$(window).resize(this.resizeCallback=function(){var e=r.button.offset();$("#simplemodal-container").css({top:e.top,left:e.left})}),window.scrollTo(0,this.button.offset().top),this.opened=!0},hideForm:function(){this.container.empty(),$(this.container).hasClass("oneWide")?$(this.container).removeClass("oneWide"):$(this.container).hasClass("twoWide")?$(this.container).removeClass("twoWide"):$(this.container).hasClass("threeWide")?$(this.container).removeClass("threeWide"):$(this.container).hasClass("fourWide")&&$(this.container).removeClass("fourWide"),$.modal.close(),typeof this.resizeCallback=="function"&&$(window).unbind("resize",this.resizeCallback),this.resizeCallback=null,this.opened=!1}})}),define("text!templates/downloadBox.html",[],function(){return'<div class="style2">\r\n		<dl class="download_menu">\r\n			{{#downloadItems}}\r\n			<dt>{{#id}}<a id="{{id}}" class="download_option {{class}}">{{/id}}{{label}}{{#id}}</a>{{/id}}</dt>\r\n			{{#children}}\r\n				<dd><a id="{{id}}" class="download_option {{class}}">{{label}}</a></dd>\r\n			{{/children}}\r\n			{{/downloadItems}}\r\n			<dt class="clear"/>\r\n		</dl>\r\n</div>'}),define("js/view/VC_Download",["classy","text!templates/downloadBox.html","signals","mustache","simpleModal"],function(e,t,n){return e.$extend({__init__:function(e){var t=this;this.container=e,this.button=$("#main_download_button"),this.downloadButtonClicked=new n.Signal,this.downloadOptionClicked=new n.Signal,this.button.click(function(e){t.button.hasClass("disabled")||t.downloadButtonClicked.dispatch()}),this.container.delegate(".download_option","click",function(e){t.hideDownload(),t.downloadOptionClicked.dispatch(t.idMap[$(e.target).attr("id")])}),this.modalCloseHandler=function(e){$(e.target).parents("#download_dialog_container").length==0&&t.hideDownload()}},generateDownload:function(e,n){this.idMap=function(){var e={};for(var t=0;t<n.length;t++){var r=n[t];if(r.id)e[r.id]=r;else if(n[t].children)for(var i=0;i<r.children.length;i++)e[r.children[i].id]=r.children[i]}return e}(),e.empty();var r=$(Mustache.to_html(t,{downloadItems:n}));e.append(r)},showDownload:function(e){var t=this,n=t.button.offset();this.generateDownload(this.container,e),$("#download_dialog_container").modal({autoPosition:!1,overlayClose:!0,fixed:!1,close:!1,persist:!0}),$("#simplemodal-container").css({top:n.top,left:n.left}),$("body").one("click",function(){$("body").bind("click",t.modalCloseHandler)}),this.container.css({left:this.button.outerWidth()-this.container.outerWidth()}),$(window).resize(this.resizeCallback=function(){var e=t.button.offset();$("#simplemodal-container").css({top:e.top,left:e.left})})},hideDownload:function(){$.modal.close(),typeof this.resizeCallback=="function"&&$(window).unbind("resize",this.resizeCallback),typeof this.modalCloseHandler=="function"&&$("body").unbind("click",this.modalCloseHandler),this.resizeCallback=null}})}),define("text!templates/visualizationBox.html",[],function(){return'{{#items}}\r\n<input type="radio" id="{{class}}-radio" name="{{name}}" value="{{class}}"/><label for="{{class}}-radio" alt="{{description}}" title="{{description}}" ><span class="ico {{class}}"></span>{{label}}</label>\r\n{{/items}}'}),define("js/view/VC_Visualization",["classy","text!templates/visualizationBox.html","signals","mustache"],function(e,t,n){return e.$extend({__init__:function(e,t){var r=this;this.container=e,this.config=$.extend({},t?t:this.$class.defaultConfig),this.items=this.config.items,this.visualizationSelected=new n.Signal,this.generateMenu(this.container,$.extend(this.config,t)),$(this.container).buttonset(),this.visualizationSelectors=$("input",this.container),this.updateSelectionIndex(this.config.currentSelectionIndex?this.config.currentSelectionIndex:0),this.visualizationSelectors.change(function(e){r.updateSelection(this.value);var t=r.config.items[r.currentSelectionIndex];r.visualizationSelected.dispatch({newClass:t["class"],item:t,event:e})})},generateMenu:function(e,n,r){var i=$(Mustache.to_html(t,{items:this.items}));e.empty().append(i)},updateSelection:function(e){var t=this;$.each(this.config.items,function(n,r){r["class"]==e&&t.updateSelectionIndex(n)})},updateSelectionIndex:function(e){var t=this;this.currentSelectionIndex=e,$.each(this.config.items,function(e,n){e==t.currentSelectionIndex&&$("input[value="+n["class"]+"]",t.container).attr("checked",!0)}),$(this.container).buttonset("refresh")},__classvars__:{defaultConfig:{items:[{name:"visualizations","class":"linechart",description:"Time-series chart",label:"Time-series"},{name:"visualizations","class":"columnchart",description:"Column chart",label:"Column"},{name:"visualizations","class":"map",description:"U.S. map over time",label:"Map"}],currentSelectionIndex:0},pinKeyConfig:{items:[{name:"pinKeyVisualizations","class":"pin",description:"Pin series for comparison across data sets",label:"Pin"},{name:"pinKeyVisualizations","class":"sourcekey",description:"Link to API source key",label:"API"}],currentSelectionIndex:0}}})}),define("text!templates/topic_selector.html",[],function(){return'<div class="topic_selection_inner_container">\r\n	<h1>Change data set</h1>\r\n		<form id="data_set" name="data_set">\r\n			<!---label id="topic_select_label" for="topic_select">Change Data Set: </label--->\r\n			<select id="topic_select" size="1" name="topic_select" class="link_prompt">\r\n				{{#topics}}\r\n				{{#label}}<optgroup label="{{label}}">\r\n				{{#topics}}\r\n				<option class="link_option" value="{{dataTopicId}}">{{description}}</option>\r\n				{{/topics}}\r\n				</optgroup>\r\n				{{/label}}\r\n				{{^label}}\r\n				<option class="link_option" value="{{dataTopicId}}">{{description}}</option>\r\n				{{/label}}\r\n				{{/topics}}\r\n			</select>\r\n		</form>\r\n</div>\r\n<div class="topic_selection_inner_container or">\r\n	<h1>OR</h1>\r\n</div>\r\n<div class="topic_selection_inner_container">\r\n	<h1>View a pre-generated report</h1>\r\n		<form id="choose_report" name="choose_report">\r\n			<select class="link_prompt" id="report_select" size="1" name="report_select">\r\n				<option value="">Choose a report</option>\r\n				{{#reports}}\r\n				<option class="link_option" value="{{json}}">{{description}}</option>\r\n				{{/reports}}\r\n			</select>\r\n		</form>\r\n</div>\r\n<div class="clear"></div>'}),define("js/view/VC_Selection",["classy","signals","text!templates/topic_selector.html","json2"],function(e,t,n){return e.$extend({topicSelect:null,reportSelect:null,topicSelectionChanged:null,reportSelectionChanged:null,__init__:function(e,n){this.top=n,this.container=e,this.topicSelectionChanged=new t.Signal,this.reportSelectionChanged=new t.Signal},create:function(e,t,r,i){var s=this;this.container.html(Mustache.render(n,{topics:r,reports:i,top:this.top})),this.topicSelect=$("#topic_select",this.container).change(function(){s.topicSelect.val()!=""&&s.topicSelectionChanged.dispatch(s.topicSelect.val())}),this.reportSelect=$("#report_select",this.container).change(function(){s.reportSelect.val()!=""&&s.reportSelectionChanged.dispatch(JSON.parse(s.reportSelect.val()))}),t!=null&&$(this.reportSelect.find("option").get(t+1)).attr("selected","selected"),this.updateTopicSelection(e);if(navigator.appName=="Microsoft Internet Explorer"){function o(e){var t=$(e.data);return e.data!=e.target?t.data("open")?(t.css("width",t.data("originalWidth")),t.data("open",!1)):t.data("open",!0):setTimeout(function(){t.data("open")?(t.css("width",t.data("originalWidth")),t.data("open",!1)):t.data("open",!0)},100),typeof o=="function"&&$("body").unbind("mouseup",o),!0}var u=navigator.userAgent,a=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");a.exec(u)!=null&&(rv=parseFloat(RegExp.$1),rv<9&&this.container.find("select").each(function(){var e=$(this);e.css("min-width",e.width()),e.data("originalWidth",e.width())}).bind("mousedown",function(e){var t=$(this),n=$(this).clone();return n.css("width","auto"),t.parent().append(n.css("visible","false")),n.width()>t.width()&&t.css("width","auto"),n.remove(),t.css("position","relative"),$("body").bind("mouseup",this,o),!0}).bind("change blur",function(e){var t=$(this);return t.css("width",t.data("originalWidth")),t.data("open",!1),!0}))}},updateTopicSelection:function(e){this.topicSelect.val(e)},updateReportSelection:function(e){this.reportSelect.val(this.reportSelect.length)}})}),define("text!/global/scripts/modules/src/timeSlider/time_slider.html",[],function(){return'<div id="timeSliderContainer">\r\n	<div class="labelContainer"></div>\r\n	<div class="timeSlider{{#selectDateRange}} range{{/selectDateRange}}"></div>\r\n</div>'}),define("dateCodeUtils",[],{months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],parseDateCode:function(e,t){e=e.toString();var n=e.substring(0,4),r,i;switch(t.toUpperCase()){case"A":i=0;break;case"Q":i=(e.substring(4)-1)*3;break;case"M":i=e.substring(4)-1}return i!==void 0&&(r=new Date(n,i)),r},createDateCode:function(e,t){var n=e.getFullYear().toString(),r,i;switch(t.toUpperCase()){case"A":i="";break;case"Q":i=Math.ceil((e.getMonth()+1)/3),i=i<10?"0"+i:i;break;case"M":i=e.getMonth()+1,i=i<10?"0"+i:i}return i!==void 0&&(r=n+""+i),r},formatDateCode:function(e,t){var n=e.toString().substring(0,4),r=e.toString().substring(4,6),i="";switch(t){case"A":i=n;break;case"Q":i="Q"+parseInt(r,10)+" "+n;break;case"M":i=this.months[parseInt(r,10)-1]+" "+n}return i},deincrementDateCode:function(e,t){return this.deincrementOrIncrementDateCode(e,t,!1)},incrementDateCode:function(e,t){return this.deincrementOrIncrementDateCode(e,t,!0)},deincrementOrIncrementDateCode:function(e,t,n){var r=this.parseDateCode(e,t);switch(t){case"A":r=new Date(r.getFullYear()+(n?1:-1),0);break;case"Q":r=new Date(r.getFullYear(),r.getMonth()+(n?3:-3));break;case"M":r=new Date(r.getFullYear(),r.getMonth()+(n?1:-1))}return this.createDateCode(r,t)}}),define("timeSlider",["signals","classy","text!/global/scripts/modules/src/timeSlider/time_slider.html","dateCodeUtils","mustache"],function(e,t,n,r){return t.$extend({sliderType:null,timeSelectionChanged:null,suppressSignals:!1,isCreated:!1,timeSlider:null,lowLabel:null,highLabel:null,lowHandle:null,highHandle:null,values:null,highVal:null,lowVal:null,freq:null,__init__:function(t){this.container=t,this.timeSelectionChanged=new e.Signal},create:function(e,t,r,i,s){var o=this;this.freq=t.toUpperCase(),this.values=r,this.lowVal=i,this.highVal=s,this.container.html(Mustache.render(n,e)),this.timeSlider=$(".timeSlider",this.container),this.sliderType=this.timeSlider.hasClass("range")?this.$class.RANGE_SLIDER:this.$class.SINGLE_SLIDER,this.createSlider(),this.isCreated=!0,this.updateTimeSelection(t,r,i,s)},createSlider:function(){var e=this,t,n,r;switch(this.sliderType){case this.$class.RANGE_SLIDER:t=function(t,n){var r;return n.values[0]>=n.values[1]||n.values[0]<0||n.values[0]>e.values.length||n.values[1]<0||n.values[1]>e.values.length?!1:(e.lowVal=e.values[n.values[0]],e.highVal=e.values[n.values[1]],e.updateLabel(!0),e.updateLabel(!1),!0)},n=function(t,n){e.lowVal=n.values[0]<0||n.values[0]>e.values.length?e.values[0]:e.values[n.values[0]],e.highVal=n.values[1]<0||n.values[1]>e.values.length?e.values[e.values.length-1]:e.values[n.values[1]],e.updateLabel(!0),e.updateLabel(!1),e.suppressSignals||e.timeSelectionChanged.dispatch(e.lowVal,e.highVal)},r=!0;break;case this.$class.SINGLE_SLIDER:t=function(t,n){return e.lowVal=e.values[n.value],e.updateLabel(!0),!0},n=function(t,n){e.lowVal=e.values[n.value],e.updateLabel(!0),e.suppressSignals||e.timeSelectionChanged.dispatch(e.lowVal)},r=!1}this.timeSlider.slider({orientation:"horizontal",slide:t,change:n,range:r});var i=this.timeSlider.children(".ui-slider-handle");this.lowHandle=i.eq(0),this.highHandle=i.eq(1),this.lowLabel=$('<div class="time_slider_tooltip"></div>').append("<span/>").css({position:"absolute"}),this.sliderType===this.$class.SINGLE_SLIDER?this.lowLabel.appendTo(this.lowHandle):(this.highLabel=$('<div class="time_slider_tooltip"></div>').append("<span/>"),this.lowLabel.appendTo(this.timeSlider),this.highLabel.appendTo(this.timeSlider),this.lowLabel.css({left:0}),this.highLabel.css({position:"absolute"})),this.updateLabel(!0),this.updateLabel(!1);switch(this.sliderType){case this.$class.RANGE_SLIDER:this.lowHandle.add(this.highHandle).addClass("dual_slider_handle");break;case this.$class.SINGLE_SLIDER:this.lowHandle.addClass("single_slider_handle")}},updateTimeSelection:function(e,t,n,r){this.suppressSignals=!0,this.values=t,this.freq=e,this.lowVal=n,this.highVal=r,this.updateTimeSlider(),this.suppressSignals=!1},updateLabel:function(e){var t=e?this.lowLabel:this.highLabel;if(t&&t.length>0){var n=e?this.lowVal:this.highVal,r=e?this.lowHandle:this.highHandle,i=t.find("span");i.text(this.formatLabel(n)),this.sliderType===this.$class.SINGLE_SLIDER?t.css({left:-0.5*i.width()+.5*r.width()}):e||t.css({left:this.timeSlider.width()-i.width()})}},updateTimeSlider:function(){this.timeSlider.slider("option",{min:0,max:this.values.length-1});switch(this.sliderType){case this.$class.RANGE_SLIDER:this.timeSlider.slider("option",{values:[$.inArray(this.lowVal,this.values),$.inArray(this.highVal,this.values)]});break;case this.$class.SINGLE_SLIDER:this.timeSlider.slider("option",{value:$.inArray(this.lowVal,this.values)})}},formatLabel:function(e){return r.formatDateCode(e,this.freq)},__classvars__:{RANGE_SLIDER:"rangeSlider",SINGLE_SLIDER:"singleSlider"}})}),define("text!templates/time_selector.html",[],function(){return'<div id="timeSliderContainer">\r\n	<div class="labelContainer"></div>\r\n	<div class="timeSlider{{#selectDateRange}} range{{/selectDateRange}}"></div>\r\n</div>\r\n<div id="frequencySelectorContainer">\r\n	<div class="labelContainer"></div>\r\n	{{#hasAnnual}}\r\n	<input type="radio" name="freqSelectorGroup" value="A" id="annual"/><label for="annual">Annual</label>\r\n	{{/hasAnnual}}\r\n	{{#hasQuarterly}}\r\n	<input type="radio" name="freqSelectorGroup" value="Q" id="quarterly"/><label for="quarterly">Quarterly</label>\r\n	{{/hasQuarterly}}\r\n	{{#hasMonthly}}\r\n	<input type="radio" name="freqSelectorGroup" value="M" id="monthly"/><label for="monthly">Monthly</label>\r\n	{{/hasMonthly}}\r\n</div>'}),define("js/view/VC_TimeSelection",["timeSlider","signals","text!templates/time_selector.html"],function(e,t,n){return e.$extend({frequencySelectionChanged:null,freqSelectors:null,__init__:function(e){this.$super(e),this.frequencySelectionChanged=new t.Signal},create:function(e,t,r,i,s){var o=this;this.freq=t,this.values=r,this.lowVal=i,this.highVal=s,this.container.html(Mustache.render(n,e)),$("#frequencySelectorContainer",this.container).buttonset(),this.freqSelectors=$("input:radio[name=freqSelectorGroup]",this.container),this.freqSelectors.change(function(){o.suppressSignals||o.frequencySelectionChanged.dispatch(o.freqSelectors.filter(":checked").val())}),this.timeSlider=$(".timeSlider",this.container),this.sliderType=this.timeSlider.hasClass("range")?this.$class.RANGE_SLIDER:this.$class.SINGLE_SLIDER,this.createSlider(),this.isCreated=!0,this.updateTimeSelection(t,r,i,s)},updateTimeSelection:function(e,t,n,r){this.$super(e,t,n,r),this.suppressSignals=!0,this.updateFreqSelectors(),this.suppressSignals=!1},updateFreqSelectors:function(){this.freqSelectors.filter("[value="+this.freq+"]").attr("checked",!0),$("#frequencySelectorContainer",this.container).buttonset("refresh")}})}),define("text!templates/analysisBox.html",[],function(){return'<div class="style2">\r\n	<h3>Related Analysis</h3>\r\n	<ul class="analysis_menu">\r\n		{{#relatedAnalysis}}\r\n		<li><a href="{{URL}}">{{TITLE}}</a></li>\r\n		{{/relatedAnalysis}}\r\n	</ul>\r\n	{{#moreAnalysisURL}}<a href="{{moreAnalysisURL}}">More...</a>{{/moreAnalysisURL}}\r\n	<br/>\r\n	<h3>Electricity Monthly Update</h3>\r\n	<a href="/electricity/monthly/update/">Electricity Monthly Update</a>\r\n	<h3>Additional Insight &amp; Data</h3>\r\n	<div class="add_insight">\r\n		<form id="historical" name="historical">\r\n			<label for="h_data">Historical Reports &amp; Data Files<br/>\r\n			<select class="link_prompt" id="h_data" style="width:204px" size="1" name="h_data" onchange="window.location.href = this.value;">\r\n				<option class="link_prompt" value="">Jump To</option>\r\n				<option class="link_option" value="/aer">Annual Energy Review</option>\r\n				<option class="link_option" value="/totalenergy/data/monthly/">Monthly Energy Review</option>\r\n				<option class="link_option" value="/electricity/annual/">Electric Power Annual</option>\r\n				<option class="link_option" value="/cneaf/electricity/page/data.html">Detailed Databases</option>\r\n			</select>\r\n			</label>\r\n		</form>\r\n\r\n		<form id="projections" name="projections">\r\n			<label for="p_data">Projections: <br/>\r\n			<select class="link_prompt" id="p_data" style="width:204px" size="1" name="p_data" onchange="window.location.href = this.value;">\r\n				<option class="link_prompt" value="">Jump To</option>\r\n				<option class="link_option" value="/forecasts/aeo/">Annual Energy Outlook</option>\r\n				<option class="link_option" value="/forecasts/steo/">Short-Term Energy Outlook</option>\r\n			</select>\r\n			</label>\r\n		</form>\r\n	</div>\r\n</div>'}),define("js/view/VC_Analysis",["classy","text!templates/analysisBox.html","signals","mustache"],function(e,t,n){return e.$extend({__init__:function(e){var t=this;this.container=e,this.button=$("#main_analysis_button"),this.analysisButtonClicked=new n.Signal,this.button.click(function(e){t.button.hasClass("disabled")||t.analysisButtonClicked.dispatch()})},generateAnalysis:function(e,n,r){e.empty();var i=$(Mustache.to_html(t,{relatedAnalysis:n.slice(0,4),moreAnalysisURL:n.length>5?r:void 0}));e.append(i)},showAnalysis:function(e,t){var n=this,r=n.button.offset(),i=function(e){$(e.target).parents("#analysis_dialog_container").length==0&&($.modal.close(),typeof i=="function"&&$("body").unbind("click",i))};this.generateAnalysis(this.container,e,t),$("#analysis_dialog_container").modal({autoPosition:!1,overlayClose:!0,fixed:!1,close:!1,persist:!0}),$("body").one("click",function(){$("body").bind("click",i)}),$("#simplemodal-container").css({top:r.top,left:r.left}),this.container.css({left:(this.button.outerWidth()-this.container.outerWidth())/2}),$(window).resize(this.resizeCallback=function(){var e=n.button.offset();$("#simplemodal-container").css({top:e.top,left:e.left})})},hideDownload:function(){$.modal.close(),typeof this.resizeCallback=="function"&&$(window).unbind("resize",this.resizeCallback),this.resizeCallback=null}})}),define("text!templates/lineChart.html",[],function(){return'<div id="lineChartContainer"></div>\r\n<div class="chartIndexing">\r\n	<form id="chartOptions">\r\n		<div id="indexContainer">\r\n			<span class="optionsLabel">Chart indexing options: </span>\r\n			<input type="radio" id="index0" name="index" value="0" checked="checked"/><label for="index0">None</label>\r\n			<input type="radio" id="index1" name="index" value="1"/><label for="index1">Index to start as percent</label>\r\n			<input type="radio" id="index2" name="index" value="2"/><label for="index2">Index to start as value</label>\r\n		</div>\r\n	</form>\r\n</div>'}),define("js/view/VC_LineChart",["signals","classy","js/view/DateCodeUtil","text!templates/lineChart.html"],function(e,t,n,r){return t.$extend({container:null,chart:null,indexingChanged:null,indexing:null,data:null,dataMap:null,dataColumns:null,freq:null,units:null,axis:null,series:null,seriesMap:null,seriesColorQueue:null,__init__:function(t){String.prototype.replaceAll=function(e,t){return t?this.replace(new RegExp("["+e+"]","g"),t):this};var n=this;this.indexing=null,this.data=[],this.dataMap={},this.dataColumns=[],this.freq="",this.units={},this.axis=[],this.series=[],this.seriesMap={},this.seriesColorQueue=this.$class.seriesColors.slice(0),this.container=t,this.indexingChanged=new e.Signal,this.container.html(Mustache.render(r)),$("#indexContainer",this.container).buttonset(),$('form input[name="index"]',this.container).on("change",function(e){n.indexingChanged.dispatch($(e.target).val())})},createSeriesOpts:function(e,t,r,i,s){var o={data:[],color:this.claimNextColor(),tooltip:{units:e.UNITS},xType:function(){switch(r){case"A":return Highcharts.xTypes.annual;case"Q":return Highcharts.xTypes.quarterly;case"M":return Highcharts.xTypes.monthly}}()},u=o.name=(s?e.PINNED_NAME:e.CHART_NAME)+(i?" ("+e.UNITS+")":""),a,f,l;for(l=0;l<t.length;l++){var c=parseInt(t[l].toString());o.data.push([n.parseDateCode(c,r).getTime(),isNaN(f=parseFloat(e.DATA[c]))?null:f])}return o},resetColorQueue:function(){this.seriesColorQueue=this.$class.seriesColors.slice(0)},claimNextColor:function(){return color=this.seriesColorQueue.shift(),this.seriesColorQueue.push(color),color},releaseColor:function(e){this.seriesColorQueue.splice($.inArray(e,this.seriesColorQueue),1),this.seriesColorQueue.unshift(e)},update:function(e,t,r,i,s,o,u,a,f){var l=this,c=[],h=[],p={},d,v,m,g;this.data=t,this.dataColumns=r,this.freq=i,this.indexing=s,this.seriesMap={},this.resetColorQueue(),this.setIndexed(this.indexing);if(this.indexing!=1)for(d=0;d<this.data.length;d++)t[d]!=null&&(m=t[d],g=m.UNITS,g in p||(p[g]=h.length,h.push($.extend(!0,{title:{text:g},opposite:h.length%2},this.$class.defaultYAxisOptions))));else g="Percent",p[g]=0,h.push($.extend({title:{text:g}},this.$class.defaultYAxisOptions));for(d=0;d<this.data.length;d++)if(t[d]!=null){m=t[d];var y=null;if((s==="1"||s==="2")&&!isNaN(m.DATA[o])||s==="0"||typeof s=="undefined")y=$.extend(this.createSeriesOpts(m,r,i,h.length>1?!0:!1,a),{yAxis:s==="1"?0:p[m.UNITS]}),c.push(y)}else this.claimNextColor();this.destroy(),v=$.extend(!0,{chart:{renderTo:$("#lineChartContainer",this.container).get(0),spacingBottom:0},title:{text:e},yAxis:h,xAxis:{min:n.parseDateCode(o,i).getTime(),max:n.parseDateCode(u,i).getTime()},series:c,userGenerated:f,exporting:{filename:e.replaceAll(":",",").replaceAll(" ","_")}},this.$class.defaultChartOptions),$.extend(!0,v,{exporting:{embedOptions:{series_id:null,analysis:this.indexing==2?"indexval":this.indexing==1?"indexpct":"none",relation_mode:"line"}}});var b=[];for(var d=0;d<t.length;d++)t[d]!=null&&b.push(t[d].SERIES_ID);b.length>0&&(v.exporting.embedOptions.series_id=b.join(";")),i=="A"&&(v.xAxis.tickInterval=31536e6);switch(s){case"1":$.extend(!0,v,{plotOptions:{series:{compare:"percent",tooltip:{precision:2}}},subtitle:{text:"Indexed to "+n.formatDateCode(o,i)+" as percent"},yAxis:Highcharts.map(v.yAxis,function(e){return $.extend(!0,e,{min:null,title:{align:v.yAxis.length>2?"middle":"above"}})})});break;case"2":$.extend(!0,v,{plotOptions:{series:{compare:"value"}},subtitle:{text:"Indexed to "+n.formatDateCode(o,i)+" as value"},yAxis:Highcharts.map(v.yAxis,function(e){return $.extend(!0,e,{min:null,title:{align:v.yAxis.length>2?"middle":"above"}})})});break;default:$.extend(!0,v,{plotOptions:{series:{compare:null}},yAxis:Highcharts.map(v.yAxis,function(e){return $.extend(!0,e,{min:0,title:{align:v.yAxis.length>2?"middle":"above"}})})})}this.units=p,this.axis=h,this.chart=new this.$class.chartConstructor(v),this.series=this.chart.series.slice(0),$.each(this.series,function(e,t){l.seriesMap[t.name]=e})},setStartEnd:function(e,t,r){this.chart.xAxis&&this.chart.xAxis.length>0&&this.chart.xAxis[0].setExtremes(n.parseDateCode(e,r).getTime(),n.parseDateCode(t,r).getTime());switch(this.indexing){case"1":this.chart.setTitle(null,{text:"Indexed to "+n.formatDateCode(e,r)+" as percent"});break;case"2":this.chart.setTitle(null,{text:"Indexed to "+n.formatDateCode(e,r)+" as value"});break;default:}},download:function(e){String.prototype.replaceAll=function(e,t){return t?this.replace(new RegExp("["+e+"]","g"),t):this};if(this.chart)if(e=="csv")this.chart.generateCSV();else{var t;switch(e){case"svg":t={url:"/global/scripts/jquery/highcharts/exporting-server/index.cfm",type:"image/svg+xml"};break;case"pdf":t={url:"/global/scripts/jquery/highcharts/exporting-server/index.cfm",type:"application/pdf"};break;case"png":default:t={url:"/global/scripts/jquery/highcharts/exporting-server/index.cfm"}}this.chart.exportChart(t)}},embed:function(){this.chart.openAPIEmbed()},setIndexed:function(e){$('form input[name="index"]').filter("[value="+e+"]").attr("checked",!0),$("#indexContainer",this.container).buttonset("refresh")},removeSeries:function(e){this.highchartSeries[e.CHART_NAME].remove(),delete this.seriesOptions[e.CHART_NAME]},destroy:function(){this.chart!=null&&(this.chart.hasRendered==1&&this.chart.destroy(),$(".chartCaptionsContainer",this.container).remove(),this.chart=null)},__classvars__:{chartConstructor:Highcharts.Chart,seriesColors:Highcharts.getOptions().colors,defaultYAxisOptions:{labels:{x:null,y:null}},defaultChartOptions:{chart:{zoomType:"",panning:!1,lineUpYAxisZeros:!0},xAxis:{maxZoom:1,type:"datetime",labels:{y:20},startOnTick:!1,showFirstLabel:!0},navigator:{enabled:!1},rangeSelector:{enabled:!1},scrollbar:{enabled:!1}}}})}),define("text!templates/columnChart.html",[],function(){return'<div id="columnChartContainer"></div>\r\n<div class="chartIndexing">\r\n	<form id="chartOptions">\r\n		<div id="indexContainer">\r\n			<div id="columnValuesContainer">\r\n				<span class="optionsLabel">Value options:</span>\r\n				<input type="radio" id="columnValues0" name="columnvalues" value="0" checked="checked"/><label for="columnValues0">Show values only</label>\r\n				<input type="radio" id="columnValues1" name="columnvalues" value="1"/><label for="columnValues1">Show percent change only</label>\r\n			</div>\r\n			<div id="columnEndpointsContainer">\r\n				<span class="optionsLabel">Series options:</span>\r\n				<input type="radio" id="columnEndpoints0" name="columnendpoints" value="0" checked="checked"><label for="columnEndpoints0">Graph first and last</label>\r\n				<input type="radio" id="columnEndpoints1" name="columnendpoints" value="1"><label for="columnEndpoints1">Graph first</label>\r\n				<input type="radio" id="columnEndpoints2" name="columnendpoints" value="2"><label for="columnEndpoints2">Graph last</label>\r\n			</div>\r\n		</div>\r\n	</form>\r\n</div>'}),define("js/view/VC_ColumnChart",["signals","classy","js/view/DateCodeUtil","text!templates/columnChart.html","mustache"],function(e,t,n,r){return t.$extend({seriesColorQueue:null,__init__:function(t){String.prototype.replaceAll=function(e,t){return t?this.replace(new RegExp("["+e+"]","g"),t):this};var n=this;this.container=t,this.container.html(Mustache.render(r)),this.endpointSelectionChanged=new e.Signal,this.valuesSelectionChanged=new e.Signal,this.data=[],this.dataMap={},this.seriesColorQueue=this.$class.seriesColors.slice(0),$("#columnValuesContainer",this.container).buttonset(),$("#columnEndpointsContainer",this.container).buttonset(),$('form input[name="columnendpoints"]',this.container).on("change",function(e){n.endpointSelectionChanged.dispatch($(e.target).val())}),$('form input[name="columnvalues"]',this.container).on("change",function(e){n.valuesSelectionChanged.dispatch($(e.target).val())})},update:function(e,t,r,i,s,o,u,a,f,l){var c=this,h=[],p=[],d=[],v="Change ",m=2,g={},y=a=="0",b=a=="1";!y&&!b&&(y=!0),b&&d.push({title:{text:"% Change"}}),this.resetColorQueue(),$.each(t,function(e,t){y&&t!=null&&(t.UNITS in g||(g[t.UNITS]=d.push({title:{text:t.UNITS},opposite:d.length%2})-1))}),$.each(t,function(e,t){t!=null?p.push({name:(f?t.PINNED_NAME:t.CHART_NAME)+(d.length>1?" ("+t.UNITS+")":""),yAxis:y?g[t.UNITS]:0,data:function(){var e=[];if(y){var n=t.DATA[s],r=t.DATA[o];switch(u){case"1":isNaN(n)?e.push(null):e.push(n);break;case"2":isNaN(r)?e.push(null):e.push(r);break;case"0":default:isNaN(n)?e.push(null):e.push(n),isNaN(r)?e.push(null):e.push(r)}}else{var i=t.DATA[s],a=t.DATA[o];!isNaN(i)&&!isNaN(a)&&i>0?e.push((a-i)/i*100):e.push(null)}return e}(),tooltip:b?{precision:m}:void 0,color:c.claimNextColor()}):c.claimNextColor()});var w=$.extend(!0,{chart:{renderTo:$("#columnChartContainer",this.container).get(0)},title:{text:e},series:p,xAxis:{categories:function(){var e=[];startVal=n.formatDateCode(s,i),endVal=n.formatDateCode(o,i);if(y)switch(u){case"1":e.push(startVal);break;case"2":e.push(endVal);break;case"0":default:e.push(startVal),e.push(endVal)}else e.push(v+startVal+"-"+endVal);return e}(),min:function(){switch(a){case"1":return 0;case"0":default:switch(u){case"1":case"2":return 0;case 0:default:return null}return null}return null}(),max:function(){switch(a){case"1":return 0;case"0":default:switch(u){case"1":case"2":return 0;default:return null}}return null}()},yAxis:$.map(d,function(e){return $.extend(e.title,{align:d.length>2?"middle":void 0}),e}),userGenerated:l,exporting:{filename:e.replaceAll(":",",").replaceAll(" ","_")}},this.$class.defaultChartOptions);$.extend(!0,w,{exporting:{embedOptions:{series_id:null,analysis:"none",relation_mode:"column"}}});var E=[];for(var S=0;S<t.length;S++)t[S]!=null&&E.push(t[S].SERIES_ID);E.length>0&&(w.exporting.embedOptions.series_id=E.join(";")),this.usePinnedName=f,this.userGenerated=l,this.title=e,this.data=t,this.dataColumns=r,this.freq=i,this.start=s,this.end=o,this.setEndpoints(u),this.setValues(a),this.destroy(),this.chart=new Highcharts.Chart(w)},download:function(e){if(this.chart)if(e=="csv")this.chart.generateCSV();else{var t;switch(e){case"svg":t={url:"/global/scripts/jquery/highcharts/exporting-server/index.cfm",type:"image/svg+xml"};break;case"pdf":t={url:"/global/scripts/jquery/highcharts/exporting-server/index.cfm",type:"application/pdf"};break;case"png":default:t={url:"/global/scripts/jquery/highcharts/exporting-server/index.cfm"}}this.chart.exportChart(t)}},setEndpoints:function(e){$('form input[name="columnendpoints"]',this.container).filter("[value="+e+"]").attr("checked",!0),$("#columnEndpointsContainer",this.container).buttonset("refresh"),this.endpoints=e},setValues:function(e){$('form input[name="columnvalues"]',this.container).filter("[value="+e+"]").attr("checked",!0),$("#columnValuesContainer",this.container).buttonset("refresh"),this.values=e},setStartEnd:function(e,t,n){this.update(this.title,this.data,this.dataColumns,n,e,t,this.endpoints,this.values,this.usePinnedName,this.userGenerated)},resetColorQueue:function(){this.seriesColorQueue=this.$class.seriesColors.slice(0)},claimNextColor:function(){return color=this.seriesColorQueue.shift(),this.seriesColorQueue.push(color),color},releaseColor:function(e){this.seriesColorQueue.splice($.inArray(e,this.seriesColorQueue),1),this.seriesColorQueue.unshift(e)},embed:function(){this.chart.openAPIEmbed()},destroy:function(){this.chart!=null&&(this.chart.hasRendered==1&&this.chart.destroy(),$(".chartCaptionsContainer",this.container).remove(),this.chart=null)},__classvars__:{seriesColors:Highcharts.getOptions().colors,defaultChartOptions:{chart:{defaultSeriesType:"column",lineUpYAxisZeros:!0,spacingBottom:0}}}})}),define("animatedComponent",["classy"],function(e){return e.$extend({__init__:function(){this.animation={enabled:!1,stepSize:1e3,iteration:0,interval:null}},update:function(e){$.extend(this.animation,e)},play:function(e,t){var n=this,r=function(){var t;n.animation.maxIteration&&(e?t=n.animation.iteration%n.animation.maxIteration:(t=Math.min(n.animation.iteration,n.animation.maxIteration),t==n.animation.maxIteration&&n.stop())),n.animation.callback&&n.animation.callback.call(n,t);if(n.animation.maxIteration===void 0||t+1<=n.animation.maxIteration)n.animation.iteration=t+1};this.animation.interval&&this.stop(),r(),this.animation.interval=setInterval(r,t||this.animation.stepSize)},stop:function(){clearInterval(this.animation.interval),this.animation.interval=null},reset:function(e){this.animation.iteration=Math.min(e,this.animation.maxIteration),this.animation.callback&&this.animation.callback.call(this,e)},destroy:function(){this.stop()}})}),define("map",["animatedComponent","signals","order!jVectorMap","order!usa-en"],function(e,t,n){return e.$extend({__init__:function(e,n){var r=this;this.$super(),this.container=e,this.regionClicked=new t.Signal,this.markerClicked=new t.Signal,this.mapContainer=$("#mapContainer",this.container),this.legendContainer=$("#map_legend",this.container),this.titleContainer=$("#mapTitle",this.container),this.titleContainer.length==0&&(this.titleContainer=$('<h2 id="mapTitle"></h2>').appendTo(this.container)),this.mapContainer.length==0&&(this.mapContainer=$('<div id="mapContainer"></div>').appendTo(this.container)),this.legendContainer.length==0&&(this.legendContainer=$('<div id="map_legend"></div>').appendTo(this.container)),this.counts=null,this.map=null,this.colors={},this.basemap=n==null?"usa_en":n,this.options={animation:{callback:function(e){this.colors?this.worldMap.series.regions[0].setValues(this.getCurrentColors()):this.worldMap.series.regions&&this.worldMap.series.regions.length>0?this.worldMap.series.regions[0].setValues(this.getCurrentCounts()):this.worldMap.series.markers&&this.worldMap.series.markers.length>0&&this.worldMap.series.markers[0].setValues(this.getCurrentCounts())}},map:this.basemap,normalizeFunction:"polynomial",hoverOpacity:.7,hoverColor:!1,backgroundColor:"white",dataPrecision:0}},play:function(e,t){this.$super(e,t)},update:function(e,t,n){var r=this;typeof n!="undefined"&&typeof n.map!="undefined"&&(this.basemap=n.map,this.options.map=n.map),this.counts=$.map(e instanceof Array?e:[e],function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(jvm.WorldMap.maps[r.basemap].paths.hasOwnProperty(n.toUpperCase())?t[n.toUpperCase()]=e[n]:jvm.WorldMap.maps[r.basemap].paths.hasOwnProperty(n.toLowerCase())?t[n.toLowerCase()]=e[n]:t[n]=e[n]);return t}),this.options=$.extend(this.options||{},n),this.$super($.extend(!0,this.animation,this.options.animation,{maxIteration:e.length-1})),this.setTitle(t),this.calculateMinMax(),typeof this.assignColors=="function"&&this.assignColors(),this.createLegend(),this.setContainerHeight(),this.createMap()},setContainerHeight:function(){this.mapContainer.height(this.mapContainer.parent().height()-(this.titleContainer.outerHeight(!0)+this.legendContainer.outerHeight(!0)+parseInt(this.mapContainer.css("paddingTop"))+parseInt(this.mapContainer.css("paddingBottom"))+10))},calculateMinMax:function(){this.min=this.max=null;for(var e=0;e<this.counts.length;e++)for(var t in this.counts[e])this.counts[e].hasOwnProperty(t)&&(this.min=this.min==null||this.counts[e][t]<this.min?this.counts[e][t]:this.min,this.max=this.max==null||this.counts[e][t]>this.max?this.counts[e][t]:this.max);this.min!==null&&(this.min=parseFloat(Highcharts.numberFormat(this.min,this.options.dataPrecision,".",""))),this.max!==null&&(this.max=parseFloat(Highcharts.numberFormat(this.max,this.options.dataPrecision,".","")))},setTitle:function(e){this.titleContainer.text(e)},createRegionOps:function(){return[{values:this.colors?this.getCurrentColors():this.getCurrentCounts(),min:this.min,max:this.max,scale:this.colors?void 0:this.$class.palette}]},createMarkerOps:function(){return this.options.markers?[{values:this.colors?this.getCurrentColors():this.getCurrentCounts(),min:this.min,max:this.max,scale:this.colors?void 0:this.$class.palette}]:null},createMap:function(){var e=this;this.worldMap&&this.worldMap.remove(),this.regionOps=this.createRegionOps(),this.markerOps=this.createMarkerOps();var t={};this.regionOps&&(t.regions=this.regionOps),this.markerOps&&(t.markers=this.markerOps),this.mapContainer.empty(),this.map=$('<div style="height:100%;width:100%;" class="map_inside_container"></div>').appendTo(this.mapContainer).vectorMap($.extend(!0,{regionStyle:{initial:{fill:"#CCCCCC","fill-opacity":1,stroke:"none","stroke-width":0,"stroke-opacity":1},hover:{"fill-opacity":.8},selected:{fill:"yellow"}},series:t,onRegionClick:function(t,n){e.regionClicked.dispatch(n.toUpperCase(),t)},onMarkerClick:function(t,n){e.markerClicked.dispatch(e.options.markers[n],t)},zoomOnScroll:!1},this.options)),this.worldMap=this.mapContainer.find(".jvectormap-container").data("mapObject")},createLegend:function(e,t){},getCurrentColors:function(){var e={};return $.each(jvm.WorldMap.maps[this.basemap].paths,function(t,n){e[t]=""}),$.extend(e,this.colors[this.animation.iteration])},getCurrentCounts:function(){return this.counts[this.animation.iteration]},destroy:function(){this.worldMap&&this.worldMap.remove(),this.mapContainer.empty(),this.legendContainer.empty(),this.titleContainer.empty()},assignColors:function(e,t,n){},exportMap:function(e){if(!window.SVGAngle)throw"SVG not supported";var t="white",n=$(".jvectormap-container").html(),r=$(".jvectormap-container").html(),i=$(".jvectormap-container").find("svg").attr("height");i=parseInt(i)+20;var s=n.indexOf("height");s=n.indexOf('"',s);var o=n.indexOf('"',s+1);n=n.slice(0,s+1)+i+n.slice(o),n=n.replace(/<div[^<]+<\/div>/gi,""),n=n.replace(/<svg /gi,'<svg xmlns="http://www.w3.org/2000/svg"  version="1.1" '),n=n.replace(/<g><\/g>/gi,""),n=n.replace(/<g/,'<rect x="0" y="0" width="100%" height="100%" fill="'+t+'"></rect><g'),n=n.replace(/zIndex="[^"]+"/g,"").replace(/isShadow="[^"]+"/g,"").replace(/symbolName="[^"]+"/g,"").replace(/jQuery[0-9]+="[^"]+"/g,"").replace(/isTracker="[^"]+"/g,"").replace(/url\([^#]+#/g,"url(#").replace(/&nbsp;/g,"Â ").replace(/&shy;/g,"Â­").replace(/id=([^" >]+)/g,'id="$1"').replace(/class=([^" ]+)/g,'class="$1"').replace(/ transform /g," ").replace(/:(path|rect)/g,"$1").replace(/style="([^"]+)"/g,function(e){return e.toLowerCase()}),n=n.replace(/(url\(#highcharts-[0-9]+)&quot;/g,"$1").replace(/&quot;/g,"'"),n.match(/ xmlns="/g)&&n.match(/ xmlns="/g).length===2&&(n=n.replace(/xmlns="[^"]+"/,""));var u="/global/scripts/jquery/highcharts/exporting-server/index.cfm",a="";switch(e){case"svg":a="image/svg+xml";break;case"pdf":a="application/pdf";break;case"png":default:a="image/png"}String.prototype.replaceAll=function(e,t){return t?this.replace(new RegExp("["+e+"]","g"),t):this};var f=$('<form action="'+u+'" method="POST">'+'<input type="hidden" name="svg" id="hiddensvg">'+'<input type="hidden" name="type" value="'+a+'">'+'<input type="hidden" name="filename" value="map_of_'+this.titleContainer.text().replaceAll(":",",").replaceAll(" ","_")+'">'+"</form>");$("body").append(f),f.find("input[id=hiddensvg]").val(n),f.submit(),f.remove()},__classvars__:{palette:["#7ce3ff","#4cc9ff","#0196d8","#00628c","#00355b"]}})}),define("continuousMap",["signals","map","order!jVectorMap","order!usa-en"],function(e,t,n){return t.$extend({__init__:function(e,t){this.$super(e,t)},createLegend:function(e){var t=this,n=this,r,i,s,o,u,a;this.legendContainer.empty();var f=$('<span style="display: inline-block; text-align:center;"></span>').appendTo(this.legendContainer);this.options.legendTitle&&($('<span class="map_legend_title">'+this.options.legendTitle+"</span>").appendTo(f),$("<br />").appendTo(f)),t.options.legendItemFormatter?(u=t.options.legendItemFormatter.call(t,this.min),a=t.options.legendItemFormatter.call(t,this.max)):(u=this.min,a=this.max),t.$class.drawGradient(f,t.$class.palette[0],t.$class.palette[t.$class.palette.length-1],u,a),$("<br />").appendTo(f),$("<br />").appendTo(f);var l=$("<div/>").appendTo(f);$("<span/>").appendTo(l).attr("style","display:inline-block;margin-right:10px;width:20px;height:20px;background-color:#CCC"),$("<span>Value is not available</span>").appendTo(l).attr("style","margin-top:3px;display:inline-block;")},assignColors:function(){var e=[],t=this.max,n=this.min,r=parseInt(this.$class.palette[0].substring(1,3),16),i=parseInt(this.$class.palette[this.$class.palette.length-1].substring(1,3),16),s=parseInt(this.$class.palette[0].substring(3,5),16),o=parseInt(this.$class.palette[this.$class.palette.length-1].substring(3,5),16),u=parseInt(this.$class.palette[0].substring(5),16),a=parseInt(this.$class.palette[this.$class.palette.length-1].substring(5),16),f,l,c,h,p,d;for(var v=0;v<this.counts.length;v++)for(f in this.counts[v]){e[v]||(e[v]={}),l=parseFloat(Highcharts.numberFormat(this.counts[v][f],this.options.dataPrecision,".","")),c=(l-n)/(t-n);switch(this.scaleType){case"logarithmic":c=(Math.log(l)-Math.log(n))/(Math.log(t)-Math.log(n))}h=parseInt(c*i-(c-1)*r,10).toString(16).replace(/^(\w{1})$/,"0$1"),p=parseInt(c*o-(c-1)*s,10).toString(16).replace(/^(\w{1})$/,"0$1"),d=parseInt(c*a-(c-1)*u,10).toString(16).replace(/^(\w{1})$/,"0$1"),e[v][f]="#"+h+p+d}this.colors=e},__classvars__:{drawGradient:function(e,t,n,r,i){var s="";s+="background-image: -ms-linear-gradient(left, "+t+" 0%, "+n+" 100%);",s+='-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr='+t+", endColorstr="+n+', gradientType=1)";',s+="filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="+t+", endColorstr="+n+", gradientType=1)",s+="background-image: -webkit-gradient(linear, left bottom, right bottom, from("+t+"), to("+n+"));",s+="background-image: -webkit-linear-gradient(left, "+t+", "+n+");",s+="background-image:    -moz-linear-gradient(left, "+t+", "+n+");",s+="background-image:      -o-linear-gradient(left, "+t+", "+n+";",s+="background-image:         linear-gradient(to left, "+t+","+n+");",$("<span>"+r+"</span>").appendTo(e),$('<span class="map_legend_gradient"></span>').appendTo(e).attr("style",s),$("<span>"+i+"</span>").appendTo(e)}}})}),define("growthMap",["map"],function(e){return e.$extend({__init__:function(e,t){this.$super(e,t)},update:function(e,t,n){e=$.map(e,function(t,n){var r={};for(var i in t)t.hasOwnProperty(i)&&n>0&&typeof e[n-1]!="undefined"&&e[n-1].hasOwnProperty(i)&&t[i]*e[n-1][i]>0&&(r[i]=100*(t[i]-e[n-1][i])/e[n-1][i]);return r}),this.$super(e,t,$.extend({},n,{backgroundColor:"#ffffff"}))},createRegionOps:function(){return[{attributes:this.getCurrentColors()}]},createLegend:function(){var e=this,t,n,r,i,s,o;this.legendContainer.empty();var u=$('<span style="display: inline-block; text-align:center;"></span>').appendTo(this.legendContainer);this.options.legendTitle&&($('<span class="map_legend_title">'+this.options.legendTitle+"</span>").appendTo(u),$("<br />").appendTo(u)),e.options.legendItemFormatter?(s=e.options.legendItemFormatter.call(e,this.min),o=e.options.legendItemFormatter.call(e,this.max)):(s=this.min,o=this.max);var a="",f="";a+="background-image: -ms-linear-gradient(left, "+this.$class.palette[0]+" 0%, "+this.$class.palette[1]+" 100%);",a+='-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr='+this.$class.palette[0]+", endColorstr="+this.$class.palette[1]+', gradientType=1)";',a+="filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="+this.$class.palette[0]+", endColorstr="+this.$class.palette[1]+", gradientType=1)",a+="background-image: -webkit-gradient(linear, left bottom, right bottom, from("+this.$class.palette[0]+"), to("+this.$class.palette[1]+"));",a+="background-image: -webkit-linear-gradient(left, "+this.$class.palette[0]+", "+this.$class.palette[1]+");",a+="background-image:    -moz-linear-gradient(left, "+this.$class.palette[0]+", "+this.$class.palette[1]+");",a+="background-image:      -o-linear-gradient(left, "+this.$class.palette[0]+", "+this.$class.palette[1]+";",a+="background-image:         linear-gradient(to left, "+this.$class.palette[0]+","+this.$class.palette[1]+");",f+="background-image: -ms-linear-gradient(left, "+this.$class.palette[3]+" 0%, "+this.$class.palette[4]+" 100%);",f+='-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr='+this.$class.palette[3]+", endColorstr="+this.$class.palette[4]+', gradientType=1)";',f+="filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="+this.$class.palette[3]+", endColorstr="+this.$class.palette[4]+", gradientType=1)",f+="background-image: -webkit-gradient(linear, left bottom, right bottom, from("+this.$class.palette[3]+"), to("+this.$class.palette[4]+"));",f+="background-image: -webkit-linear-gradient(left, "+this.$class.palette[3]+", "+this.$class.palette[4]+");",f+="background-image:    -moz-linear-gradient(left, "+this.$class.palette[3]+", "+this.$class.palette[4]+");",f+="background-image:      -o-linear-gradient(left, "+this.$class.palette[3]+", "+this.$class.palette[4]+";",f+="background-image:         linear-gradient(to left, "+this.$class.palette[3]+","+this.$class.palette[4]+");",$("<span>"+s+"</span>").appendTo(u);var l=$('<span class="map_legend_gradient"></span>').appendTo(u);$('<span class="growth_gradient_component"></span>').attr("style",a).appendTo(l),$('<span class="growth_gradient_component"></span>').attr("style",f).appendTo(l),$("<span>"+o+"</span>").appendTo(u),$("<br />").appendTo(u),$("<br />").appendTo(u);var c=$("<div/>").appendTo(u);$("<span></span").appendTo(c).attr("style","display:inline-block;margin-right:10px;width:20px;height:20px;background-color:#CCC"),$("<span>Value is not available</span>").appendTo(c).attr("style","margin-top:3px;display:inline-block;")},calculateMinMax:function(){this.options.extremes!==void 0?(this.min=this.options.extremes.min,this.max=this.options.extremes.max):(this.$super(),this.max>0&&this.min<0&&(Math.abs(this.min)>this.max?this.max=Math.abs(this.min):this.min=-1*this.max))},assignColors:function(){var e=[],t=this.max,n=this.min,r,i,s,o,u,a,f,l,c,h,p,d,v;for(var m=0;m<this.counts.length;m++)for(f in this.counts[m])l=parseFloat(Highcharts.numberFormat(this.counts[m][f],this.options.dataPrecision,".","")),l<0?(h=(l-n)/(-1*n),r=parseInt(this.$class.palette[0].substring(1,3),16),i=parseInt(this.$class.palette[1].substring(1,3),16),s=parseInt(this.$class.palette[0].substring(3,5),16),o=parseInt(this.$class.palette[1].substring(3,5),16),u=parseInt(this.$class.palette[0].substring(5),16),a=parseInt(this.$class.palette[1].substring(5),16),p=(r<i?Math.max:Math.min).call(window,parseInt(h*i-(h-1)*r,10),r).toString(16).replace(/^(\w{1})$/,"0$1"),d=(s<o?Math.max:Math.min).call(window,parseInt(h*o-(h-1)*s,10),s).toString(16).replace(/^(\w{1})$/,"0$1"),v=(u<a?Math.max:Math.min).call(window,parseInt(h*a-(h-1)*u,10),u).toString(16).replace(/^(\w{1})$/,"0$1")):l>0?(h=l/t,r=parseInt(this.$class.palette[3].substring(1,3),16),i=parseInt(this.$class.palette[4].substring(1,3),16),s=parseInt(this.$class.palette[3].substring(3,5),16),o=parseInt(this.$class.palette[4].substring(3,5),16),u=parseInt(this.$class.palette[3].substring(5),16),a=parseInt(this.$class.palette[4].substring(5),16),p=(r>i?Math.max:Math.min).call(window,parseInt(h*i-(h-1)*r,10),i).toString(16).replace(/^(\w{1})$/,"0$1"),d=(s>o?Math.max:Math.min).call(window,parseInt(h*o-(h-1)*s,10),o).toString(16).replace(/^(\w{1})$/,"0$1"),v=(u>a?Math.max:Math.min).call(window,parseInt(h*a-(h-1)*u,10),a).toString(16).replace(/^(\w{1})$/,"0$1")):(p=this.$class.palette[2].substring(1,3),d=this.$class.palette[2].substring(3,5),v=this.$class.palette[2].substring(5)),e[m]||(e[m]={}),e[m][f]="#"+p+d+v;this.colors=e},__classvars__:{palette:["#6F2EA4","#C5ABDB","#CCCCCC","#BED5AD","#5D9732"]}})}),define("text!templates/animatedMap.html",[],function(){return'<h2 id="mapTitle"></h2>\r\n<div id="mapContainer"></div>\r\n<div id="controls_container">\r\n	<h2>Map controls &amp; legend</h2>\r\n	<div class="animated_map_button_container">\r\n		<div id="animated_map_type_container">\r\n			<span class="optionsLabel">Value options:</span>\r\n			{{#mapTypes}}\r\n			<input id="radio_{{id}}" type="radio" name="animated_map_type_radio" value="{{id}}" /><label for="radio_{{id}}">{{title}}</label>\r\n			{{/mapTypes}}\r\n		</div>\r\n		<br/>	\r\n		<div id="animated_map_slider"></div>\r\n		<br/>\r\n		<div id="animated_map_transport_container">\r\n			<input type="checkbox" id="play_button"></input><label for="play_button">Play</label>\r\n			<input type="checkbox" id="pause_button"></input><label for="pause_button">Pause</label>\r\n			<button id="reset_button">Reset</button>\r\n		</div>\r\n		<hr>\r\n		<div id="map_units_label_container">\r\n			<span id="map_units_label"></span>\r\n		</div>\r\n		<div id="map_legend"></div>\r\n	</div>\r\n</div>\r\n'}),define("js/view/VC_AnimatedMap",["classy","continuousMap","growthMap","signals","js/view/DateCodeUtil","text!templates/animatedMap.html","mustache","us-merc-en"],function(e,t,n,r,i,s){return e.$extend({__init__:function(e){this.ContinuousMapClass=t=t.$extend({__classvars__:{palette:["#b0efff","#001F37"]}}),this.GrowthMapClass=n;var i=this;this.container=e,this.container.html(Mustache.render(s,{mapTypes:[{id:this.$class.CONTINUOUS_MAP,title:"Values"},{id:this.$class.GROWTH_MAP,title:"Growth"}]})),this.createPlayerControls(),this.mapTypeButtonset=$("#animated_map_type_container",this.container).buttonset(),this.mapTypeSelector=$("[name=animated_map_type_radio]",this.container),this.unitsLabel=$("#map_units_label",this.container),this.mapTypeChangeRequested=new r.Signal,this.mapTypeSelectorHandler=function(e){i.mapTypeChangeRequested.dispatch(i.mapTypeSelector.filter(":checked").val())}},embed:function(){var e=this.options.embedOptions,t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+"="+e[n]);window.open("/opendata/embed.cfm?"+t.join("&"))},createPlayerControls:function(){var e=this;this.playButton=$("#play_button",this.container).button({icons:{primary:"map_play_icon"}}),this.pauseButton=$("#pause_button",this.container).button({icons:{primary:"map_pause_icon"}}),this.resetButton=$("#reset_button",this.container).button({icons:{primary:"map_reset_icon"}}),this.slider=$("#animated_map_slider",this.container).slider(),this.handle=$("#animated_map_slider",this.container).children(".ui-slider-handle"),this.sliderLabel=$('<div class="map_slider_tooltip" style="margin-top: -18px;"></div>').css({position:"absolute"}).appendTo(this.handle),this.playHandler=function(){e.map.stop(),e.position==e.displayColumns[e.displayColumns.length-1]&&e.map.reset(0),e.setButtonState(!0),e.map.play(!1,300)},this.pauseHandler=function(){e.map.stop(),e.setButtonState(!1)},this.resetHandler=function(){e.map.stop(),e.map.reset(e.displayColumns.length-1),e.position=e.displayColumns[e.displayColumns.length-1],e.map.setTitle(e.title+" "+e.displayColumns[e.displayColumns.length-1]),e.setButtonState(!1),$("#reset_button").removeClass("red")},this.sliderHandler=function(t,n){e.map.stop(),e.map.reset(n.value),e.position=e.displayColumns[n.value],e.setButtonState(!1)},$('label[for="'+this.pauseButton.attr("id")+'"]').hide()},destroy:function(){this.map&&this.map.destroy()},update:function(e,t,n,r,s,o,u){var a=this,f=0;this.displayColumns=[],this.counts=[],this.basemap=typeof u=="undefined"?"us_merc_en":u,this.title=e.TITLE,this.data=e,this.mapType=t,this.start=n,this.end=r,this.options=o,this.map&&(this.map.stop(),this.map.destroy()),this.setButtonState(!1);switch(t){case this.$class.GROWTH_MAP:this.map=new this.GrowthMapClass(this.container,this.basemap),this.units="Percent change from prior",this.precision=2;break;default:this.map=new this.ContinuousMapClass(this.container,this.basemap),this.units=e.UNITS||"",this.precision=e.PRECISION}this.unitsLabel.text(this.units),this.mapTypeSelector.filter("[value="+t+"]").attr("checked","true"),this.mapTypeButtonset.buttonset("refresh"),$.each(e.DATACOLUMNS,function(t,i){i>=n&&i<=r&&(a.displayColumns.push(i),a.counts.push(e.DATA[i]))}),this.position!==void 0?(f=$.inArray(this.position,this.displayColumns),~f||(f=this.displayColumns.length-1)):f=this.displayColumns.length-1,this.map.animation.enabled=!0,this.map.update(this.counts,this.title+" "+this.displayColumns[f],$.extend({animation:{enabled:!0,callback:function(e){this.colors?this.worldMap.series.regions[0].setValues(this.getCurrentColors()):this.worldMap.series.regions&&this.worldMap.series.regions.length>0&&this.worldMap.series.regions[0].setValues(this.getCurrentCounts());var t={},n=a.displayColumns[e];a.position=n;var r=typeof n=="undefined"||n==null?"":i.formatDateCode(n,s);a.map.setTitle(a.title+" "+r),a.sliderLabel.text(r),t.left=-0.5*a.sliderLabel.width()+.5*a.handle.width(),a.sliderLabel.height()>1.5*parseInt(a.sliderLabel.css("font-size").slice(0,-2),10)?t.top=-0.5*a.sliderLabel.height():t.top=0,a.sliderLabel.css(t),a.slider.slider("option","value",e),e==a.displayColumns.length-1&&a.setButtonState(!1),this.basemap=="coal_basin_merc_en"&&$('path[data-code^="US-"]',this.container).attr("fill","#666666")},iteration:f},continuous:!0,isGrowth:!0,dataPrecision:2,extremes:{min:-100,max:100},legendItemFormatter:function(e){var n;return t==a.$class.GROWTH_MAP?(n=Highcharts.numberFormat(e,a.precision)+"%",e>0&&(n+="+")):n=Highcharts.numberFormat(e,a.precision),n},zoomOnScroll:!0,onRegionLabelShow:function(e,t,n){if(n){var r=a.map.getCurrentCounts()[n];r!==void 0&&$(t).html($(t).html()+" "+Highcharts.numberFormat(r,a.precision)+" "+(a.mapType==a.$class.GROWTH_MAP?"% change from "+i.formatDateCode(i.deincrementDateCode(a.position,s),s)+" to "+i.formatDateCode(a.position,s):a.units))}else t.empty()}},o)),this.map.reset(f),this.slider.slider("option","min",0),this.slider.slider("option","max",this.displayColumns.length-1),this.slider.slider("option","value",f),typeof this.sliderHandler=="function"&&this.slider.unbind("slide",this.sliderHandler),this.slider.bind("slide",this.sliderHandler),typeof this.playHandler=="function"&&this.playButton.unbind("click",this.playHandler),this.playButton.bind("click",this.playHandler),typeof this.pauseHandler=="function"&&this.pauseButton.unbind("click",this.pauseHandler),this.pauseButton.bind("click",this.pauseHandler),typeof this.resetHandler=="function"&&this.resetButton.unbind("click",this.resetHandler),this.resetButton.bind("click",this.resetHandler),typeof this.mapTypeSelectorHandler=="function"&&this.mapTypeSelector.unbind("change",this.mapTypeSelectorHandler),this.mapTypeSelector.bind("change",this.mapTypeSelectorHandler)},setButtonState:function(e){e&&(this.playButton.attr("checked",!1),$('label[for="'+this.playButton.attr("id")+'"]').hide(),$('label[for="'+this.pauseButton.attr("id")+'"]').show()),e||(this.pauseButton.attr("checked",!1),$('label[for="'+this.pauseButton.attr("id")+'"]').hide(),$('label[for="'+this.playButton.attr("id")+'"]').show()),this.playButton.button("refresh"),this.pauseButton.button("refresh")},outputToArrOfArrs:function(){var e=[],t=[],n=this.map.worldMap.regions,r,i,s,o;for(r in n)n.hasOwnProperty(r)&&t.push(r);t.sort(),e.push(["Units: "+(this.mapType==this.$class.GROWTH_MAP?"percent change from previous period":this.data.UNITS)]);var u=this.displayColumns.slice();u.unshift(""),e.push(u);for(s=0;s<t.length;s++){r=t[s],e.push(o=['"'+r+'"']);for(i=0;i<this.counts.length;i++)o.push(this.map.counts[i][r]||"")}return e},__classvars__:{CONTINUOUS_MAP:"0",GROWTH_MAP:"1"}})}),define("qTipsHelp",["classy","signals","qtips"],function(e,t){return e.$extend({__init__:function(){var e=this;this.tooltipsShown=!1,this.button=$("#help_button"),this.helpButtonClicked=new t.Signal,this.button.click(function(t){e.button.hasClass("disabled")||e.helpButtonClicked.dispatch()}),this.windowMouseDownHandler=function(t){var n=function(e){var n=t.target;while(n.parentNode){if(n.parentNode==e)return!0;n=n.parentNode}return!1}(e.button.get(0));e.tooltipsShown&&!n&&e.hideHelpTooltips()}},toggleHelpTooltips:function(e){this.tooltipsShown?this.hideHelpTooltips():this.showHelpTooltips(e)},showHelpTooltips:function(e){var t=this;this.button.css("cursor","wait").addClass("selected");for(var n=0;n<e.length;n++){var r=typeof e[n].selector=="function"?e[n].selector():$(e[n].selector);$.each($(r),function(r,s){$(s).is(":visible")&&($(s).attr("class",$(s).attr("class")+" help_target"),$(s).qtip({content:{prerender:!0,text:e[n].tip},show:"null",hide:"null",style:{tip:!0,name:"cream",width:e[n].width?e[n].width:250},position:{corner:{target:e[n].position,tooltip:t.$class.qtipsOpposite[e[n].position]},adjust:{x:e[n].xAdjust?e[n].xAdjust:0,y:e[n].yAdjust?e[n].yAdjust:0}}}))})}$(".help_target").qtip("show"),this.button.css("cursor","default"),$("body").width(Math.max($(window).width(),1600)).mousedown(this.windowMouseDownHandler),$(window).scrollLeft(($("body").width()-$(window).width())/2).resize(),this.tooltipsShown=!0},hideHelpTooltips:function(){this.button.removeClass("selected"),$(".qtip iframe").hide(),$(".help_target").removeClass("help_target").qtip("destroy"),$("body").width("100%").scroll().unbind("mousedown",this.windowMouseDownHandler),this.tooltipsShown=!1,$(window).resize()},__classvars__:{qtipsOpposite:{topLeft:"bottomRight",topMiddle:"bottomMiddle",topRight:"bottomLeft",bottomLeft:"topRight",bottomMiddle:"topMiddle",bottomRight:"topLeft",leftTop:"rightBottom",leftMiddle:"rightMiddle",leftBottom:"rightTop",rightTop:"leftBottom",rightMiddle:"leftMiddle",rightBottom:"leftTop",center:"center"}}})}),define("viewStack",["classy"],function(e){return e.$extend({__init__:function(e){this.container=e,this.viewNames=[],this.viewsMap={}},addView:function(e,t){return t||(t=$("<div/>").attr("id",e)),this.container.append(t),this.viewNames.push(e),this.viewsMap[e]=t,this.viewNames.length==1?this.setActiveView(e):this.positionView(t,!1),t},removeView:function(e){if(this.viewsMap.hasOwnProperty(e)){var t=this.viewsMap[e];delete this.viewsMap[e],this.viewNames.splice($.indexOf(this.viewNames,e),1),t.remove(),this.activeName==e&&this.viewNames.length>0&&this.setActiveView(this.viewNames[0])}},getView:function(e){return this.viewsMap[e]},hasView:function(e){return e in this.viewsMap},setActiveView:function(e){if(e==this.activeName)return;if(!(e in this.viewsMap))throw new Error("Invalid View Name");this.activeName=e;for(var t in this.viewsMap)if(this.viewsMap.hasOwnProperty(t)){var n=this.viewsMap[t];this.positionView(n,t==e)}},positionView:function(e,t){e.css({display:t?"block":"none"})}})}),define("text!templates/tableTitle.html",[],function(){return"<h1>{{title}}</h1>"}),define("text!templates/footnotes.html",[],function(){return'NM = Not meaningful due to large relative standard error.  {{#rseAvailable}}Show relative standard errors expressed as percent in parenthesis: <input type="checkbox" id="rse_checkbox"></input>{{/rseAvailable}}\r\n</BR>\r\n<a class="lightbox" id="termsLink" href="dataservice/termsAndDefs.cfm?topic={{topic}}&showDetail={{showDetail}}&showFilterValues={{showFilterValues}}">Terms and definitions</a>'}),define("js/pages/AggregateDataPage",["hasher","signals","puremvc","classy","page","js/Facade","js/Controller","js/model/AggregateDataConfigProxy","js/model/AggregateDataRequestProxy","js/model/AggregateDataParameterProxy","js/model/AggregateDataTableDataProxy","js/model/HelpTooltipProxy","js/model/MapDataProxy","js/view/MediatorElectricityTopicSelection","js/view/MediatorForm","js/view/MediatorDownload","js/view/MediatorVisualization","js/view/MediatorPinKeyVisualization","js/view/MediatorViewStack","js/view/MediatorLineChart","js/view/MediatorColumnChart","js/view/MediatorDualSliderTimeSelection","js/view/MediatorHelpTooltip","js/view/MediatorAnimatedMap","js/view/MediatorAnalysis","js/view/MediatorAggregateDataGrid","js/view/VC_PageLayout","js/view/VC_Form","js/view/VC_Download","js/view/VC_Visualization","js/view/VC_Selection","js/view/VC_TimeSelection","js/view/VC_Analysis","js/view/VC_LineChart","js/view/VC_ColumnChart","js/view/VC_AnimatedMap","js/view/DateCodeUtil","js/view/GridFormatters","datagrid","qTipsHelp","viewStack","text!templates/tableTitle.html","text!templates/footnotes.html","simpleModal"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U){var z=null,W=i.$extend({load:function(e){$("#pagecontent").addClass("aggregate"),this.$super(e),i.clearErrorMessage(),z?z.sendNotification(X.RELOAD,e):(z=X.getInstance(this.name),z.sendNotification(X.STARTUP,e))},unload:function(){z.sendNotification(X.UNLOAD),X.removeCore(this.name),z=null,this.$super(),$("#pagecontent").removeClass("aggregate")}})("js/pages/AggregateDataPage"),X=s.$extend({initializeController:function(){this.$super(),this.registerCommand(this.$class.STARTUP,V),this.registerCommand(this.$class.RELOAD,J),this.registerCommand(this.$class.TABLE_PARAMS_UPDATED,o.TableParamsUpdatedCommand),this.registerCommand(this.$class.CHART_PARAMS_UPDATED,o.UpdateChartDataCommand),this.registerCommand(this.$class.TABLE_RENDERED,o.HideLoadMaskCommand),this.registerCommand(this.$class.TABLE_SELECTION_UPDATED,G),this.registerCommand(this.$class.FREQUENCY_SELECTION_UPDATED,o.FrequencySelectionUpdatedCommand),this.registerCommand(this.$class.TOPIC_SELECTION_UPDATED,Y),this.registerCommand(this.$class.REPORT_SELECTION_UPDATED,Z),this.registerCommand(this.$class.TIME_SELECTION_UPDATED,o.UpdateHashCommand),this.registerCommand(this.$class.CHART_SELECTION_UPDATED,o.UpdateHashCommand),this.registerCommand(this.$class.CHART_DATA_UPDATED,et),this.registerCommand(this.$class.TABLEDATA_UPDATED,et),this.registerCommand(this.$class.DEFAULT_CHART_SET,o.UpdateChartedCommand),this.registerCommand(this.$class.CSV_DATA_GENERATED,o.OutputToCSVCommand),this.registerCommand(this.$class.ERROR,o.ErrorCommand),this.registerCommand(this.$class.MAP_TYPE_SELECTION_UPDATED,o.UpdateHashCommand),this.registerCommand(this.$class.RSE_SELECTION_UPDATED,o.UpdateHashCommand),this.registerCommand(this.$class.AGGREGATE_DATA_CLICK_THROUGH,Y),this.registerCommand(this.$class.SOURCE_KEY_SELECTED,o.OpenAPIWindowCommand),this.registerCommand(this.$class.PIN_KEY_SELECTION_UPDATED,o.UpdateHashCommand)},__classvars__:{getInstance:function(e){return n.Facade.hasCore(e)||new X(e),n.Facade.getInstance(e)}}}),V=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(K),this.addSubCommand(Q),this.addSubCommand(o.UpdateParameterProxyCommand)}}),J=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.UpdateRequestProxyCommand),this.addSubCommand(o.UpdateParameterProxyCommand)}}),K=n.SimpleCommand.$extend({execute:function(e){var t=this,n=new u,r=new a(e.getBody()),i=new f,s=new l,o=new c,p=new h;this.facade.registerProxy(r),this.facade.registerProxy(n),this.facade.registerProxy(i),this.facade.registerProxy(s),this.facade.registerProxy(o),this.facade.registerProxy(p);var d={id:"csv_table",type:"csv","class":"ico_csv",target:"table",label:"Table (CSV)"},v=$.extend({},{map:[{label:"Map",children:[{id:"map_png",type:"png","class":"ico_img",target:"map",label:"Map (PNG)"},{id:"map_pdf",type:"pdf","class":"ico_pdf",target:"map",label:"Map (PDF)"},{id:"map_svg",type:"svg","class":"ico_img",target:"map",label:"Map (SVG)"},{id:"map_embed",type:"embed","class":"ico_embed",target:"map",label:"Map Embed"}]},{label:"Data",children:[{id:"map_csv",type:"csv","class":"ico_csv",target:"map",label:"Map (CSV)"},d]}],columnchart:[{label:"Chart",children:[{id:"columnchart_pdf",type:"pdf","class":"ico_pdf",target:"columnchart",label:"PDF"},{id:"columnchart_png",type:"png","class":"ico_img",target:"columnchart",label:"PNG"},{id:"columnchart_svg",type:"svg","class":"ico_img",target:"columnchart",label:"SVG"},{id:"columnchart_embed",type:"embed","class":"ico_embed",target:"columnchart",label:"EMBED"}]},{label:"Data",children:[{id:"columnchart_csv",type:"csv","class":"ico_csv",target:"columnchart",label:"Chart (CSV)"},d]}],linechart:[{label:"Chart",children:[{id:"linechart_pdf",type:"pdf","class":"ico_pdf",target:"linechart",label:"PDF"},{id:"linechart_png",type:"png","class":"ico_img",target:"linechart",label:"PNG"},{id:"linechart_svg",type:"svg","class":"ico_img",target:"linechart",label:"SVG"},{id:"linechart_embed",type:"embed","class":"ico_embed",target:"linechart",label:"EMBED"}]},{label:"Data",children:[{id:"linechart_csv",type:"csv","class":"ico_csv",target:"linechart",label:"Chart (CSV)"},d]}]});n.setVisualizations(A.defaultConfig.items.slice()),n.setLinkTypes(A.pinKeyConfig.items.slice()),n.setDownloadParameters(v)}}),Q=n.SimpleCommand.$extend({execute:function(){var e=new nt,t=new tt(e);this.facade.registerMediator(t)}}),G=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.ResetChartedCommand),this.addSubCommand(o.UpdateHashCommand)}}),Y=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.ResetChartedCommand),this.addSubCommand(o.ResetAggColumnsCommand),this.addSubCommand(o.UpdateTopicHashCommand)}}),Z=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.ResetStartEndCommand),this.addSubCommand(o.ResetChartedCommand),this.addSubCommand(o.ResetChartindexedCommand),this.addSubCommand(o.ResetAggColumnsCommand),this.addSubCommand(o.UpdateReportHashCommand)}}),et=n.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(f.NAME),n=this.facade.retrieveProxy(l.NAME),r=this.facade.retrieveProxy(h.NAME);t.getChartType()=="map"&&r.updateMapData(n.getChartData("map")[0])}}),tt=n.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this,t=this.getViewComponent(),n=this.facade.retrieveProxy(u.NAME),r=this.facade.retrieveProxy(a.NAME),i=new k(t.getFormContainer()),s=new L(t.getDownloadContainer()),o=new A(t.getVisualizationContainer(),{items:n.getVisualizations()}),f=new O(t.getTopTopicSelectionContainer(),!0),l=new O(t.getMiddleTopicSelectionContainer(),!1),c=new M(t.getTimeSelectionContainer()),h=new _(t.getAnalysisContainer()),C=new F(t.getTableContainer()),B=new q(t.getChartContainer()),j=new A(t.getPinKeyVisualizationContainer(),{items:n.getLinkTypes()}),R=B.addView("linechart"),z=B.addView("columnchart"),W=B.addView("map"),V=new P(z),J=new D(R),K=new I,Q=new H(W),G=new d(i),Y=new v(s),Z=new m(o),et=new p(f,!0),tt=new p(l,!1),nt=new E(c),rt=new N(C),it=new y(B),st=new b(J),ot=new w(V),ut=new S(K),at=new x(Q),ft=new T(h),lt=new g(j);this.facade.registerMediator(ut),this.facade.registerMediator(G),this.facade.registerMediator(Y),this.facade.registerMediator(Z),this.facade.registerMediator(et),this.facade.registerMediator(tt),this.facade.registerMediator(nt),this.facade.registerMediator(rt),this.facade.registerMediator(it),this.facade.registerMediator(st),this.facade.registerMediator(ot),this.facade.registerMediator(at),this.facade.registerMediator(ft),this.facade.registerMediator(lt),this.getViewComponent().getFootnoteContainer().empty().html(Mustache.to_html(U,{rseAvailable:!0,topic:r.getTopicId(),showFilterValues:!0,showDetail:!1})).on("change","#rse_checkbox",function(t){e.sendNotification(X.RSE_SELECTION_UPDATED,{rse:$(t.target).is(":checked")?"1":"0"})}),$("a.lightbox",this.getViewComponent().getFootnoteContainer()).fancybox({autoDimensions:!1,autoScale:!1,width:900,height:600,scrolling:"auto",type:"ajax",autoSize:"false"})},listNotificationInterests:function(){return this.$super().concat([X.TABLEDATA_UPDATED,X.RSE_PARAM_UPDATED,X.TABLE_RENDERED,X.TOPIC_PARAMS_UPDATED])},handleNotification:function(e){var t=this.getViewComponent();switch(e.getName()){case X.TABLEDATA_UPDATED:var n=this.facade.retrieveProxy(l.NAME),r=this.facade.retrieveProxy(f.NAME),i=this.facade.retrieveProxy(u.NAME),s=n.getTableTitle();r.getReportIndex()!=null&&(s=i.getReports()[r.getReportIndex()].description),window.document.title="Electricity data browser - "+s;break;case X.TABLE_RENDERED:t.getMiddleTopicSelectionContainer().is(":hidden")&&t.getMiddleTopicSelectionContainer().slideDown(1500);break;case X.RSE_PARAM_UPDATED:var r=this.facade.retrieveProxy(f.NAME);t.getFootnoteContainer().find("#rse_checkbox").attr("checked",r.getShowRSE());break;case X.TOPIC_PARAMS_UPDATED:var o=this.facade.retrieveProxy(a.NAME),c=this;this.getViewComponent().getFootnoteContainer().empty().html(Mustache.to_html(U,{rseAvailable:!0,topic:o.getTopicId(),showFilterValues:!0,showDetail:!1})).on("change","#rse_checkbox",function(e){c.sendNotification(X.RSE_SELECTION_UPDATED,{rse:$(e.target).is(":checked")?"1":"0"})}),$("a.lightbox",this.getViewComponent().getFootnoteContainer()).fancybox({autoDimensions:!1,autoScale:!1,width:900,height:600,scrolling:"auto",type:"ajax",autoSize:"false"});break;default:this.$super(e)}},__classvars__:{NAME:"PageMediator"}}),nt=C.$extend({__init__:function(){this.$super($("#pagecontent"),{mainFilterButtonOpts:{selected:!1,id:"main_filter_button"},overlayFilterButtonOpts:{selected:!0,id:"overlay_filter_button"},mainVisualizationButtonOpts:{selected:!1,id:"main_visualization_button"},overlayVisualizationButtonOpts:{selected:!0,id:"overlay_visualization_button"},mainDownloadButtonOpts:{selected:!1,id:"main_download_button"},overlayDownloadButtonOpts:{selected:!0,id:"overlay_download_button"},mainAnalysisButtonOpts:{selected:!1,id:"main_analysis_button"},overlayAnalysisButtonOpts:{selected:!0,id:"overlay_analysis_button"}})}});return W}),define("js/model/ListConfigProxy",["js/model/ConfigProxy","js/model/ConfigMixinDownload"],function(e,t){return e.$extend({__include__:[t]})}),define("js/model/ListRequestProxy",["js/model/RequestProxy","js/model/RequestMixinTopic"],function(e,t){return e.$extend({__include__:[t]})}),define("js/model/ParameterMixinDateCode",[],function(){return{getDatecode:function(){return this.getQuery().datecode},validateDatecode:function(e,t){var n,r;switch(e.freq){case"A":n=t.annualStart,r=t.annualEnd;break;case"Q":n=t.quarterlyStart,r=t.quarterlyEnd;break;case"M":n=t.monthlyStart,r=t.monthlyEnd}this.checkVal(e,"datecode",r,function(e){return e>=n&&e<=r}),e.datecode=parseInt(e.datecode)},resetDatecode:function(){delete this.getQuery().datecode}}}),define("js/model/ParameterMixinDateCodes",["js/view/DateCodeUtil"],function(e){return{getDateCodes:function(){return this.getData().dateCodes},updateDateCodes:function(t,n){var r=[],i,s,o;switch(t){case"A":i=n.annualStart,s=n.annualEnd;break;case"Q":i=n.quarterlyStart,s=n.quarterlyEnd;break;case"M":i=n.monthlyStart,s=n.monthlyEnd}for(o=i;o<=s;o=parseInt(e.incrementDateCode(o,t),10))r.push(o);$.extend(this.getData(),{dateCodes:r})}}}),define("js/model/ListParameterProxy",["js/Facade","js/model/ConfigProxy","js/model/RequestProxy","js/model/ParameterProxy","js/model/ParameterMixinTopic","js/model/ParameterMixinReport","js/model/ParameterMixinFrequency","js/model/ParameterMixinAggColumn","js/model/ParameterMixinDateCode","js/model/ParameterMixinDateCodes","js/model/ParameterMixinGetCharted","js/model/ParameterMixinStateBasinType"],function(e,t,n,r,s,o,u,a,f,l,c,h){return r.$extend({__include__:[s,o,u,a,f,l,c,h],getQueryKeys:function(){var e=this.facade.retrieveProxy(t.NAME);topic=e.getTopic(this.getTopicId()),ret=["agg"],i;for(i=0;i<topic.aggColumns.length;i++)ret.push(topic.aggColumns[i].filterGroup.varName);return ret.concat(["freq","datecode","rtype"])},getGAString:function(e,t){var n=$.extend({},this.getQuery(),e),r="topic/"+(t?t:this.getTopicId())+"/?"+(n.agg?"agg="+n.agg:"")+(n.freq?"&freq="+n.freq:"")+(n.datecode?"&datecode="+n.datecode:"");return $.each(this.getAggColumnParams(),function(e,t){r+="&"+e+"="+n[e]}),r},getGAStringByTopic:function(e,t){return e.datecode=null,this.getGAString(e,t)},getFullPath:function(e,t){var r=this.facade.retrieveProxy(n.NAME);return r.getPath()+"/"+(t!==void 0?t:this.getTopicId())+this.getQueryString(e)},getFormParams:function(){return $.extend({topic:this.getTopicId(),agg:this.getAgg()},this.getAggColumnParams())},getTableParams:function(){return $.extend({topic:this.getTopicId(),freq:this.getFreq(),agg:this.getAgg(),datecode:this.getDatecode(),rtype:this.getRegionType()},this.getAggColumnParams())},getTableParamsString:function(){var e=this.facade.retrieveProxy(t.NAME),n=e.getTopic(this.getTopicId()),r="topic="+this.getTopicId()+"&agg="+this.getAgg(),s;for(i=0;i<n.aggColumns.length;i++)s=n.aggColumns[i].filterGroup.varName,r+="&"+s+"="+this.getQuery()[s];return r+="&freq="+this.getFreq(),r+="&datecode="+this.getDatecode(),r+="&rtype="+this.getRegionType(),r},getTimeParams:function(){return{datecode:this.getDatecode(),freq:this.getFreq()}},update:function(){var r={},s=this.facade.retrieveProxy(n.NAME),o=this.facade.retrieveProxy(t.NAME),u=s.getTopicId(),a=o.getTopic(u),f=u!==this.getTopicId(),l=!1;this.updateTopicId(u),this.updateQuery(s.getQuery(),function(e,t,n){f|=e=="datecode",f|=e=="freq",f|=e=="agg",l|=e=="rtype";for(i=0;i<a.aggColumns.length&&!f;i++)isAggColumn=e==a["aggColumns"][i]["filterGroup"]["varName"],f|=isAggColumn}),this.updateDateCodes(this.getFreq(),a),this.updateReportIndex(),f&&this.sendNotification(e.TABLE_PARAMS_UPDATED),l&&this.sendNotification(e.REGION_TYPE_PARAM_UPDATED)},validateQuery:function(e){var n=this.facade.retrieveProxy(t.NAME),r=n.getTopic(this.getTopicId());this.validateFrequency(e,r),this.validateAggColumns(e,r),this.validateDatecode(e,r)}})}),define("js/view/MediatorListMap",["puremvc","js/Facade","js/model/TableDataProxy","js/model/ParameterProxy","us-merc-en","coal-basin-merc-en"],function(e,t,n,r){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().regionClicked.add(function(n,r){n.match(/US-[A-Z][A-Z]/)&&e.sendNotification(t.STATE_MAP_CLICKED,{stateCode:n.replace("US-","")})}),this.getViewComponent().markerClicked.add(function(n,i){var s=e.facade.retrieveProxy(r.NAME).getTimeParams().freq,o={code:n.code,freq:s};e.sendNotification(t.PLANT_LIST_CLICK_THROUGH,o,"PlantMarkerClick")})},onRemove:function(){this.$super(),this.getViewComponent().destroy()},listNotificationInterests:function(){return this.$super().concat([t.TABLEDATA_UPDATED,t.MINE_HIGHLIGHT,t.REGION_TYPE_PARAM_UPDATED,t.UNLOAD])},handleNotification:function(e){var i=this.facade.retrieveProxy(n.NAME),s=this.facade.retrieveProxy(r.NAME),o=this,u=this.getViewComponent();switch(e.getName()){case t.TABLEDATA_UPDATED:case t.REGION_TYPE_PARAM_UPDATED:i.hasData()&&(!i.getData().SINGLE_STATE||s.getRegionType()=="b"?(u.mapContainer.addClass("clickable-regions ").removeClass("clickable-markers"),u.update(s.getRegionType()=="b"?i.getBasinMineCounts():i.getMineCounts(),i.getMapTitle(),{zoomOnScroll:!0,map:s.getRegionType()=="b"?"coal_basin_merc_en":"us_merc_en",onRegionLabelShow:function(e,t,n){o.onRegionLabelShow(e,t,n)},onRegionOver:function(e,t){return t.split("-")[0]=="US"&&s.getRegionType()=="b"?!1:!0},regionStyle:{hover:{stroke:"#FFFF96","fill-opacity":1,"stroke-width":3,"stroke-opacity":1}},onMarkerLabelShow:null,markers:null,legendTitle:o.getLegendTitle()}),s.getRegionType()=="b"&&$('path[data-code^="US-"]',this.container).attr("fill","#666666")):(u.mapContainer.addClass("clickable-markers").removeClass("clickable-regions "),require(["us"+i.getData().STATE_KEY.toLowerCase()+"-merc-en"],function(){u.update(i.getMineCounts(),i.getMapTitle(),{zoomOnScroll:!0,zoomMax:110,map:"us"+i.getData().STATE_KEY.toLowerCase()+"_merc_en",onRegionLabelShow:null,onMarkerLabelShow:function(e,t,n){return o.markerLabelShow(e,t,n)},markers:o.getMarkers(),regionStyle:{initial:{cursor:"default"}},markerStyle:{initial:{cursor:"pointer",fill:"#808080"}},onMarkerOver:function(e,t){return o.onMarkerOver(e,t)},onMarkerOut:function(e,t){return o.onMarkerOut(e,t)},legendTitle:o.getLegendTitle()})})));break;case t.MINE_HIGHLIGHT:case t.POWER_PLANT_HIGHLIGHT:var a=e.getBody(),f;typeof u.worldMap!="undefined"&&$.each(u.worldMap.markers,function(e,t){t.config.code==a.code&&(f=t.element)}),f!=null&&(a.highlight?(f.applyAttr("stroke","#FFFF96"),f.applyAttr("stroke-width",f.properties["stroke-width"]*2)):(f.applyAttr("stroke",f.properties.stroke),f.applyAttr("stroke-width",f.properties["stroke-width"])));break;case t.UNLOAD:this.getViewComponent().destroy();break;default:this.$super(e)}},markerLabelShow:function(e,t,n){var r=this.getViewComponent(),i=r.options.markers[n],s=i.name+"<BR>"+"MSHA ID: "+i.code+"<BR>"+"Coal Rank: "+i.rank+"<BR>"+"Mine Type: "+i.type+"<BR>"+"Mine Status: "+i.status+"<BR>"+"Location: "+i.latLng[0]+", "+i.latLng[1];return $(t).html(s),s},onMarkerOver:function(e,n){var r=this.getViewComponent();return this.sendNotification(t.MINE_HIGHLIGHT,{index:n,code:r.worldMap.markers[n].config.code,highlight:!0},"PlantListMapMarkerOver"),!1},onMarkerOut:function(e,n){var r=this.getViewComponent();return this.sendNotification(t.MINE_HIGHLIGHT,{index:n,code:r.worldMap.markers[n].config.code,highlight:!1},"PlantListMapMarkerOut"),!1},onRegionLabelShow:function(e,t,n){var i=this.getViewComponent(),s=i.getCurrentCounts()[n],o=this.facade.retrieveProxy(r.NAME);(o.getRegionType()=="b"&&n.split("-")[0]=="BS"||o.getRegionType()!="b"&&n.split("-")[0]=="US")&&$(t).html($(t).html()+" "+(s!==void 0?s:0)+" mines")},getLegendTitle:function(){var e=this.facade.retrieveProxy(n.NAME);return e.getMineMarkers().length+" total mines"},getMarkers:function(){var e=this.facade.retrieveProxy(n.NAME),t=this.facade.retrieveProxy(r.NAME),i=this.getViewComponent(),s=$.merge([],e.getMineMarkers());return typeof t.isMine!="function"||t.isMine()?$.each(s,function(e,t){i.$class.styleMarkerMine(t)}):$.each(s,function(e,t){i.$class.styleMarkerPlant(t)}),s},__classvars__:{NAME:"ListMapMediator"}})}),define("js/model/ListPlantTableDataProxy",["js/Facade","js/model/ParameterProxy","js/model/TableDataProxy","js/view/MediatorListMap","slickdataview"],function(e,t,n,r){return n.$extend({isUpdating:!1,__init__:function(){this.$super(this.$class.NAME),this.setData("SINGLE_STATE",!1)},loadTableData:function(){var n=this.facade.retrieveProxy(t.NAME),r=n.getTableParamsString(),i=this;this.isUpdating=!0,this.inCache(r)?(this.setDataFromCache(r),this.isUpdating=!1,this.sendNotification(e.TABLEDATA_UPDATED)):$.ajax(encodeURI(this.$class.PROXY_URL+"?method="+this.$class.PROXY_METHOD+"&"+r),{dataType:"json",error:function(){i.sendNotification(e.ERROR)},success:function(t){var n=new Slick.Data.DataView;n.setFilter(i.listFilter),n.setItems(t.DATA),i.setData(r,$.extend(t,{dataView:n,mappedCounts:function(){var e={};for(var n in t.STATE_COUNTS)if(t.STATE_COUNTS.hasOwnProperty(n)){var r=t.STATE_COUNTS[n];r!==0&&(e[n.toLowerCase()]=r)}return e}(),basinMappedCounts:function(){var e={};for(var n in t.BASIN_COUNTS)if(t.BASIN_COUNTS.hasOwnProperty(n)){var r=t.BASIN_COUNTS[n];r!==0&&(e[n.toLowerCase()]=r)}return e}()})),i.isUpdating=!1,i.sendNotification(e.TABLEDATA_UPDATED)}})},listFilter:function(e,t){var n=!0,r,s,o,u;if(t&&t.searchString!=""){o=t.searchString.toUpperCase().split(" ");for(i=0;i<o.length&&n;i++){u=o[i];if(u!="")for(r in e)if(e.hasOwnProperty(r)){s=e[r].toString().toUpperCase();if(n=~s.indexOf(u))break}}}return n},updateListFilter:function(e){this.getTableData()&&(this.getTableData().setFilterArgs({searchString:e}),this.getTableData().refresh())},getDataColumns:function(){return this.getData().DATA_COLUMNS},getTableData:function(){return this.getData().dataView},getTableTitle:function(){return this.getData().DESCRIPTION},getMapTitle:function(){return this.getData().MAP_TITLE},getCounts:function(){return this.getData().mappedCounts},getMarkers:function(){var e=this.getData().DATA,t=[],n=this.facade.retrieveMediator(r.NAME).getViewComponent().$class.MARKER;return $.each(e,function(e,r){var i={latLng:[r.lat,r.lon],name:r["Plant Name"],code:r["Plant Code"],fuel:r["Fuel Types"],sector:r["Sector Name"],primemover:r["Prime Movers"],aggFuelType:r["Aggregate Fuel Type"]},s=r["Aggregate Fuel Type"];n.hasOwnProperty(s)&&(i.style={fill:n[r["Aggregate Fuel Type"]].color}),t.push(i)}),t},hasData:function(){return typeof this.getTableData()!="undefined"?!0:!1},__classvars__:{PROXY_URL:"dataService/dataService.cfc",PROXY_METHOD:"getPlantList"}})}),define("js/view/MediatorPlantListDataGrid",["puremvc","js/Facade","js/model/ConfigProxy","js/model/ParameterProxy","js/view/GridFormatters","js/model/TableDataProxy"],function(e,t,n,r,i,s){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().onClick.add(function(n,i,s){var o=e.getViewComponent(),u=o.columns,a=u[i].iconClass,f;if(i===0){var l=e.facade.retrieveProxy(r.NAME).getTimeParams().freq,c="plant/"+s["Plant Code"]+"?freq="+l,h={label:c,code:s["Plant Code"],freq:l};e.sendNotification(t.PLANT_LIST_CLICK_THROUGH,h,"PlantListClickThrough")}}),this.getViewComponent().container.on("mouseover",".slick-row",function(n){e.sendNotification(t.POWER_PLANT_HIGHLIGHT,{code:e.getViewComponent().slickgrid.getDataItem($(n.currentTarget).index()).id,highlight:!0},"PlantListTableRowOver")}),this.getViewComponent().container.on("mouseout",".slick-row",function(n){e.sendNotification(t.POWER_PLANT_HIGHLIGHT,{code:e.getViewComponent().slickgrid.getDataItem($(n.currentTarget).index()).id,highlight:!1},"PlantListTableRowOut")})},listNotificationInterests:function(){return this.$super().concat([t.TABLEDATA_UPDATED,t.DOWNLOAD_OPTION_SELECTED,t.POWER_PLANT_HIGHLIGHT,t.UNLOAD])},handleNotification:function(e){var i=e.getBody(),o=this.getViewComponent();switch(e.getName()){case t.TABLEDATA_UPDATED:var u=this.facade.retrieveProxy(s.NAME),a=this.facade.retrieveProxy(r.NAME),f=this.facade.retrieveProxy(n.NAME),l=a.getTimeParams(),c=u.getTableData(),h=this.generateColumns(u.getDataColumns(),c,l.freq);o.update(c,h,{}),o.slickgrid.setSortColumn(h[0].id,!0),this.sendNotification(t.TABLE_RENDERED);break;case t.DOWNLOAD_OPTION_SELECTED:if(e.body.target=="table"&&e.body.type=="csv"){var u=this.facade.retrieveProxy(s.NAME),p=[['"'+u.getTableTitle()+'"'],['"'+window.location.href+'"'],['"'+Date()+'"'],['"Source: U.S. Energy Information Administration"']].concat(this.getViewComponent().outputToArrOfArrs());this.sendNotification(t.CSV_DATA_GENERATED,p)}break;case t.UNLOAD:o.destroy();break;case t.POWER_PLANT_HIGHLIGHT:var d=this.getViewComponent().slickgrid.getData().getRowById(i.code);i.highlight?$(".slick-row:eq("+d+")",o.container).addClass("highlight"):$(".slick-row:eq("+d+")",o.container).removeClass("highlight");break;default:this.$super(e)}},generateColumns:function(e,t,n){var r=[],i,s;for(i=0;i<e.length;i++)s=e[i],r.push({id:s,name:s,field:s,displayFormatter:i==0?this.$class.linkCellFormatter:void 0,freq:n,sortable:!0,headerCssClass:"slick-header-column-sortable"});return r},__classvars__:{NAME:"DataGridMediator",linkCellFormatter:function(e,t,n,r,i){return n!==""?'<span class="link_cell">'+n+"</span>":n}}})}),define("js/view/MediatorSearch",["puremvc","js/Facade"],function(e,t){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().inputChanged.add(function(n){e.sendNotification(t.SEARCH_STRING_UPDATED,n)})},__classvars__:{NAME:"SearchMediator"}})}),define("js/view/MediatorSingleSliderTimeSelection",["puremvc","js/Facade","js/model/TableDataProxy","js/model/ConfigProxy","js/model/ParameterProxy"],function(e,t,n,r,i){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().timeSelectionChanged.add(function(r){var i=e.facade.retrieveProxy(n.NAME);e.sendNotification(t.TIME_SELECTION_UPDATED,{datecode:r},"SingleSliderTimeSelectionChanged")}),this.getViewComponent().frequencySelectionChanged.add(function(n){e.sendNotification(t.FREQUENCY_SELECTION_UPDATED,{freq:n},"FrequencyChanged")})},listNotificationInterests:function(){return this.$super().concat([t.TABLEDATA_UPDATED])},handleNotification:function(e){var s=this.facade.retrieveProxy(i.NAME),o=this.facade.retrieveProxy(n.NAME),u=this.facade.retrieveProxy(r.NAME),a=u.getTopic(s.getTopicId()),f=s.getTimeParams(),l;switch(e.getName()){case t.TABLEDATA_UPDATED:l=s.getDateCodes(),this.getViewComponent().create(a,f.freq,l,f.datecode);break;default:this.$super(e)}},__classvars__:{NAME:"TimeSelectionMediator"}})}),define("js/view/MediatorPlantListMap",["puremvc","js/Facade","js/model/TableDataProxy","js/model/ParameterProxy","us-merc-en","coal-basin-merc-en"],function(e,t,n,r){return e.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this;this.getViewComponent().regionClicked.add(function(n,r){n.match(/US-[A-Z][A-Z]/)&&e.sendNotification(t.STATE_MAP_CLICKED,{stateCode:n.replace("US-","")})}),this.getViewComponent().markerClicked.add(function(n,i){var s=e.facade.retrieveProxy(r.NAME).getTimeParams().freq,o={code:n.code,freq:s};e.sendNotification(t.PLANT_LIST_CLICK_THROUGH,o,"PlantMarkerClick")})},onRemove:function(){this.$super(),this.getViewComponent().destroy()},listNotificationInterests:function(){return this.$super().concat([t.TABLEDATA_UPDATED,t.POWER_PLANT_HIGHLIGHT,t.REGION_TYPE_PARAM_UPDATED,t.UNLOAD,t.DOWNLOAD_OPTION_SELECTED])},handleNotification:function(e){var i=this.facade.retrieveProxy(n.NAME),s=this.facade.retrieveProxy(r.NAME),o=this,u=this.getViewComponent();switch(e.getName()){case t.TABLEDATA_UPDATED:case t.REGION_TYPE_PARAM_UPDATED:i.hasData()&&(!i.getData().SINGLE_STATE||s.getRegionType()=="b"?(u.mapContainer.addClass("clickable-regions ").removeClass("clickable-markers"),u.update(i.getCounts(),i.getMapTitle(),{zoomOnScroll:!0,map:"us_merc_en",onRegionLabelShow:function(e,t,n){o.onRegionLabelShow(e,t,n)},regionStyle:{hover:{stroke:"#FFFF96","fill-opacity":1,"stroke-width":3,"stroke-opacity":1}},onMarkerLabelShow:null,markers:null,legendTitle:o.getLegendTitle()}),s.getRegionType()=="b"&&$('path[data-code^="US-"]',this.container).attr("fill","#666666")):(u.mapContainer.addClass("clickable-markers").removeClass("clickable-regions "),require(["us"+i.getData().STATE_KEY.toLowerCase()+"-merc-en"],function(){u.update(i.getCounts(),i.getMapTitle(),{zoomOnScroll:!0,zoomMax:110,map:"us"+i.getData().STATE_KEY.toLowerCase()+"_merc_en",onRegionLabelShow:null,onMarkerLabelShow:function(e,t,n){return o.markerLabelShow(e,t,n)},markers:o.getMarkers(),regionStyle:{initial:{cursor:"default"}},markerStyle:{initial:{cursor:"pointer",fill:"#808080"}},onMarkerOver:function(e,t){return o.onMarkerOver(e,t)},onMarkerOut:function(e,t){return o.onMarkerOut(e,t)},legendTitle:o.getLegendTitle()})})));break;case t.MINE_HIGHLIGHT:case t.POWER_PLANT_HIGHLIGHT:var a=e.getBody(),f;typeof u.worldMap!="undefined"&&$.each(u.worldMap.markers,function(e,t){t.config.code==a.code&&(f=t.element)}),f!=null&&(a.highlight?(f.applyAttr("stroke","#FFFF96"),f.applyAttr("stroke-width",f.properties["stroke-width"]*2)):(f.applyAttr("stroke",f.properties.stroke),f.applyAttr("stroke-width",f.properties["stroke-width"])));break;case t.UNLOAD:this.getViewComponent().destroy();break;case t.DOWNLOAD_OPTION_SELECTED:e.body.target!="map"||e.body.type!="png"&&e.body.type!="pdf"?e.body.target=="map"&&e.body.type=="svg"&&(window.SVGAngle?this.getViewComponent().map.exportMap(e.body.type):alert("Map download requires a modern browser, such as Chrome, Firefox or Internet Explorer 9+")):this.getViewComponent().exportMap(e.body.type);break;default:this.$super(e)}},markerLabelShow:function(e,t,n){var r=this.getViewComponent(),i=r.options.markers[n],s=i.name+"<BR>"+"Plant code: "+i.code+"<BR>"+"Sector: "+i.sector+"<BR>"+"Fuel types: "+i.fuel+"<BR>"+"Prime movers: "+i.primemover+"<BR>"+"Location: "+i.latLng[0]+", "+i.latLng[1];return $(t).html(s),s},onMarkerOver:function(e,n){var r=this.getViewComponent();return this.sendNotification(t.POWER_PLANT_HIGHLIGHT,{index:n,code:r.worldMap.markers[n].config.code,highlight:!0},"PlantListMapMarkerOver"),!1},onMarkerOut:function(e,n){var r=this.getViewComponent();return this.sendNotification(t.POWER_PLANT_HIGHLIGHT,{index:n,code:r.worldMap.markers[n].config.code,highlight:!1},"PlantListMapMarkerOut"),!1},onRegionLabelShow:function(e,t,n){var r=this.getViewComponent(),i=r.getCurrentCounts()[n];n?$(t).html($(t).html()+" "+(i!==void 0?i:0)+" plants"):t.empty()},getLegendTitle:function(){var e=this.facade.retrieveProxy(n.NAME);return e.getMarkers().length+" total power plants"},getMarkers:function(){var e=this.facade.retrieveProxy(n.NAME),t=this.facade.retrieveProxy(r.NAME),i=this.getViewComponent(),s=$.merge([],e.getMarkers());return $.each(s,function(e,t){i.$class.styleMarkerPlant(t)}),s},__classvars__:{NAME:"ListMapMediator"}})}),define("text!templates/searchBox.html",[],function(){return'<div id="searchbox">\r\n	<input type="text" name="searchInput" placeholder="{{searchPrompt}}"></input>\r\n	<a id="search_box_reset">Reset<span>&nbsp;</span></a>\r\n</div>'}),define("js/view/VC_Search",["classy","signals","text!templates/searchBox.html","mustache"],function(e,t,n){return e.$extend({input:null,resetButton:null,inputChanged:null,__init__:function(e,r){var i=this;this.container=e,this.container.html(Mustache.render(n,r||this.$class.templateOpts)),this.inputChanged=new t.Signal,this.input=this.container.find("input"),this.resetButton=this.container.find("#search_box_reset"),this.input.keyup(function(e){i.inputChanged.dispatch(i.input.val())}),this.resetButton.click(function(e){i.input.val(""),i.inputChanged.dispatch(i.input.val())})},__classvars__:{templateOpts:{searchPrompt:"search all fields"}}})}),define("bucketMap",["map","signals","order!jVectorMap","order!usa-en"],function(e,t){return e.$extend({__init__:function(e,t){var n=this;this.$super(e,t),$.extend(this.options,{bucketFunction:this.$class.linearBucketFunction})},createLegend:function(){var e=this,t,n,r,i,s,o;this.legendContainer.empty();var u=$('<span style="display: inline-block; text-align:center;"></span>').appendTo(this.legendContainer);this.options.legendTitle&&($('<span class="map_legend_title">'+this.options.legendTitle+"</span>").appendTo(u),$("<br />").appendTo(u)),$.each(this.buckets,function(t,n){var r=$('<span class="marker_container"></span>');return $('<span class="map_legend_marker"></span>').appendTo(r).css("background-color",e.$class.palette[t]).after("<span>"+(n.label?n.label:e.$class.defaultLegendLabelFunction.call(e,n))+"</span>"),r.appendTo(u),!0});var a=$('<span class="marker_container"></span>');$('<span class="map_legend_marker"></span>').appendTo(a).css("background-color","#CCC").after("<span>Value is not available</span>"),a.appendTo(u)},assignColors:function(){this.buckets=this.options.bucketFunction.call(this,this.counts,this.$class.palette);var e=[],t,n,r,i;for(var s=0;s<this.counts.length;s++)for(t in this.counts[s]){n=parseFloat(Highcharts.numberFormat(this.counts[s][t],this.options.dataPrecision,".",""));for(var o=0;o<this.buckets.length;o++)this.buckets[o].testValue&&typeof this.buckets[o].testValue=="function"?this.buckets[o].testValue(n)&&(e[s]||(e[s]={}),e[s][t]=this.$class.palette[o]):this.$class.defaultBucketTestFunction.call(this.buckets[o],n)&&(e[s]||(e[s]={}),e[s][t]=this.$class.palette[o])}this.colors=e},__classvars__:{linearBucketFunction:function(e,t){var n=[],r,i=(this.max-this.min)/t.length;for(var s=0;s<t.length;s++){var o={min:null,max:null};o.min=parseFloat(Highcharts.numberFormat(this.min+i*s,this.options.dataPrecision,".","")),o.min=s==0?o.min:o.min+1/Math.pow(10,this.options.dataPrecision),o.max=parseFloat(Highcharts.numberFormat(this.min+i*(s+1),this.options.dataPrecision,".","")),o.max=o.max<o.min?o.min:o.max,o.mid=(o.max-o.min)/2+o.min,(n.length==0||o.min!=n[n.length-1].min||o.max!=n[n.length-1].max)&&!isNaN(o.min)&&!isNaN(o.max)&&n.push(o);if(o.max>=this.max)break}return n},defaultBucketTestFunction:function(e){return this.min&&this.max?e>=this.min&&e<=this.max:this.min?e>=this.min:this.max?e<=this.max:!1},defaultLegendLabelFunction:function(e){var t,n;return this.options.legendItemFormatter?(t=self.options.legendItemFormatter.call(self,e.min),n=self.options.legendItemFormatter.call(self,e.max)):(t=e.min,n=e.max),t+(e.min<e.max?" to "+n:"")}}})}),define("js/view/VC_PlantListMap",["bucketMap","us-merc-en"],function(e){return e.$extend({createLegend:function(){this.options.legendTitle&&($(".legend_container h2",this.container).remove(),$(".legend_container",this.container).prepend("<h2>"+this.options.legendTitle+"</h2>"));if(this.options.markers!=null){this.legendContainer.empty();var e=$('<span class="plantMarkers" style="display: inline-block; text-align:center;"></span>').appendTo(this.legendContainer);$.each(this.$class.MARKER,function(t,n){var r=$('<span class="marker_container"></span>');return $('<span class="map_legend_marker"></span>').appendTo(r).css("background-color",n.color).after("<span>"+n.name+"</span>"),r.appendTo(e),!0})}else this.options.legendTitle=null,this.$super()},createMarkerOps:function(){return null},__classvars__:{MARKER:{WAS:{name:"Biomass",color:"rgb(93,151,50)"},COW:{name:"Coal",color:"rgb(0,0,0)"},GEO:{name:"Geothermal",color:"rgb(65,14,20)"},HYC:{name:"Hydro",color:"rgb(0,57,83)"},NG:{name:"Natural gas",color:"rgb(0,150,215)"},NUC:{name:"Nuclear",color:"rgb(163,51,64)"},OTH:{name:"Other",color:"rgb(51,51,51)"},OOG:{name:"Other fossil gases",color:"rgb(242,183,124)"},PET:{name:"Petroleum",color:"rgb(189,115,42)"},HPS:{name:"Pumped storage",color:"rgb(102,136,152)"},SUN:{name:"Solar",color:"rgb(255,199,2)"},WND:{name:"Wind",color:"rgb(102,102,102)"},WWW:{name:"Wood",color:"rgb(42,75,17)"}},styleMarkerPlant:function(e){e.style={fill:this.MARKER[e.aggFuelType].color,stroke:Highcharts.eia_grey}}}})}),define("js/view/VC_DataViewGrid",["datagrid"],function(e){return e.$extend({onViewRowCountChanged:null,onViewRowsChanged:null,__init__:function(e){var t=this;this.onViewRowCountChanged=function(e,n){t.slickgrid.updateRowCount(),t.slickgrid.render()},this.onViewRowsChanged=function(e,n){t.slickgrid.invalidateRows(n.rows),t.slickgrid.render()},this.$super(e)},setData:function(e){var t=this;this.data&&this.data.getLength&&(this.data.onRowCountChanged.unsubscribe(this.onViewRowCountChanged),this.data.onRowsChanged.unsubscribe(this.onViewRowsChanged)),e.getLength&&(e.onRowCountChanged.subscribe(this.onViewRowCountChanged),e.onRowsChanged.subscribe(this.onViewRowsChanged)),this.$super(e)}})}),define("text!templates/map.html",[],function(){return'<h2 id="mapTitle" class="map_title"></h2>\r\n<div id="mapContainer" class="map_container"></div>\r\n<div id="controls_container" class="legend_container">\r\n	<div id="map_legend"></div>\r\n</div>\r\n'}),define("js/pages/PlantListPage",["hasher","signals","puremvc","classy","page","js/Facade","js/Controller","js/model/ListConfigProxy","js/model/ListRequestProxy","js/model/ListParameterProxy","js/model/ListPlantTableDataProxy","js/model/HelpTooltipProxy","js/view/MediatorPlantListDataGrid","js/view/MediatorElectricityTopicSelection","js/view/MediatorForm","js/view/MediatorDownload","js/view/MediatorSearch","js/view/MediatorSingleSliderTimeSelection","js/view/MediatorPlantListMap","js/view/MediatorHelpTooltip","js/view/VC_PageLayout","js/view/VC_Form","js/view/VC_Download","js/view/VC_Search","js/view/VC_Selection","js/view/VC_TimeSelection","js/view/VC_PlantListMap","qTipsHelp","js/view/VC_DataViewGrid","js/view/DateCodeUtil","text!templates/main.html","text!templates/filter_button.html","text!templates/download_button.html","text!templates/tableTitle.html","text!templates/map.html","text!templates/footnotes.html"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H){var B=null,j=i.$extend({load:function(e){$("#pagecontent").addClass("plantList"),this.$super(e),i.clearErrorMessage(),B?B.sendNotification(F.RELOAD,e):(B=F.getInstance(this.name),B.sendNotification(F.STARTUP,e))},unload:function(){B.sendNotification(F.UNLOAD),F.removeCore(this.name),B=null,this.$super(),$("#pagecontent").removeClass("plantList")}})("scripts/modules/pages/PlantListPage"),F=s.$extend({initializeController:function(){this.$super(),this.registerCommand(this.$class.STARTUP,I),this.registerCommand(this.$class.RELOAD,q),this.registerCommand(this.$class.TABLE_PARAMS_UPDATED,o.TableParamsUpdatedCommand),this.registerCommand(this.$class.TABLE_RENDERED,o.HideLoadMaskCommand),this.registerCommand(this.$class.TOPIC_SELECTION_UPDATED,W),this.registerCommand(this.$class.REPORT_SELECTION_UPDATED,X),this.registerCommand(this.$class.TIME_SELECTION_UPDATED,o.UpdateHashCommand),this.registerCommand(this.$class.FREQUENCY_SELECTION_UPDATED,o.FrequencySelectionUpdatedSingleTimeSliderCommand),this.registerCommand(this.$class.TABLE_SELECTION_UPDATED,o.UpdateHashCommand),this.registerCommand(this.$class.CSV_DATA_GENERATED,o.OutputToCSVCommand),this.registerCommand(this.$class.SEARCH_STRING_UPDATED,J),this.registerCommand(this.$class.STATE_MAP_CLICKED,K),this.registerCommand(this.$class.ERROR,o.ErrorCommand),this.registerCommand(this.$class.PLANT_LIST_CLICK_THROUGH,o.UpdatePlantHashCommand)},__classvars__:{getInstance:function(e){return n.Facade.hasCore(e)||new F(e),n.Facade.getInstance(e)}}}),I=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(R),this.addSubCommand(U),this.addSubCommand(o.UpdateParameterProxyCommand)}}),q=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.UpdateRequestProxyCommand),this.addSubCommand(o.UpdateParameterProxyCommand)}}),R=n.SimpleCommand.$extend({execute:function(e){var t=new a(e.getBody()),n=new u,r={label:"Data",children:[{id:"csv_table",type:"csv","class":"ico_csv",target:"table",label:"Table (CSV)"}]},i=$.extend([],[{label:"Map",children:[{id:"map_png",type:"png","class":"ico_img",target:"map",label:"Map (PNG)"},{id:"map_pdf",type:"pdf","class":"ico_pdf",target:"map",label:"Map (PDF)"},{id:"map_svg",type:"svg","class":"ico_img",target:"map",label:"Map (SVG)"}]},r]);n.setDownloadParameters(i);var s=new f,o=new l,h=new c;this.facade.registerProxy(t),this.facade.registerProxy(n),this.facade.registerProxy(s),this.facade.registerProxy(o),this.facade.registerProxy(h)}}),U=n.SimpleCommand.$extend({execute:function(){var e=new G,t=new Q(e);this.facade.registerMediator(t)}}),z=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.ShowLoadMaskCommand),this.addSubCommand(o.UpdateTableDataProxyCommand)}}),W=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.ResetDatecodeCommand),this.addSubCommand(o.UpdateTopicHashCommand)}}),X=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.ResetDatecodeCommand),this.addSubCommand(o.UpdateReportHashCommand)}}),V=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.ResetDatecodeCommand),this.addSubCommand(o.UpdateHashCommand)}}),J=n.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(l.NAME);t.updateListFilter(e.getBody())}}),K=n.SimpleCommand.$extend({execute:function(e){var t=this.facade.retrieveProxy(u.NAME),n=this.facade.retrieveProxy(f.NAME),r=e.getBody().stateCode,i=[],o={geo:""},a="",l=t.getTopic(n.getTopicId());for(var c=0;c<l.aggColumns.length;c++)if(l.aggColumns[c].filterGroup.varName=="geo"){var h=l.aggColumns[c].filterGroup.filterValues;for(var p=0;p<h.length;p++)if(h[p].filterValue==r){i[h[p].valueId]=1;break}break}for(c=0;c<Math.ceil(i.length/5)*5;c++)i[c]&&i[c]==1?a+="1":a+="0",c%5==4&&(o.geo=o.geo+parseInt(a,2).toString(32),a="");o.geo=o["geo"]==""?"g":o.geo,this.sendNotification(s.TABLE_SELECTION_UPDATED,o,"StateMapCicked")}}),Q=n.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this.getViewComponent();e.getPinKeyVisualizationContainer().css("display","none");var t=new E(e.getFormContainer()),n=new S(e.getDownloadContainer()),r=new x(e.getSearchContainer()),i=new N(e.getTimeSelectionContainer()),s=new T(e.getTopTopicSelectionContainer(),!0),o=new T(e.getMiddleTopicSelectionContainer(),!1),u=new L(e.getTableContainer()),f=new k,l=new C(e.getChartContainer(),"us_merc_en"),c=new d(t),w=new v(n),A=new m(r),O=new g(i),M=new p(s,!0),_=new p(o,!1),D=new h(u),P=new y(l),B=new b(f);this.facade.registerMediator(B),this.facade.registerMediator(c),this.facade.registerMediator(w),this.facade.registerMediator(A),this.facade.registerMediator(O),this.facade.registerMediator(M),this.facade.registerMediator(_),this.facade.registerMediator(D),this.facade.registerMediator(P);var j=this.facade.retrieveProxy(a.NAME);this.getViewComponent().getFootnoteContainer().empty().html(Mustache.to_html(H,{rseAvailable:!1,topic:j.getTopicId(),showFilterValues:!0,showDetail:!0})),$("a.lightbox",this.getViewComponent().getFootnoteContainer()).fancybox({autoDimensions:!1,autoScale:!1,width:900,height:600,scrolling:"auto",type:"ajax",autoSize:"false"})},listNotificationInterests:function(){return this.$super().concat([F.TABLEDATA_UPDATED,F.TABLE_RENDERED])},handleNotification:function(e){switch(e.getName()){case F.TABLEDATA_UPDATED:var t=this.getViewComponent(),n=this.facade.retrieveProxy(l.NAME),r=this.facade.retrieveProxy(f.NAME),i=this.facade.retrieveProxy(u.NAME),s=n.getTableTitle();this.getViewComponent().getTitleContainer().empty(),this.getViewComponent().getTitleContainer().css("display","block"),this.getViewComponent().getTitleContainer().append(Mustache.to_html(D,{title:s})),window.document.title="Electricity data browser - "+s;break;case F.TABLE_RENDERED:var t=this.getViewComponent();t.getMiddleTopicSelectionContainer().is(":hidden")&&t.getMiddleTopicSelectionContainer().slideDown(1500);break;default:this.$super(e)}},__classvars__:{NAME:"PageMediator"}}),G=w.$extend({__init__:function(){this.$super($("#pagecontent"),{mainFilterButtonOpts:{selected:!1,id:"main_filter_button"},overlayFilterButtonOpts:{selected:!0,id:"overlay_filter_button"},mainDownloadButtonOpts:{selected:!1,id:"main_download_button"},overlayDownloadButtonOpts:{selected:!0,id:"overlay_download_button"}}),this.getChartContainer().html(Mustache.render(P))}});return j}),define("js/model/ConfigMixinPreviousPage",[],function(){return{getPreviousPage:function(){return this.getData().previousPage},setPreviousPage:function(e){this.getData().previousPage=e}}}),define("js/model/SiteDataConfigProxy",["js/model/ConfigProxy","js/model/ConfigMixinVisualization","js/model/ConfigMixinDownload","js/model/ConfigMixinViewStack","js/model/ConfigMixinLinkType","js/model/ConfigMixinPreviousPage"],function(e,t,n,r,i,s){return e.$extend({__include__:[t,n,r,i,s]})}),define("js/model/SiteDataRequestProxy",["js/model/RequestProxy","js/model/RequestMixinTopic"],function(e,t){return e.$extend({__include__:[t],getId:function(){return this.getData()[1]}})}),define("js/model/ParameterMixinSite",[],function(){return{getId:function(){return this.getData().id},updateId:function(e){$.extend(this.getData(),{id:e})}}}),define("js/model/SiteDataParameterProxy",["js/Facade","js/model/ConfigProxy","js/model/RequestProxy","js/model/ParameterProxy","js/model/ParameterMixinSite","js/model/ParameterMixinTopic","js/model/ParameterMixinReport","js/model/ParameterMixinFrequency","js/model/ParameterMixinStartEnd","js/model/ParameterMixinChart","js/model/ParameterMixinLinkType"],function(e,t,n,r,i,s,o,u,a,f,l){return r.$extend({__include__:[i,s,o,u,a,f,l],getQueryKeys:function(){var e=this.facade.retrieveProxy(t.NAME),n=e.getTopic(this.getTopicId()),r=["agg"],i;for(i=0;i<n.aggColumns.length;i++)r.push(n.aggColumns[i].filterGroup.varName);return $.each(e.getVisualizations(),function(e,t){r.push(t["class"])}),["freq","start","end","charted","chartindexed","ctype","ltype"]},getGAString:function(e,t){var n=$.extend({},this.getTableParams(),e),r="id/"+n.id+"/?"+(n.freq?"&freq="+n.freq:"");return r},getGAStringByTopic:function(e,t){var n=$.extend({},this.getQuery(),e),r="topic/"+(t?t:this.getTopicId())+"/?"+(n.agg?"agg="+n.agg:"")+(n.freq?"&freq="+n.freq:"");return $.each(n,function(e,t){e!="agg"&&e!="freq"&&e!="topicId"&&(r+="&"+e+"="+n[e])}),r},getTableParams:function(){return{id:this.getId(),freq:this.getFreq(),ids:this.getCharted("pin")}},getTableParamsString:function(){return"id="+this.getId()+"&freq="+this.getFreq()+"&ids="+this.getCharted("pin")},getChartParams:function(){var e=this,n=this.facade.retrieveProxy(t.NAME),r={chartindexed:this.getChartIndexed(),ctype:this.getChartType(),columnendpoints:this.getColumnEndpoints(),columnvalues:this.getColumnValues()};return $.each(n.getVisualizations(),function(t,n){r[n["class"]]=e.getChartedByType(n["class"])}),$.extend(r,this.getTimeParams())},getTimeParams:function(){return{start:this.getStart(),end:this.getEnd(),freq:this.getFreq()}},getFullPath:function(e){var t=this.facade.retrieveProxy(n.NAME);return t.getPath()+"/"+this.getId()+this.getQueryString(e)},update:function(){var r={},i=this.facade.retrieveProxy(n.NAME),s=this.facade.retrieveProxy(t.NAME),o=i.getId(),u=i.getTopicId(),a=i.getQuery(),f=s.getTopic(u),l=o!==this.getId(),c=!1,h=!("ctype"in i.getQuery()),p=!("ctype"in i.getQuery()),d=!1,v=this;this.updateTopicId(u),this.updateId(o),this.updateQuery(i.getQuery(),function(e,t,n){c|=e=="start"||e=="end"||e=="freq",l|=e=="freq",$.each(s.getVisualizations(),function(t,n){h|=e==n["class"]}),l|=e=="pin",h|=p|=e=="ctype",h|=e=="chartindexed",h|=e=="columnendpoints",h|=e=="columnvalues",d|=e=="ltype"}),this.updateChartIdFrequencies(this.getFreq()),l&&this.sendNotification(e.TABLE_PARAMS_UPDATED),p&&(this.getChartType()!="pin"&&this.getChartType()!="sourcekey"&&this.sendNotification(e.UPDATE_VISUALIZATION_VIEW_STACK),this.sendNotification(e.CTYPE_PARAM_UPDATED)),h&&this.sendNotification(e.CHART_PARAMS_UPDATED),c&&this.sendNotification(e.TIME_PARAMS_UPDATED),d&&this.sendNotification(e.PIN_KEY_PARAM_UPDATED)},validateQuery:function(e){var n=this.facade.retrieveProxy(t.NAME),r=n.getTopic(this.getTopicId());this.validateFrequency(e,r),this.validateStartEnd(e,r),this.validateChartParams(e,r,n.getVisualizations()),this.validateLinkType(e,r,n.getLinkTypes())},__classvars__:{NAME:"ParameterProxy"}})}),define("js/model/SiteDataTableDataProxy",["js/Facade","js/model/ParameterProxy","js/model/TableDataProxy","js/model/TableDataMixinLevel","js/model/TableDataMixinChart"],function(e,t,n,r,s){return n.$extend({isUpdating:!1,__include__:[r,s],getDataColumns:function(){return this.getData().DATACOLUMNS},getMinColumn:function(){return this.getData().DATACOLUMNS[0]},getMaxColumn:function(){return this.getData().DATACOLUMNS[this.getData().dataColumns.length-1]},getTableData:function(){return this.getData().DATA},getSeriesData:function(){return this.getData().SERIESDATA.DATA},getCombinedData:function(){var e=[],t=this.getSeriesData(),n=this.getTableTitle(),r=this.getTableData();t.length>0&&e.push({DESCRIPTION:"Pinned Series",ACTION:this.$class.CLEAR}),e=e.concat(t);var i={DESCRIPTION:n};return e.length==0&&(i.ACTION=this.$class.CLEAR),e.push(i),e=e.concat(r),e},getTableTitle:function(){return this.getInfo().NAME},getInfo:function(){return this.getData().INFO},getChildRows:function(e){var t=[],n=this.getCombinedData();for(var r=e+1;r<n.length&&n[r].LEVEL>n[e].LEVEL;r++)n[r].HAS_DATA&&t.push(r);return t},getChildData:function(e){var t=this.getChildRows(e),n=this.getCombinedData(),r=[];for(i=0;i<t.length;i++)r.push(n[t[i]]);return r},loadTableData:function(){var n=this.facade.retrieveProxy(t.NAME),r=n.getTableParamsString(),i=this;this.isUpdating=!0,this.inCache(r)?(this.setDataFromCache(r),this.processChartData(),this.isUpdating=!1,this.sendNotification(e.TABLEDATA_UPDATED)):$.ajax(encodeURI(this.$class.PROXY_URL+"?method="+this.$class.PROXY_METHOD+"&"+r),{dataType:"json",error:function(){i.sendNotification(e.ERROR)},success:function(t){t.DATA=$.extend(t.DATA,{getRowMetadata:i.$class.getRowMetadata}),t.chartData={},i.setData(r,t),i.createIDMap(),i.processLevels(),i.processChartData("linechart"),i.processChartData("columnchart"),i.processChartData("pin"),i.isUpdating=!1,i.sendNotification(e.TABLEDATA_UPDATED)}})},__classvars__:{PROXY_URL:"dataService/dataService.cfc",PROXY_METHOD:"getPlantData",CLEAR:"clear"}})}),define("js/view/MediatorPlantDataTimeSelection",["js/Facade","js/model/ConfigProxy","js/model/ParameterProxy","js/model/TableDataProxy","js/view/MediatorDualSliderTimeSelection"],function(e,t,n,r,i){return i.$extend({handleNotification:function(i){var s=this.facade.retrieveProxy(n.NAME),o=this.facade.retrieveProxy(r.NAME),u=this.facade.retrieveProxy(t.NAME),a=s.getTimeParams(),f=u.getTopic(s.getTopicId()),l;switch(i.getName()){case e.TABLEDATA_UPDATED:l=o.getDataColumns(),this.getViewComponent().create($.extend({},f,{selectDateRange:!0}),a.freq,l,a.start,a.end);break;default:this.$super(i)}}})}),define("js/view/MediatorPlantDataDataGrid",["js/Facade","js/model/ConfigProxy","js/model/ParameterProxy","js/model/TableDataProxy","js/view/DateCodeUtil","js/view/GridFormatters","js/view/MediatorAggregateDataGrid","datagrid"],function(e,t,n,r,i,s,o,u){return o.$extend({listNotificationInterests:function(){var t=this.$super(),n=$.inArray(e.RSE_PARAM_UPDATED);return n>=0&&t.splice(n,1),t},handleNotification:function(i){switch(i.getName()){case e.TABLEDATA_UPDATED:var s=this.facade.retrieveProxy(r.NAME),o=this.facade.retrieveProxy(n.NAME),u=this.facade.retrieveProxy(t.NAME),a=o.getTimeParams(),f=s.getCombinedData(),l=this.generateColumns(s.getDataColumns(),f,a.freq);this.getViewComponent().update(f,l,{frozenColumn:2,dataItemColumnValueExtractor:function(e,t){var n=t&&t.field?t.field.split("."):[],r=t.field?e:null;for(var i=0;i<n.length;i++){r=r[n[i]];if(!r||typeof r=="undefined")break}return r},scrollToRight:!0,addSpacerColumn:!0},a.start,a.end),this.sendNotification(e.TABLE_RENDERED);break;default:this.$super(i)}},generateColumns:function(e,t,r){var o,a=this.facade.retrieveProxy(n.NAME),f=[{id:"pinKey",field:"HAS_DATA",width:30,displayFormatter:s.pinSeriesFormatter,output:!1,cssClass:"chart_column",iconClass:a.getLinkType(),resizable:!1},{id:"description",name:" ",field:"DESCRIPTION",displayFormatter:s.descriptionFormatter,outputFormatter:this.$class.descriptionOutputFormatter,cssClass:"description",width:400,maxWidth:904},{id:"chart",field:"HAS_DATA",width:30,displayFormatter:s.chartButtonFormatter,output:!1,cssClass:"chart_column",iconClass:a.getChartType(),resizable:!1},{id:"units",name:"units",field:"UNITS",display:!1}];u.autosizeColumn(f,0,t,10);for(o=0;o<e.length;o++){var l=parseInt(e[o]).toString();f.push({id:l,name:i.formatDateCode(l,r),field:"DATA."+l.toString(),dataFormatter:s.numericalDataFormatter,width:100})}return f}})}),define("text!templates/plantDataTableTitle.html",[],function(){return'<div>\r\n	{{#BACKURL}}<a href="./#/{{BACKURL}}">&lt;&nbsp;Return to previous page</a>{{/BACKURL}}\r\n	<br/>\r\n	<strong>Plant name:</strong> {{NAME}} &nbsp;|&nbsp; <strong>Plant code:</strong> {{ID}} &nbsp;|&nbsp; <strong>Operator:</strong> {{UTILITYNAME}} &nbsp;|&nbsp; <strong>Operator code:</strong> {{UTILITYCODE}}\r\n	<br/>\r\n	<strong>State:</strong> {{STATE}} &nbsp;|&nbsp; <strong>Sector:</strong> {{SECTOR}} \r\n	{{#LON}}&nbsp;|&nbsp; <a target="_blank" href="/state/maps.cfm?lon={{LON}}&lat={{LAT}}&initialZoom=144447.638572">View in dynamic map viewer</a>{{/LON}} <!--\r\n	&nbsp;|&nbsp; <a href="/coal/data/browser/#/shipments/plant/{{ID}}{{LINK_ARGS}}">Coal shipments to {{NAME}}</a>-->\r\n</div>'}),define("js/pages/PlantDataPage",["hasher","signals","puremvc","classy","page","js/Facade","js/Controller","js/model/SiteDataConfigProxy","js/model/SiteDataRequestProxy","js/model/SiteDataParameterProxy","js/model/SiteDataTableDataProxy","js/model/HelpTooltipProxy","js/view/VC_PageLayout","js/view/VC_Download","js/view/VC_Visualization","js/view/VC_Selection","js/view/VC_TimeSelection","datagrid","viewStack","js/view/VC_ColumnChart","js/view/VC_LineChart","qTipsHelp","js/view/MediatorDownload","js/view/MediatorVisualization","js/view/MediatorElectricityTopicSelection","js/view/MediatorPlantDataTimeSelection","js/view/MediatorPlantDataDataGrid","js/view/MediatorViewStack","js/view/MediatorLineChart","js/view/MediatorColumnChart","js/view/MediatorHelpTooltip","js/view/MediatorPinKeyVisualization","text!templates/main.html","text!templates/filter_button.html","text!templates/download_button.html","text!templates/plantDataTableTitle.html","text!templates/footnotes.html"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B){var j=null,F=i.$extend({load:function(e){e[0]=1,$("#pagecontent").addClass("plantData"),this.$super(e),i.clearErrorMessage(),j?j.sendNotification(I.RELOAD,e):(j=I.getInstance(this.name),j.sendNotification(I.STARTUP,e))},unload:function(){j.sendNotification(I.UNLOAD),I.removeCore(this.name),j=null,this.$super(),$("#pagecontent").removeClass("plantData")}})("scripts/modules/pages/PlantDataPage"),I=s.$extend({initializeController:function(){this.$super(),this.registerCommand(this.$class.STARTUP,q),this.registerCommand(this.$class.RELOAD,R),this.registerCommand(this.$class.TABLE_PARAMS_UPDATED,o.TableParamsUpdatedCommand),this.registerCommand(this.$class.CHART_PARAMS_UPDATED,o.UpdateChartDataCommand),this.registerCommand(this.$class.TABLE_RENDERED,o.HideLoadMaskCommand),this.registerCommand(this.$class.TABLE_SELECTION_UPDATED,W),this.registerCommand(this.$class.FREQUENCY_SELECTION_UPDATED,o.FrequencySelectionUpdatedCommand),this.registerCommand(this.$class.TOPIC_SELECTION_UPDATED,X),this.registerCommand(this.$class.REPORT_SELECTION_UPDATED,V),this.registerCommand(this.$class.TIME_SELECTION_UPDATED,o.UpdateHashCommand),this.registerCommand(this.$class.CHART_SELECTION_UPDATED,o.UpdateHashCommand),this.registerCommand(this.$class.DEFAULT_CHART_SET,o.UpdateChartedCommand),this.registerCommand(this.$class.CSV_DATA_GENERATED,o.OutputToCSVCommand),this.registerCommand(this.$class.ERROR,o.ErrorCommand),this.registerCommand(this.$class.SOURCE_KEY_SELECTED,o.OpenAPIWindowCommand),this.registerCommand(this.$class.PIN_KEY_SELECTION_UPDATED,o.UpdateHashCommand)},__classvars__:{getInstance:function(e){return n.Facade.hasCore(e)||new I(e),n.Facade.getInstance(e)}}}),q=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(U),this.addSubCommand(z),this.addSubCommand(o.UpdateParameterProxyCommand)}}),R=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.UpdateRequestProxyCommand),this.addSubCommand(o.UpdateParameterProxyCommand)}}),U=n.SimpleCommand.$extend({execute:function(e){var t={id:"csv_table",type:"csv","class":"ico_csv",target:"table",label:"Table (CSV)"},n=new a(e.getBody()),r=new u;r.setDownloadParameters({columnchart:[{label:"Chart",children:[{id:"columnchart_pdf",type:"pdf","class":"ico_pdf",target:"columnchart",label:"PDF"},{id:"columnchart_png",type:"png","class":"ico_img",target:"columnchart",label:"PNG"},{id:"columnchart_svg",type:"svg","class":"ico_img",target:"columnchart",label:"SVG"},{id:"columnchart_embed",type:"embed","class":"ico_embed",target:"columnchart",label:"EMBED"}]},{label:"Data",children:[{id:"columnchart_csv",type:"csv","class":"ico_csv",target:"columnchart",label:"Chart (CSV)"},t]}],linechart:[{label:"Chart",children:[{id:"linechart_pdf",type:"pdf","class":"ico_pdf",target:"linechart",label:"PDF"},{id:"linechart_png",type:"png","class":"ico_img",target:"linechart",label:"PNG"},{id:"linechart_svg",type:"svg","class":"ico_img",target:"linechart",label:"SVG"},{id:"linechart_embed",type:"embed","class":"ico_embed",target:"linechart",label:"EMBED"}]},{label:"Data",children:[{id:"linechart_csv",type:"csv","class":"ico_csv",target:"linechart",label:"Chart (CSV)"},t]}]});var i=d.defaultConfig.items.slice();i.splice(2,1),r.setVisualizations(i),r.setLinkTypes(d.pinKeyConfig.items.slice()),F.$class.requests.length>1&&r.setPreviousPage(F.$class.requests[F.$class.requests.length-2]);var s=new f,o=new l,h=new c;this.facade.registerProxy(n),this.facade.registerProxy(r),this.facade.registerProxy(s),this.facade.registerProxy(o),this.facade.registerProxy(h)}}),z=n.SimpleCommand.$extend({execute:function(){var e=new K,t=new J(e);this.facade.registerMediator(t)}}),W=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.ResetChartedCommand),this.addSubCommand(o.UpdateHashCommand)}}),X=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.ResetStartEndCommand),this.addSubCommand(o.ResetChartedCommand),this.addSubCommand(o.ResetChartindexedCommand),this.addSubCommand(o.UpdateTopicHashCommand)}}),V=n.MacroCommand.$extend({initializeMacroCommand:function(){this.addSubCommand(o.ResetStartEndCommand),this.addSubCommand(o.ResetChartedCommand),this.addSubCommand(o.ResetChartindexedCommand),this.addSubCommand(o.UpdateReportHashCommand)}}),J=n.Mediator.$extend({__init__:function(e){this.$super(this.$class.NAME,e)},onRegister:function(){var e=this.getViewComponent(),t=this.facade.retrieveProxy(u.NAME),n=new p(e.getDownloadContainer()),r=new d(e.getVisualizationContainer(),{items:t.getVisualizations()}),i=new v(e.getTopTopicSelectionContainer(),!0),s=new v(e.getMiddleTopicSelectionContainer(),!1),o=new m(e.getTimeSelectionContainer()),f=new g(e.getTableContainer()),l=new y(e.getChartContainer()),c=new d(e.getPinKeyVisualizationContainer(),{items:t.getLinkTypes()}),h=l.addView("linechart"),_=l.addView("columnchart"),D=new b(_),P=new w(h),H=new E,j=new S(n),F=new x(r),I=new T(i,!0),q=new T(s,!1),R=new N(o),U=new C(f),z=new k(l),W=new L(P),X=new A(D),V=new O(H),J=new M(c);this.facade.registerMediator(V),this.facade.registerMediator(j),this.facade.registerMediator(F),this.facade.registerMediator(q),this.facade.registerMediator(I),this.facade.registerMediator(R),this.facade.registerMediator(z),this.facade.registerMediator(U),this.facade.registerMediator(W),this.facade.registerMediator(X),this.facade.registerMediator(J);var K=this.facade.retrieveProxy(a.NAME);this.getViewComponent().getFootnoteContainer().empty().html(Mustache.to_html(B,{rseAvailable:!1,topic:K.getTopicId(),showFilterValues:!1,showDetail:!0})),$("a.lightbox",this.getViewComponent().getFootnoteContainer()).fancybox({autoDimensions:!1,autoScale:!1,width:900,height:600,scrolling:"auto",type:"ajax",autoSize:"false"})},listNotificationInterests:function(){return this.$super().concat([I.TABLEDATA_UPDATED,I.TABLE_RENDERED])},handleNotification:function(e){var t=this.getViewComponent();switch(e.getName()){case I.TABLEDATA_UPDATED:var n=this.facade.retrieveProxy(l.NAME),r=this.facade.retrieveProxy(u.NAME),i=this.facade.retrieveProxy(f.NAME),s=r.getPreviousPage();t.getTitleContainer().empty(),t.getTitleContainer().css("display","block");var o=i.getQueryString(),a=$.extend(n.getInfo(),{BACKURL:s?s.request_:i.getFullTopicPath({},i.getTopicId()),LINK_ARGS:o});t.getTitleContainer().append(Mustache.to_html(H,a)),window.document.title="Electricity data browser - "+n.getTableTitle();break;case I.TABLE_RENDERED:t.getMiddleTopicSelectionContainer().is(":hidden")&&t.getMiddleTopicSelectionContainer().slideDown(1500);break;default:this.$super(e)}},__classvars__:{NAME:"PageMediator"}}),K=h.$extend({__init__:function(){this.$super($("#pagecontent"),{mainFilterButtonOpts:{disabled:!0,selected:!1,id:"main_filter_button"},overlayFilterButtonOpts:{selected:!0,id:"overlay_filter_button"},mainVisualizationButtonOpts:{selected:!1,id:"main_visualization_button"},overlayVisualizationButtonOpts:{selected:!0,id:"overlay_visualization_button"},mainDownloadButtonOpts:{selected:!1,id:"main_download_button"},overlayDownloadButtonOpts:{selected:!0,id:"overlay_download_button"}})}});return F}),define("js/routes",["js/pages/AggregateDataPage","js/pages/PlantListPage","js/pages/PlantDataPage"],{defaultHash:"topic/0",patterns:[{pattern:/topic\/(\d{1,2})\/?(\?.*)?/,moduleURI:"js/pages/AggregateDataPage",rules:{0:[0,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,56,57]}},{pattern:/topic\/(\d{1,2})\/?(\?.*)?/,moduleURI:"js/pages/PlantListPage",rules:{0:[1]}},{pattern:/plant\/()(\d+)\/?(\?.*)?/,moduleURI:"js/pages/PlantDataPage"}]}),define("js/router",["js/routes","crossroads","hasher","page"],function(e,t,n,r){function o(e,t){if(e.indexOf)return e.indexOf(t);var n=e.length;while(n--)if(e[n]===t)return n;return-1}function u(e){var t=(e||"").replace("?","").split("&"),n=t.length,r={},i,s;while(n--)t[n]=t[n].split("="),i=t[n][1],r[t[n][0]]=i;return r}function a(e,t){function s(t,i){if(t)if(typeof t=="object"){var o={};$.extend(o,t,r.query),r.query=o}else typeof t=="function"?s(t.call(n,e,r),i):r[i]==void 0&&(r[i]=t)}var n=this,r={query:{}},i;for(i in t)t.hasOwnProperty(i)&&t[i]!==void 0&&(r[i]=t[i],(i=="query"||typeof t[i]=="string"&&t[i].indexOf("?")==0)&&$.extend(r.query,u(t[i])));if(n.defaults)for(i in t)t.hasOwnProperty(i)&&s(n.defaults[i],i);return[r]}function f(e){var t,n,r;if(t=e.rules)for(n in t)t.hasOwnProperty(n)&&n!="normalize_"&&(r=t[n],t[n]=function(t){return function(n,r,i){var u=!0;return t instanceof RegExp?u=t.test(n):t instanceof Array?u=o(t,n)!==-1:t instanceof Function&&(u=t(n,r,i)),!u&&e.defaultHash&&(s=e.defaultHash),u}}(r));else t=e.rules={};return t.normalize_=function(t,n){return a.call(e,t,n)},e}function l(e,t){typeof console!="undefined"&&typeof console.log=="function"&&console.log(e)}function c(n){var r;if(s){if(s==n)throw"Bad redirect hash: "+s;r=s,s=null,t.parse(r)}else t.parse(e.defaultHash)}function h(){var e=arguments;try{require([this.moduleURI],function(t){var n;i!=t&&p();try{t.load.apply(t,e)}catch(s){if(location.host.indexOf("wwwdev")!=-1||location.host.indexOf("vdc")!=-1)throw s;r.errorHandler({module:t.toString(),route:e[0],error:s.name+" "+s.message,stack:s.stack})}i=t})}catch(t){if(location.host.indexOf("wwwdev")!=-1||location.host.indexOf("vdc")!=-1)throw t;r.errorHandler({module:this.moduleURI,route:e[0],error:t.name+" "+t.message,stack:t.stack})}}function p(){i&&(i.unload(),i=null)}function d(e,n,r){var i=t.addRoute(e);r&&(i.rules=r),i.matched.add(h,{moduleURI:n})}function v(){var r,i;for(r=0;r<e.patterns.length;r++)i=f(e.patterns[r]),d(i.pattern,i.moduleURI,i.rules);t.routed.add(l),t.bypassed.add(c),t.shouldTypecast=!0,n.initialized.add(t.parse,t),n.changed.add(t.parse,t),n.init(),n.getHash()==""&&t.parse(e.defaultHash)}var i=null,s;return{init:v}}),require(["js/router","page"],function(e,t){t.showLoadMask(),$(e.init)}),define("js/main",function(){})